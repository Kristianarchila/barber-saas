
> backend@1.0.0 test
> jest --runInBand --detectOpenHandles

node.exe : (node:25328) [MONGOOSE] Warning: Duplicate schema index on 
{"reviewToken":1} found. This is often due to declaring an index using both 
"index: true" and "schema.index()". Please remove the duplicate index definition.
En línea: 1 Carácter: 1
+ & "C:\Program Files\nodejs/node.exe" "C:\Program Files\nodejs/node_mo ...
+ ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : NotSpecified: ((node:25328) [M...dex definition.:S 
   tring) [], RemoteException
    + FullyQualifiedErrorId : NativeCommandError
 
(Use `node --trace-warnings ...` to show where the warning was created)
(node:25328) [MONGOOSE] Warning: Duplicate schema index on {"reviewToken":1} 
found. This is often due to declaring an index using both "index: true" and 
"schema.index()". Please remove the duplicate index definition.
[0mGET /api/reservas/698bdc29087386dd6aa11d7b [33m404[0m 20.298 ms - 35[0m
[0mPATCH /api/reservas/698bdc2a087386dd6aa11da9/completar [33m404[0m 14.731 ms - 727[0m
[0mPATCH /api/reservas/698bdc2a087386dd6aa11dd7/cancelar [33m404[0m 9.098 ms - 718[0m
[0mGET /api/reservas [32m200[0m 20.413 ms - 243[0m
[0mGET /api/barberias/test-barberia-b/admin/servicios [33m400[0m 0.441 ms - 51[0m
[0mPOST /api/barberias/test-barberia-b/admin/servicios [33m400[0m 1.092 ms - 51[0m
[0mPUT /api/barberias/test-barberia-b/admin/servicios/698bdc2b087386dd6aa11e89 [33m400[0m 0.677 ms - 51[0m
[0mGET /api/barberias/test-barberia-b/barbero [33m404[0m 5.792 ms - 37[0m
[0mPOST /api/barberias/test-barberia-b/barbero [33m404[0m 6.495 ms - 37[0m
[0mGET /api/barberias/test-barberia-b/admin/servicios [33m400[0m 0.312 ms - 51[0m
[0mGET /api/barberias/slug-inexistente/admin/servicios [33m400[0m 0.409 ms - 51[0m
[0mGET /api/reservas?barberiaId=698bdc2d087386dd6aa11f5d [32m200[0m 12.376 ms - 243[0m
[0mPOST /api/barberias/test-barberia-a/admin/servicios [33m400[0m 0.615 ms - 51[0m
[0mGET /api/reservas/698bdc2e087386dd6aa11fc7 [32m200[0m 11.233 ms - 218[0m
[0mGET /api/barberias/test-barberia-a/admin/servicios [33m400[0m 0.238 ms - 51[0m
[0mGET /api/barberias/test-barberia-b/admin/servicios [33m400[0m 0.245 ms - 51[0m
[0mGET /api/barberias/test-barberia-b/admin/servicios [33m400[0m 0.326 ms - 51[0m
[0mGET /api/barberias/test-barberia-a/admin/servicios [33m400[0m 0.208 ms - 51[0m
[0mGET /api/barberias/test-barberia-b/admin/servicios [33m400[0m 0.229 ms - 51[0m
FAIL tests/multi-tenant-security.test.js (11.972 s)
  ÔùÅ Console

    console.log
      [dotenv@17.2.3] injecting env (13) from .env -- tip: ÔÜÖ´©Å  write to 
custom object with { processEnv: myObject }

      at _log (node_modules/dotenv/lib/main.js:142:11)

    console.log
      ­ƒôí [GET] /api/reservas/698bdc29087386dd6aa11d7b

      at log (src/app.js:93:11)

    console.log
      ­ƒôí [PATCH] /api/reservas/698bdc2a087386dd6aa11da9/completar

      at log (src/app.js:93:11)

    console.log
      [Transaction] Started: CompleteReservation (attempt 1/3)

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:54:25)

    console.log
      [Transaction] Aborted: CompleteReservation

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:69:29)

    console.error
      [Transaction] Failed: CompleteReservation {
        error: 'Reserva no encontrada',
        attempt: 1,
        stack: 'Error: Reserva no encontrada\n' +
          '    at TransactionManager.executeInTransaction.operationName (C:\\User
s\\Kristian\\Desktop\\barber-saas\\backend\\src\\application\\use-cases\\reservas
\\CompleteReserva.js:30:35)\n' +
          '    at processTicksAndRejections 
(node:internal/process/task_queues:105:5)\n' +
          '    at Function.executeInTransaction (C:\\Users\\Kristian\\Desktop\\ba
rber-saas\\backend\\src\\utils\\TransactionManager.js:57:32)\n' +
          '    at CompleteReserva.execute (C:\\Users\\Kristian\\Desktop\\barber-s
aas\\backend\\src\\application\\use-cases\\reservas\\CompleteReserva.js:24:24)\n'
 +
          '    at Object.<anonymous>.exports.completarReserva (C:\\Users\\Kristia
n\\Desktop\\barber-saas\\backend\\src\\controllers\\reservas.controller.js:92:25)
'
      }

    [0m [90m 80 |[39m
     [90m 81 |[39m                 [90m// Non-transient error or max retries 
reached[39m
    [31m[1m>[22m[39m[90m 82 |[39m                 
console[33m.[39merror([32m`[Transaction] Failed: 
${operationName}`[39m[33m,[39m {
     [90m    |[39m                         [31m[1m^[22m[39m
     [90m 83 |[39m                     error[33m:[39m 
error[33m.[39mmessage[33m,[39m
     [90m 84 |[39m                     attempt[33m:[39m attempt [33m+[39m 
[35m1[39m[33m,[39m
     [90m 85 |[39m                     stack[33m:[39m 
error[33m.[39mstack[0m

      at Function.error [as executeInTransaction] 
(src/utils/TransactionManager.js:82:25)
      at CompleteReserva.execute 
(src/application/use-cases/reservas/CompleteReserva.js:24:24)
      at Object.<anonymous>.exports.completarReserva 
(src/controllers/reservas.controller.js:92:25)

    console.error
      ƒö┤ ERROR: TransactionError: Transaction failed for CompleteReservation: 
Reserva no encontrada
          at Function.executeInTransaction (C:\Users\Kristian\Desktop\barber-saas
\backend\src\utils\TransactionManager.js:88:42)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at CompleteReserva.execute (C:\Users\Kristian\Desktop\barber-saas\backe
nd\src\application\use-cases\reservas\CompleteReserva.js:24:24)
          at Object.<anonymous>.exports.completarReserva (C:\Users\Kristian\Deskt
op\barber-saas\backend\src\controllers\reservas.controller.js:92:25) {
        isTransactionError: true,
        originalError: Error: Reserva no encontrada
            at TransactionManager.executeInTransaction.operationName (C:\Users\Kr
istian\Desktop\barber-saas\backend\src\application\use-cases\reservas\CompleteRes
erva.js:30:35)
            at processTicksAndRejections 
(node:internal/process/task_queues:105:5)
            at Function.executeInTransaction (C:\Users\Kristian\Desktop\barber-sa
as\backend\src\utils\TransactionManager.js:57:32)
            at CompleteReserva.execute (C:\Users\Kristian\Desktop\barber-saas\bac
kend\src\application\use-cases\reservas\CompleteReserva.js:24:24)
            at Object.<anonymous>.exports.completarReserva (C:\Users\Kristian\Des
ktop\barber-saas\backend\src\controllers\reservas.controller.js:92:25) {
          statusCode: 404
        },
        context: { operationName: 'CompleteReservation', attempt: 1 },
        timestamp: 2026-02-11T01:32:26.163Z,
        originalStack: 'Error: Reserva no encontrada\n' +
          '    at TransactionManager.executeInTransaction.operationName (C:\\User
s\\Kristian\\Desktop\\barber-saas\\backend\\src\\application\\use-cases\\reservas
\\CompleteReserva.js:30:35)\n' +
          '    at processTicksAndRejections 
(node:internal/process/task_queues:105:5)\n' +
          '    at Function.executeInTransaction (C:\\Users\\Kristian\\Desktop\\ba
rber-saas\\backend\\src\\utils\\TransactionManager.js:57:32)\n' +
          '    at CompleteReserva.execute (C:\\Users\\Kristian\\Desktop\\barber-s
aas\\backend\\src\\application\\use-cases\\reservas\\CompleteReserva.js:24:24)\n'
 +
          '    at Object.<anonymous>.exports.completarReserva (C:\\Users\\Kristia
n\\Desktop\\barber-saas\\backend\\src\\controllers\\reservas.controller.js:92:25)
',
        statusCode: 404
      }

    [0m [90m 4 |[39m
     [90m 5 |[39m [36mconst[39m errorHandler [33m=[39m (err[33m,[39m 
req[33m,[39m res[33m,[39m next) [33m=>[39m {
    [31m[1m>[22m[39m[90m 6 |[39m   console[33m.[39merror([32m"ƒö┤ 
ERROR:"[39m[33m,[39m err)[33m;[39m
     [90m   |[39m           [31m[1m^[22m[39m
     [90m 7 |[39m
     [90m 8 |[39m   [90m// ­ƒöÑ A├æADIR HEADERS CORS SI NO EXISTEN[39m
     [90m 9 |[39m   [36mconst[39m origin [33m=[39m 
req[33m.[39mheaders[33m.[39morigin[33m;[39m[0m

      at error (src/config/middleware/errorHandler.js:6:11)
      at Layer.handleError (node_modules/router/lib/layer.js:116:17)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at node_modules/router/index.js:688:15
      at next (node_modules/router/index.js:276:14)
      at next (node_modules/router/lib/route.js:132:14)
      at next (src/controllers/reservas.controller.js:102:9)

    console.log
      ­ƒôí [PATCH] /api/reservas/698bdc2a087386dd6aa11dd7/cancelar

      at log (src/app.js:93:11)

    console.log
      [Transaction] Started: CancelReservation (attempt 1/3)

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:54:25)

    console.log
      [Transaction] Aborted: CancelReservation

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:69:29)

    console.error
      [Transaction] Failed: CancelReservation {
        error: 'Reserva no encontrada',
        attempt: 1,
        stack: 'Error: Reserva no encontrada\n' +
          '    at TransactionManager.executeInTransaction.operationName (C:\\User
s\\Kristian\\Desktop\\barber-saas\\backend\\src\\application\\use-cases\\reservas
\\CancelReserva.js:28:35)\n' +
          '    at processTicksAndRejections 
(node:internal/process/task_queues:105:5)\n' +
          '    at Function.executeInTransaction (C:\\Users\\Kristian\\Desktop\\ba
rber-saas\\backend\\src\\utils\\TransactionManager.js:57:32)\n' +
          '    at CancelReserva.execute (C:\\Users\\Kristian\\Desktop\\barber-saa
s\\backend\\src\\application\\use-cases\\reservas\\CancelReserva.js:22:25)\n' +
          '    at Object.<anonymous>.exports.cancelarReserva (C:\\Users\\Kristian
\\Desktop\\barber-saas\\backend\\src\\controllers\\reservas.controller.js:45:25)'
      }

    [0m [90m 80 |[39m
     [90m 81 |[39m                 [90m// Non-transient error or max retries 
reached[39m
    [31m[1m>[22m[39m[90m 82 |[39m                 
console[33m.[39merror([32m`[Transaction] Failed: 
${operationName}`[39m[33m,[39m {
     [90m    |[39m                         [31m[1m^[22m[39m
     [90m 83 |[39m                     error[33m:[39m 
error[33m.[39mmessage[33m,[39m
     [90m 84 |[39m                     attempt[33m:[39m attempt [33m+[39m 
[35m1[39m[33m,[39m
     [90m 85 |[39m                     stack[33m:[39m 
error[33m.[39mstack[0m

      at Function.error [as executeInTransaction] 
(src/utils/TransactionManager.js:82:25)
      at CancelReserva.execute 
(src/application/use-cases/reservas/CancelReserva.js:22:25)
      at Object.<anonymous>.exports.cancelarReserva 
(src/controllers/reservas.controller.js:45:25)

    console.error
      ƒö┤ ERROR: TransactionError: Transaction failed for CancelReservation: 
Reserva no encontrada
          at Function.executeInTransaction (C:\Users\Kristian\Desktop\barber-saas
\backend\src\utils\TransactionManager.js:88:42)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at CancelReserva.execute (C:\Users\Kristian\Desktop\barber-saas\backend
\src\application\use-cases\reservas\CancelReserva.js:22:25)
          at Object.<anonymous>.exports.cancelarReserva (C:\Users\Kristian\Deskto
p\barber-saas\backend\src\controllers\reservas.controller.js:45:25) {
        isTransactionError: true,
        originalError: Error: Reserva no encontrada
            at TransactionManager.executeInTransaction.operationName (C:\Users\Kr
istian\Desktop\barber-saas\backend\src\application\use-cases\reservas\CancelReser
va.js:28:35)
            at processTicksAndRejections 
(node:internal/process/task_queues:105:5)
            at Function.executeInTransaction (C:\Users\Kristian\Desktop\barber-sa
as\backend\src\utils\TransactionManager.js:57:32)
            at CancelReserva.execute (C:\Users\Kristian\Desktop\barber-saas\backe
nd\src\application\use-cases\reservas\CancelReserva.js:22:25)
            at Object.<anonymous>.exports.cancelarReserva (C:\Users\Kristian\Desk
top\barber-saas\backend\src\controllers\reservas.controller.js:45:25) {
          statusCode: 404
        },
        context: { operationName: 'CancelReservation', attempt: 1 },
        timestamp: 2026-02-11T01:32:26.528Z,
        originalStack: 'Error: Reserva no encontrada\n' +
          '    at TransactionManager.executeInTransaction.operationName (C:\\User
s\\Kristian\\Desktop\\barber-saas\\backend\\src\\application\\use-cases\\reservas
\\CancelReserva.js:28:35)\n' +
          '    at processTicksAndRejections 
(node:internal/process/task_queues:105:5)\n' +
          '    at Function.executeInTransaction (C:\\Users\\Kristian\\Desktop\\ba
rber-saas\\backend\\src\\utils\\TransactionManager.js:57:32)\n' +
          '    at CancelReserva.execute (C:\\Users\\Kristian\\Desktop\\barber-saa
s\\backend\\src\\application\\use-cases\\reservas\\CancelReserva.js:22:25)\n' +
          '    at Object.<anonymous>.exports.cancelarReserva (C:\\Users\\Kristian
\\Desktop\\barber-saas\\backend\\src\\controllers\\reservas.controller.js:45:25)'
,
        statusCode: 404
      }

    [0m [90m 4 |[39m
     [90m 5 |[39m [36mconst[39m errorHandler [33m=[39m (err[33m,[39m 
req[33m,[39m res[33m,[39m next) [33m=>[39m {
    [31m[1m>[22m[39m[90m 6 |[39m   console[33m.[39merror([32m"ƒö┤ 
ERROR:"[39m[33m,[39m err)[33m;[39m
     [90m   |[39m           [31m[1m^[22m[39m
     [90m 7 |[39m
     [90m 8 |[39m   [90m// ­ƒöÑ A├æADIR HEADERS CORS SI NO EXISTEN[39m
     [90m 9 |[39m   [36mconst[39m origin [33m=[39m 
req[33m.[39mheaders[33m.[39morigin[33m;[39m[0m

      at error (src/config/middleware/errorHandler.js:6:11)
      at Layer.handleError (node_modules/router/lib/layer.js:116:17)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at node_modules/router/index.js:688:15
      at next (node_modules/router/index.js:276:14)
      at next (node_modules/router/lib/route.js:132:14)
      at next (src/controllers/reservas.controller.js:57:9)

    console.log
      ­ƒôí [GET] /api/reservas

      at log (src/app.js:93:11)

    console.log
      ­ƒôí [GET] /api/barberias/test-barberia-b/admin/servicios

      at log (src/app.js:93:11)

    console.log
      ­ƒôí [POST] /api/barberias/test-barberia-b/admin/servicios

      at log (src/app.js:93:11)

    console.log
      ƒôí [PUT] 
/api/barberias/test-barberia-b/admin/servicios/698bdc2b087386dd6aa11e89

      at log (src/app.js:93:11)

    console.log
      ­ƒôí [GET] /api/barberias/test-barberia-b/barbero

      at log (src/app.js:93:11)

    console.log
      ­ƒôí [POST] /api/barberias/test-barberia-b/barbero

      at log (src/app.js:93:11)

    console.log
      ­ƒôí [GET] /api/barberias/test-barberia-b/admin/servicios

      at log (src/app.js:93:11)

    console.log
      ­ƒôí [GET] /api/barberias/slug-inexistente/admin/servicios

      at log (src/app.js:93:11)

    console.log
      ­ƒôí [GET] /api/reservas?barberiaId=698bdc2d087386dd6aa11f5d

      at log (src/app.js:93:11)

    console.log
      ­ƒôí [POST] /api/barberias/test-barberia-a/admin/servicios

      at log (src/app.js:93:11)

    console.log
      ­ƒôí [GET] /api/reservas/698bdc2e087386dd6aa11fc7

      at log (src/app.js:93:11)

    console.log
      ­ƒôí [GET] /api/barberias/test-barberia-a/admin/servicios

      at log (src/app.js:93:11)

    console.log
      ­ƒôí [GET] /api/barberias/test-barberia-b/admin/servicios

      at log (src/app.js:93:11)

    console.log
      ­ƒôí [GET] /api/barberias/test-barberia-b/admin/servicios

      at log (src/app.js:93:11)

    console.log
      ­ƒôí [GET] /api/barberias/test-barberia-a/admin/servicios

      at log (src/app.js:93:11)

    console.log
      ­ƒôí [GET] /api/barberias/test-barberia-b/admin/servicios

      at log (src/app.js:93:11)

  ÔùÅ ƒöÉ Multi-Tenant Security Tests ÔÇ║ ƒÜ½ Servicios - Cross-Tenant Access 
Prevention ÔÇ║ Admin A NO puede acceder a servicios de Barber├¡a B v├¡a slug

    expect(received).toBe(expected) // Object.is equality

    Expected: 403
    Received: 400

    [0m [90m 182 |[39m                 
[33m.[39m[36mset[39m([32m'Authorization'[39m[33m,[39m [32m`Bearer 
${tokenAdminA}`[39m)[33m;[39m
     [90m 183 |[39m
    [31m[1m>[22m[39m[90m 184 |[39m             
expect(res[33m.[39mstatus)[33m.[39mtoBe([35m403[39m)[33m;[39m
     [90m     |[39m                                [31m[1m^[22m[39m
     [90m 185 |[39m             expect(res[33m.[39mbody[33m.[39mmessage)[3
3m.[39mtoContain([32m'permiso'[39m)[33m;[39m
     [90m 186 |[39m         })[33m;[39m
     [90m 187 |[39m[0m

      at Object.toBe (tests/multi-tenant-security.test.js:184:32)

  ÔùÅ ƒöÉ Multi-Tenant Security Tests ÔÇ║ ƒÜ½ Servicios - Cross-Tenant Access 
Prevention ÔÇ║ Admin A NO puede crear servicio en Barber├¡a B

    expect(received).toBe(expected) // Object.is equality

    Expected: 403
    Received: 400

    [0m [90m 196 |[39m                 })[33m;[39m
     [90m 197 |[39m
    [31m[1m>[22m[39m[90m 198 |[39m             
expect(res[33m.[39mstatus)[33m.[39mtoBe([35m403[39m)[33m;[39m
     [90m     |[39m                                [31m[1m^[22m[39m
     [90m 199 |[39m         })[33m;[39m
     [90m 200 |[39m
     [90m 201 |[39m         it([32m'Admin A NO puede editar servicio de 
Barber├¡a B'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.toBe (tests/multi-tenant-security.test.js:198:32)

  ÔùÅ ƒöÉ Multi-Tenant Security Tests ÔÇ║ ƒÜ½ Servicios - Cross-Tenant Access 
Prevention ÔÇ║ Admin A NO puede editar servicio de Barber├¡a B

    expect(received).toBe(expected) // Object.is equality

    Expected: 403
    Received: 400

    [0m [90m 208 |[39m                 })[33m;[39m
     [90m 209 |[39m
    [31m[1m>[22m[39m[90m 210 |[39m             
expect(res[33m.[39mstatus)[33m.[39mtoBe([35m403[39m)[33m;[39m
     [90m     |[39m                                [31m[1m^[22m[39m
     [90m 211 |[39m         })[33m;[39m
     [90m 212 |[39m     })[33m;[39m
     [90m 213 |[39m[0m

      at Object.toBe (tests/multi-tenant-security.test.js:210:32)

  ÔùÅ ƒöÉ Multi-Tenant Security Tests ÔÇ║ ƒÜ½ Barberos - Cross-Tenant Access 
Prevention ÔÇ║ Admin A NO puede ver barberos de Barber├¡a B

    expect(received).toBe(expected) // Object.is equality

    Expected: 403
    Received: 404

    [0m [90m 218 |[39m                 
[33m.[39m[36mset[39m([32m'Authorization'[39m[33m,[39m [32m`Bearer 
${tokenAdminA}`[39m)[33m;[39m
     [90m 219 |[39m
    [31m[1m>[22m[39m[90m 220 |[39m             
expect(res[33m.[39mstatus)[33m.[39mtoBe([35m403[39m)[33m;[39m
     [90m     |[39m                                [31m[1m^[22m[39m
     [90m 221 |[39m         })[33m;[39m
     [90m 222 |[39m
     [90m 223 |[39m         it([32m'Admin A NO puede crear barbero en 
Barber├¡a B'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.toBe (tests/multi-tenant-security.test.js:220:32)

  ÔùÅ ƒöÉ Multi-Tenant Security Tests ÔÇ║ ƒÜ½ Barberos - Cross-Tenant Access 
Prevention ÔÇ║ Admin A NO puede crear barbero en Barber├¡a B

    expect(received).toBe(expected) // Object.is equality

    Expected: 403
    Received: 404

    [0m [90m 230 |[39m                 })[33m;[39m
     [90m 231 |[39m
    [31m[1m>[22m[39m[90m 232 |[39m             
expect(res[33m.[39mstatus)[33m.[39mtoBe([35m403[39m)[33m;[39m
     [90m     |[39m                                [31m[1m^[22m[39m
     [90m 233 |[39m         })[33m;[39m
     [90m 234 |[39m     })[33m;[39m
     [90m 235 |[39m[0m

      at Object.toBe (tests/multi-tenant-security.test.js:232:32)

  ÔùÅ ƒöÉ Multi-Tenant Security Tests ÔÇ║ ƒöÆ URL Slug Manipulation Attempts ÔÇ║ 
Rechaza intento de acceder con slug incorrecto

    expect(received).toBe(expected) // Object.is equality

    Expected: 403
    Received: 400

    [0m [90m 240 |[39m                 
[33m.[39m[36mset[39m([32m'Authorization'[39m[33m,[39m [32m`Bearer 
${tokenAdminA}`[39m)[33m;[39m
     [90m 241 |[39m
    [31m[1m>[22m[39m[90m 242 |[39m             
expect(res[33m.[39mstatus)[33m.[39mtoBe([35m403[39m)[33m;[39m
     [90m     |[39m                                [31m[1m^[22m[39m
     [90m 243 |[39m             expect(res[33m.[39mbody[33m.[39mmessage)[3
3m.[39mtoMatch([35m/permiso|barber├¡a/i[39m)[33m;[39m
     [90m 244 |[39m         })[33m;[39m
     [90m 245 |[39m[0m

      at Object.toBe (tests/multi-tenant-security.test.js:242:32)

  ÔùÅ ƒöÉ Multi-Tenant Security Tests ÔÇ║ ƒöÆ URL Slug Manipulation Attempts ÔÇ║ 
Rechaza slug inexistente

    expect(received).toBe(expected) // Object.is equality

    Expected: 404
    Received: 400

    [0m [90m 249 |[39m                 
[33m.[39m[36mset[39m([32m'Authorization'[39m[33m,[39m [32m`Bearer 
${tokenAdminA}`[39m)[33m;[39m
     [90m 250 |[39m
    [31m[1m>[22m[39m[90m 251 |[39m             
expect(res[33m.[39mstatus)[33m.[39mtoBe([35m404[39m)[33m;[39m
     [90m     |[39m                                [31m[1m^[22m[39m
     [90m 252 |[39m             expect(res[33m.[39mbody[33m.[39mmessage)[3
3m.[39mtoMatch([35m/barber├¡a.*encontrada/i[39m)[33m;[39m
     [90m 253 |[39m         })[33m;[39m
     [90m 254 |[39m     })[33m;[39m[0m

      at Object.toBe (tests/multi-tenant-security.test.js:251:32)

  ÔùÅ ƒöÉ Multi-Tenant Security Tests ÔÇ║ ƒöÆ Query Parameter Injection 
Prevention ÔÇ║ Ignora barberiaId inyectado en request body

    expect(received).toBe(expected) // Object.is equality

    Expected: 201
    Received: 400

    [0m [90m 280 |[39m                 })[33m;[39m
     [90m 281 |[39m
    [31m[1m>[22m[39m[90m 282 |[39m             
expect(res[33m.[39mstatus)[33m.[39mtoBe([35m201[39m)[33m;[39m
     [90m     |[39m                                [31m[1m^[22m[39m
     [90m 283 |[39m
     [90m 284 |[39m             [90m// Verificar que se cre├│ con barberiaId 
correcto[39m
     [90m 285 |[39m             [90m// Use .id from hexagonal entity[39m[0m

      at Object.toBe (tests/multi-tenant-security.test.js:282:32)

  ÔùÅ ƒöÉ Multi-Tenant Security Tests ÔÇ║ Ô£à Legitimate Access Allowed ÔÇ║ 
Admin A puede acceder a sus servicios

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 400

    [0m [90m 305 |[39m                 
[33m.[39m[36mset[39m([32m'Authorization'[39m[33m,[39m [32m`Bearer 
${tokenAdminA}`[39m)[33m;[39m
     [90m 306 |[39m
    [31m[1m>[22m[39m[90m 307 |[39m             
expect(res[33m.[39mstatus)[33m.[39mtoBe([35m200[39m)[33m;[39m
     [90m     |[39m                                [31m[1m^[22m[39m
     [90m 308 |[39m             
expect(res[33m.[39mbody[33m.[39mservicios)[33m.[39mtoBeDefined()[33m;[39m
     [90m 309 |[39m             expect([33mArray[39m[33m.[39misArray(res[3
3m.[39mbody[33m.[39mservicios))[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m 310 |[39m         })[33m;[39m[0m

      at Object.toBe (tests/multi-tenant-security.test.js:307:32)

  ÔùÅ ƒöÉ Multi-Tenant Security Tests ÔÇ║ Ô£à Legitimate Access Allowed ÔÇ║ 
Admin B puede acceder a sus propios datos

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 400

    [0m [90m 315 |[39m                 
[33m.[39m[36mset[39m([32m'Authorization'[39m[33m,[39m [32m`Bearer 
${tokenAdminB}`[39m)[33m;[39m
     [90m 316 |[39m
    [31m[1m>[22m[39m[90m 317 |[39m             
expect(res[33m.[39mstatus)[33m.[39mtoBe([35m200[39m)[33m;[39m
     [90m     |[39m                                [31m[1m^[22m[39m
     [90m 318 |[39m         })[33m;[39m
     [90m 319 |[39m     })[33m;[39m
     [90m 320 |[39m[0m

      at Object.toBe (tests/multi-tenant-security.test.js:317:32)

  ÔùÅ ƒöÉ Multi-Tenant Security Tests ÔÇ║ ƒöì Logging and Monitoring ÔÇ║ Loguea 
intentos de acceso cross-tenant

    expect(received).toBe(expected) // Object.is equality

    Expected: 403
    Received: 400

    [0m [90m 327 |[39m                 
[33m.[39m[36mset[39m([32m'Authorization'[39m[33m,[39m [32m`Bearer 
${tokenAdminA}`[39m)[33m;[39m
     [90m 328 |[39m
    [31m[1m>[22m[39m[90m 329 |[39m             
expect(res[33m.[39mstatus)[33m.[39mtoBe([35m403[39m)[33m;[39m
     [90m     |[39m                                [31m[1m^[22m[39m
     [90m 330 |[39m             [90m// En producci├│n, verificar├¡amos que se 
gener├│ un log de warning[39m
     [90m 331 |[39m         })[33m;[39m
     [90m 332 |[39m     })[33m;[39m[0m

      at Object.toBe (tests/multi-tenant-security.test.js:329:32)

  ÔùÅ ƒöÉ Multi-Tenant Security Tests ÔÇ║ ƒææ SUPERADMIN Access ÔÇ║ SUPERADMIN 
puede acceder a cualquier barber├¡a

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 400

    [0m [90m 356 |[39m                 
[33m.[39m[36mset[39m([32m'Authorization'[39m[33m,[39m [32m`Bearer 
${tokenSuperAdmin}`[39m)[33m;[39m
     [90m 357 |[39m
    [31m[1m>[22m[39m[90m 358 |[39m             
expect(resA[33m.[39mstatus)[33m.[39mtoBe([35m200[39m)[33m;[39m
     [90m     |[39m                                 [31m[1m^[22m[39m
     [90m 359 |[39m             
expect(resB[33m.[39mstatus)[33m.[39mtoBe([35m200[39m)[33m;[39m
     [90m 360 |[39m             expect(resA[33m.[39mbody[33m.[39mservicios)
[33m.[39mtoBeDefined()[33m;[39m
     [90m 361 |[39m             expect(resB[33m.[39mbody[33m.[39mservicios)
[33m.[39mtoBeDefined()[33m;[39m[0m

      at Object.toBe (tests/multi-tenant-security.test.js:358:33)

(node:25328) [MONGOOSE] Warning: Duplicate schema index on {"reviewToken":1} 
found. This is often due to declaring an index using both "index: true" and 
"schema.index()". Please remove the duplicate index definition.
(node:25328) [MONGOOSE] Warning: Duplicate schema index on {"reviewToken":1} 
found. This is often due to declaring an index using both "index: true" and 
"schema.index()". Please remove the duplicate index definition.
[0mPOST /api/public/barberias/barberia-test/resenas?reviewToken=2043b6577f8bc507585aac0139efe1d95128fba511810d7efa772f3c896a3b60 [32m201[0m 27.675 ms - 646[0m
[0mPOST /api/public/barberias/barberia-test/resenas [33m404[0m 6.061 ms - 51[0m
[0mPOST /api/public/barberias/barberia-test/resenas?reviewToken=invalid-token [33m404[0m 6.119 ms - 51[0m
[0mPOST /api/public/barberias/barberia-test/resenas?reviewToken=0b799b1099a4444e8a4f04ecc2478d4a7f902d67c438bccb833a901a8cd72e75 [32m201[0m 12.848 ms - 611[0m
[0mPOST /api/public/barberia-test/resenas?reviewToken=0b799b1099a4444e8a4f04ecc2478d4a7f902d67c438bccb833a901a8cd72e75 [33m404[0m 1.993 ms - 172[0m
[0mPOST /api/public/barberia-test/resenas?reviewToken=0ea24c3708d55b2171373b547ca3a320a7d20c9206900f3def869b419169ec3d [33m404[0m 0.964 ms - 172[0m
[0mGET /api/public/barberias/barberia-test/resenas/validar-token?reviewToken=b1537f7e98b777170dd91cd91efd76e2711e27f2b7b371f2e0de3de4a5df3279 [32m200[0m 14.379 ms - 158[0m
[0mGET /api/public/barberias/barberia-test/resenas/validar-token?reviewToken=invalid [33m404[0m 5.963 ms - 60[0m
[0mGET /api/public/barberias/barberia-test/resenas [32m200[0m 16.839 ms - 864[0m
[0mGET /api/public/barberias/barberia-test/resenas [32m200[0m 21.976 ms - 864[0m
[0mGET /api/admin/resenas/pendientes [32m200[0m 10.923 ms - 424[0m
[0mGET /api/admin/resenas/pendientes [33m401[0m 0.192 ms - 27[0m
[0mPATCH /api/admin/resenas/698bdc35968fdc828feeb6f3/aprobar [32m200[0m 12.780 ms - 448[0m
[0mPATCH /api/admin/resenas/698bdc35968fdc828feeb707/aprobar [33m401[0m 0.209 ms - 27[0m
[0mGET /api/admin/resenas/estadisticas [32m200[0m 5.792 ms - 141[0m
[0mGET /api/public/barberias/barberia-2/resenas [32m200[0m 11.393 ms - 474[0m
[0mGET /api/public/barberias/barberia-2/resenas [32m200[0m 11.985 ms - 474[0m
FAIL tests/resenas.test.js (6.384 s)
  ÔùÅ Console

    console.log
      [dotenv@17.2.3] injecting env (13) from .env -- tip: ƒæÑ sync secrets 
across teammates & machines: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

    console.log
      ƒôí [POST] /api/public/barberias/barberia-test/resenas?reviewToken=2043b657
7f8bc507585aac0139efe1d95128fba511810d7efa772f3c896a3b60

      at log (src/app.js:93:11)

    console.log
      ­ƒôí [POST] /api/public/barberias/barberia-test/resenas

      at log (src/app.js:93:11)

    console.log
      ƒôí [POST] 
/api/public/barberias/barberia-test/resenas?reviewToken=invalid-token

      at log (src/app.js:93:11)

    console.log
      ƒôí [POST] /api/public/barberias/barberia-test/resenas?reviewToken=0b799b10
99a4444e8a4f04ecc2478d4a7f902d67c438bccb833a901a8cd72e75

      at log (src/app.js:93:11)

    console.log
      ƒôí [POST] /api/public/barberia-test/resenas?reviewToken=0b799b1099a4444e8a
4f04ecc2478d4a7f902d67c438bccb833a901a8cd72e75

      at log (src/app.js:93:11)

    console.log
      ƒôí [POST] /api/public/barberia-test/resenas?reviewToken=0ea24c3708d55b2171
373b547ca3a320a7d20c9206900f3def869b419169ec3d

      at log (src/app.js:93:11)

    console.log
      ƒôí [GET] /api/public/barberias/barberia-test/resenas/validar-token?reviewT
oken=b1537f7e98b777170dd91cd91efd76e2711e27f2b7b371f2e0de3de4a5df3279

      at log (src/app.js:93:11)

    console.log
      ƒôí [GET] 
/api/public/barberias/barberia-test/resenas/validar-token?reviewToken=invalid

      at log (src/app.js:93:11)

    console.log
      ­ƒôí [GET] /api/public/barberias/barberia-test/resenas

      at log (src/app.js:93:11)

    console.log
      ­ƒôí [GET] /api/public/barberias/barberia-test/resenas

      at log (src/app.js:93:11)

    console.log
      ­ƒôí [GET] /api/admin/resenas/pendientes

      at log (src/app.js:93:11)

    console.log
      ­ƒôí [GET] /api/admin/resenas/pendientes

      at log (src/app.js:93:11)

    console.log
      ­ƒôí [PATCH] /api/admin/resenas/698bdc35968fdc828feeb6f3/aprobar

      at log (src/app.js:93:11)

    console.log
      ­ƒôí [PATCH] /api/admin/resenas/698bdc35968fdc828feeb707/aprobar

      at log (src/app.js:93:11)

    console.log
      ­ƒôí [GET] /api/admin/resenas/estadisticas

      at log (src/app.js:93:11)

    console.log
      ­ƒôí [GET] /api/public/barberias/barberia-2/resenas

      at log (src/app.js:93:11)

    console.log
      ­ƒôí [GET] /api/public/barberias/barberia-2/resenas

      at log (src/app.js:93:11)

  ÔùÅ Sistema de Rese├▒as - Tests ÔÇ║ POST /api/public/:slug/resenas - Crear 
Rese├▒a ÔÇ║ Debe rechazar rese├▒a duplicada

    expect(received).toBe(expected) // Object.is equality

    Expected: 500
    Received: 404

    [0m [90m 157 |[39m                 })[33m;[39m
     [90m 158 |[39m
    [31m[1m>[22m[39m[90m 159 |[39m             
expect(response[33m.[39mstatus)[33m.[39mtoBe([35m500[39m)[33m;[39m
     [90m     |[39m                                     [31m[1m^[22m[39m
     [90m 160 |[39m             expect(response[33m.[39mbody[33m.[39msucces
s)[33m.[39mtoBe([36mfalse[39m)[33m;[39m
     [90m 161 |[39m         })[33m;[39m
     [90m 162 |[39m[0m

      at Object.toBe (tests/resenas.test.js:159:37)

  ÔùÅ Sistema de Rese├▒as - Tests ÔÇ║ POST /api/public/:slug/resenas - Crear 
Rese├▒a ÔÇ║ Debe rechazar rese├▒a sin calificaci├│n general

    expect(received).toBe(expected) // Object.is equality

    Expected: 500
    Received: 404

    [0m [90m 168 |[39m                 })[33m;[39m
     [90m 169 |[39m
    [31m[1m>[22m[39m[90m 170 |[39m             
expect(response[33m.[39mstatus)[33m.[39mtoBe([35m500[39m)[33m;[39m
     [90m     |[39m                                     [31m[1m^[22m[39m
     [90m 171 |[39m             expect(response[33m.[39mbody[33m.[39msucces
s)[33m.[39mtoBe([36mfalse[39m)[33m;[39m
     [90m 172 |[39m         })[33m;[39m
     [90m 173 |[39m     })[33m;[39m[0m

      at Object.toBe (tests/resenas.test.js:170:37)

  ÔùÅ Sistema de Rese├▒as - Tests ÔÇ║ Multitenancy - Aislamiento de Datos ÔÇ║ 
Barber├¡a 1 solo debe ver sus propias rese├▒as

    expect(received).toBe(expected) // Object.is equality

    Expected: "698bdc35968fdc828feeb727"
    Received: "698bdc36968fdc828feeb731"

    [0m [90m 422 |[39m             
expect(response[33m.[39mstatus)[33m.[39mtoBe([35m200[39m)[33m;[39m
     [90m 423 |[39m             expect(response[33m.[39mbody[33m.[39mdata[
33m.[39mresenas[33m.[39mlength)[33m.[39mtoBe([35m1[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 424 |[39m             expect(response[33m.[39mbo
dy[33m.[39mdata[33m.[39mresenas[[35m0[39m][33m.[39mbarberiaId[33m.[39mt
oString())[33m.[39mtoBe(barberia[33m.[39m_id[33m.[39mtoString())[33m;[39m
     [90m     |[39m                                                            
             [31m[1m^[22m[39m
     [90m 425 |[39m         })[33m;[39m
     [90m 426 |[39m
     [90m 427 |[39m         test([32m'Barber├¡a 2 solo debe ver sus propias 
rese├▒as'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.toBe (tests/resenas.test.js:424:73)

(node:25328) [MONGOOSE] Warning: Duplicate schema index on {"reviewToken":1} 
found. This is often due to declaring an index using both "index: true" and 
"schema.index()". Please remove the duplicate index definition.
(node:25328) [MONGOOSE] Warning: Duplicate schema index on {"reviewToken":1} 
found. This is often due to declaring an index using both "index: true" and 
"schema.index()". Please remove the duplicate index definition.
[0mPOST /api/public/barberias/atomic-shop/barberos/698bdc391c939d5496faaa6f/reservar [32m201[0m 46.654 ms - 638[0m
[0mPOST /api/public/barberias/atomic-shop/barberos/698bdc391c939d5496faaa6f/reservar [31m500[0m 34.123 ms - 1164[0m
[0mPOST /api/public/barberias/atomic-shop/barberos/698bdc391c939d5496faaa6f/reservar [32m201[0m 26.368 ms - 638[0m
[0mPOST /api/public/barberias/atomic-shop/barberos/698bdc391c939d5496faaa6f/reservar [31m500[0m 21.683 ms - 1164[0m
FAIL tests/reservas_atomicas.test.js
  ÔùÅ Console

    console.log
      [dotenv@17.2.3] injecting env (13) from .env -- tip: Ô£à audit secrets and 
track compliance: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

    console.log
      ƒôí [POST] 
/api/public/barberias/atomic-shop/barberos/698bdc391c939d5496faaa6f/reservar

      at log (src/app.js:93:11)

    console.log
      [Transaction] Started: CreateReservation (attempt 1/3)

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:54:25)

    console.log
      [Transaction] Committed: CreateReservation

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:61:25)

    console.log
      ƒôí [POST] 
/api/public/barberias/atomic-shop/barberos/698bdc391c939d5496faaa6f/reservar

      at log (src/app.js:93:11)

    console.log
      [Transaction] Started: CreateReservation (attempt 1/3)

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:54:25)

    console.log
      [Transaction] Aborted: CreateReservation

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:69:29)

    console.error
      [Transaction] Failed: CreateReservation {
        error: `E11000 duplicate key error collection: test.reservas index: 
unique_reservation_slot dup key: { barberoId: 
ObjectId('698bdc391c939d5496faaa6f'), fecha: new Date(1796083200000), hora: 
"10:00", barberiaId: ObjectId('698bdc391c939d5496faaa6d') }`,
        attempt: 1,
        stack: `MongoServerError: E11000 duplicate key error collection: 
test.reservas index: unique_reservation_slot dup key: { barberoId: 
ObjectId('698bdc391c939d5496faaa6f'), fecha: new Date(1796083200000), hora: 
"10:00", barberiaId: ObjectId('698bdc391c939d5496faaa6d') }\n` +
          '    at InsertOneOperation.handleOk (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\node_modules\\mongodb\\src\\operations\\insert.ts:79:13)\n' +
          '    at tryOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\backen
d\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:294:26)\n' +
          '    at processTicksAndRejections 
(node:internal/process/task_queues:105:5)\n' +
          '    at executeOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\ba
ckend\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:123:12)\n' +
          '    at Collection.insertOne (C:\\Users\\Kristian\\Desktop\\barber-saas
\\backend\\node_modules\\mongodb\\src\\collection.ts:294:12)\n' +
          '    at model.$__save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backe
nd\\node_modules\\mongoose\\lib\\model.js:398:16)\n' +
          '    at model.save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\
\node_modules\\mongoose\\lib\\model.js:609:5)\n' +
          '    at C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\\node_module
s\\mongoose\\lib\\model.js:2722:9\n' +
          '    at async Promise.all (index 0)\n' +
          '    at Function.create (C:\\Users\\Kristian\\Desktop\\barber-saas\\bac
kend\\node_modules\\mongoose\\lib\\model.js:2707:11)\n' +
          '    at MongoReservaRepository.save (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\src\\infrastructure\\database\\mongodb\\repositories\\MongoRese
rvaRepository.js:15:16)\n' +
          '    at TransactionManager.executeInTransaction.operationName (C:\\User
s\\Kristian\\Desktop\\barber-saas\\backend\\src\\application\\use-cases\\reservas
\\CreateReserva.js:72:42)\n' +
          '    at Function.executeInTransaction (C:\\Users\\Kristian\\Desktop\\ba
rber-saas\\backend\\src\\utils\\TransactionManager.js:57:32)\n' +
          '    at CreateReserva.execute (C:\\Users\\Kristian\\Desktop\\barber-saa
s\\backend\\src\\application\\use-cases\\reservas\\CreateReserva.js:26:34)\n' +
          '    at Object.<anonymous>.exports.crearReservaBySlug (C:\\Users\\Krist
ian\\Desktop\\barber-saas\\backend\\src\\controllers\\public.controller.js:140:25
)'
      }

    [0m [90m 80 |[39m
     [90m 81 |[39m                 [90m// Non-transient error or max retries 
reached[39m
    [31m[1m>[22m[39m[90m 82 |[39m                 
console[33m.[39merror([32m`[Transaction] Failed: 
${operationName}`[39m[33m,[39m {
     [90m    |[39m                         [31m[1m^[22m[39m
     [90m 83 |[39m                     error[33m:[39m 
error[33m.[39mmessage[33m,[39m
     [90m 84 |[39m                     attempt[33m:[39m attempt [33m+[39m 
[35m1[39m[33m,[39m
     [90m 85 |[39m                     stack[33m:[39m 
error[33m.[39mstack[0m

      at Function.error [as executeInTransaction] 
(src/utils/TransactionManager.js:82:25)
      at CreateReserva.execute 
(src/application/use-cases/reservas/CreateReserva.js:26:34)
      at Object.<anonymous>.exports.crearReservaBySlug 
(src/controllers/public.controller.js:140:25)

    console.error
      ƒö┤ ERROR: TransactionError: Transaction failed for CreateReservation: 
E11000 duplicate key error collection: test.reservas index: 
unique_reservation_slot dup key: { barberoId: 
ObjectId('698bdc391c939d5496faaa6f'), fecha: new Date(1796083200000), hora: 
"10:00", barberiaId: ObjectId('698bdc391c939d5496faaa6d') }
          at Function.executeInTransaction (C:\Users\Kristian\Desktop\barber-saas
\backend\src\utils\TransactionManager.js:88:42)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at CreateReserva.execute (C:\Users\Kristian\Desktop\barber-saas\backend
\src\application\use-cases\reservas\CreateReserva.js:26:34)
          at Object.<anonymous>.exports.crearReservaBySlug (C:\Users\Kristian\Des
ktop\barber-saas\backend\src\controllers\public.controller.js:140:25) {
        isTransactionError: true,
        originalError: MongoServerError: E11000 duplicate key error collection: 
test.reservas index: unique_reservation_slot dup key: { barberoId: 
ObjectId('698bdc391c939d5496faaa6f'), fecha: new Date(1796083200000), hora: 
"10:00", barberiaId: ObjectId('698bdc391c939d5496faaa6d') }
            at InsertOneOperation.handleOk (C:\Users\Kristian\Desktop\barber-saas
\backend\node_modules\mongodb\src\operations\insert.ts:79:13)
            at tryOperation (C:\Users\Kristian\Desktop\barber-saas\backend\node_m
odules\mongodb\src\operations\execute_operation.ts:294:26)
            at processTicksAndRejections 
(node:internal/process/task_queues:105:5)
            at executeOperation (C:\Users\Kristian\Desktop\barber-saas\backend\no
de_modules\mongodb\src\operations\execute_operation.ts:123:12)
            at Collection.insertOne (C:\Users\Kristian\Desktop\barber-saas\backen
d\node_modules\mongodb\src\collection.ts:294:12)
            at model.$__save (C:\Users\Kristian\Desktop\barber-saas\backend\node_
modules\mongoose\lib\model.js:398:16)
            at model.save (C:\Users\Kristian\Desktop\barber-saas\backend\node_mod
ules\mongoose\lib\model.js:609:5)
            at C:\Users\Kristian\Desktop\barber-saas\backend\node_modules\mongoos
e\lib\model.js:2722:9
            at async Promise.all (index 0)
            at Function.create (C:\Users\Kristian\Desktop\barber-saas\backend\nod
e_modules\mongoose\lib\model.js:2707:11)
            at MongoReservaRepository.save (C:\Users\Kristian\Desktop\barber-saas
\backend\src\infrastructure\database\mongodb\repositories\MongoReservaRepository.
js:15:16)
            at TransactionManager.executeInTransaction.operationName (C:\Users\Kr
istian\Desktop\barber-saas\backend\src\application\use-cases\reservas\CreateReser
va.js:72:42)
            at Function.executeInTransaction (C:\Users\Kristian\Desktop\barber-sa
as\backend\src\utils\TransactionManager.js:57:32)
            at CreateReserva.execute (C:\Users\Kristian\Desktop\barber-saas\backe
nd\src\application\use-cases\reservas\CreateReserva.js:26:34)
            at Object.<anonymous>.exports.crearReservaBySlug (C:\Users\Kristian\D
esktop\barber-saas\backend\src\controllers\public.controller.js:140:25) {
          errorLabelSet: Set(0) {},
          errorResponse: {
            index: 0,
            code: 11000,
            errmsg: `E11000 duplicate key error collection: test.reservas index: 
unique_reservation_slot dup key: { barberoId: 
ObjectId('698bdc391c939d5496faaa6f'), fecha: new Date(1796083200000), hora: 
"10:00", barberiaId: ObjectId('698bdc391c939d5496faaa6d') }`,
            keyPattern: [Object],
            keyValue: [Object]
          },
          index: 0,
          code: 11000,
          keyPattern: { barberoId: 1, fecha: 1, hora: 1, barberiaId: 1 },
          keyValue: {
            barberoId: new ObjectId('698bdc391c939d5496faaa6f'),
            fecha: 2026-12-01T00:00:00.000Z,
            hora: '10:00',
            barberiaId: new ObjectId('698bdc391c939d5496faaa6d')
          }
        },
        context: { operationName: 'CreateReservation', attempt: 1 },
        timestamp: 2026-02-11T01:32:41.622Z,
        originalStack: `MongoServerError: E11000 duplicate key error collection: 
test.reservas index: unique_reservation_slot dup key: { barberoId: 
ObjectId('698bdc391c939d5496faaa6f'), fecha: new Date(1796083200000), hora: 
"10:00", barberiaId: ObjectId('698bdc391c939d5496faaa6d') }\n` +
          '    at InsertOneOperation.handleOk (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\node_modules\\mongodb\\src\\operations\\insert.ts:79:13)\n' +
          '    at tryOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\backen
d\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:294:26)\n' +
          '    at processTicksAndRejections 
(node:internal/process/task_queues:105:5)\n' +
          '    at executeOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\ba
ckend\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:123:12)\n' +
          '    at Collection.insertOne (C:\\Users\\Kristian\\Desktop\\barber-saas
\\backend\\node_modules\\mongodb\\src\\collection.ts:294:12)\n' +
          '    at model.$__save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backe
nd\\node_modules\\mongoose\\lib\\model.js:398:16)\n' +
          '    at model.save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\
\node_modules\\mongoose\\lib\\model.js:609:5)\n' +
          '    at C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\\node_module
s\\mongoose\\lib\\model.js:2722:9\n' +
          '    at async Promise.all (index 0)\n' +
          '    at Function.create (C:\\Users\\Kristian\\Desktop\\barber-saas\\bac
kend\\node_modules\\mongoose\\lib\\model.js:2707:11)\n' +
          '    at MongoReservaRepository.save (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\src\\infrastructure\\database\\mongodb\\repositories\\MongoRese
rvaRepository.js:15:16)\n' +
          '    at TransactionManager.executeInTransaction.operationName (C:\\User
s\\Kristian\\Desktop\\barber-saas\\backend\\src\\application\\use-cases\\reservas
\\CreateReserva.js:72:42)\n' +
          '    at Function.executeInTransaction (C:\\Users\\Kristian\\Desktop\\ba
rber-saas\\backend\\src\\utils\\TransactionManager.js:57:32)\n' +
          '    at CreateReserva.execute (C:\\Users\\Kristian\\Desktop\\barber-saa
s\\backend\\src\\application\\use-cases\\reservas\\CreateReserva.js:26:34)\n' +
          '    at Object.<anonymous>.exports.crearReservaBySlug (C:\\Users\\Krist
ian\\Desktop\\barber-saas\\backend\\src\\controllers\\public.controller.js:140:25
)'
      }

    [0m [90m 4 |[39m
     [90m 5 |[39m [36mconst[39m errorHandler [33m=[39m (err[33m,[39m 
req[33m,[39m res[33m,[39m next) [33m=>[39m {
    [31m[1m>[22m[39m[90m 6 |[39m   console[33m.[39merror([32m"ƒö┤ 
ERROR:"[39m[33m,[39m err)[33m;[39m
     [90m   |[39m           [31m[1m^[22m[39m
     [90m 7 |[39m
     [90m 8 |[39m   [90m// ­ƒöÑ A├æADIR HEADERS CORS SI NO EXISTEN[39m
     [90m 9 |[39m   [36mconst[39m origin [33m=[39m 
req[33m.[39mheaders[33m.[39morigin[33m;[39m[0m

      at error (src/config/middleware/errorHandler.js:6:11)
      at Layer.handleError (node_modules/router/lib/layer.js:116:17)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at Layer.handleError (node_modules/router/lib/layer.js:111:12)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at Immediate.next (node_modules/router/index.js:291:5)
      at Immediate._onImmediate (node_modules/router/index.js:688:15)

    console.log
      ƒôí [POST] 
/api/public/barberias/atomic-shop/barberos/698bdc391c939d5496faaa6f/reservar

      at log (src/app.js:93:11)

    console.log
      [Transaction] Started: CreateReservation (attempt 1/3)

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:54:25)

    console.log
      [Transaction] Committed: CreateReservation

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:61:25)

    console.log
      ƒôí [POST] 
/api/public/barberias/atomic-shop/barberos/698bdc391c939d5496faaa6f/reservar

      at log (src/app.js:93:11)

    console.log
      [Transaction] Started: CreateReservation (attempt 1/3)

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:54:25)

    console.log
      [Transaction] Aborted: CreateReservation

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:69:29)

    console.error
      [Transaction] Failed: CreateReservation {
        error: `E11000 duplicate key error collection: test.reservas index: 
unique_reservation_slot dup key: { barberoId: 
ObjectId('698bdc391c939d5496faaa6f'), fecha: new Date(1796083200000), hora: 
"11:00", barberiaId: ObjectId('698bdc391c939d5496faaa6d') }`,
        attempt: 1,
        stack: `MongoServerError: E11000 duplicate key error collection: 
test.reservas index: unique_reservation_slot dup key: { barberoId: 
ObjectId('698bdc391c939d5496faaa6f'), fecha: new Date(1796083200000), hora: 
"11:00", barberiaId: ObjectId('698bdc391c939d5496faaa6d') }\n` +
          '    at InsertOneOperation.handleOk (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\node_modules\\mongodb\\src\\operations\\insert.ts:79:13)\n' +
          '    at tryOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\backen
d\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:294:26)\n' +
          '    at processTicksAndRejections 
(node:internal/process/task_queues:105:5)\n' +
          '    at executeOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\ba
ckend\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:123:12)\n' +
          '    at Collection.insertOne (C:\\Users\\Kristian\\Desktop\\barber-saas
\\backend\\node_modules\\mongodb\\src\\collection.ts:294:12)\n' +
          '    at model.$__save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backe
nd\\node_modules\\mongoose\\lib\\model.js:398:16)\n' +
          '    at model.save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\
\node_modules\\mongoose\\lib\\model.js:609:5)\n' +
          '    at C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\\node_module
s\\mongoose\\lib\\model.js:2722:9\n' +
          '    at async Promise.all (index 0)\n' +
          '    at Function.create (C:\\Users\\Kristian\\Desktop\\barber-saas\\bac
kend\\node_modules\\mongoose\\lib\\model.js:2707:11)\n' +
          '    at MongoReservaRepository.save (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\src\\infrastructure\\database\\mongodb\\repositories\\MongoRese
rvaRepository.js:15:16)\n' +
          '    at TransactionManager.executeInTransaction.operationName (C:\\User
s\\Kristian\\Desktop\\barber-saas\\backend\\src\\application\\use-cases\\reservas
\\CreateReserva.js:72:42)\n' +
          '    at Function.executeInTransaction (C:\\Users\\Kristian\\Desktop\\ba
rber-saas\\backend\\src\\utils\\TransactionManager.js:57:32)\n' +
          '    at CreateReserva.execute (C:\\Users\\Kristian\\Desktop\\barber-saa
s\\backend\\src\\application\\use-cases\\reservas\\CreateReserva.js:26:34)\n' +
          '    at Object.<anonymous>.exports.crearReservaBySlug (C:\\Users\\Krist
ian\\Desktop\\barber-saas\\backend\\src\\controllers\\public.controller.js:140:25
)'
      }

    [0m [90m 80 |[39m
     [90m 81 |[39m                 [90m// Non-transient error or max retries 
reached[39m
    [31m[1m>[22m[39m[90m 82 |[39m                 
console[33m.[39merror([32m`[Transaction] Failed: 
${operationName}`[39m[33m,[39m {
     [90m    |[39m                         [31m[1m^[22m[39m
     [90m 83 |[39m                     error[33m:[39m 
error[33m.[39mmessage[33m,[39m
     [90m 84 |[39m                     attempt[33m:[39m attempt [33m+[39m 
[35m1[39m[33m,[39m
     [90m 85 |[39m                     stack[33m:[39m 
error[33m.[39mstack[0m

      at Function.error [as executeInTransaction] 
(src/utils/TransactionManager.js:82:25)
      at CreateReserva.execute 
(src/application/use-cases/reservas/CreateReserva.js:26:34)
      at Object.<anonymous>.exports.crearReservaBySlug 
(src/controllers/public.controller.js:140:25)

    console.error
      ƒö┤ ERROR: TransactionError: Transaction failed for CreateReservation: 
E11000 duplicate key error collection: test.reservas index: 
unique_reservation_slot dup key: { barberoId: 
ObjectId('698bdc391c939d5496faaa6f'), fecha: new Date(1796083200000), hora: 
"11:00", barberiaId: ObjectId('698bdc391c939d5496faaa6d') }
          at Function.executeInTransaction (C:\Users\Kristian\Desktop\barber-saas
\backend\src\utils\TransactionManager.js:88:42)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at CreateReserva.execute (C:\Users\Kristian\Desktop\barber-saas\backend
\src\application\use-cases\reservas\CreateReserva.js:26:34)
          at Object.<anonymous>.exports.crearReservaBySlug (C:\Users\Kristian\Des
ktop\barber-saas\backend\src\controllers\public.controller.js:140:25) {
        isTransactionError: true,
        originalError: MongoServerError: E11000 duplicate key error collection: 
test.reservas index: unique_reservation_slot dup key: { barberoId: 
ObjectId('698bdc391c939d5496faaa6f'), fecha: new Date(1796083200000), hora: 
"11:00", barberiaId: ObjectId('698bdc391c939d5496faaa6d') }
            at InsertOneOperation.handleOk (C:\Users\Kristian\Desktop\barber-saas
\backend\node_modules\mongodb\src\operations\insert.ts:79:13)
            at tryOperation (C:\Users\Kristian\Desktop\barber-saas\backend\node_m
odules\mongodb\src\operations\execute_operation.ts:294:26)
            at processTicksAndRejections 
(node:internal/process/task_queues:105:5)
            at executeOperation (C:\Users\Kristian\Desktop\barber-saas\backend\no
de_modules\mongodb\src\operations\execute_operation.ts:123:12)
            at Collection.insertOne (C:\Users\Kristian\Desktop\barber-saas\backen
d\node_modules\mongodb\src\collection.ts:294:12)
            at model.$__save (C:\Users\Kristian\Desktop\barber-saas\backend\node_
modules\mongoose\lib\model.js:398:16)
            at model.save (C:\Users\Kristian\Desktop\barber-saas\backend\node_mod
ules\mongoose\lib\model.js:609:5)
            at C:\Users\Kristian\Desktop\barber-saas\backend\node_modules\mongoos
e\lib\model.js:2722:9
            at async Promise.all (index 0)
            at Function.create (C:\Users\Kristian\Desktop\barber-saas\backend\nod
e_modules\mongoose\lib\model.js:2707:11)
            at MongoReservaRepository.save (C:\Users\Kristian\Desktop\barber-saas
\backend\src\infrastructure\database\mongodb\repositories\MongoReservaRepository.
js:15:16)
            at TransactionManager.executeInTransaction.operationName (C:\Users\Kr
istian\Desktop\barber-saas\backend\src\application\use-cases\reservas\CreateReser
va.js:72:42)
            at Function.executeInTransaction (C:\Users\Kristian\Desktop\barber-sa
as\backend\src\utils\TransactionManager.js:57:32)
            at CreateReserva.execute (C:\Users\Kristian\Desktop\barber-saas\backe
nd\src\application\use-cases\reservas\CreateReserva.js:26:34)
            at Object.<anonymous>.exports.crearReservaBySlug (C:\Users\Kristian\D
esktop\barber-saas\backend\src\controllers\public.controller.js:140:25) {
          errorLabelSet: Set(0) {},
          errorResponse: {
            index: 0,
            code: 11000,
            errmsg: `E11000 duplicate key error collection: test.reservas index: 
unique_reservation_slot dup key: { barberoId: 
ObjectId('698bdc391c939d5496faaa6f'), fecha: new Date(1796083200000), hora: 
"11:00", barberiaId: ObjectId('698bdc391c939d5496faaa6d') }`,
            keyPattern: [Object],
            keyValue: [Object]
          },
          index: 0,
          code: 11000,
          keyPattern: { barberoId: 1, fecha: 1, hora: 1, barberiaId: 1 },
          keyValue: {
            barberoId: new ObjectId('698bdc391c939d5496faaa6f'),
            fecha: 2026-12-01T00:00:00.000Z,
            hora: '11:00',
            barberiaId: new ObjectId('698bdc391c939d5496faaa6d')
          }
        },
        context: { operationName: 'CreateReservation', attempt: 1 },
        timestamp: 2026-02-11T01:32:41.703Z,
        originalStack: `MongoServerError: E11000 duplicate key error collection: 
test.reservas index: unique_reservation_slot dup key: { barberoId: 
ObjectId('698bdc391c939d5496faaa6f'), fecha: new Date(1796083200000), hora: 
"11:00", barberiaId: ObjectId('698bdc391c939d5496faaa6d') }\n` +
          '    at InsertOneOperation.handleOk (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\node_modules\\mongodb\\src\\operations\\insert.ts:79:13)\n' +
          '    at tryOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\backen
d\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:294:26)\n' +
          '    at processTicksAndRejections 
(node:internal/process/task_queues:105:5)\n' +
          '    at executeOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\ba
ckend\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:123:12)\n' +
          '    at Collection.insertOne (C:\\Users\\Kristian\\Desktop\\barber-saas
\\backend\\node_modules\\mongodb\\src\\collection.ts:294:12)\n' +
          '    at model.$__save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backe
nd\\node_modules\\mongoose\\lib\\model.js:398:16)\n' +
          '    at model.save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\
\node_modules\\mongoose\\lib\\model.js:609:5)\n' +
          '    at C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\\node_module
s\\mongoose\\lib\\model.js:2722:9\n' +
          '    at async Promise.all (index 0)\n' +
          '    at Function.create (C:\\Users\\Kristian\\Desktop\\barber-saas\\bac
kend\\node_modules\\mongoose\\lib\\model.js:2707:11)\n' +
          '    at MongoReservaRepository.save (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\src\\infrastructure\\database\\mongodb\\repositories\\MongoRese
rvaRepository.js:15:16)\n' +
          '    at TransactionManager.executeInTransaction.operationName (C:\\User
s\\Kristian\\Desktop\\barber-saas\\backend\\src\\application\\use-cases\\reservas
\\CreateReserva.js:72:42)\n' +
          '    at Function.executeInTransaction (C:\\Users\\Kristian\\Desktop\\ba
rber-saas\\backend\\src\\utils\\TransactionManager.js:57:32)\n' +
          '    at CreateReserva.execute (C:\\Users\\Kristian\\Desktop\\barber-saa
s\\backend\\src\\application\\use-cases\\reservas\\CreateReserva.js:26:34)\n' +
          '    at Object.<anonymous>.exports.crearReservaBySlug (C:\\Users\\Krist
ian\\Desktop\\barber-saas\\backend\\src\\controllers\\public.controller.js:140:25
)'
      }

    [0m [90m 4 |[39m
     [90m 5 |[39m [36mconst[39m errorHandler [33m=[39m (err[33m,[39m 
req[33m,[39m res[33m,[39m next) [33m=>[39m {
    [31m[1m>[22m[39m[90m 6 |[39m   console[33m.[39merror([32m"ƒö┤ 
ERROR:"[39m[33m,[39m err)[33m;[39m
     [90m   |[39m           [31m[1m^[22m[39m
     [90m 7 |[39m
     [90m 8 |[39m   [90m// ­ƒöÑ A├æADIR HEADERS CORS SI NO EXISTEN[39m
     [90m 9 |[39m   [36mconst[39m origin [33m=[39m 
req[33m.[39mheaders[33m.[39morigin[33m;[39m[0m

      at error (src/config/middleware/errorHandler.js:6:11)
      at Layer.handleError (node_modules/router/lib/layer.js:116:17)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at Layer.handleError (node_modules/router/lib/layer.js:111:12)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at Immediate.next (node_modules/router/index.js:291:5)
      at Immediate._onImmediate (node_modules/router/index.js:688:15)

  ÔùÅ Pruebas de Atomicidad de Reservas (Anti-Overbooking) ÔÇ║ No debe permitir 
dos reservas en el mismo horario (Previene Overbooking)

    expect(received).toBe(expected) // Object.is equality

    Expected: 409
    Received: 500

    [0m [90m 79 |[39m
     [90m 80 |[39m         [90m// Debe fallar con el c├│digo 409 Conflict (no 
400)[39m
    [31m[1m>[22m[39m[90m 81 |[39m         
expect(res2[33m.[39mstatus)[33m.[39mtoBe([35m409[39m)[33m;[39m
     [90m    |[39m                             [31m[1m^[22m[39m
     [90m 82 |[39m         
expect(res2[33m.[39mbody[33m.[39mmessage)[33m.[39mtoContain([32m'Alguien 
acaba de reservar este horario'[39m)[33m;[39m
     [90m 83 |[39m
     [90m 84 |[39m         [90m// Verificar en la BD que solo hay una reserva 
real[39m[0m

      at Object.toBe (tests/reservas_atomicas.test.js:81:29)

  ÔùÅ Pruebas de Atomicidad de Reservas (Anti-Overbooking) ÔÇ║ Debe permitir 
reservar si la cita anterior fue CANCELADA

    expect(received).toBe(expected) // Object.is equality

    Expected: 201
    Received: 500

    [0m [90m 124 |[39m             [33m.[39msend(payload)[33m;[39m
     [90m 125 |[39m
    [31m[1m>[22m[39m[90m 126 |[39m         
expect(res2[33m.[39mstatus)[33m.[39mtoBe([35m201[39m)[33m;[39m
     [90m     |[39m                             [31m[1m^[22m[39m
     [90m 127 |[39m         expect(res2[33m.[39mbody[33m.[39mreserva[33m.
[39memailCliente)[33m.[39mtoBe([32m'cliente2@test.com'[39m)[33m;[39m
     [90m 128 |[39m     })[33m;[39m
     [90m 129 |[39m })[33m;[39m[0m

      at Object.toBe (tests/reservas_atomicas.test.js:126:29)

(node:25328) [MONGOOSE] Warning: Duplicate schema index on {"reviewToken":1} 
found. This is often due to declaring an index using both "index: true" and 
"schema.index()". Please remove the duplicate index definition.
FAIL tests/transaction-rollback.test.js
  ÔùÅ Console

    console.log
      [Transaction] Started: CompleteReservation (attempt 1/3)

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:54:25)

    console.log
      [Transaction] Aborted: CompleteReservation

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:69:29)

    console.error
      [Transaction] Failed: CompleteReservation {
        error: 'barberiaId es requerido para el aislamiento de datos',
        attempt: 1,
        stack: 'Error: barberiaId es requerido para el aislamiento de datos\n' +
          '    at MongoReservaRepository.findById (C:\\Users\\Kristian\\Desktop\\
barber-saas\\backend\\src\\infrastructure\\database\\mongodb\\repositories\\Mongo
ReservaRepository.js:23:19)\n' +
          '    at findById (C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\\s
rc\\application\\use-cases\\reservas\\CompleteReserva.js:27:62)\n' +
          '    at Function.operation [as executeInTransaction] (C:\\Users\\Kristi
an\\Desktop\\barber-saas\\backend\\src\\utils\\TransactionManager.js:57:38)\n' +
          '    at processTicksAndRejections 
(node:internal/process/task_queues:105:5)\n' +
          '    at CompleteReserva.execute (C:\\Users\\Kristian\\Desktop\\barber-s
aas\\backend\\src\\application\\use-cases\\reservas\\CompleteReserva.js:24:24)\n'
 +
          '    at Object.<anonymous> (C:\\Users\\Kristian\\Desktop\\barber-saas\\
backend\\tests\\transaction-rollback.test.js:81:13)'
      }

    [0m [90m 80 |[39m
     [90m 81 |[39m                 [90m// Non-transient error or max retries 
reached[39m
    [31m[1m>[22m[39m[90m 82 |[39m                 
console[33m.[39merror([32m`[Transaction] Failed: 
${operationName}`[39m[33m,[39m {
     [90m    |[39m                         [31m[1m^[22m[39m
     [90m 83 |[39m                     error[33m:[39m 
error[33m.[39mmessage[33m,[39m
     [90m 84 |[39m                     attempt[33m:[39m attempt [33m+[39m 
[35m1[39m[33m,[39m
     [90m 85 |[39m                     stack[33m:[39m 
error[33m.[39mstack[0m

      at Function.error [as executeInTransaction] 
(src/utils/TransactionManager.js:82:25)
      at CompleteReserva.execute 
(src/application/use-cases/reservas/CompleteReserva.js:24:24)
      at Object.<anonymous> (tests/transaction-rollback.test.js:81:13)

    console.log
      [Transaction] Started: CompleteReservation (attempt 1/3)

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:54:25)

    console.log
      [Transaction] Aborted: CompleteReservation

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:69:29)

    console.error
      [Transaction] Failed: CompleteReservation {
        error: 'barberiaId es requerido para el aislamiento de datos',
        attempt: 1,
        stack: 'Error: barberiaId es requerido para el aislamiento de datos\n' +
          '    at MongoReservaRepository.findById (C:\\Users\\Kristian\\Desktop\\
barber-saas\\backend\\src\\infrastructure\\database\\mongodb\\repositories\\Mongo
ReservaRepository.js:23:19)\n' +
          '    at findById (C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\\s
rc\\application\\use-cases\\reservas\\CompleteReserva.js:27:62)\n' +
          '    at Function.operation [as executeInTransaction] (C:\\Users\\Kristi
an\\Desktop\\barber-saas\\backend\\src\\utils\\TransactionManager.js:57:38)\n' +
          '    at processTicksAndRejections 
(node:internal/process/task_queues:105:5)\n' +
          '    at CompleteReserva.execute (C:\\Users\\Kristian\\Desktop\\barber-s
aas\\backend\\src\\application\\use-cases\\reservas\\CompleteReserva.js:24:24)\n'
 +
          '    at Object.<anonymous> (C:\\Users\\Kristian\\Desktop\\barber-saas\\
backend\\tests\\transaction-rollback.test.js:137:28)'
      }

    [0m [90m 80 |[39m
     [90m 81 |[39m                 [90m// Non-transient error or max retries 
reached[39m
    [31m[1m>[22m[39m[90m 82 |[39m                 
console[33m.[39merror([32m`[Transaction] Failed: 
${operationName}`[39m[33m,[39m {
     [90m    |[39m                         [31m[1m^[22m[39m
     [90m 83 |[39m                     error[33m:[39m 
error[33m.[39mmessage[33m,[39m
     [90m 84 |[39m                     attempt[33m:[39m attempt [33m+[39m 
[35m1[39m[33m,[39m
     [90m 85 |[39m                     stack[33m:[39m 
error[33m.[39mstack[0m

      at Function.error [as executeInTransaction] 
(src/utils/TransactionManager.js:82:25)
      at CompleteReserva.execute 
(src/application/use-cases/reservas/CompleteReserva.js:24:24)
      at Object.<anonymous> (tests/transaction-rollback.test.js:137:28)

  ÔùÅ Transaction Rollback Integration Tests ÔÇ║ CompleteReserva Transaction 
Rollback ÔÇ║ should rollback reservation update if client update fails

    expect(received).toBe(expected) // Object.is equality

    Expected: 0
    Received: undefined

    [0m [90m 90 |[39m             [90m// 6. Verify client visit count 
unchanged[39m
     [90m 91 |[39m             [36mconst[39m clienteAfter [33m=[39m 
[36mawait[39m 
[33mUserModel[39m[33m.[39mfindById(cliente[33m.[39m_id)[33m;[39m
    [31m[1m>[22m[39m[90m 92 |[39m             expect(clienteAfter[33m.[39
mhistorialVisitas)[33m.[39mtoBe([35m0[39m)[33m;[39m
     [90m    |[39m                                                   
[31m[1m^[22m[39m
     [90m 93 |[39m
     [90m 94 |[39m             [90m// Restore original method[39m
     [90m 95 |[39m             clienteRepository[33m.[39mupdate [33m=[39m 
originalUpdate[33m;[39m[0m

      at Object.toBe (tests/transaction-rollback.test.js:92:51)

  ÔùÅ Transaction Rollback Integration Tests ÔÇ║ CompleteReserva Transaction 
Rollback ÔÇ║ should commit both updates when successful

    TransactionError: Transaction failed for CompleteReservation: barberiaId es 
requerido para el aislamiento de datos

    [0m [90m 86 |[39m                 })[33m;[39m
     [90m 87 |[39m
    [31m[1m>[22m[39m[90m 88 |[39m                 [36mconst[39m 
transactionError [33m=[39m [36mnew[39m [33mTransactionError[39m(
     [90m    |[39m                                          
[31m[1m^[22m[39m
     [90m 89 |[39m                     [32m`Transaction failed for 
${operationName}: ${error.message}`[39m[33m,[39m
     [90m 90 |[39m                     error[33m,[39m
     [90m 91 |[39m                     { operationName[33m,[39m 
attempt[33m:[39m attempt [33m+[39m [35m1[39m }[0m

      at Function.executeInTransaction (src/utils/TransactionManager.js:88:42)
      at CompleteReserva.execute 
(src/application/use-cases/reservas/CompleteReserva.js:24:24)
      at Object.<anonymous> (tests/transaction-rollback.test.js:137:28)

(node:25328) [MONGOOSE] Warning: Duplicate schema index on {"reviewToken":1} 
found. This is often due to declaring an index using both "index: true" and 
"schema.index()". Please remove the duplicate index definition.
(node:25328) [MONGOOSE] Warning: Duplicate schema index on {"reviewToken":1} 
found. This is often due to declaring an index using both "index: true" and 
"schema.index()". Please remove the duplicate index definition.
[0mPOST /api/public/barberias/test-barberia/barberos/698bdc3d626399f145648db1/reservar [32m201[0m 150.028 ms - 641[0m
[0mPOST /api/public/barberias/test-barberia/barberos/698bdc3d626399f145648db1/reservar [31m500[0m 489.701 ms - 1164[0m
[0mPOST /api/public/barberias/test-barberia/barberos/698bdc3d626399f145648db1/reservar [31m500[0m 481.608 ms - 1164[0m
[0mPOST /api/public/barberias/test-barberia/barberos/698bdc3d626399f145648db1/reservar [31m500[0m 472.437 ms - 1164[0m
[0mPOST /api/public/barberias/test-barberia/barberos/698bdc3d626399f145648db1/reservar [31m500[0m 502.638 ms - 1164[0m
[0mPOST /api/public/barberias/test-barberia/barberos/698bdc3d626399f145648db1/reservar [31m500[0m 517.828 ms - 1164[0m
[0mPOST /api/public/barberias/test-barberia/barberos/698bdc3d626399f145648db1/reservar [31m500[0m 508.156 ms - 1164[0m
[0mPOST /api/public/barberias/test-barberia/barberos/698bdc3d626399f145648db1/reservar [31m500[0m 496.672 ms - 1164[0m
[0mPOST /api/public/barberias/test-barberia/barberos/698bdc3d626399f145648db1/reservar [31m500[0m 490.247 ms - 1164[0m
[0mPOST /api/public/barberias/test-barberia/barberos/698bdc3d626399f145648db1/reservar [31m500[0m 502.637 ms - 1164[0m
[0mPOST /api/public/barberias/test-barberia/barberos/698bdc3e626399f145648e26/reservar [33m429[0m 2.547 ms - 61[0m
[0mPOST /api/public/barberias/test-barberia/barberos/698bdc3e626399f145648e26/reservar [33m429[0m 0.583 ms - 61[0m
[0mPOST /api/public/barberias/test-barberia/barberos/698bdc3e626399f145648e26/reservar [33m429[0m 0.514 ms - 61[0m
[0mPOST /api/public/barberias/test-barberia/barberos/698bdc3e626399f145648e26/reservar [33m429[0m 0.480 ms - 61[0m
[0mPOST /api/public/barberias/test-barberia/barberos/698bdc3e626399f145648e26/reservar [33m429[0m 0.499 ms - 61[0m
[0mPOST /api/public/barberias/test-barberia/barberos/698bdc3e626399f145648e26/reservar [33m429[0m 0.473 ms - 61[0m
[0mPOST /api/public/barberias/test-barberia/barberos/698bdc3e626399f145648e26/reservar [33m429[0m 0.669 ms - 61[0m
[0mPOST /api/public/barberias/test-barberia/barberos/698bdc3e626399f145648e26/reservar [33m429[0m 0.537 ms - 61[0m
[0mPOST /api/public/barberias/test-barberia/barberos/698bdc3e626399f145648e26/reservar [33m429[0m 0.500 ms - 61[0m
[0mPOST /api/public/barberias/test-barberia/barberos/698bdc3e626399f145648e26/reservar [33m429[0m 0.543 ms - 61[0m
[0mPOST /api/public/barberias/test-barberia/barberos/698bdc3e626399f145648e26/reservar [33m429[0m 0.480 ms - 61[0m
[0mPOST /api/public/barberias/test-barberia/barberos/698bdc3e626399f145648e26/reservar [33m429[0m 0.475 ms - 61[0m
[0mPOST /api/public/barberias/test-barberia/barberos/698bdc3e626399f145648e26/reservar [33m429[0m 0.500 ms - 61[0m
[0mPOST /api/public/barberias/test-barberia/barberos/698bdc3e626399f145648e26/reservar [33m429[0m 0.497 ms - 61[0m
[0mPOST /api/public/barberias/test-barberia/barberos/698bdc3e626399f145648e26/reservar [33m429[0m 0.465 ms - 61[0m
[0mPOST /api/public/barberias/test-barberia/barberos/698bdc3e626399f145648e26/reservar [33m429[0m 0.462 ms - 61[0m
[0mPOST /api/public/barberias/test-barberia/barberos/698bdc3e626399f145648e26/reservar [33m429[0m 0.624 ms - 61[0m
[0mPOST /api/public/barberias/test-barberia/barberos/698bdc3e626399f145648e26/reservar [33m429[0m 0.503 ms - 61[0m
[0mPOST /api/public/barberias/test-barberia/barberos/698bdc3e626399f145648e26/reservar [33m429[0m 0.925 ms - 61[0m
[0mPOST /api/public/barberias/test-barberia/barberos/698bdc3e626399f145648e26/reservar [33m429[0m 0.882 ms - 61[0m
[0mPOST /api/public/barberias/test-barberia/barberos/698bdc3e626399f145648e26/reservar [33m429[0m 0.800 ms - 61[0m
[0mPOST /api/public/barberias/test-barberia/barberos/698bdc3e626399f145648e26/reservar [33m429[0m 0.670 ms - 61[0m
[0mPOST /api/public/barberias/test-barberia/barberos/698bdc3e626399f145648e26/reservar [33m429[0m 0.608 ms - 61[0m
[0mPOST /api/public/barberias/test-barberia/barberos/698bdc3e626399f145648e26/reservar [33m429[0m 0.753 ms - 61[0m
[0mPOST /api/public/barberias/test-barberia/barberos/698bdc3e626399f145648e26/reservar [33m429[0m 1.116 ms - 61[0m
[0mPOST /api/public/barberias/test-barberia/barberos/698bdc3e626399f145648e26/reservar [33m429[0m 0.663 ms - 61[0m
[0mPOST /api/public/barberias/test-barberia/barberos/698bdc3e626399f145648e26/reservar [33m429[0m 0.519 ms - 61[0m
[0mPOST /api/public/barberias/test-barberia/barberos/698bdc3e626399f145648e26/reservar [33m429[0m 0.614 ms - 61[0m
[0mPOST /api/public/barberias/test-barberia/barberos/698bdc3e626399f145648e26/reservar [33m429[0m 0.576 ms - 61[0m
[0mPOST /api/public/barberias/test-barberia/barberos/698bdc3e626399f145648e26/reservar [33m429[0m 0.553 ms - 61[0m
[0mPOST /api/public/barberias/test-barberia/barberos/698bdc3e626399f145648e26/reservar [32m201[0m 431.464 ms - 640[0m
[0mPOST /api/public/barberias/test-barberia/barberos/698bdc3e626399f145648e26/reservar [31m500[0m 818.387 ms - 1164[0m
[0mPOST /api/public/barberias/test-barberia/barberos/698bdc3e626399f145648e26/reservar [31m500[0m 814.371 ms - 1164[0m
[0mPOST /api/public/barberias/test-barberia/barberos/698bdc3e626399f145648e26/reservar [31m500[0m 864.026 ms - 1164[0m
[0mPOST /api/public/barberias/test-barberia/barberos/698bdc3e626399f145648e26/reservar [31m500[0m 862.425 ms - 1164[0m
[0mPOST /api/public/barberias/test-barberia/barberos/698bdc3e626399f145648e26/reservar [31m500[0m 857.966 ms - 1164[0m
[0mPOST /api/public/barberias/test-barberia/barberos/698bdc3e626399f145648e26/reservar [31m500[0m 849.230 ms - 1164[0m
[0mPOST /api/public/barberias/test-barberia/barberos/698bdc3e626399f145648e26/reservar [31m500[0m 857.003 ms - 1164[0m
[0mPOST /api/public/barberias/test-barberia/barberos/698bdc3e626399f145648e26/reservar [31m500[0m 898.971 ms - 1164[0m
[0mPOST /api/public/barberias/test-barberia/barberos/698bdc3e626399f145648e26/reservar [31m500[0m 862.243 ms - 1164[0m
[0mPOST /api/public/barberias/test-barberia/barberos/698bdc3e626399f145648e26/reservar [31m500[0m 856.392 ms - 1164[0m
[0mPOST /api/public/barberias/test-barberia/barberos/698bdc3e626399f145648e26/reservar [31m500[0m 875.219 ms - 1164[0m
[0mPOST /api/public/barberias/test-barberia/barberos/698bdc3e626399f145648e26/reservar [31m500[0m 868.142 ms - 1164[0m
[0mPOST /api/public/barberias/test-barberia/barberos/698bdc3e626399f145648e26/reservar [31m500[0m 895.100 ms - 1164[0m
[0mPOST /api/public/barberias/test-barberia/barberos/698bdc3e626399f145648e26/reservar [31m500[0m 875.751 ms - 1164[0m
[0mPOST /api/public/barberias/test-barberia/barberos/698bdc3e626399f145648e26/reservar [31m500[0m 891.061 ms - 1164[0m
[0mPOST /api/public/barberias/test-barberia/barberos/698bdc3e626399f145648e26/reservar [31m500[0m 881.514 ms - 1164[0m
[0mPOST /api/public/barberias/test-barberia/barberos/698bdc3e626399f145648e26/reservar [31m500[0m 890.784 ms - 1164[0m
[0mPOST /api/public/barberias/test-barberia/barberos/698bdc3e626399f145648e26/reservar [31m500[0m 946.644 ms - 1164[0m
[0mPOST /api/public/barberias/test-barberia/barberos/698bdc3e626399f145648e26/reservar [31m500[0m 923.704 ms - 1164[0m
[0mPOST /api/public/barberias/test-barberia/barberos/698bdc40626399f145648f39/reservar [33m429[0m 0.675 ms - 61[0m
[0mPOST /api/public/barberias/test-barberia/barberos/698bdc40626399f145648f59/reservar [33m429[0m 0.719 ms - 61[0m
[0mPOST /api/public/barberias/test-barberia/barberos/698bdc40626399f145648f59/reservar [33m429[0m 0.491 ms - 61[0m
[0mPOST /api/public/barberias/test-barberia/barberos/698bdc40626399f145648f59/reservar [33m429[0m 0.513 ms - 61[0m
[0mPOST /api/public/barberias/test-barberia/barberos/698bdc40626399f145648f59/reservar [33m429[0m 0.659 ms - 61[0m
[0mPOST /api/public/barberias/test-barberia/barberos/698bdc40626399f145648f59/reservar [33m429[0m 0.521 ms - 61[0m
[0mPOST /api/public/barberias/test-barberia/barberos/698bdc40626399f145648f59/reservar [33m429[0m 0.539 ms - 61[0m
[0mPOST /api/public/barberias/test-barberia/barberos/698bdc40626399f145648f59/reservar [33m429[0m 0.489 ms - 61[0m
[0mPOST /api/public/barberias/test-barberia/barberos/698bdc40626399f145648f59/reservar [33m429[0m 0.477 ms - 61[0m
[0mPOST /api/public/barberias/test-barberia/barberos/698bdc40626399f145648f59/reservar [33m429[0m 0.815 ms - 61[0m
[0mPOST /api/public/barberias/test-barberia/barberos/698bdc40626399f145648f59/reservar [33m429[0m 0.478 ms - 61[0m
[0mPOST /api/public/barberias/test-barberia/barberos/698bdc40626399f145648f59/reservar [33m429[0m 0.552 ms - 61[0m
[0mPOST /api/public/barberias/test-barberia/barberos/698bdc40626399f145648f59/reservar [33m429[0m 0.545 ms - 61[0m
[0mPOST /api/public/barberias/test-barberia/barberos/698bdc40626399f145648f59/reservar [33m429[0m 0.532 ms - 61[0m
[0mPOST /api/public/barberias/test-barberia/barberos/698bdc40626399f145648f59/reservar [33m429[0m 0.554 ms - 61[0m
[0mPOST /api/public/barberias/test-barberia/barberos/698bdc40626399f145648f59/reservar [33m429[0m 0.477 ms - 61[0m
[0mPOST /api/public/barberias/test-barberia/barberos/698bdc40626399f145648f59/reservar [33m429[0m 1.349 ms - 61[0m
[0mPOST /api/public/barberias/test-barberia/barberos/698bdc40626399f145648f59/reservar [33m429[0m 0.510 ms - 61[0m
[0mPOST /api/public/barberias/test-barberia/barberos/698bdc40626399f145648f59/reservar [33m429[0m 0.575 ms - 61[0m
[0mPOST /api/public/barberias/test-barberia/barberos/698bdc40626399f145648f59/reservar [33m429[0m 0.519 ms - 61[0m
[0mPOST /api/public/barberias/test-barberia/barberos/698bdc40626399f145648f59/reservar [33m429[0m 0.483 ms - 61[0m
FAIL tests/race-condition-stress.test.js
  ÔùÅ Console

    console.log
      [dotenv@17.2.3] injecting env (13) from .env -- tip: ÔÜÖ´©Å  load multiple 
.env files with { path: ['.env.local', '.env'] }

      at _log (node_modules/dotenv/lib/main.js:142:11)

    console.log
      ƒôí [POST] 
/api/public/barberias/test-barberia/barberos/698bdc3d626399f145648db1/reservar

      at log (src/app.js:93:11)

    console.log
      ƒôí [POST] 
/api/public/barberias/test-barberia/barberos/698bdc3d626399f145648db1/reservar

      at log (src/app.js:93:11)

    console.log
      ƒôí [POST] 
/api/public/barberias/test-barberia/barberos/698bdc3d626399f145648db1/reservar

      at log (src/app.js:93:11)

    console.log
      ƒôí [POST] 
/api/public/barberias/test-barberia/barberos/698bdc3d626399f145648db1/reservar

      at log (src/app.js:93:11)

    console.log
      ƒôí [POST] 
/api/public/barberias/test-barberia/barberos/698bdc3d626399f145648db1/reservar

      at log (src/app.js:93:11)

    console.log
      ƒôí [POST] 
/api/public/barberias/test-barberia/barberos/698bdc3d626399f145648db1/reservar

      at log (src/app.js:93:11)

    console.log
      ƒôí [POST] 
/api/public/barberias/test-barberia/barberos/698bdc3d626399f145648db1/reservar

      at log (src/app.js:93:11)

    console.log
      ƒôí [POST] 
/api/public/barberias/test-barberia/barberos/698bdc3d626399f145648db1/reservar

      at log (src/app.js:93:11)

    console.log
      ƒôí [POST] 
/api/public/barberias/test-barberia/barberos/698bdc3d626399f145648db1/reservar

      at log (src/app.js:93:11)

    console.log
      ƒôí [POST] 
/api/public/barberias/test-barberia/barberos/698bdc3d626399f145648db1/reservar

      at log (src/app.js:93:11)

    console.log
      [Transaction] Started: CreateReservation (attempt 1/3)

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:54:25)

    console.log
      [Transaction] Started: CreateReservation (attempt 1/3)

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:54:25)

    console.log
      [Transaction] Started: CreateReservation (attempt 1/3)

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:54:25)

    console.log
      [Transaction] Started: CreateReservation (attempt 1/3)

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:54:25)

    console.log
      [Transaction] Started: CreateReservation (attempt 1/3)

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:54:25)

    console.log
      [Transaction] Started: CreateReservation (attempt 1/3)

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:54:25)

    console.log
      [Transaction] Started: CreateReservation (attempt 1/3)

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:54:25)

    console.log
      [Transaction] Started: CreateReservation (attempt 1/3)

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:54:25)

    console.log
      [Transaction] Started: CreateReservation (attempt 1/3)

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:54:25)

    console.log
      [Transaction] Started: CreateReservation (attempt 1/3)

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:54:25)

    console.log
      [Transaction] Committed: CreateReservation

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:61:25)

    console.log
      [Transaction] Aborted: CreateReservation

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:69:29)

    console.warn
      [Transaction] Transient error, retrying in 200ms: WriteConflict error: 
this operation conflicted with another operation. Please retry your operation or 
multi-document transaction.

    [0m [90m 74 |[39m                     attempt[33m++[39m[33m;[39m
     [90m 75 |[39m                     [36mconst[39m delay [33m=[39m 
retryDelay [33m*[39m [33mMath[39m[33m.[39mpow([35m2[39m[33m,[39m 
attempt)[33m;[39m [90m// Exponential backoff[39m
    [31m[1m>[22m[39m[90m 76 |[39m                     
console[33m.[39mwarn([32m`[Transaction] Transient error, retrying in 
${delay}ms:`[39m[33m,[39m error[33m.[39mmessage)[33m;[39m
     [90m    |[39m                             [31m[1m^[22m[39m
     [90m 77 |[39m                     [36mawait[39m 
[36mthis[39m[33m.[39msleep(delay)[33m;[39m
     [90m 78 |[39m                     [36mcontinue[39m[33m;[39m
     [90m 79 |[39m                 }[0m

      at Function.warn [as executeInTransaction] 
(src/utils/TransactionManager.js:76:29)
      at CreateReserva.execute 
(src/application/use-cases/reservas/CreateReserva.js:26:34)
      at Object.<anonymous>.exports.crearReservaBySlug 
(src/controllers/public.controller.js:140:25)

    console.log
      [Transaction] Aborted: CreateReservation

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:69:29)

    console.warn
      [Transaction] Transient error, retrying in 200ms: WriteConflict error: 
this operation conflicted with another operation. Please retry your operation or 
multi-document transaction.

    [0m [90m 74 |[39m                     attempt[33m++[39m[33m;[39m
     [90m 75 |[39m                     [36mconst[39m delay [33m=[39m 
retryDelay [33m*[39m [33mMath[39m[33m.[39mpow([35m2[39m[33m,[39m 
attempt)[33m;[39m [90m// Exponential backoff[39m
    [31m[1m>[22m[39m[90m 76 |[39m                     
console[33m.[39mwarn([32m`[Transaction] Transient error, retrying in 
${delay}ms:`[39m[33m,[39m error[33m.[39mmessage)[33m;[39m
     [90m    |[39m                             [31m[1m^[22m[39m
     [90m 77 |[39m                     [36mawait[39m 
[36mthis[39m[33m.[39msleep(delay)[33m;[39m
     [90m 78 |[39m                     [36mcontinue[39m[33m;[39m
     [90m 79 |[39m                 }[0m

      at Function.warn [as executeInTransaction] 
(src/utils/TransactionManager.js:76:29)
      at CreateReserva.execute 
(src/application/use-cases/reservas/CreateReserva.js:26:34)
      at Object.<anonymous>.exports.crearReservaBySlug 
(src/controllers/public.controller.js:140:25)

    console.log
      [Transaction] Aborted: CreateReservation

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:69:29)

    console.warn
      [Transaction] Transient error, retrying in 200ms: WriteConflict error: 
this operation conflicted with another operation. Please retry your operation or 
multi-document transaction.

    [0m [90m 74 |[39m                     attempt[33m++[39m[33m;[39m
     [90m 75 |[39m                     [36mconst[39m delay [33m=[39m 
retryDelay [33m*[39m [33mMath[39m[33m.[39mpow([35m2[39m[33m,[39m 
attempt)[33m;[39m [90m// Exponential backoff[39m
    [31m[1m>[22m[39m[90m 76 |[39m                     
console[33m.[39mwarn([32m`[Transaction] Transient error, retrying in 
${delay}ms:`[39m[33m,[39m error[33m.[39mmessage)[33m;[39m
     [90m    |[39m                             [31m[1m^[22m[39m
     [90m 77 |[39m                     [36mawait[39m 
[36mthis[39m[33m.[39msleep(delay)[33m;[39m
     [90m 78 |[39m                     [36mcontinue[39m[33m;[39m
     [90m 79 |[39m                 }[0m

      at Function.warn [as executeInTransaction] 
(src/utils/TransactionManager.js:76:29)
      at CreateReserva.execute 
(src/application/use-cases/reservas/CreateReserva.js:26:34)
      at Object.<anonymous>.exports.crearReservaBySlug 
(src/controllers/public.controller.js:140:25)

    console.log
      [Transaction] Aborted: CreateReservation

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:69:29)

    console.warn
      [Transaction] Transient error, retrying in 200ms: WriteConflict error: 
this operation conflicted with another operation. Please retry your operation or 
multi-document transaction.

    [0m [90m 74 |[39m                     attempt[33m++[39m[33m;[39m
     [90m 75 |[39m                     [36mconst[39m delay [33m=[39m 
retryDelay [33m*[39m [33mMath[39m[33m.[39mpow([35m2[39m[33m,[39m 
attempt)[33m;[39m [90m// Exponential backoff[39m
    [31m[1m>[22m[39m[90m 76 |[39m                     
console[33m.[39mwarn([32m`[Transaction] Transient error, retrying in 
${delay}ms:`[39m[33m,[39m error[33m.[39mmessage)[33m;[39m
     [90m    |[39m                             [31m[1m^[22m[39m
     [90m 77 |[39m                     [36mawait[39m 
[36mthis[39m[33m.[39msleep(delay)[33m;[39m
     [90m 78 |[39m                     [36mcontinue[39m[33m;[39m
     [90m 79 |[39m                 }[0m

      at Function.warn [as executeInTransaction] 
(src/utils/TransactionManager.js:76:29)
      at CreateReserva.execute 
(src/application/use-cases/reservas/CreateReserva.js:26:34)
      at Object.<anonymous>.exports.crearReservaBySlug 
(src/controllers/public.controller.js:140:25)

    console.log
      [Transaction] Aborted: CreateReservation

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:69:29)

    console.warn
      [Transaction] Transient error, retrying in 200ms: WriteConflict error: 
this operation conflicted with another operation. Please retry your operation or 
multi-document transaction.

    [0m [90m 74 |[39m                     attempt[33m++[39m[33m;[39m
     [90m 75 |[39m                     [36mconst[39m delay [33m=[39m 
retryDelay [33m*[39m [33mMath[39m[33m.[39mpow([35m2[39m[33m,[39m 
attempt)[33m;[39m [90m// Exponential backoff[39m
    [31m[1m>[22m[39m[90m 76 |[39m                     
console[33m.[39mwarn([32m`[Transaction] Transient error, retrying in 
${delay}ms:`[39m[33m,[39m error[33m.[39mmessage)[33m;[39m
     [90m    |[39m                             [31m[1m^[22m[39m
     [90m 77 |[39m                     [36mawait[39m 
[36mthis[39m[33m.[39msleep(delay)[33m;[39m
     [90m 78 |[39m                     [36mcontinue[39m[33m;[39m
     [90m 79 |[39m                 }[0m

      at Function.warn [as executeInTransaction] 
(src/utils/TransactionManager.js:76:29)
      at CreateReserva.execute 
(src/application/use-cases/reservas/CreateReserva.js:26:34)
      at Object.<anonymous>.exports.crearReservaBySlug 
(src/controllers/public.controller.js:140:25)

    console.log
      [Transaction] Aborted: CreateReservation

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:69:29)

    console.warn
      [Transaction] Transient error, retrying in 200ms: WriteConflict error: 
this operation conflicted with another operation. Please retry your operation or 
multi-document transaction.

    [0m [90m 74 |[39m                     attempt[33m++[39m[33m;[39m
     [90m 75 |[39m                     [36mconst[39m delay [33m=[39m 
retryDelay [33m*[39m [33mMath[39m[33m.[39mpow([35m2[39m[33m,[39m 
attempt)[33m;[39m [90m// Exponential backoff[39m
    [31m[1m>[22m[39m[90m 76 |[39m                     
console[33m.[39mwarn([32m`[Transaction] Transient error, retrying in 
${delay}ms:`[39m[33m,[39m error[33m.[39mmessage)[33m;[39m
     [90m    |[39m                             [31m[1m^[22m[39m
     [90m 77 |[39m                     [36mawait[39m 
[36mthis[39m[33m.[39msleep(delay)[33m;[39m
     [90m 78 |[39m                     [36mcontinue[39m[33m;[39m
     [90m 79 |[39m                 }[0m

      at Function.warn [as executeInTransaction] 
(src/utils/TransactionManager.js:76:29)
      at CreateReserva.execute 
(src/application/use-cases/reservas/CreateReserva.js:26:34)
      at Object.<anonymous>.exports.crearReservaBySlug 
(src/controllers/public.controller.js:140:25)

    console.log
      [Transaction] Aborted: CreateReservation

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:69:29)

    console.warn
      [Transaction] Transient error, retrying in 200ms: WriteConflict error: 
this operation conflicted with another operation. Please retry your operation or 
multi-document transaction.

    [0m [90m 74 |[39m                     attempt[33m++[39m[33m;[39m
     [90m 75 |[39m                     [36mconst[39m delay [33m=[39m 
retryDelay [33m*[39m [33mMath[39m[33m.[39mpow([35m2[39m[33m,[39m 
attempt)[33m;[39m [90m// Exponential backoff[39m
    [31m[1m>[22m[39m[90m 76 |[39m                     
console[33m.[39mwarn([32m`[Transaction] Transient error, retrying in 
${delay}ms:`[39m[33m,[39m error[33m.[39mmessage)[33m;[39m
     [90m    |[39m                             [31m[1m^[22m[39m
     [90m 77 |[39m                     [36mawait[39m 
[36mthis[39m[33m.[39msleep(delay)[33m;[39m
     [90m 78 |[39m                     [36mcontinue[39m[33m;[39m
     [90m 79 |[39m                 }[0m

      at Function.warn [as executeInTransaction] 
(src/utils/TransactionManager.js:76:29)
      at CreateReserva.execute 
(src/application/use-cases/reservas/CreateReserva.js:26:34)
      at Object.<anonymous>.exports.crearReservaBySlug 
(src/controllers/public.controller.js:140:25)

    console.log
      [Transaction] Aborted: CreateReservation

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:69:29)

    console.warn
      [Transaction] Transient error, retrying in 200ms: WriteConflict error: 
this operation conflicted with another operation. Please retry your operation or 
multi-document transaction.

    [0m [90m 74 |[39m                     attempt[33m++[39m[33m;[39m
     [90m 75 |[39m                     [36mconst[39m delay [33m=[39m 
retryDelay [33m*[39m [33mMath[39m[33m.[39mpow([35m2[39m[33m,[39m 
attempt)[33m;[39m [90m// Exponential backoff[39m
    [31m[1m>[22m[39m[90m 76 |[39m                     
console[33m.[39mwarn([32m`[Transaction] Transient error, retrying in 
${delay}ms:`[39m[33m,[39m error[33m.[39mmessage)[33m;[39m
     [90m    |[39m                             [31m[1m^[22m[39m
     [90m 77 |[39m                     [36mawait[39m 
[36mthis[39m[33m.[39msleep(delay)[33m;[39m
     [90m 78 |[39m                     [36mcontinue[39m[33m;[39m
     [90m 79 |[39m                 }[0m

      at Function.warn [as executeInTransaction] 
(src/utils/TransactionManager.js:76:29)
      at CreateReserva.execute 
(src/application/use-cases/reservas/CreateReserva.js:26:34)
      at Object.<anonymous>.exports.crearReservaBySlug 
(src/controllers/public.controller.js:140:25)

    console.log
      [Transaction] Aborted: CreateReservation

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:69:29)

    console.warn
      [Transaction] Transient error, retrying in 200ms: WriteConflict error: 
this operation conflicted with another operation. Please retry your operation or 
multi-document transaction.

    [0m [90m 74 |[39m                     attempt[33m++[39m[33m;[39m
     [90m 75 |[39m                     [36mconst[39m delay [33m=[39m 
retryDelay [33m*[39m [33mMath[39m[33m.[39mpow([35m2[39m[33m,[39m 
attempt)[33m;[39m [90m// Exponential backoff[39m
    [31m[1m>[22m[39m[90m 76 |[39m                     
console[33m.[39mwarn([32m`[Transaction] Transient error, retrying in 
${delay}ms:`[39m[33m,[39m error[33m.[39mmessage)[33m;[39m
     [90m    |[39m                             [31m[1m^[22m[39m
     [90m 77 |[39m                     [36mawait[39m 
[36mthis[39m[33m.[39msleep(delay)[33m;[39m
     [90m 78 |[39m                     [36mcontinue[39m[33m;[39m
     [90m 79 |[39m                 }[0m

      at Function.warn [as executeInTransaction] 
(src/utils/TransactionManager.js:76:29)
      at CreateReserva.execute 
(src/application/use-cases/reservas/CreateReserva.js:26:34)
      at Object.<anonymous>.exports.crearReservaBySlug 
(src/controllers/public.controller.js:140:25)

    console.log
      [Transaction] Started: CreateReservation (attempt 2/3)

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:54:25)

    console.log
      [Transaction] Started: CreateReservation (attempt 2/3)

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:54:25)

    console.log
      [Transaction] Started: CreateReservation (attempt 2/3)

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:54:25)

    console.log
      [Transaction] Started: CreateReservation (attempt 2/3)

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:54:25)

    console.log
      [Transaction] Started: CreateReservation (attempt 2/3)

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:54:25)

    console.log
      [Transaction] Started: CreateReservation (attempt 2/3)

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:54:25)

    console.log
      [Transaction] Started: CreateReservation (attempt 2/3)

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:54:25)

    console.log
      [Transaction] Started: CreateReservation (attempt 2/3)

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:54:25)

    console.log
      [Transaction] Started: CreateReservation (attempt 2/3)

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:54:25)

    console.log
      [Transaction] Aborted: CreateReservation

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:69:29)

    console.error
      [Transaction] Failed: CreateReservation {
        error: `E11000 duplicate key error collection: test.reservas index: 
unique_reservation_slot dup key: { barberoId: 
ObjectId('698bdc3d626399f145648db1'), fecha: new Date(1773532800000), hora: 
"10:00", barberiaId: ObjectId('698bdc3d626399f145648daf') }`,
        attempt: 2,
        stack: `MongoServerError: E11000 duplicate key error collection: 
test.reservas index: unique_reservation_slot dup key: { barberoId: 
ObjectId('698bdc3d626399f145648db1'), fecha: new Date(1773532800000), hora: 
"10:00", barberiaId: ObjectId('698bdc3d626399f145648daf') }\n` +
          '    at InsertOneOperation.handleOk (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\node_modules\\mongodb\\src\\operations\\insert.ts:79:13)\n' +
          '    at tryOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\backen
d\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:294:26)\n' +
          '    at processTicksAndRejections 
(node:internal/process/task_queues:105:5)\n' +
          '    at executeOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\ba
ckend\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:123:12)\n' +
          '    at Collection.insertOne (C:\\Users\\Kristian\\Desktop\\barber-saas
\\backend\\node_modules\\mongodb\\src\\collection.ts:294:12)\n' +
          '    at model.$__save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backe
nd\\node_modules\\mongoose\\lib\\model.js:398:16)\n' +
          '    at model.save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\
\node_modules\\mongoose\\lib\\model.js:609:5)\n' +
          '    at C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\\node_module
s\\mongoose\\lib\\model.js:2722:9\n' +
          '    at async Promise.all (index 0)\n' +
          '    at Function.create (C:\\Users\\Kristian\\Desktop\\barber-saas\\bac
kend\\node_modules\\mongoose\\lib\\model.js:2707:11)\n' +
          '    at MongoReservaRepository.save (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\src\\infrastructure\\database\\mongodb\\repositories\\MongoRese
rvaRepository.js:15:16)\n' +
          '    at TransactionManager.executeInTransaction.operationName (C:\\User
s\\Kristian\\Desktop\\barber-saas\\backend\\src\\application\\use-cases\\reservas
\\CreateReserva.js:72:42)\n' +
          '    at Function.executeInTransaction (C:\\Users\\Kristian\\Desktop\\ba
rber-saas\\backend\\src\\utils\\TransactionManager.js:57:32)\n' +
          '    at CreateReserva.execute (C:\\Users\\Kristian\\Desktop\\barber-saa
s\\backend\\src\\application\\use-cases\\reservas\\CreateReserva.js:26:34)\n' +
          '    at Object.<anonymous>.exports.crearReservaBySlug (C:\\Users\\Krist
ian\\Desktop\\barber-saas\\backend\\src\\controllers\\public.controller.js:140:25
)'
      }

    [0m [90m 80 |[39m
     [90m 81 |[39m                 [90m// Non-transient error or max retries 
reached[39m
    [31m[1m>[22m[39m[90m 82 |[39m                 
console[33m.[39merror([32m`[Transaction] Failed: 
${operationName}`[39m[33m,[39m {
     [90m    |[39m                         [31m[1m^[22m[39m
     [90m 83 |[39m                     error[33m:[39m 
error[33m.[39mmessage[33m,[39m
     [90m 84 |[39m                     attempt[33m:[39m attempt [33m+[39m 
[35m1[39m[33m,[39m
     [90m 85 |[39m                     stack[33m:[39m 
error[33m.[39mstack[0m

      at Function.error [as executeInTransaction] 
(src/utils/TransactionManager.js:82:25)
      at CreateReserva.execute 
(src/application/use-cases/reservas/CreateReserva.js:26:34)
      at Object.<anonymous>.exports.crearReservaBySlug 
(src/controllers/public.controller.js:140:25)

    console.log
      [Transaction] Aborted: CreateReservation

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:69:29)

    console.error
      [Transaction] Failed: CreateReservation {
        error: `E11000 duplicate key error collection: test.reservas index: 
unique_reservation_slot dup key: { barberoId: 
ObjectId('698bdc3d626399f145648db1'), fecha: new Date(1773532800000), hora: 
"10:00", barberiaId: ObjectId('698bdc3d626399f145648daf') }`,
        attempt: 2,
        stack: `MongoServerError: E11000 duplicate key error collection: 
test.reservas index: unique_reservation_slot dup key: { barberoId: 
ObjectId('698bdc3d626399f145648db1'), fecha: new Date(1773532800000), hora: 
"10:00", barberiaId: ObjectId('698bdc3d626399f145648daf') }\n` +
          '    at InsertOneOperation.handleOk (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\node_modules\\mongodb\\src\\operations\\insert.ts:79:13)\n' +
          '    at tryOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\backen
d\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:294:26)\n' +
          '    at processTicksAndRejections 
(node:internal/process/task_queues:105:5)\n' +
          '    at executeOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\ba
ckend\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:123:12)\n' +
          '    at Collection.insertOne (C:\\Users\\Kristian\\Desktop\\barber-saas
\\backend\\node_modules\\mongodb\\src\\collection.ts:294:12)\n' +
          '    at model.$__save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backe
nd\\node_modules\\mongoose\\lib\\model.js:398:16)\n' +
          '    at model.save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\
\node_modules\\mongoose\\lib\\model.js:609:5)\n' +
          '    at C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\\node_module
s\\mongoose\\lib\\model.js:2722:9\n' +
          '    at async Promise.all (index 0)\n' +
          '    at Function.create (C:\\Users\\Kristian\\Desktop\\barber-saas\\bac
kend\\node_modules\\mongoose\\lib\\model.js:2707:11)\n' +
          '    at MongoReservaRepository.save (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\src\\infrastructure\\database\\mongodb\\repositories\\MongoRese
rvaRepository.js:15:16)\n' +
          '    at TransactionManager.executeInTransaction.operationName (C:\\User
s\\Kristian\\Desktop\\barber-saas\\backend\\src\\application\\use-cases\\reservas
\\CreateReserva.js:72:42)\n' +
          '    at Function.executeInTransaction (C:\\Users\\Kristian\\Desktop\\ba
rber-saas\\backend\\src\\utils\\TransactionManager.js:57:32)\n' +
          '    at CreateReserva.execute (C:\\Users\\Kristian\\Desktop\\barber-saa
s\\backend\\src\\application\\use-cases\\reservas\\CreateReserva.js:26:34)\n' +
          '    at Object.<anonymous>.exports.crearReservaBySlug (C:\\Users\\Krist
ian\\Desktop\\barber-saas\\backend\\src\\controllers\\public.controller.js:140:25
)'
      }

    [0m [90m 80 |[39m
     [90m 81 |[39m                 [90m// Non-transient error or max retries 
reached[39m
    [31m[1m>[22m[39m[90m 82 |[39m                 
console[33m.[39merror([32m`[Transaction] Failed: 
${operationName}`[39m[33m,[39m {
     [90m    |[39m                         [31m[1m^[22m[39m
     [90m 83 |[39m                     error[33m:[39m 
error[33m.[39mmessage[33m,[39m
     [90m 84 |[39m                     attempt[33m:[39m attempt [33m+[39m 
[35m1[39m[33m,[39m
     [90m 85 |[39m                     stack[33m:[39m 
error[33m.[39mstack[0m

      at Function.error [as executeInTransaction] 
(src/utils/TransactionManager.js:82:25)
      at CreateReserva.execute 
(src/application/use-cases/reservas/CreateReserva.js:26:34)
      at Object.<anonymous>.exports.crearReservaBySlug 
(src/controllers/public.controller.js:140:25)

    console.log
      [Transaction] Aborted: CreateReservation

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:69:29)

    console.error
      [Transaction] Failed: CreateReservation {
        error: `E11000 duplicate key error collection: test.reservas index: 
unique_reservation_slot dup key: { barberoId: 
ObjectId('698bdc3d626399f145648db1'), fecha: new Date(1773532800000), hora: 
"10:00", barberiaId: ObjectId('698bdc3d626399f145648daf') }`,
        attempt: 2,
        stack: `MongoServerError: E11000 duplicate key error collection: 
test.reservas index: unique_reservation_slot dup key: { barberoId: 
ObjectId('698bdc3d626399f145648db1'), fecha: new Date(1773532800000), hora: 
"10:00", barberiaId: ObjectId('698bdc3d626399f145648daf') }\n` +
          '    at InsertOneOperation.handleOk (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\node_modules\\mongodb\\src\\operations\\insert.ts:79:13)\n' +
          '    at tryOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\backen
d\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:294:26)\n' +
          '    at processTicksAndRejections 
(node:internal/process/task_queues:105:5)\n' +
          '    at executeOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\ba
ckend\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:123:12)\n' +
          '    at Collection.insertOne (C:\\Users\\Kristian\\Desktop\\barber-saas
\\backend\\node_modules\\mongodb\\src\\collection.ts:294:12)\n' +
          '    at model.$__save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backe
nd\\node_modules\\mongoose\\lib\\model.js:398:16)\n' +
          '    at model.save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\
\node_modules\\mongoose\\lib\\model.js:609:5)\n' +
          '    at C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\\node_module
s\\mongoose\\lib\\model.js:2722:9\n' +
          '    at async Promise.all (index 0)\n' +
          '    at Function.create (C:\\Users\\Kristian\\Desktop\\barber-saas\\bac
kend\\node_modules\\mongoose\\lib\\model.js:2707:11)\n' +
          '    at MongoReservaRepository.save (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\src\\infrastructure\\database\\mongodb\\repositories\\MongoRese
rvaRepository.js:15:16)\n' +
          '    at TransactionManager.executeInTransaction.operationName (C:\\User
s\\Kristian\\Desktop\\barber-saas\\backend\\src\\application\\use-cases\\reservas
\\CreateReserva.js:72:42)\n' +
          '    at Function.executeInTransaction (C:\\Users\\Kristian\\Desktop\\ba
rber-saas\\backend\\src\\utils\\TransactionManager.js:57:32)\n' +
          '    at CreateReserva.execute (C:\\Users\\Kristian\\Desktop\\barber-saa
s\\backend\\src\\application\\use-cases\\reservas\\CreateReserva.js:26:34)\n' +
          '    at Object.<anonymous>.exports.crearReservaBySlug (C:\\Users\\Krist
ian\\Desktop\\barber-saas\\backend\\src\\controllers\\public.controller.js:140:25
)'
      }

    [0m [90m 80 |[39m
     [90m 81 |[39m                 [90m// Non-transient error or max retries 
reached[39m
    [31m[1m>[22m[39m[90m 82 |[39m                 
console[33m.[39merror([32m`[Transaction] Failed: 
${operationName}`[39m[33m,[39m {
     [90m    |[39m                         [31m[1m^[22m[39m
     [90m 83 |[39m                     error[33m:[39m 
error[33m.[39mmessage[33m,[39m
     [90m 84 |[39m                     attempt[33m:[39m attempt [33m+[39m 
[35m1[39m[33m,[39m
     [90m 85 |[39m                     stack[33m:[39m 
error[33m.[39mstack[0m

      at Function.error [as executeInTransaction] 
(src/utils/TransactionManager.js:82:25)
      at CreateReserva.execute 
(src/application/use-cases/reservas/CreateReserva.js:26:34)
      at Object.<anonymous>.exports.crearReservaBySlug 
(src/controllers/public.controller.js:140:25)

    console.error
      ƒö┤ ERROR: TransactionError: Transaction failed for CreateReservation: 
E11000 duplicate key error collection: test.reservas index: 
unique_reservation_slot dup key: { barberoId: 
ObjectId('698bdc3d626399f145648db1'), fecha: new Date(1773532800000), hora: 
"10:00", barberiaId: ObjectId('698bdc3d626399f145648daf') }
          at Function.executeInTransaction (C:\Users\Kristian\Desktop\barber-saas
\backend\src\utils\TransactionManager.js:88:42)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at CreateReserva.execute (C:\Users\Kristian\Desktop\barber-saas\backend
\src\application\use-cases\reservas\CreateReserva.js:26:34)
          at Object.<anonymous>.exports.crearReservaBySlug (C:\Users\Kristian\Des
ktop\barber-saas\backend\src\controllers\public.controller.js:140:25) {
        isTransactionError: true,
        originalError: MongoServerError: E11000 duplicate key error collection: 
test.reservas index: unique_reservation_slot dup key: { barberoId: 
ObjectId('698bdc3d626399f145648db1'), fecha: new Date(1773532800000), hora: 
"10:00", barberiaId: ObjectId('698bdc3d626399f145648daf') }
            at InsertOneOperation.handleOk (C:\Users\Kristian\Desktop\barber-saas
\backend\node_modules\mongodb\src\operations\insert.ts:79:13)
            at tryOperation (C:\Users\Kristian\Desktop\barber-saas\backend\node_m
odules\mongodb\src\operations\execute_operation.ts:294:26)
            at processTicksAndRejections 
(node:internal/process/task_queues:105:5)
            at executeOperation (C:\Users\Kristian\Desktop\barber-saas\backend\no
de_modules\mongodb\src\operations\execute_operation.ts:123:12)
            at Collection.insertOne (C:\Users\Kristian\Desktop\barber-saas\backen
d\node_modules\mongodb\src\collection.ts:294:12)
            at model.$__save (C:\Users\Kristian\Desktop\barber-saas\backend\node_
modules\mongoose\lib\model.js:398:16)
            at model.save (C:\Users\Kristian\Desktop\barber-saas\backend\node_mod
ules\mongoose\lib\model.js:609:5)
            at C:\Users\Kristian\Desktop\barber-saas\backend\node_modules\mongoos
e\lib\model.js:2722:9
            at async Promise.all (index 0)
            at Function.create (C:\Users\Kristian\Desktop\barber-saas\backend\nod
e_modules\mongoose\lib\model.js:2707:11)
            at MongoReservaRepository.save (C:\Users\Kristian\Desktop\barber-saas
\backend\src\infrastructure\database\mongodb\repositories\MongoReservaRepository.
js:15:16)
            at TransactionManager.executeInTransaction.operationName (C:\Users\Kr
istian\Desktop\barber-saas\backend\src\application\use-cases\reservas\CreateReser
va.js:72:42)
            at Function.executeInTransaction (C:\Users\Kristian\Desktop\barber-sa
as\backend\src\utils\TransactionManager.js:57:32)
            at CreateReserva.execute (C:\Users\Kristian\Desktop\barber-saas\backe
nd\src\application\use-cases\reservas\CreateReserva.js:26:34)
            at Object.<anonymous>.exports.crearReservaBySlug (C:\Users\Kristian\D
esktop\barber-saas\backend\src\controllers\public.controller.js:140:25) {
          errorLabelSet: Set(0) {},
          errorResponse: {
            index: 0,
            code: 11000,
            errmsg: `E11000 duplicate key error collection: test.reservas index: 
unique_reservation_slot dup key: { barberoId: 
ObjectId('698bdc3d626399f145648db1'), fecha: new Date(1773532800000), hora: 
"10:00", barberiaId: ObjectId('698bdc3d626399f145648daf') }`,
            keyPattern: [Object],
            keyValue: [Object]
          },
          index: 0,
          code: 11000,
          keyPattern: { barberoId: 1, fecha: 1, hora: 1, barberiaId: 1 },
          keyValue: {
            barberoId: new ObjectId('698bdc3d626399f145648db1'),
            fecha: 2026-03-15T00:00:00.000Z,
            hora: '10:00',
            barberiaId: new ObjectId('698bdc3d626399f145648daf')
          }
        },
        context: { operationName: 'CreateReservation', attempt: 2 },
        timestamp: 2026-02-11T01:32:46.464Z,
        originalStack: `MongoServerError: E11000 duplicate key error collection: 
test.reservas index: unique_reservation_slot dup key: { barberoId: 
ObjectId('698bdc3d626399f145648db1'), fecha: new Date(1773532800000), hora: 
"10:00", barberiaId: ObjectId('698bdc3d626399f145648daf') }\n` +
          '    at InsertOneOperation.handleOk (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\node_modules\\mongodb\\src\\operations\\insert.ts:79:13)\n' +
          '    at tryOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\backen
d\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:294:26)\n' +
          '    at processTicksAndRejections 
(node:internal/process/task_queues:105:5)\n' +
          '    at executeOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\ba
ckend\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:123:12)\n' +
          '    at Collection.insertOne (C:\\Users\\Kristian\\Desktop\\barber-saas
\\backend\\node_modules\\mongodb\\src\\collection.ts:294:12)\n' +
          '    at model.$__save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backe
nd\\node_modules\\mongoose\\lib\\model.js:398:16)\n' +
          '    at model.save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\
\node_modules\\mongoose\\lib\\model.js:609:5)\n' +
          '    at C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\\node_module
s\\mongoose\\lib\\model.js:2722:9\n' +
          '    at async Promise.all (index 0)\n' +
          '    at Function.create (C:\\Users\\Kristian\\Desktop\\barber-saas\\bac
kend\\node_modules\\mongoose\\lib\\model.js:2707:11)\n' +
          '    at MongoReservaRepository.save (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\src\\infrastructure\\database\\mongodb\\repositories\\MongoRese
rvaRepository.js:15:16)\n' +
          '    at TransactionManager.executeInTransaction.operationName (C:\\User
s\\Kristian\\Desktop\\barber-saas\\backend\\src\\application\\use-cases\\reservas
\\CreateReserva.js:72:42)\n' +
          '    at Function.executeInTransaction (C:\\Users\\Kristian\\Desktop\\ba
rber-saas\\backend\\src\\utils\\TransactionManager.js:57:32)\n' +
          '    at CreateReserva.execute (C:\\Users\\Kristian\\Desktop\\barber-saa
s\\backend\\src\\application\\use-cases\\reservas\\CreateReserva.js:26:34)\n' +
          '    at Object.<anonymous>.exports.crearReservaBySlug (C:\\Users\\Krist
ian\\Desktop\\barber-saas\\backend\\src\\controllers\\public.controller.js:140:25
)'
      }

    [0m [90m 4 |[39m
     [90m 5 |[39m [36mconst[39m errorHandler [33m=[39m (err[33m,[39m 
req[33m,[39m res[33m,[39m next) [33m=>[39m {
    [31m[1m>[22m[39m[90m 6 |[39m   console[33m.[39merror([32m"ƒö┤ 
ERROR:"[39m[33m,[39m err)[33m;[39m
     [90m   |[39m           [31m[1m^[22m[39m
     [90m 7 |[39m
     [90m 8 |[39m   [90m// ­ƒöÑ A├æADIR HEADERS CORS SI NO EXISTEN[39m
     [90m 9 |[39m   [36mconst[39m origin [33m=[39m 
req[33m.[39mheaders[33m.[39morigin[33m;[39m[0m

      at error (src/config/middleware/errorHandler.js:6:11)
      at Layer.handleError (node_modules/router/lib/layer.js:116:17)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at Layer.handleError (node_modules/router/lib/layer.js:111:12)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at Immediate.next (node_modules/router/index.js:291:5)
      at Immediate._onImmediate (node_modules/router/index.js:688:15)

    console.error
      ƒö┤ ERROR: TransactionError: Transaction failed for CreateReservation: 
E11000 duplicate key error collection: test.reservas index: 
unique_reservation_slot dup key: { barberoId: 
ObjectId('698bdc3d626399f145648db1'), fecha: new Date(1773532800000), hora: 
"10:00", barberiaId: ObjectId('698bdc3d626399f145648daf') }
          at Function.executeInTransaction (C:\Users\Kristian\Desktop\barber-saas
\backend\src\utils\TransactionManager.js:88:42)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at CreateReserva.execute (C:\Users\Kristian\Desktop\barber-saas\backend
\src\application\use-cases\reservas\CreateReserva.js:26:34)
          at Object.<anonymous>.exports.crearReservaBySlug (C:\Users\Kristian\Des
ktop\barber-saas\backend\src\controllers\public.controller.js:140:25) {
        isTransactionError: true,
        originalError: MongoServerError: E11000 duplicate key error collection: 
test.reservas index: unique_reservation_slot dup key: { barberoId: 
ObjectId('698bdc3d626399f145648db1'), fecha: new Date(1773532800000), hora: 
"10:00", barberiaId: ObjectId('698bdc3d626399f145648daf') }
            at InsertOneOperation.handleOk (C:\Users\Kristian\Desktop\barber-saas
\backend\node_modules\mongodb\src\operations\insert.ts:79:13)
            at tryOperation (C:\Users\Kristian\Desktop\barber-saas\backend\node_m
odules\mongodb\src\operations\execute_operation.ts:294:26)
            at processTicksAndRejections 
(node:internal/process/task_queues:105:5)
            at executeOperation (C:\Users\Kristian\Desktop\barber-saas\backend\no
de_modules\mongodb\src\operations\execute_operation.ts:123:12)
            at Collection.insertOne (C:\Users\Kristian\Desktop\barber-saas\backen
d\node_modules\mongodb\src\collection.ts:294:12)
            at model.$__save (C:\Users\Kristian\Desktop\barber-saas\backend\node_
modules\mongoose\lib\model.js:398:16)
            at model.save (C:\Users\Kristian\Desktop\barber-saas\backend\node_mod
ules\mongoose\lib\model.js:609:5)
            at C:\Users\Kristian\Desktop\barber-saas\backend\node_modules\mongoos
e\lib\model.js:2722:9
            at async Promise.all (index 0)
            at Function.create (C:\Users\Kristian\Desktop\barber-saas\backend\nod
e_modules\mongoose\lib\model.js:2707:11)
            at MongoReservaRepository.save (C:\Users\Kristian\Desktop\barber-saas
\backend\src\infrastructure\database\mongodb\repositories\MongoReservaRepository.
js:15:16)
            at TransactionManager.executeInTransaction.operationName (C:\Users\Kr
istian\Desktop\barber-saas\backend\src\application\use-cases\reservas\CreateReser
va.js:72:42)
            at Function.executeInTransaction (C:\Users\Kristian\Desktop\barber-sa
as\backend\src\utils\TransactionManager.js:57:32)
            at CreateReserva.execute (C:\Users\Kristian\Desktop\barber-saas\backe
nd\src\application\use-cases\reservas\CreateReserva.js:26:34)
            at Object.<anonymous>.exports.crearReservaBySlug (C:\Users\Kristian\D
esktop\barber-saas\backend\src\controllers\public.controller.js:140:25) {
          errorLabelSet: Set(0) {},
          errorResponse: {
            index: 0,
            code: 11000,
            errmsg: `E11000 duplicate key error collection: test.reservas index: 
unique_reservation_slot dup key: { barberoId: 
ObjectId('698bdc3d626399f145648db1'), fecha: new Date(1773532800000), hora: 
"10:00", barberiaId: ObjectId('698bdc3d626399f145648daf') }`,
            keyPattern: [Object],
            keyValue: [Object]
          },
          index: 0,
          code: 11000,
          keyPattern: { barberoId: 1, fecha: 1, hora: 1, barberiaId: 1 },
          keyValue: {
            barberoId: new ObjectId('698bdc3d626399f145648db1'),
            fecha: 2026-03-15T00:00:00.000Z,
            hora: '10:00',
            barberiaId: new ObjectId('698bdc3d626399f145648daf')
          }
        },
        context: { operationName: 'CreateReservation', attempt: 2 },
        timestamp: 2026-02-11T01:32:46.466Z,
        originalStack: `MongoServerError: E11000 duplicate key error collection: 
test.reservas index: unique_reservation_slot dup key: { barberoId: 
ObjectId('698bdc3d626399f145648db1'), fecha: new Date(1773532800000), hora: 
"10:00", barberiaId: ObjectId('698bdc3d626399f145648daf') }\n` +
          '    at InsertOneOperation.handleOk (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\node_modules\\mongodb\\src\\operations\\insert.ts:79:13)\n' +
          '    at tryOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\backen
d\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:294:26)\n' +
          '    at processTicksAndRejections 
(node:internal/process/task_queues:105:5)\n' +
          '    at executeOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\ba
ckend\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:123:12)\n' +
          '    at Collection.insertOne (C:\\Users\\Kristian\\Desktop\\barber-saas
\\backend\\node_modules\\mongodb\\src\\collection.ts:294:12)\n' +
          '    at model.$__save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backe
nd\\node_modules\\mongoose\\lib\\model.js:398:16)\n' +
          '    at model.save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\
\node_modules\\mongoose\\lib\\model.js:609:5)\n' +
          '    at C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\\node_module
s\\mongoose\\lib\\model.js:2722:9\n' +
          '    at async Promise.all (index 0)\n' +
          '    at Function.create (C:\\Users\\Kristian\\Desktop\\barber-saas\\bac
kend\\node_modules\\mongoose\\lib\\model.js:2707:11)\n' +
          '    at MongoReservaRepository.save (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\src\\infrastructure\\database\\mongodb\\repositories\\MongoRese
rvaRepository.js:15:16)\n' +
          '    at TransactionManager.executeInTransaction.operationName (C:\\User
s\\Kristian\\Desktop\\barber-saas\\backend\\src\\application\\use-cases\\reservas
\\CreateReserva.js:72:42)\n' +
          '    at Function.executeInTransaction (C:\\Users\\Kristian\\Desktop\\ba
rber-saas\\backend\\src\\utils\\TransactionManager.js:57:32)\n' +
          '    at CreateReserva.execute (C:\\Users\\Kristian\\Desktop\\barber-saa
s\\backend\\src\\application\\use-cases\\reservas\\CreateReserva.js:26:34)\n' +
          '    at Object.<anonymous>.exports.crearReservaBySlug (C:\\Users\\Krist
ian\\Desktop\\barber-saas\\backend\\src\\controllers\\public.controller.js:140:25
)'
      }

    [0m [90m 4 |[39m
     [90m 5 |[39m [36mconst[39m errorHandler [33m=[39m (err[33m,[39m 
req[33m,[39m res[33m,[39m next) [33m=>[39m {
    [31m[1m>[22m[39m[90m 6 |[39m   console[33m.[39merror([32m"ƒö┤ 
ERROR:"[39m[33m,[39m err)[33m;[39m
     [90m   |[39m           [31m[1m^[22m[39m
     [90m 7 |[39m
     [90m 8 |[39m   [90m// ­ƒöÑ A├æADIR HEADERS CORS SI NO EXISTEN[39m
     [90m 9 |[39m   [36mconst[39m origin [33m=[39m 
req[33m.[39mheaders[33m.[39morigin[33m;[39m[0m

      at error (src/config/middleware/errorHandler.js:6:11)
      at Layer.handleError (node_modules/router/lib/layer.js:116:17)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at Layer.handleError (node_modules/router/lib/layer.js:111:12)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at Immediate.next (node_modules/router/index.js:291:5)
      at Immediate._onImmediate (node_modules/router/index.js:688:15)

    console.error
      ƒö┤ ERROR: TransactionError: Transaction failed for CreateReservation: 
E11000 duplicate key error collection: test.reservas index: 
unique_reservation_slot dup key: { barberoId: 
ObjectId('698bdc3d626399f145648db1'), fecha: new Date(1773532800000), hora: 
"10:00", barberiaId: ObjectId('698bdc3d626399f145648daf') }
          at Function.executeInTransaction (C:\Users\Kristian\Desktop\barber-saas
\backend\src\utils\TransactionManager.js:88:42)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at CreateReserva.execute (C:\Users\Kristian\Desktop\barber-saas\backend
\src\application\use-cases\reservas\CreateReserva.js:26:34)
          at Object.<anonymous>.exports.crearReservaBySlug (C:\Users\Kristian\Des
ktop\barber-saas\backend\src\controllers\public.controller.js:140:25) {
        isTransactionError: true,
        originalError: MongoServerError: E11000 duplicate key error collection: 
test.reservas index: unique_reservation_slot dup key: { barberoId: 
ObjectId('698bdc3d626399f145648db1'), fecha: new Date(1773532800000), hora: 
"10:00", barberiaId: ObjectId('698bdc3d626399f145648daf') }
            at InsertOneOperation.handleOk (C:\Users\Kristian\Desktop\barber-saas
\backend\node_modules\mongodb\src\operations\insert.ts:79:13)
            at tryOperation (C:\Users\Kristian\Desktop\barber-saas\backend\node_m
odules\mongodb\src\operations\execute_operation.ts:294:26)
            at processTicksAndRejections 
(node:internal/process/task_queues:105:5)
            at executeOperation (C:\Users\Kristian\Desktop\barber-saas\backend\no
de_modules\mongodb\src\operations\execute_operation.ts:123:12)
            at Collection.insertOne (C:\Users\Kristian\Desktop\barber-saas\backen
d\node_modules\mongodb\src\collection.ts:294:12)
            at model.$__save (C:\Users\Kristian\Desktop\barber-saas\backend\node_
modules\mongoose\lib\model.js:398:16)
            at model.save (C:\Users\Kristian\Desktop\barber-saas\backend\node_mod
ules\mongoose\lib\model.js:609:5)
            at C:\Users\Kristian\Desktop\barber-saas\backend\node_modules\mongoos
e\lib\model.js:2722:9
            at async Promise.all (index 0)
            at Function.create (C:\Users\Kristian\Desktop\barber-saas\backend\nod
e_modules\mongoose\lib\model.js:2707:11)
            at MongoReservaRepository.save (C:\Users\Kristian\Desktop\barber-saas
\backend\src\infrastructure\database\mongodb\repositories\MongoReservaRepository.
js:15:16)
            at TransactionManager.executeInTransaction.operationName (C:\Users\Kr
istian\Desktop\barber-saas\backend\src\application\use-cases\reservas\CreateReser
va.js:72:42)
            at Function.executeInTransaction (C:\Users\Kristian\Desktop\barber-sa
as\backend\src\utils\TransactionManager.js:57:32)
            at CreateReserva.execute (C:\Users\Kristian\Desktop\barber-saas\backe
nd\src\application\use-cases\reservas\CreateReserva.js:26:34)
            at Object.<anonymous>.exports.crearReservaBySlug (C:\Users\Kristian\D
esktop\barber-saas\backend\src\controllers\public.controller.js:140:25) {
          errorLabelSet: Set(0) {},
          errorResponse: {
            index: 0,
            code: 11000,
            errmsg: `E11000 duplicate key error collection: test.reservas index: 
unique_reservation_slot dup key: { barberoId: 
ObjectId('698bdc3d626399f145648db1'), fecha: new Date(1773532800000), hora: 
"10:00", barberiaId: ObjectId('698bdc3d626399f145648daf') }`,
            keyPattern: [Object],
            keyValue: [Object]
          },
          index: 0,
          code: 11000,
          keyPattern: { barberoId: 1, fecha: 1, hora: 1, barberiaId: 1 },
          keyValue: {
            barberoId: new ObjectId('698bdc3d626399f145648db1'),
            fecha: 2026-03-15T00:00:00.000Z,
            hora: '10:00',
            barberiaId: new ObjectId('698bdc3d626399f145648daf')
          }
        },
        context: { operationName: 'CreateReservation', attempt: 2 },
        timestamp: 2026-02-11T01:32:46.467Z,
        originalStack: `MongoServerError: E11000 duplicate key error collection: 
test.reservas index: unique_reservation_slot dup key: { barberoId: 
ObjectId('698bdc3d626399f145648db1'), fecha: new Date(1773532800000), hora: 
"10:00", barberiaId: ObjectId('698bdc3d626399f145648daf') }\n` +
          '    at InsertOneOperation.handleOk (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\node_modules\\mongodb\\src\\operations\\insert.ts:79:13)\n' +
          '    at tryOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\backen
d\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:294:26)\n' +
          '    at processTicksAndRejections 
(node:internal/process/task_queues:105:5)\n' +
          '    at executeOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\ba
ckend\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:123:12)\n' +
          '    at Collection.insertOne (C:\\Users\\Kristian\\Desktop\\barber-saas
\\backend\\node_modules\\mongodb\\src\\collection.ts:294:12)\n' +
          '    at model.$__save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backe
nd\\node_modules\\mongoose\\lib\\model.js:398:16)\n' +
          '    at model.save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\
\node_modules\\mongoose\\lib\\model.js:609:5)\n' +
          '    at C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\\node_module
s\\mongoose\\lib\\model.js:2722:9\n' +
          '    at async Promise.all (index 0)\n' +
          '    at Function.create (C:\\Users\\Kristian\\Desktop\\barber-saas\\bac
kend\\node_modules\\mongoose\\lib\\model.js:2707:11)\n' +
          '    at MongoReservaRepository.save (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\src\\infrastructure\\database\\mongodb\\repositories\\MongoRese
rvaRepository.js:15:16)\n' +
          '    at TransactionManager.executeInTransaction.operationName (C:\\User
s\\Kristian\\Desktop\\barber-saas\\backend\\src\\application\\use-cases\\reservas
\\CreateReserva.js:72:42)\n' +
          '    at Function.executeInTransaction (C:\\Users\\Kristian\\Desktop\\ba
rber-saas\\backend\\src\\utils\\TransactionManager.js:57:32)\n' +
          '    at CreateReserva.execute (C:\\Users\\Kristian\\Desktop\\barber-saa
s\\backend\\src\\application\\use-cases\\reservas\\CreateReserva.js:26:34)\n' +
          '    at Object.<anonymous>.exports.crearReservaBySlug (C:\\Users\\Krist
ian\\Desktop\\barber-saas\\backend\\src\\controllers\\public.controller.js:140:25
)'
      }

    [0m [90m 4 |[39m
     [90m 5 |[39m [36mconst[39m errorHandler [33m=[39m (err[33m,[39m 
req[33m,[39m res[33m,[39m next) [33m=>[39m {
    [31m[1m>[22m[39m[90m 6 |[39m   console[33m.[39merror([32m"ƒö┤ 
ERROR:"[39m[33m,[39m err)[33m;[39m
     [90m   |[39m           [31m[1m^[22m[39m
     [90m 7 |[39m
     [90m 8 |[39m   [90m// ­ƒöÑ A├æADIR HEADERS CORS SI NO EXISTEN[39m
     [90m 9 |[39m   [36mconst[39m origin [33m=[39m 
req[33m.[39mheaders[33m.[39morigin[33m;[39m[0m

      at error (src/config/middleware/errorHandler.js:6:11)
      at Layer.handleError (node_modules/router/lib/layer.js:116:17)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at Layer.handleError (node_modules/router/lib/layer.js:111:12)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at Immediate.next (node_modules/router/index.js:291:5)
      at Immediate._onImmediate (node_modules/router/index.js:688:15)

    console.log
      [Transaction] Aborted: CreateReservation

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:69:29)

    console.error
      [Transaction] Failed: CreateReservation {
        error: `E11000 duplicate key error collection: test.reservas index: 
unique_reservation_slot dup key: { barberoId: 
ObjectId('698bdc3d626399f145648db1'), fecha: new Date(1773532800000), hora: 
"10:00", barberiaId: ObjectId('698bdc3d626399f145648daf') }`,
        attempt: 2,
        stack: `MongoServerError: E11000 duplicate key error collection: 
test.reservas index: unique_reservation_slot dup key: { barberoId: 
ObjectId('698bdc3d626399f145648db1'), fecha: new Date(1773532800000), hora: 
"10:00", barberiaId: ObjectId('698bdc3d626399f145648daf') }\n` +
          '    at InsertOneOperation.handleOk (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\node_modules\\mongodb\\src\\operations\\insert.ts:79:13)\n' +
          '    at tryOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\backen
d\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:294:26)\n' +
          '    at processTicksAndRejections 
(node:internal/process/task_queues:105:5)\n' +
          '    at executeOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\ba
ckend\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:123:12)\n' +
          '    at Collection.insertOne (C:\\Users\\Kristian\\Desktop\\barber-saas
\\backend\\node_modules\\mongodb\\src\\collection.ts:294:12)\n' +
          '    at model.$__save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backe
nd\\node_modules\\mongoose\\lib\\model.js:398:16)\n' +
          '    at model.save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\
\node_modules\\mongoose\\lib\\model.js:609:5)\n' +
          '    at C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\\node_module
s\\mongoose\\lib\\model.js:2722:9\n' +
          '    at async Promise.all (index 0)\n' +
          '    at Function.create (C:\\Users\\Kristian\\Desktop\\barber-saas\\bac
kend\\node_modules\\mongoose\\lib\\model.js:2707:11)\n' +
          '    at MongoReservaRepository.save (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\src\\infrastructure\\database\\mongodb\\repositories\\MongoRese
rvaRepository.js:15:16)\n' +
          '    at TransactionManager.executeInTransaction.operationName (C:\\User
s\\Kristian\\Desktop\\barber-saas\\backend\\src\\application\\use-cases\\reservas
\\CreateReserva.js:72:42)\n' +
          '    at Function.executeInTransaction (C:\\Users\\Kristian\\Desktop\\ba
rber-saas\\backend\\src\\utils\\TransactionManager.js:57:32)\n' +
          '    at CreateReserva.execute (C:\\Users\\Kristian\\Desktop\\barber-saa
s\\backend\\src\\application\\use-cases\\reservas\\CreateReserva.js:26:34)\n' +
          '    at Object.<anonymous>.exports.crearReservaBySlug (C:\\Users\\Krist
ian\\Desktop\\barber-saas\\backend\\src\\controllers\\public.controller.js:140:25
)'
      }

    [0m [90m 80 |[39m
     [90m 81 |[39m                 [90m// Non-transient error or max retries 
reached[39m
    [31m[1m>[22m[39m[90m 82 |[39m                 
console[33m.[39merror([32m`[Transaction] Failed: 
${operationName}`[39m[33m,[39m {
     [90m    |[39m                         [31m[1m^[22m[39m
     [90m 83 |[39m                     error[33m:[39m 
error[33m.[39mmessage[33m,[39m
     [90m 84 |[39m                     attempt[33m:[39m attempt [33m+[39m 
[35m1[39m[33m,[39m
     [90m 85 |[39m                     stack[33m:[39m 
error[33m.[39mstack[0m

      at Function.error [as executeInTransaction] 
(src/utils/TransactionManager.js:82:25)
      at CreateReserva.execute 
(src/application/use-cases/reservas/CreateReserva.js:26:34)
      at Object.<anonymous>.exports.crearReservaBySlug 
(src/controllers/public.controller.js:140:25)

    console.log
      [Transaction] Aborted: CreateReservation

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:69:29)

    console.error
      [Transaction] Failed: CreateReservation {
        error: `E11000 duplicate key error collection: test.reservas index: 
unique_reservation_slot dup key: { barberoId: 
ObjectId('698bdc3d626399f145648db1'), fecha: new Date(1773532800000), hora: 
"10:00", barberiaId: ObjectId('698bdc3d626399f145648daf') }`,
        attempt: 2,
        stack: `MongoServerError: E11000 duplicate key error collection: 
test.reservas index: unique_reservation_slot dup key: { barberoId: 
ObjectId('698bdc3d626399f145648db1'), fecha: new Date(1773532800000), hora: 
"10:00", barberiaId: ObjectId('698bdc3d626399f145648daf') }\n` +
          '    at InsertOneOperation.handleOk (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\node_modules\\mongodb\\src\\operations\\insert.ts:79:13)\n' +
          '    at tryOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\backen
d\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:294:26)\n' +
          '    at processTicksAndRejections 
(node:internal/process/task_queues:105:5)\n' +
          '    at executeOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\ba
ckend\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:123:12)\n' +
          '    at Collection.insertOne (C:\\Users\\Kristian\\Desktop\\barber-saas
\\backend\\node_modules\\mongodb\\src\\collection.ts:294:12)\n' +
          '    at model.$__save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backe
nd\\node_modules\\mongoose\\lib\\model.js:398:16)\n' +
          '    at model.save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\
\node_modules\\mongoose\\lib\\model.js:609:5)\n' +
          '    at C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\\node_module
s\\mongoose\\lib\\model.js:2722:9\n' +
          '    at async Promise.all (index 0)\n' +
          '    at Function.create (C:\\Users\\Kristian\\Desktop\\barber-saas\\bac
kend\\node_modules\\mongoose\\lib\\model.js:2707:11)\n' +
          '    at MongoReservaRepository.save (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\src\\infrastructure\\database\\mongodb\\repositories\\MongoRese
rvaRepository.js:15:16)\n' +
          '    at TransactionManager.executeInTransaction.operationName (C:\\User
s\\Kristian\\Desktop\\barber-saas\\backend\\src\\application\\use-cases\\reservas
\\CreateReserva.js:72:42)\n' +
          '    at Function.executeInTransaction (C:\\Users\\Kristian\\Desktop\\ba
rber-saas\\backend\\src\\utils\\TransactionManager.js:57:32)\n' +
          '    at CreateReserva.execute (C:\\Users\\Kristian\\Desktop\\barber-saa
s\\backend\\src\\application\\use-cases\\reservas\\CreateReserva.js:26:34)\n' +
          '    at Object.<anonymous>.exports.crearReservaBySlug (C:\\Users\\Krist
ian\\Desktop\\barber-saas\\backend\\src\\controllers\\public.controller.js:140:25
)'
      }

    [0m [90m 80 |[39m
     [90m 81 |[39m                 [90m// Non-transient error or max retries 
reached[39m
    [31m[1m>[22m[39m[90m 82 |[39m                 
console[33m.[39merror([32m`[Transaction] Failed: 
${operationName}`[39m[33m,[39m {
     [90m    |[39m                         [31m[1m^[22m[39m
     [90m 83 |[39m                     error[33m:[39m 
error[33m.[39mmessage[33m,[39m
     [90m 84 |[39m                     attempt[33m:[39m attempt [33m+[39m 
[35m1[39m[33m,[39m
     [90m 85 |[39m                     stack[33m:[39m 
error[33m.[39mstack[0m

      at Function.error [as executeInTransaction] 
(src/utils/TransactionManager.js:82:25)
      at CreateReserva.execute 
(src/application/use-cases/reservas/CreateReserva.js:26:34)
      at Object.<anonymous>.exports.crearReservaBySlug 
(src/controllers/public.controller.js:140:25)

    console.log
      [Transaction] Aborted: CreateReservation

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:69:29)

    console.error
      [Transaction] Failed: CreateReservation {
        error: `E11000 duplicate key error collection: test.reservas index: 
unique_reservation_slot dup key: { barberoId: 
ObjectId('698bdc3d626399f145648db1'), fecha: new Date(1773532800000), hora: 
"10:00", barberiaId: ObjectId('698bdc3d626399f145648daf') }`,
        attempt: 2,
        stack: `MongoServerError: E11000 duplicate key error collection: 
test.reservas index: unique_reservation_slot dup key: { barberoId: 
ObjectId('698bdc3d626399f145648db1'), fecha: new Date(1773532800000), hora: 
"10:00", barberiaId: ObjectId('698bdc3d626399f145648daf') }\n` +
          '    at InsertOneOperation.handleOk (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\node_modules\\mongodb\\src\\operations\\insert.ts:79:13)\n' +
          '    at tryOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\backen
d\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:294:26)\n' +
          '    at processTicksAndRejections 
(node:internal/process/task_queues:105:5)\n' +
          '    at executeOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\ba
ckend\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:123:12)\n' +
          '    at Collection.insertOne (C:\\Users\\Kristian\\Desktop\\barber-saas
\\backend\\node_modules\\mongodb\\src\\collection.ts:294:12)\n' +
          '    at model.$__save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backe
nd\\node_modules\\mongoose\\lib\\model.js:398:16)\n' +
          '    at model.save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\
\node_modules\\mongoose\\lib\\model.js:609:5)\n' +
          '    at C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\\node_module
s\\mongoose\\lib\\model.js:2722:9\n' +
          '    at async Promise.all (index 0)\n' +
          '    at Function.create (C:\\Users\\Kristian\\Desktop\\barber-saas\\bac
kend\\node_modules\\mongoose\\lib\\model.js:2707:11)\n' +
          '    at MongoReservaRepository.save (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\src\\infrastructure\\database\\mongodb\\repositories\\MongoRese
rvaRepository.js:15:16)\n' +
          '    at TransactionManager.executeInTransaction.operationName (C:\\User
s\\Kristian\\Desktop\\barber-saas\\backend\\src\\application\\use-cases\\reservas
\\CreateReserva.js:72:42)\n' +
          '    at Function.executeInTransaction (C:\\Users\\Kristian\\Desktop\\ba
rber-saas\\backend\\src\\utils\\TransactionManager.js:57:32)\n' +
          '    at CreateReserva.execute (C:\\Users\\Kristian\\Desktop\\barber-saa
s\\backend\\src\\application\\use-cases\\reservas\\CreateReserva.js:26:34)\n' +
          '    at Object.<anonymous>.exports.crearReservaBySlug (C:\\Users\\Krist
ian\\Desktop\\barber-saas\\backend\\src\\controllers\\public.controller.js:140:25
)'
      }

    [0m [90m 80 |[39m
     [90m 81 |[39m                 [90m// Non-transient error or max retries 
reached[39m
    [31m[1m>[22m[39m[90m 82 |[39m                 
console[33m.[39merror([32m`[Transaction] Failed: 
${operationName}`[39m[33m,[39m {
     [90m    |[39m                         [31m[1m^[22m[39m
     [90m 83 |[39m                     error[33m:[39m 
error[33m.[39mmessage[33m,[39m
     [90m 84 |[39m                     attempt[33m:[39m attempt [33m+[39m 
[35m1[39m[33m,[39m
     [90m 85 |[39m                     stack[33m:[39m 
error[33m.[39mstack[0m

      at Function.error [as executeInTransaction] 
(src/utils/TransactionManager.js:82:25)
      at CreateReserva.execute 
(src/application/use-cases/reservas/CreateReserva.js:26:34)
      at Object.<anonymous>.exports.crearReservaBySlug 
(src/controllers/public.controller.js:140:25)

    console.log
      [Transaction] Aborted: CreateReservation

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:69:29)

    console.error
      [Transaction] Failed: CreateReservation {
        error: `E11000 duplicate key error collection: test.reservas index: 
unique_reservation_slot dup key: { barberoId: 
ObjectId('698bdc3d626399f145648db1'), fecha: new Date(1773532800000), hora: 
"10:00", barberiaId: ObjectId('698bdc3d626399f145648daf') }`,
        attempt: 2,
        stack: `MongoServerError: E11000 duplicate key error collection: 
test.reservas index: unique_reservation_slot dup key: { barberoId: 
ObjectId('698bdc3d626399f145648db1'), fecha: new Date(1773532800000), hora: 
"10:00", barberiaId: ObjectId('698bdc3d626399f145648daf') }\n` +
          '    at InsertOneOperation.handleOk (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\node_modules\\mongodb\\src\\operations\\insert.ts:79:13)\n' +
          '    at tryOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\backen
d\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:294:26)\n' +
          '    at processTicksAndRejections 
(node:internal/process/task_queues:105:5)\n' +
          '    at executeOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\ba
ckend\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:123:12)\n' +
          '    at Collection.insertOne (C:\\Users\\Kristian\\Desktop\\barber-saas
\\backend\\node_modules\\mongodb\\src\\collection.ts:294:12)\n' +
          '    at model.$__save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backe
nd\\node_modules\\mongoose\\lib\\model.js:398:16)\n' +
          '    at model.save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\
\node_modules\\mongoose\\lib\\model.js:609:5)\n' +
          '    at C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\\node_module
s\\mongoose\\lib\\model.js:2722:9\n' +
          '    at async Promise.all (index 0)\n' +
          '    at Function.create (C:\\Users\\Kristian\\Desktop\\barber-saas\\bac
kend\\node_modules\\mongoose\\lib\\model.js:2707:11)\n' +
          '    at MongoReservaRepository.save (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\src\\infrastructure\\database\\mongodb\\repositories\\MongoRese
rvaRepository.js:15:16)\n' +
          '    at TransactionManager.executeInTransaction.operationName (C:\\User
s\\Kristian\\Desktop\\barber-saas\\backend\\src\\application\\use-cases\\reservas
\\CreateReserva.js:72:42)\n' +
          '    at Function.executeInTransaction (C:\\Users\\Kristian\\Desktop\\ba
rber-saas\\backend\\src\\utils\\TransactionManager.js:57:32)\n' +
          '    at CreateReserva.execute (C:\\Users\\Kristian\\Desktop\\barber-saa
s\\backend\\src\\application\\use-cases\\reservas\\CreateReserva.js:26:34)\n' +
          '    at Object.<anonymous>.exports.crearReservaBySlug (C:\\Users\\Krist
ian\\Desktop\\barber-saas\\backend\\src\\controllers\\public.controller.js:140:25
)'
      }

    [0m [90m 80 |[39m
     [90m 81 |[39m                 [90m// Non-transient error or max retries 
reached[39m
    [31m[1m>[22m[39m[90m 82 |[39m                 
console[33m.[39merror([32m`[Transaction] Failed: 
${operationName}`[39m[33m,[39m {
     [90m    |[39m                         [31m[1m^[22m[39m
     [90m 83 |[39m                     error[33m:[39m 
error[33m.[39mmessage[33m,[39m
     [90m 84 |[39m                     attempt[33m:[39m attempt [33m+[39m 
[35m1[39m[33m,[39m
     [90m 85 |[39m                     stack[33m:[39m 
error[33m.[39mstack[0m

      at Function.error [as executeInTransaction] 
(src/utils/TransactionManager.js:82:25)
      at CreateReserva.execute 
(src/application/use-cases/reservas/CreateReserva.js:26:34)
      at Object.<anonymous>.exports.crearReservaBySlug 
(src/controllers/public.controller.js:140:25)

    console.log
      [Transaction] Aborted: CreateReservation

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:69:29)

    console.error
      [Transaction] Failed: CreateReservation {
        error: `E11000 duplicate key error collection: test.reservas index: 
unique_reservation_slot dup key: { barberoId: 
ObjectId('698bdc3d626399f145648db1'), fecha: new Date(1773532800000), hora: 
"10:00", barberiaId: ObjectId('698bdc3d626399f145648daf') }`,
        attempt: 2,
        stack: `MongoServerError: E11000 duplicate key error collection: 
test.reservas index: unique_reservation_slot dup key: { barberoId: 
ObjectId('698bdc3d626399f145648db1'), fecha: new Date(1773532800000), hora: 
"10:00", barberiaId: ObjectId('698bdc3d626399f145648daf') }\n` +
          '    at InsertOneOperation.handleOk (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\node_modules\\mongodb\\src\\operations\\insert.ts:79:13)\n' +
          '    at tryOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\backen
d\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:294:26)\n' +
          '    at processTicksAndRejections 
(node:internal/process/task_queues:105:5)\n' +
          '    at executeOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\ba
ckend\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:123:12)\n' +
          '    at Collection.insertOne (C:\\Users\\Kristian\\Desktop\\barber-saas
\\backend\\node_modules\\mongodb\\src\\collection.ts:294:12)\n' +
          '    at model.$__save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backe
nd\\node_modules\\mongoose\\lib\\model.js:398:16)\n' +
          '    at model.save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\
\node_modules\\mongoose\\lib\\model.js:609:5)\n' +
          '    at C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\\node_module
s\\mongoose\\lib\\model.js:2722:9\n' +
          '    at async Promise.all (index 0)\n' +
          '    at Function.create (C:\\Users\\Kristian\\Desktop\\barber-saas\\bac
kend\\node_modules\\mongoose\\lib\\model.js:2707:11)\n' +
          '    at MongoReservaRepository.save (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\src\\infrastructure\\database\\mongodb\\repositories\\MongoRese
rvaRepository.js:15:16)\n' +
          '    at TransactionManager.executeInTransaction.operationName (C:\\User
s\\Kristian\\Desktop\\barber-saas\\backend\\src\\application\\use-cases\\reservas
\\CreateReserva.js:72:42)\n' +
          '    at Function.executeInTransaction (C:\\Users\\Kristian\\Desktop\\ba
rber-saas\\backend\\src\\utils\\TransactionManager.js:57:32)\n' +
          '    at CreateReserva.execute (C:\\Users\\Kristian\\Desktop\\barber-saa
s\\backend\\src\\application\\use-cases\\reservas\\CreateReserva.js:26:34)\n' +
          '    at Object.<anonymous>.exports.crearReservaBySlug (C:\\Users\\Krist
ian\\Desktop\\barber-saas\\backend\\src\\controllers\\public.controller.js:140:25
)'
      }

    [0m [90m 80 |[39m
     [90m 81 |[39m                 [90m// Non-transient error or max retries 
reached[39m
    [31m[1m>[22m[39m[90m 82 |[39m                 
console[33m.[39merror([32m`[Transaction] Failed: 
${operationName}`[39m[33m,[39m {
     [90m    |[39m                         [31m[1m^[22m[39m
     [90m 83 |[39m                     error[33m:[39m 
error[33m.[39mmessage[33m,[39m
     [90m 84 |[39m                     attempt[33m:[39m attempt [33m+[39m 
[35m1[39m[33m,[39m
     [90m 85 |[39m                     stack[33m:[39m 
error[33m.[39mstack[0m

      at Function.error [as executeInTransaction] 
(src/utils/TransactionManager.js:82:25)
      at CreateReserva.execute 
(src/application/use-cases/reservas/CreateReserva.js:26:34)
      at Object.<anonymous>.exports.crearReservaBySlug 
(src/controllers/public.controller.js:140:25)

    console.log
      [Transaction] Aborted: CreateReservation

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:69:29)

    console.error
      [Transaction] Failed: CreateReservation {
        error: `E11000 duplicate key error collection: test.reservas index: 
unique_reservation_slot dup key: { barberoId: 
ObjectId('698bdc3d626399f145648db1'), fecha: new Date(1773532800000), hora: 
"10:00", barberiaId: ObjectId('698bdc3d626399f145648daf') }`,
        attempt: 2,
        stack: `MongoServerError: E11000 duplicate key error collection: 
test.reservas index: unique_reservation_slot dup key: { barberoId: 
ObjectId('698bdc3d626399f145648db1'), fecha: new Date(1773532800000), hora: 
"10:00", barberiaId: ObjectId('698bdc3d626399f145648daf') }\n` +
          '    at InsertOneOperation.handleOk (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\node_modules\\mongodb\\src\\operations\\insert.ts:79:13)\n' +
          '    at tryOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\backen
d\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:294:26)\n' +
          '    at processTicksAndRejections 
(node:internal/process/task_queues:105:5)\n' +
          '    at executeOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\ba
ckend\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:123:12)\n' +
          '    at Collection.insertOne (C:\\Users\\Kristian\\Desktop\\barber-saas
\\backend\\node_modules\\mongodb\\src\\collection.ts:294:12)\n' +
          '    at model.$__save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backe
nd\\node_modules\\mongoose\\lib\\model.js:398:16)\n' +
          '    at model.save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\
\node_modules\\mongoose\\lib\\model.js:609:5)\n' +
          '    at C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\\node_module
s\\mongoose\\lib\\model.js:2722:9\n' +
          '    at async Promise.all (index 0)\n' +
          '    at Function.create (C:\\Users\\Kristian\\Desktop\\barber-saas\\bac
kend\\node_modules\\mongoose\\lib\\model.js:2707:11)\n' +
          '    at MongoReservaRepository.save (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\src\\infrastructure\\database\\mongodb\\repositories\\MongoRese
rvaRepository.js:15:16)\n' +
          '    at TransactionManager.executeInTransaction.operationName (C:\\User
s\\Kristian\\Desktop\\barber-saas\\backend\\src\\application\\use-cases\\reservas
\\CreateReserva.js:72:42)\n' +
          '    at Function.executeInTransaction (C:\\Users\\Kristian\\Desktop\\ba
rber-saas\\backend\\src\\utils\\TransactionManager.js:57:32)\n' +
          '    at CreateReserva.execute (C:\\Users\\Kristian\\Desktop\\barber-saa
s\\backend\\src\\application\\use-cases\\reservas\\CreateReserva.js:26:34)\n' +
          '    at Object.<anonymous>.exports.crearReservaBySlug (C:\\Users\\Krist
ian\\Desktop\\barber-saas\\backend\\src\\controllers\\public.controller.js:140:25
)'
      }

    [0m [90m 80 |[39m
     [90m 81 |[39m                 [90m// Non-transient error or max retries 
reached[39m
    [31m[1m>[22m[39m[90m 82 |[39m                 
console[33m.[39merror([32m`[Transaction] Failed: 
${operationName}`[39m[33m,[39m {
     [90m    |[39m                         [31m[1m^[22m[39m
     [90m 83 |[39m                     error[33m:[39m 
error[33m.[39mmessage[33m,[39m
     [90m 84 |[39m                     attempt[33m:[39m attempt [33m+[39m 
[35m1[39m[33m,[39m
     [90m 85 |[39m                     stack[33m:[39m 
error[33m.[39mstack[0m

      at Function.error [as executeInTransaction] 
(src/utils/TransactionManager.js:82:25)
      at CreateReserva.execute 
(src/application/use-cases/reservas/CreateReserva.js:26:34)
      at Object.<anonymous>.exports.crearReservaBySlug 
(src/controllers/public.controller.js:140:25)

    console.error
      ƒö┤ ERROR: TransactionError: Transaction failed for CreateReservation: 
E11000 duplicate key error collection: test.reservas index: 
unique_reservation_slot dup key: { barberoId: 
ObjectId('698bdc3d626399f145648db1'), fecha: new Date(1773532800000), hora: 
"10:00", barberiaId: ObjectId('698bdc3d626399f145648daf') }
          at Function.executeInTransaction (C:\Users\Kristian\Desktop\barber-saas
\backend\src\utils\TransactionManager.js:88:42)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at CreateReserva.execute (C:\Users\Kristian\Desktop\barber-saas\backend
\src\application\use-cases\reservas\CreateReserva.js:26:34)
          at Object.<anonymous>.exports.crearReservaBySlug (C:\Users\Kristian\Des
ktop\barber-saas\backend\src\controllers\public.controller.js:140:25) {
        isTransactionError: true,
        originalError: MongoServerError: E11000 duplicate key error collection: 
test.reservas index: unique_reservation_slot dup key: { barberoId: 
ObjectId('698bdc3d626399f145648db1'), fecha: new Date(1773532800000), hora: 
"10:00", barberiaId: ObjectId('698bdc3d626399f145648daf') }
            at InsertOneOperation.handleOk (C:\Users\Kristian\Desktop\barber-saas
\backend\node_modules\mongodb\src\operations\insert.ts:79:13)
            at tryOperation (C:\Users\Kristian\Desktop\barber-saas\backend\node_m
odules\mongodb\src\operations\execute_operation.ts:294:26)
            at processTicksAndRejections 
(node:internal/process/task_queues:105:5)
            at executeOperation (C:\Users\Kristian\Desktop\barber-saas\backend\no
de_modules\mongodb\src\operations\execute_operation.ts:123:12)
            at Collection.insertOne (C:\Users\Kristian\Desktop\barber-saas\backen
d\node_modules\mongodb\src\collection.ts:294:12)
            at model.$__save (C:\Users\Kristian\Desktop\barber-saas\backend\node_
modules\mongoose\lib\model.js:398:16)
            at model.save (C:\Users\Kristian\Desktop\barber-saas\backend\node_mod
ules\mongoose\lib\model.js:609:5)
            at C:\Users\Kristian\Desktop\barber-saas\backend\node_modules\mongoos
e\lib\model.js:2722:9
            at async Promise.all (index 0)
            at Function.create (C:\Users\Kristian\Desktop\barber-saas\backend\nod
e_modules\mongoose\lib\model.js:2707:11)
            at MongoReservaRepository.save (C:\Users\Kristian\Desktop\barber-saas
\backend\src\infrastructure\database\mongodb\repositories\MongoReservaRepository.
js:15:16)
            at TransactionManager.executeInTransaction.operationName (C:\Users\Kr
istian\Desktop\barber-saas\backend\src\application\use-cases\reservas\CreateReser
va.js:72:42)
            at Function.executeInTransaction (C:\Users\Kristian\Desktop\barber-sa
as\backend\src\utils\TransactionManager.js:57:32)
            at CreateReserva.execute (C:\Users\Kristian\Desktop\barber-saas\backe
nd\src\application\use-cases\reservas\CreateReserva.js:26:34)
            at Object.<anonymous>.exports.crearReservaBySlug (C:\Users\Kristian\D
esktop\barber-saas\backend\src\controllers\public.controller.js:140:25) {
          errorLabelSet: Set(0) {},
          errorResponse: {
            index: 0,
            code: 11000,
            errmsg: `E11000 duplicate key error collection: test.reservas index: 
unique_reservation_slot dup key: { barberoId: 
ObjectId('698bdc3d626399f145648db1'), fecha: new Date(1773532800000), hora: 
"10:00", barberiaId: ObjectId('698bdc3d626399f145648daf') }`,
            keyPattern: [Object],
            keyValue: [Object]
          },
          index: 0,
          code: 11000,
          keyPattern: { barberoId: 1, fecha: 1, hora: 1, barberiaId: 1 },
          keyValue: {
            barberoId: new ObjectId('698bdc3d626399f145648db1'),
            fecha: 2026-03-15T00:00:00.000Z,
            hora: '10:00',
            barberiaId: new ObjectId('698bdc3d626399f145648daf')
          }
        },
        context: { operationName: 'CreateReservation', attempt: 2 },
        timestamp: 2026-02-11T01:32:46.473Z,
        originalStack: `MongoServerError: E11000 duplicate key error collection: 
test.reservas index: unique_reservation_slot dup key: { barberoId: 
ObjectId('698bdc3d626399f145648db1'), fecha: new Date(1773532800000), hora: 
"10:00", barberiaId: ObjectId('698bdc3d626399f145648daf') }\n` +
          '    at InsertOneOperation.handleOk (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\node_modules\\mongodb\\src\\operations\\insert.ts:79:13)\n' +
          '    at tryOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\backen
d\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:294:26)\n' +
          '    at processTicksAndRejections 
(node:internal/process/task_queues:105:5)\n' +
          '    at executeOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\ba
ckend\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:123:12)\n' +
          '    at Collection.insertOne (C:\\Users\\Kristian\\Desktop\\barber-saas
\\backend\\node_modules\\mongodb\\src\\collection.ts:294:12)\n' +
          '    at model.$__save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backe
nd\\node_modules\\mongoose\\lib\\model.js:398:16)\n' +
          '    at model.save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\
\node_modules\\mongoose\\lib\\model.js:609:5)\n' +
          '    at C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\\node_module
s\\mongoose\\lib\\model.js:2722:9\n' +
          '    at async Promise.all (index 0)\n' +
          '    at Function.create (C:\\Users\\Kristian\\Desktop\\barber-saas\\bac
kend\\node_modules\\mongoose\\lib\\model.js:2707:11)\n' +
          '    at MongoReservaRepository.save (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\src\\infrastructure\\database\\mongodb\\repositories\\MongoRese
rvaRepository.js:15:16)\n' +
          '    at TransactionManager.executeInTransaction.operationName (C:\\User
s\\Kristian\\Desktop\\barber-saas\\backend\\src\\application\\use-cases\\reservas
\\CreateReserva.js:72:42)\n' +
          '    at Function.executeInTransaction (C:\\Users\\Kristian\\Desktop\\ba
rber-saas\\backend\\src\\utils\\TransactionManager.js:57:32)\n' +
          '    at CreateReserva.execute (C:\\Users\\Kristian\\Desktop\\barber-saa
s\\backend\\src\\application\\use-cases\\reservas\\CreateReserva.js:26:34)\n' +
          '    at Object.<anonymous>.exports.crearReservaBySlug (C:\\Users\\Krist
ian\\Desktop\\barber-saas\\backend\\src\\controllers\\public.controller.js:140:25
)'
      }

    [0m [90m 4 |[39m
     [90m 5 |[39m [36mconst[39m errorHandler [33m=[39m (err[33m,[39m 
req[33m,[39m res[33m,[39m next) [33m=>[39m {
    [31m[1m>[22m[39m[90m 6 |[39m   console[33m.[39merror([32m"ƒö┤ 
ERROR:"[39m[33m,[39m err)[33m;[39m
     [90m   |[39m           [31m[1m^[22m[39m
     [90m 7 |[39m
     [90m 8 |[39m   [90m// ­ƒöÑ A├æADIR HEADERS CORS SI NO EXISTEN[39m
     [90m 9 |[39m   [36mconst[39m origin [33m=[39m 
req[33m.[39mheaders[33m.[39morigin[33m;[39m[0m

      at error (src/config/middleware/errorHandler.js:6:11)
      at Layer.handleError (node_modules/router/lib/layer.js:116:17)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at Layer.handleError (node_modules/router/lib/layer.js:111:12)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at Immediate.next (node_modules/router/index.js:291:5)
      at Immediate._onImmediate (node_modules/router/index.js:688:15)

    console.error
      ƒö┤ ERROR: TransactionError: Transaction failed for CreateReservation: 
E11000 duplicate key error collection: test.reservas index: 
unique_reservation_slot dup key: { barberoId: 
ObjectId('698bdc3d626399f145648db1'), fecha: new Date(1773532800000), hora: 
"10:00", barberiaId: ObjectId('698bdc3d626399f145648daf') }
          at Function.executeInTransaction (C:\Users\Kristian\Desktop\barber-saas
\backend\src\utils\TransactionManager.js:88:42)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at CreateReserva.execute (C:\Users\Kristian\Desktop\barber-saas\backend
\src\application\use-cases\reservas\CreateReserva.js:26:34)
          at Object.<anonymous>.exports.crearReservaBySlug (C:\Users\Kristian\Des
ktop\barber-saas\backend\src\controllers\public.controller.js:140:25) {
        isTransactionError: true,
        originalError: MongoServerError: E11000 duplicate key error collection: 
test.reservas index: unique_reservation_slot dup key: { barberoId: 
ObjectId('698bdc3d626399f145648db1'), fecha: new Date(1773532800000), hora: 
"10:00", barberiaId: ObjectId('698bdc3d626399f145648daf') }
            at InsertOneOperation.handleOk (C:\Users\Kristian\Desktop\barber-saas
\backend\node_modules\mongodb\src\operations\insert.ts:79:13)
            at tryOperation (C:\Users\Kristian\Desktop\barber-saas\backend\node_m
odules\mongodb\src\operations\execute_operation.ts:294:26)
            at processTicksAndRejections 
(node:internal/process/task_queues:105:5)
            at executeOperation (C:\Users\Kristian\Desktop\barber-saas\backend\no
de_modules\mongodb\src\operations\execute_operation.ts:123:12)
            at Collection.insertOne (C:\Users\Kristian\Desktop\barber-saas\backen
d\node_modules\mongodb\src\collection.ts:294:12)
            at model.$__save (C:\Users\Kristian\Desktop\barber-saas\backend\node_
modules\mongoose\lib\model.js:398:16)
            at model.save (C:\Users\Kristian\Desktop\barber-saas\backend\node_mod
ules\mongoose\lib\model.js:609:5)
            at C:\Users\Kristian\Desktop\barber-saas\backend\node_modules\mongoos
e\lib\model.js:2722:9
            at async Promise.all (index 0)
            at Function.create (C:\Users\Kristian\Desktop\barber-saas\backend\nod
e_modules\mongoose\lib\model.js:2707:11)
            at MongoReservaRepository.save (C:\Users\Kristian\Desktop\barber-saas
\backend\src\infrastructure\database\mongodb\repositories\MongoReservaRepository.
js:15:16)
            at TransactionManager.executeInTransaction.operationName (C:\Users\Kr
istian\Desktop\barber-saas\backend\src\application\use-cases\reservas\CreateReser
va.js:72:42)
            at Function.executeInTransaction (C:\Users\Kristian\Desktop\barber-sa
as\backend\src\utils\TransactionManager.js:57:32)
            at CreateReserva.execute (C:\Users\Kristian\Desktop\barber-saas\backe
nd\src\application\use-cases\reservas\CreateReserva.js:26:34)
            at Object.<anonymous>.exports.crearReservaBySlug (C:\Users\Kristian\D
esktop\barber-saas\backend\src\controllers\public.controller.js:140:25) {
          errorLabelSet: Set(0) {},
          errorResponse: {
            index: 0,
            code: 11000,
            errmsg: `E11000 duplicate key error collection: test.reservas index: 
unique_reservation_slot dup key: { barberoId: 
ObjectId('698bdc3d626399f145648db1'), fecha: new Date(1773532800000), hora: 
"10:00", barberiaId: ObjectId('698bdc3d626399f145648daf') }`,
            keyPattern: [Object],
            keyValue: [Object]
          },
          index: 0,
          code: 11000,
          keyPattern: { barberoId: 1, fecha: 1, hora: 1, barberiaId: 1 },
          keyValue: {
            barberoId: new ObjectId('698bdc3d626399f145648db1'),
            fecha: 2026-03-15T00:00:00.000Z,
            hora: '10:00',
            barberiaId: new ObjectId('698bdc3d626399f145648daf')
          }
        },
        context: { operationName: 'CreateReservation', attempt: 2 },
        timestamp: 2026-02-11T01:32:46.474Z,
        originalStack: `MongoServerError: E11000 duplicate key error collection: 
test.reservas index: unique_reservation_slot dup key: { barberoId: 
ObjectId('698bdc3d626399f145648db1'), fecha: new Date(1773532800000), hora: 
"10:00", barberiaId: ObjectId('698bdc3d626399f145648daf') }\n` +
          '    at InsertOneOperation.handleOk (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\node_modules\\mongodb\\src\\operations\\insert.ts:79:13)\n' +
          '    at tryOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\backen
d\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:294:26)\n' +
          '    at processTicksAndRejections 
(node:internal/process/task_queues:105:5)\n' +
          '    at executeOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\ba
ckend\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:123:12)\n' +
          '    at Collection.insertOne (C:\\Users\\Kristian\\Desktop\\barber-saas
\\backend\\node_modules\\mongodb\\src\\collection.ts:294:12)\n' +
          '    at model.$__save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backe
nd\\node_modules\\mongoose\\lib\\model.js:398:16)\n' +
          '    at model.save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\
\node_modules\\mongoose\\lib\\model.js:609:5)\n' +
          '    at C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\\node_module
s\\mongoose\\lib\\model.js:2722:9\n' +
          '    at async Promise.all (index 0)\n' +
          '    at Function.create (C:\\Users\\Kristian\\Desktop\\barber-saas\\bac
kend\\node_modules\\mongoose\\lib\\model.js:2707:11)\n' +
          '    at MongoReservaRepository.save (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\src\\infrastructure\\database\\mongodb\\repositories\\MongoRese
rvaRepository.js:15:16)\n' +
          '    at TransactionManager.executeInTransaction.operationName (C:\\User
s\\Kristian\\Desktop\\barber-saas\\backend\\src\\application\\use-cases\\reservas
\\CreateReserva.js:72:42)\n' +
          '    at Function.executeInTransaction (C:\\Users\\Kristian\\Desktop\\ba
rber-saas\\backend\\src\\utils\\TransactionManager.js:57:32)\n' +
          '    at CreateReserva.execute (C:\\Users\\Kristian\\Desktop\\barber-saa
s\\backend\\src\\application\\use-cases\\reservas\\CreateReserva.js:26:34)\n' +
          '    at Object.<anonymous>.exports.crearReservaBySlug (C:\\Users\\Krist
ian\\Desktop\\barber-saas\\backend\\src\\controllers\\public.controller.js:140:25
)'
      }

    [0m [90m 4 |[39m
     [90m 5 |[39m [36mconst[39m errorHandler [33m=[39m (err[33m,[39m 
req[33m,[39m res[33m,[39m next) [33m=>[39m {
    [31m[1m>[22m[39m[90m 6 |[39m   console[33m.[39merror([32m"ƒö┤ 
ERROR:"[39m[33m,[39m err)[33m;[39m
     [90m   |[39m           [31m[1m^[22m[39m
     [90m 7 |[39m
     [90m 8 |[39m   [90m// ­ƒöÑ A├æADIR HEADERS CORS SI NO EXISTEN[39m
     [90m 9 |[39m   [36mconst[39m origin [33m=[39m 
req[33m.[39mheaders[33m.[39morigin[33m;[39m[0m

      at error (src/config/middleware/errorHandler.js:6:11)
      at Layer.handleError (node_modules/router/lib/layer.js:116:17)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at Layer.handleError (node_modules/router/lib/layer.js:111:12)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at Immediate.next (node_modules/router/index.js:291:5)
      at Immediate._onImmediate (node_modules/router/index.js:688:15)

    console.error
      ƒö┤ ERROR: TransactionError: Transaction failed for CreateReservation: 
E11000 duplicate key error collection: test.reservas index: 
unique_reservation_slot dup key: { barberoId: 
ObjectId('698bdc3d626399f145648db1'), fecha: new Date(1773532800000), hora: 
"10:00", barberiaId: ObjectId('698bdc3d626399f145648daf') }
          at Function.executeInTransaction (C:\Users\Kristian\Desktop\barber-saas
\backend\src\utils\TransactionManager.js:88:42)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at CreateReserva.execute (C:\Users\Kristian\Desktop\barber-saas\backend
\src\application\use-cases\reservas\CreateReserva.js:26:34)
          at Object.<anonymous>.exports.crearReservaBySlug (C:\Users\Kristian\Des
ktop\barber-saas\backend\src\controllers\public.controller.js:140:25) {
        isTransactionError: true,
        originalError: MongoServerError: E11000 duplicate key error collection: 
test.reservas index: unique_reservation_slot dup key: { barberoId: 
ObjectId('698bdc3d626399f145648db1'), fecha: new Date(1773532800000), hora: 
"10:00", barberiaId: ObjectId('698bdc3d626399f145648daf') }
            at InsertOneOperation.handleOk (C:\Users\Kristian\Desktop\barber-saas
\backend\node_modules\mongodb\src\operations\insert.ts:79:13)
            at tryOperation (C:\Users\Kristian\Desktop\barber-saas\backend\node_m
odules\mongodb\src\operations\execute_operation.ts:294:26)
            at processTicksAndRejections 
(node:internal/process/task_queues:105:5)
            at executeOperation (C:\Users\Kristian\Desktop\barber-saas\backend\no
de_modules\mongodb\src\operations\execute_operation.ts:123:12)
            at Collection.insertOne (C:\Users\Kristian\Desktop\barber-saas\backen
d\node_modules\mongodb\src\collection.ts:294:12)
            at model.$__save (C:\Users\Kristian\Desktop\barber-saas\backend\node_
modules\mongoose\lib\model.js:398:16)
            at model.save (C:\Users\Kristian\Desktop\barber-saas\backend\node_mod
ules\mongoose\lib\model.js:609:5)
            at C:\Users\Kristian\Desktop\barber-saas\backend\node_modules\mongoos
e\lib\model.js:2722:9
            at async Promise.all (index 0)
            at Function.create (C:\Users\Kristian\Desktop\barber-saas\backend\nod
e_modules\mongoose\lib\model.js:2707:11)
            at MongoReservaRepository.save (C:\Users\Kristian\Desktop\barber-saas
\backend\src\infrastructure\database\mongodb\repositories\MongoReservaRepository.
js:15:16)
            at TransactionManager.executeInTransaction.operationName (C:\Users\Kr
istian\Desktop\barber-saas\backend\src\application\use-cases\reservas\CreateReser
va.js:72:42)
            at Function.executeInTransaction (C:\Users\Kristian\Desktop\barber-sa
as\backend\src\utils\TransactionManager.js:57:32)
            at CreateReserva.execute (C:\Users\Kristian\Desktop\barber-saas\backe
nd\src\application\use-cases\reservas\CreateReserva.js:26:34)
            at Object.<anonymous>.exports.crearReservaBySlug (C:\Users\Kristian\D
esktop\barber-saas\backend\src\controllers\public.controller.js:140:25) {
          errorLabelSet: Set(0) {},
          errorResponse: {
            index: 0,
            code: 11000,
            errmsg: `E11000 duplicate key error collection: test.reservas index: 
unique_reservation_slot dup key: { barberoId: 
ObjectId('698bdc3d626399f145648db1'), fecha: new Date(1773532800000), hora: 
"10:00", barberiaId: ObjectId('698bdc3d626399f145648daf') }`,
            keyPattern: [Object],
            keyValue: [Object]
          },
          index: 0,
          code: 11000,
          keyPattern: { barberoId: 1, fecha: 1, hora: 1, barberiaId: 1 },
          keyValue: {
            barberoId: new ObjectId('698bdc3d626399f145648db1'),
            fecha: 2026-03-15T00:00:00.000Z,
            hora: '10:00',
            barberiaId: new ObjectId('698bdc3d626399f145648daf')
          }
        },
        context: { operationName: 'CreateReservation', attempt: 2 },
        timestamp: 2026-02-11T01:32:46.476Z,
        originalStack: `MongoServerError: E11000 duplicate key error collection: 
test.reservas index: unique_reservation_slot dup key: { barberoId: 
ObjectId('698bdc3d626399f145648db1'), fecha: new Date(1773532800000), hora: 
"10:00", barberiaId: ObjectId('698bdc3d626399f145648daf') }\n` +
          '    at InsertOneOperation.handleOk (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\node_modules\\mongodb\\src\\operations\\insert.ts:79:13)\n' +
          '    at tryOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\backen
d\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:294:26)\n' +
          '    at processTicksAndRejections 
(node:internal/process/task_queues:105:5)\n' +
          '    at executeOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\ba
ckend\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:123:12)\n' +
          '    at Collection.insertOne (C:\\Users\\Kristian\\Desktop\\barber-saas
\\backend\\node_modules\\mongodb\\src\\collection.ts:294:12)\n' +
          '    at model.$__save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backe
nd\\node_modules\\mongoose\\lib\\model.js:398:16)\n' +
          '    at model.save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\
\node_modules\\mongoose\\lib\\model.js:609:5)\n' +
          '    at C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\\node_module
s\\mongoose\\lib\\model.js:2722:9\n' +
          '    at async Promise.all (index 0)\n' +
          '    at Function.create (C:\\Users\\Kristian\\Desktop\\barber-saas\\bac
kend\\node_modules\\mongoose\\lib\\model.js:2707:11)\n' +
          '    at MongoReservaRepository.save (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\src\\infrastructure\\database\\mongodb\\repositories\\MongoRese
rvaRepository.js:15:16)\n' +
          '    at TransactionManager.executeInTransaction.operationName (C:\\User
s\\Kristian\\Desktop\\barber-saas\\backend\\src\\application\\use-cases\\reservas
\\CreateReserva.js:72:42)\n' +
          '    at Function.executeInTransaction (C:\\Users\\Kristian\\Desktop\\ba
rber-saas\\backend\\src\\utils\\TransactionManager.js:57:32)\n' +
          '    at CreateReserva.execute (C:\\Users\\Kristian\\Desktop\\barber-saa
s\\backend\\src\\application\\use-cases\\reservas\\CreateReserva.js:26:34)\n' +
          '    at Object.<anonymous>.exports.crearReservaBySlug (C:\\Users\\Krist
ian\\Desktop\\barber-saas\\backend\\src\\controllers\\public.controller.js:140:25
)'
      }

    [0m [90m 4 |[39m
     [90m 5 |[39m [36mconst[39m errorHandler [33m=[39m (err[33m,[39m 
req[33m,[39m res[33m,[39m next) [33m=>[39m {
    [31m[1m>[22m[39m[90m 6 |[39m   console[33m.[39merror([32m"ƒö┤ 
ERROR:"[39m[33m,[39m err)[33m;[39m
     [90m   |[39m           [31m[1m^[22m[39m
     [90m 7 |[39m
     [90m 8 |[39m   [90m// ­ƒöÑ A├æADIR HEADERS CORS SI NO EXISTEN[39m
     [90m 9 |[39m   [36mconst[39m origin [33m=[39m 
req[33m.[39mheaders[33m.[39morigin[33m;[39m[0m

      at error (src/config/middleware/errorHandler.js:6:11)
      at Layer.handleError (node_modules/router/lib/layer.js:116:17)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at Layer.handleError (node_modules/router/lib/layer.js:111:12)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at Immediate.next (node_modules/router/index.js:291:5)
      at Immediate._onImmediate (node_modules/router/index.js:688:15)

    console.error
      ƒö┤ ERROR: TransactionError: Transaction failed for CreateReservation: 
E11000 duplicate key error collection: test.reservas index: 
unique_reservation_slot dup key: { barberoId: 
ObjectId('698bdc3d626399f145648db1'), fecha: new Date(1773532800000), hora: 
"10:00", barberiaId: ObjectId('698bdc3d626399f145648daf') }
          at Function.executeInTransaction (C:\Users\Kristian\Desktop\barber-saas
\backend\src\utils\TransactionManager.js:88:42)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at CreateReserva.execute (C:\Users\Kristian\Desktop\barber-saas\backend
\src\application\use-cases\reservas\CreateReserva.js:26:34)
          at Object.<anonymous>.exports.crearReservaBySlug (C:\Users\Kristian\Des
ktop\barber-saas\backend\src\controllers\public.controller.js:140:25) {
        isTransactionError: true,
        originalError: MongoServerError: E11000 duplicate key error collection: 
test.reservas index: unique_reservation_slot dup key: { barberoId: 
ObjectId('698bdc3d626399f145648db1'), fecha: new Date(1773532800000), hora: 
"10:00", barberiaId: ObjectId('698bdc3d626399f145648daf') }
            at InsertOneOperation.handleOk (C:\Users\Kristian\Desktop\barber-saas
\backend\node_modules\mongodb\src\operations\insert.ts:79:13)
            at tryOperation (C:\Users\Kristian\Desktop\barber-saas\backend\node_m
odules\mongodb\src\operations\execute_operation.ts:294:26)
            at processTicksAndRejections 
(node:internal/process/task_queues:105:5)
            at executeOperation (C:\Users\Kristian\Desktop\barber-saas\backend\no
de_modules\mongodb\src\operations\execute_operation.ts:123:12)
            at Collection.insertOne (C:\Users\Kristian\Desktop\barber-saas\backen
d\node_modules\mongodb\src\collection.ts:294:12)
            at model.$__save (C:\Users\Kristian\Desktop\barber-saas\backend\node_
modules\mongoose\lib\model.js:398:16)
            at model.save (C:\Users\Kristian\Desktop\barber-saas\backend\node_mod
ules\mongoose\lib\model.js:609:5)
            at C:\Users\Kristian\Desktop\barber-saas\backend\node_modules\mongoos
e\lib\model.js:2722:9
            at async Promise.all (index 0)
            at Function.create (C:\Users\Kristian\Desktop\barber-saas\backend\nod
e_modules\mongoose\lib\model.js:2707:11)
            at MongoReservaRepository.save (C:\Users\Kristian\Desktop\barber-saas
\backend\src\infrastructure\database\mongodb\repositories\MongoReservaRepository.
js:15:16)
            at TransactionManager.executeInTransaction.operationName (C:\Users\Kr
istian\Desktop\barber-saas\backend\src\application\use-cases\reservas\CreateReser
va.js:72:42)
            at Function.executeInTransaction (C:\Users\Kristian\Desktop\barber-sa
as\backend\src\utils\TransactionManager.js:57:32)
            at CreateReserva.execute (C:\Users\Kristian\Desktop\barber-saas\backe
nd\src\application\use-cases\reservas\CreateReserva.js:26:34)
            at Object.<anonymous>.exports.crearReservaBySlug (C:\Users\Kristian\D
esktop\barber-saas\backend\src\controllers\public.controller.js:140:25) {
          errorLabelSet: Set(0) {},
          errorResponse: {
            index: 0,
            code: 11000,
            errmsg: `E11000 duplicate key error collection: test.reservas index: 
unique_reservation_slot dup key: { barberoId: 
ObjectId('698bdc3d626399f145648db1'), fecha: new Date(1773532800000), hora: 
"10:00", barberiaId: ObjectId('698bdc3d626399f145648daf') }`,
            keyPattern: [Object],
            keyValue: [Object]
          },
          index: 0,
          code: 11000,
          keyPattern: { barberoId: 1, fecha: 1, hora: 1, barberiaId: 1 },
          keyValue: {
            barberoId: new ObjectId('698bdc3d626399f145648db1'),
            fecha: 2026-03-15T00:00:00.000Z,
            hora: '10:00',
            barberiaId: new ObjectId('698bdc3d626399f145648daf')
          }
        },
        context: { operationName: 'CreateReservation', attempt: 2 },
        timestamp: 2026-02-11T01:32:46.477Z,
        originalStack: `MongoServerError: E11000 duplicate key error collection: 
test.reservas index: unique_reservation_slot dup key: { barberoId: 
ObjectId('698bdc3d626399f145648db1'), fecha: new Date(1773532800000), hora: 
"10:00", barberiaId: ObjectId('698bdc3d626399f145648daf') }\n` +
          '    at InsertOneOperation.handleOk (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\node_modules\\mongodb\\src\\operations\\insert.ts:79:13)\n' +
          '    at tryOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\backen
d\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:294:26)\n' +
          '    at processTicksAndRejections 
(node:internal/process/task_queues:105:5)\n' +
          '    at executeOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\ba
ckend\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:123:12)\n' +
          '    at Collection.insertOne (C:\\Users\\Kristian\\Desktop\\barber-saas
\\backend\\node_modules\\mongodb\\src\\collection.ts:294:12)\n' +
          '    at model.$__save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backe
nd\\node_modules\\mongoose\\lib\\model.js:398:16)\n' +
          '    at model.save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\
\node_modules\\mongoose\\lib\\model.js:609:5)\n' +
          '    at C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\\node_module
s\\mongoose\\lib\\model.js:2722:9\n' +
          '    at async Promise.all (index 0)\n' +
          '    at Function.create (C:\\Users\\Kristian\\Desktop\\barber-saas\\bac
kend\\node_modules\\mongoose\\lib\\model.js:2707:11)\n' +
          '    at MongoReservaRepository.save (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\src\\infrastructure\\database\\mongodb\\repositories\\MongoRese
rvaRepository.js:15:16)\n' +
          '    at TransactionManager.executeInTransaction.operationName (C:\\User
s\\Kristian\\Desktop\\barber-saas\\backend\\src\\application\\use-cases\\reservas
\\CreateReserva.js:72:42)\n' +
          '    at Function.executeInTransaction (C:\\Users\\Kristian\\Desktop\\ba
rber-saas\\backend\\src\\utils\\TransactionManager.js:57:32)\n' +
          '    at CreateReserva.execute (C:\\Users\\Kristian\\Desktop\\barber-saa
s\\backend\\src\\application\\use-cases\\reservas\\CreateReserva.js:26:34)\n' +
          '    at Object.<anonymous>.exports.crearReservaBySlug (C:\\Users\\Krist
ian\\Desktop\\barber-saas\\backend\\src\\controllers\\public.controller.js:140:25
)'
      }

    [0m [90m 4 |[39m
     [90m 5 |[39m [36mconst[39m errorHandler [33m=[39m (err[33m,[39m 
req[33m,[39m res[33m,[39m next) [33m=>[39m {
    [31m[1m>[22m[39m[90m 6 |[39m   console[33m.[39merror([32m"ƒö┤ 
ERROR:"[39m[33m,[39m err)[33m;[39m
     [90m   |[39m           [31m[1m^[22m[39m
     [90m 7 |[39m
     [90m 8 |[39m   [90m// ­ƒöÑ A├æADIR HEADERS CORS SI NO EXISTEN[39m
     [90m 9 |[39m   [36mconst[39m origin [33m=[39m 
req[33m.[39mheaders[33m.[39morigin[33m;[39m[0m

      at error (src/config/middleware/errorHandler.js:6:11)
      at Layer.handleError (node_modules/router/lib/layer.js:116:17)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at Layer.handleError (node_modules/router/lib/layer.js:111:12)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at Immediate.next (node_modules/router/index.js:291:5)
      at Immediate._onImmediate (node_modules/router/index.js:688:15)

    console.error
      ƒö┤ ERROR: TransactionError: Transaction failed for CreateReservation: 
E11000 duplicate key error collection: test.reservas index: 
unique_reservation_slot dup key: { barberoId: 
ObjectId('698bdc3d626399f145648db1'), fecha: new Date(1773532800000), hora: 
"10:00", barberiaId: ObjectId('698bdc3d626399f145648daf') }
          at Function.executeInTransaction (C:\Users\Kristian\Desktop\barber-saas
\backend\src\utils\TransactionManager.js:88:42)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at CreateReserva.execute (C:\Users\Kristian\Desktop\barber-saas\backend
\src\application\use-cases\reservas\CreateReserva.js:26:34)
          at Object.<anonymous>.exports.crearReservaBySlug (C:\Users\Kristian\Des
ktop\barber-saas\backend\src\controllers\public.controller.js:140:25) {
        isTransactionError: true,
        originalError: MongoServerError: E11000 duplicate key error collection: 
test.reservas index: unique_reservation_slot dup key: { barberoId: 
ObjectId('698bdc3d626399f145648db1'), fecha: new Date(1773532800000), hora: 
"10:00", barberiaId: ObjectId('698bdc3d626399f145648daf') }
            at InsertOneOperation.handleOk (C:\Users\Kristian\Desktop\barber-saas
\backend\node_modules\mongodb\src\operations\insert.ts:79:13)
            at tryOperation (C:\Users\Kristian\Desktop\barber-saas\backend\node_m
odules\mongodb\src\operations\execute_operation.ts:294:26)
            at processTicksAndRejections 
(node:internal/process/task_queues:105:5)
            at executeOperation (C:\Users\Kristian\Desktop\barber-saas\backend\no
de_modules\mongodb\src\operations\execute_operation.ts:123:12)
            at Collection.insertOne (C:\Users\Kristian\Desktop\barber-saas\backen
d\node_modules\mongodb\src\collection.ts:294:12)
            at model.$__save (C:\Users\Kristian\Desktop\barber-saas\backend\node_
modules\mongoose\lib\model.js:398:16)
            at model.save (C:\Users\Kristian\Desktop\barber-saas\backend\node_mod
ules\mongoose\lib\model.js:609:5)
            at C:\Users\Kristian\Desktop\barber-saas\backend\node_modules\mongoos
e\lib\model.js:2722:9
            at async Promise.all (index 0)
            at Function.create (C:\Users\Kristian\Desktop\barber-saas\backend\nod
e_modules\mongoose\lib\model.js:2707:11)
            at MongoReservaRepository.save (C:\Users\Kristian\Desktop\barber-saas
\backend\src\infrastructure\database\mongodb\repositories\MongoReservaRepository.
js:15:16)
            at TransactionManager.executeInTransaction.operationName (C:\Users\Kr
istian\Desktop\barber-saas\backend\src\application\use-cases\reservas\CreateReser
va.js:72:42)
            at Function.executeInTransaction (C:\Users\Kristian\Desktop\barber-sa
as\backend\src\utils\TransactionManager.js:57:32)
            at CreateReserva.execute (C:\Users\Kristian\Desktop\barber-saas\backe
nd\src\application\use-cases\reservas\CreateReserva.js:26:34)
            at Object.<anonymous>.exports.crearReservaBySlug (C:\Users\Kristian\D
esktop\barber-saas\backend\src\controllers\public.controller.js:140:25) {
          errorLabelSet: Set(0) {},
          errorResponse: {
            index: 0,
            code: 11000,
            errmsg: `E11000 duplicate key error collection: test.reservas index: 
unique_reservation_slot dup key: { barberoId: 
ObjectId('698bdc3d626399f145648db1'), fecha: new Date(1773532800000), hora: 
"10:00", barberiaId: ObjectId('698bdc3d626399f145648daf') }`,
            keyPattern: [Object],
            keyValue: [Object]
          },
          index: 0,
          code: 11000,
          keyPattern: { barberoId: 1, fecha: 1, hora: 1, barberiaId: 1 },
          keyValue: {
            barberoId: new ObjectId('698bdc3d626399f145648db1'),
            fecha: 2026-03-15T00:00:00.000Z,
            hora: '10:00',
            barberiaId: new ObjectId('698bdc3d626399f145648daf')
          }
        },
        context: { operationName: 'CreateReservation', attempt: 2 },
        timestamp: 2026-02-11T01:32:46.478Z,
        originalStack: `MongoServerError: E11000 duplicate key error collection: 
test.reservas index: unique_reservation_slot dup key: { barberoId: 
ObjectId('698bdc3d626399f145648db1'), fecha: new Date(1773532800000), hora: 
"10:00", barberiaId: ObjectId('698bdc3d626399f145648daf') }\n` +
          '    at InsertOneOperation.handleOk (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\node_modules\\mongodb\\src\\operations\\insert.ts:79:13)\n' +
          '    at tryOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\backen
d\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:294:26)\n' +
          '    at processTicksAndRejections 
(node:internal/process/task_queues:105:5)\n' +
          '    at executeOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\ba
ckend\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:123:12)\n' +
          '    at Collection.insertOne (C:\\Users\\Kristian\\Desktop\\barber-saas
\\backend\\node_modules\\mongodb\\src\\collection.ts:294:12)\n' +
          '    at model.$__save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backe
nd\\node_modules\\mongoose\\lib\\model.js:398:16)\n' +
          '    at model.save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\
\node_modules\\mongoose\\lib\\model.js:609:5)\n' +
          '    at C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\\node_module
s\\mongoose\\lib\\model.js:2722:9\n' +
          '    at async Promise.all (index 0)\n' +
          '    at Function.create (C:\\Users\\Kristian\\Desktop\\barber-saas\\bac
kend\\node_modules\\mongoose\\lib\\model.js:2707:11)\n' +
          '    at MongoReservaRepository.save (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\src\\infrastructure\\database\\mongodb\\repositories\\MongoRese
rvaRepository.js:15:16)\n' +
          '    at TransactionManager.executeInTransaction.operationName (C:\\User
s\\Kristian\\Desktop\\barber-saas\\backend\\src\\application\\use-cases\\reservas
\\CreateReserva.js:72:42)\n' +
          '    at Function.executeInTransaction (C:\\Users\\Kristian\\Desktop\\ba
rber-saas\\backend\\src\\utils\\TransactionManager.js:57:32)\n' +
          '    at CreateReserva.execute (C:\\Users\\Kristian\\Desktop\\barber-saa
s\\backend\\src\\application\\use-cases\\reservas\\CreateReserva.js:26:34)\n' +
          '    at Object.<anonymous>.exports.crearReservaBySlug (C:\\Users\\Krist
ian\\Desktop\\barber-saas\\backend\\src\\controllers\\public.controller.js:140:25
)'
      }

    [0m [90m 4 |[39m
     [90m 5 |[39m [36mconst[39m errorHandler [33m=[39m (err[33m,[39m 
req[33m,[39m res[33m,[39m next) [33m=>[39m {
    [31m[1m>[22m[39m[90m 6 |[39m   console[33m.[39merror([32m"ƒö┤ 
ERROR:"[39m[33m,[39m err)[33m;[39m
     [90m   |[39m           [31m[1m^[22m[39m
     [90m 7 |[39m
     [90m 8 |[39m   [90m// ­ƒöÑ A├æADIR HEADERS CORS SI NO EXISTEN[39m
     [90m 9 |[39m   [36mconst[39m origin [33m=[39m 
req[33m.[39mheaders[33m.[39morigin[33m;[39m[0m

      at error (src/config/middleware/errorHandler.js:6:11)
      at Layer.handleError (node_modules/router/lib/layer.js:116:17)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at Layer.handleError (node_modules/router/lib/layer.js:111:12)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at Immediate.next (node_modules/router/index.js:291:5)
      at Immediate._onImmediate (node_modules/router/index.js:688:15)

    console.error
      ƒö┤ ERROR: TransactionError: Transaction failed for CreateReservation: 
E11000 duplicate key error collection: test.reservas index: 
unique_reservation_slot dup key: { barberoId: 
ObjectId('698bdc3d626399f145648db1'), fecha: new Date(1773532800000), hora: 
"10:00", barberiaId: ObjectId('698bdc3d626399f145648daf') }
          at Function.executeInTransaction (C:\Users\Kristian\Desktop\barber-saas
\backend\src\utils\TransactionManager.js:88:42)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at CreateReserva.execute (C:\Users\Kristian\Desktop\barber-saas\backend
\src\application\use-cases\reservas\CreateReserva.js:26:34)
          at Object.<anonymous>.exports.crearReservaBySlug (C:\Users\Kristian\Des
ktop\barber-saas\backend\src\controllers\public.controller.js:140:25) {
        isTransactionError: true,
        originalError: MongoServerError: E11000 duplicate key error collection: 
test.reservas index: unique_reservation_slot dup key: { barberoId: 
ObjectId('698bdc3d626399f145648db1'), fecha: new Date(1773532800000), hora: 
"10:00", barberiaId: ObjectId('698bdc3d626399f145648daf') }
            at InsertOneOperation.handleOk (C:\Users\Kristian\Desktop\barber-saas
\backend\node_modules\mongodb\src\operations\insert.ts:79:13)
            at tryOperation (C:\Users\Kristian\Desktop\barber-saas\backend\node_m
odules\mongodb\src\operations\execute_operation.ts:294:26)
            at processTicksAndRejections 
(node:internal/process/task_queues:105:5)
            at executeOperation (C:\Users\Kristian\Desktop\barber-saas\backend\no
de_modules\mongodb\src\operations\execute_operation.ts:123:12)
            at Collection.insertOne (C:\Users\Kristian\Desktop\barber-saas\backen
d\node_modules\mongodb\src\collection.ts:294:12)
            at model.$__save (C:\Users\Kristian\Desktop\barber-saas\backend\node_
modules\mongoose\lib\model.js:398:16)
            at model.save (C:\Users\Kristian\Desktop\barber-saas\backend\node_mod
ules\mongoose\lib\model.js:609:5)
            at C:\Users\Kristian\Desktop\barber-saas\backend\node_modules\mongoos
e\lib\model.js:2722:9
            at async Promise.all (index 0)
            at Function.create (C:\Users\Kristian\Desktop\barber-saas\backend\nod
e_modules\mongoose\lib\model.js:2707:11)
            at MongoReservaRepository.save (C:\Users\Kristian\Desktop\barber-saas
\backend\src\infrastructure\database\mongodb\repositories\MongoReservaRepository.
js:15:16)
            at TransactionManager.executeInTransaction.operationName (C:\Users\Kr
istian\Desktop\barber-saas\backend\src\application\use-cases\reservas\CreateReser
va.js:72:42)
            at Function.executeInTransaction (C:\Users\Kristian\Desktop\barber-sa
as\backend\src\utils\TransactionManager.js:57:32)
            at CreateReserva.execute (C:\Users\Kristian\Desktop\barber-saas\backe
nd\src\application\use-cases\reservas\CreateReserva.js:26:34)
            at Object.<anonymous>.exports.crearReservaBySlug (C:\Users\Kristian\D
esktop\barber-saas\backend\src\controllers\public.controller.js:140:25) {
          errorLabelSet: Set(0) {},
          errorResponse: {
            index: 0,
            code: 11000,
            errmsg: `E11000 duplicate key error collection: test.reservas index: 
unique_reservation_slot dup key: { barberoId: 
ObjectId('698bdc3d626399f145648db1'), fecha: new Date(1773532800000), hora: 
"10:00", barberiaId: ObjectId('698bdc3d626399f145648daf') }`,
            keyPattern: [Object],
            keyValue: [Object]
          },
          index: 0,
          code: 11000,
          keyPattern: { barberoId: 1, fecha: 1, hora: 1, barberiaId: 1 },
          keyValue: {
            barberoId: new ObjectId('698bdc3d626399f145648db1'),
            fecha: 2026-03-15T00:00:00.000Z,
            hora: '10:00',
            barberiaId: new ObjectId('698bdc3d626399f145648daf')
          }
        },
        context: { operationName: 'CreateReservation', attempt: 2 },
        timestamp: 2026-02-11T01:32:46.480Z,
        originalStack: `MongoServerError: E11000 duplicate key error collection: 
test.reservas index: unique_reservation_slot dup key: { barberoId: 
ObjectId('698bdc3d626399f145648db1'), fecha: new Date(1773532800000), hora: 
"10:00", barberiaId: ObjectId('698bdc3d626399f145648daf') }\n` +
          '    at InsertOneOperation.handleOk (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\node_modules\\mongodb\\src\\operations\\insert.ts:79:13)\n' +
          '    at tryOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\backen
d\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:294:26)\n' +
          '    at processTicksAndRejections 
(node:internal/process/task_queues:105:5)\n' +
          '    at executeOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\ba
ckend\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:123:12)\n' +
          '    at Collection.insertOne (C:\\Users\\Kristian\\Desktop\\barber-saas
\\backend\\node_modules\\mongodb\\src\\collection.ts:294:12)\n' +
          '    at model.$__save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backe
nd\\node_modules\\mongoose\\lib\\model.js:398:16)\n' +
          '    at model.save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\
\node_modules\\mongoose\\lib\\model.js:609:5)\n' +
          '    at C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\\node_module
s\\mongoose\\lib\\model.js:2722:9\n' +
          '    at async Promise.all (index 0)\n' +
          '    at Function.create (C:\\Users\\Kristian\\Desktop\\barber-saas\\bac
kend\\node_modules\\mongoose\\lib\\model.js:2707:11)\n' +
          '    at MongoReservaRepository.save (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\src\\infrastructure\\database\\mongodb\\repositories\\MongoRese
rvaRepository.js:15:16)\n' +
          '    at TransactionManager.executeInTransaction.operationName (C:\\User
s\\Kristian\\Desktop\\barber-saas\\backend\\src\\application\\use-cases\\reservas
\\CreateReserva.js:72:42)\n' +
          '    at Function.executeInTransaction (C:\\Users\\Kristian\\Desktop\\ba
rber-saas\\backend\\src\\utils\\TransactionManager.js:57:32)\n' +
          '    at CreateReserva.execute (C:\\Users\\Kristian\\Desktop\\barber-saa
s\\backend\\src\\application\\use-cases\\reservas\\CreateReserva.js:26:34)\n' +
          '    at Object.<anonymous>.exports.crearReservaBySlug (C:\\Users\\Krist
ian\\Desktop\\barber-saas\\backend\\src\\controllers\\public.controller.js:140:25
)'
      }

    [0m [90m 4 |[39m
     [90m 5 |[39m [36mconst[39m errorHandler [33m=[39m (err[33m,[39m 
req[33m,[39m res[33m,[39m next) [33m=>[39m {
    [31m[1m>[22m[39m[90m 6 |[39m   console[33m.[39merror([32m"ƒö┤ 
ERROR:"[39m[33m,[39m err)[33m;[39m
     [90m   |[39m           [31m[1m^[22m[39m
     [90m 7 |[39m
     [90m 8 |[39m   [90m// ­ƒöÑ A├æADIR HEADERS CORS SI NO EXISTEN[39m
     [90m 9 |[39m   [36mconst[39m origin [33m=[39m 
req[33m.[39mheaders[33m.[39morigin[33m;[39m[0m

      at error (src/config/middleware/errorHandler.js:6:11)
      at Layer.handleError (node_modules/router/lib/layer.js:116:17)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at Layer.handleError (node_modules/router/lib/layer.js:111:12)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at Immediate.next (node_modules/router/index.js:291:5)
      at Immediate._onImmediate (node_modules/router/index.js:688:15)

    console.log
      Ô£à Exitosos: 1

      at Object.log (tests/race-condition-stress.test.js:86:21)

    console.log
      ÔØî Fallidos: 9

      at Object.log (tests/race-condition-stress.test.js:87:21)

    console.log
      ƒôí [POST] 
/api/public/barberias/test-barberia/barberos/698bdc3e626399f145648e26/reservar

      at log (src/app.js:93:11)

    console.log
      ƒôí [POST] 
/api/public/barberias/test-barberia/barberos/698bdc3e626399f145648e26/reservar

      at log (src/app.js:93:11)

    console.log
      ƒôí [POST] 
/api/public/barberias/test-barberia/barberos/698bdc3e626399f145648e26/reservar

      at log (src/app.js:93:11)

    console.log
      ƒôí [POST] 
/api/public/barberias/test-barberia/barberos/698bdc3e626399f145648e26/reservar

      at log (src/app.js:93:11)

    console.log
      ƒôí [POST] 
/api/public/barberias/test-barberia/barberos/698bdc3e626399f145648e26/reservar

      at log (src/app.js:93:11)

    console.log
      ƒôí [POST] 
/api/public/barberias/test-barberia/barberos/698bdc3e626399f145648e26/reservar

      at log (src/app.js:93:11)

    console.log
      ƒôí [POST] 
/api/public/barberias/test-barberia/barberos/698bdc3e626399f145648e26/reservar

      at log (src/app.js:93:11)

    console.log
      ƒôí [POST] 
/api/public/barberias/test-barberia/barberos/698bdc3e626399f145648e26/reservar

      at log (src/app.js:93:11)

    console.log
      ƒôí [POST] 
/api/public/barberias/test-barberia/barberos/698bdc3e626399f145648e26/reservar

      at log (src/app.js:93:11)

    console.log
      ƒôí [POST] 
/api/public/barberias/test-barberia/barberos/698bdc3e626399f145648e26/reservar

      at log (src/app.js:93:11)

    console.log
      ƒôí [POST] 
/api/public/barberias/test-barberia/barberos/698bdc3e626399f145648e26/reservar

      at log (src/app.js:93:11)

    console.log
      ƒôí [POST] 
/api/public/barberias/test-barberia/barberos/698bdc3e626399f145648e26/reservar

      at log (src/app.js:93:11)

    console.log
      ƒôí [POST] 
/api/public/barberias/test-barberia/barberos/698bdc3e626399f145648e26/reservar

      at log (src/app.js:93:11)

    console.log
      ƒôí [POST] 
/api/public/barberias/test-barberia/barberos/698bdc3e626399f145648e26/reservar

      at log (src/app.js:93:11)

    console.log
      ƒôí [POST] 
/api/public/barberias/test-barberia/barberos/698bdc3e626399f145648e26/reservar

      at log (src/app.js:93:11)

    console.log
      ƒôí [POST] 
/api/public/barberias/test-barberia/barberos/698bdc3e626399f145648e26/reservar

      at log (src/app.js:93:11)

    console.log
      ƒôí [POST] 
/api/public/barberias/test-barberia/barberos/698bdc3e626399f145648e26/reservar

      at log (src/app.js:93:11)

    console.log
      ƒôí [POST] 
/api/public/barberias/test-barberia/barberos/698bdc3e626399f145648e26/reservar

      at log (src/app.js:93:11)

    console.log
      ƒôí [POST] 
/api/public/barberias/test-barberia/barberos/698bdc3e626399f145648e26/reservar

      at log (src/app.js:93:11)

    console.log
      ƒôí [POST] 
/api/public/barberias/test-barberia/barberos/698bdc3e626399f145648e26/reservar

      at log (src/app.js:93:11)

    console.log
      ƒôí [POST] 
/api/public/barberias/test-barberia/barberos/698bdc3e626399f145648e26/reservar

      at log (src/app.js:93:11)

    console.warn
      ÔÜá´©Å  [Security] Rate limit exceeded {
        ip: '::ffff:127.0.0.1',
        method: 'POST',
        path: '/test-barberia/barberos/698bdc3e626399f145648e26/reservar',
        max: 30
      }

    [0m [90m 38 |[39m [90m     */[39m
     [90m 39 |[39m     [36mstatic[39m warn(context[33m,[39m 
message[33m,[39m metadata [33m=[39m {}) {
    [31m[1m>[22m[39m[90m 40 |[39m         
console[33m.[39mwarn([32m`ÔÜá´©Å  [${context}] ${message}`[39m[33m,[39m 
metadata)[33m;[39m
     [90m    |[39m                 [31m[1m^[22m[39m
     [90m 41 |[39m     }
     [90m 42 |[39m
     [90m 43 |[39m     [90m/**[39m[0m

      at Function.warn (src/shared/Logger.js:40:17)
      at Object.warn [as handler] (src/middleware/rateLimit.middleware.js:18:20)
      at node_modules/express-rate-limit/dist/index.cjs:939:16
      at node_modules/express-rate-limit/dist/index.cjs:825:5

    console.log
      ƒôí [POST] 
/api/public/barberias/test-barberia/barberos/698bdc3e626399f145648e26/reservar

      at log (src/app.js:93:11)

    console.warn
      ÔÜá´©Å  [Security] Rate limit exceeded {
        ip: '::ffff:127.0.0.1',
        method: 'POST',
        path: '/test-barberia/barberos/698bdc3e626399f145648e26/reservar',
        max: 30
      }

    [0m [90m 38 |[39m [90m     */[39m
     [90m 39 |[39m     [36mstatic[39m warn(context[33m,[39m 
message[33m,[39m metadata [33m=[39m {}) {
    [31m[1m>[22m[39m[90m 40 |[39m         
console[33m.[39mwarn([32m`ÔÜá´©Å  [${context}] ${message}`[39m[33m,[39m 
metadata)[33m;[39m
     [90m    |[39m                 [31m[1m^[22m[39m
     [90m 41 |[39m     }
     [90m 42 |[39m
     [90m 43 |[39m     [90m/**[39m[0m

      at Function.warn (src/shared/Logger.js:40:17)
      at Object.warn [as handler] (src/middleware/rateLimit.middleware.js:18:20)
      at node_modules/express-rate-limit/dist/index.cjs:939:16
      at node_modules/express-rate-limit/dist/index.cjs:825:5

    console.log
      ƒôí [POST] 
/api/public/barberias/test-barberia/barberos/698bdc3e626399f145648e26/reservar

      at log (src/app.js:93:11)

    console.warn
      ÔÜá´©Å  [Security] Rate limit exceeded {
        ip: '::ffff:127.0.0.1',
        method: 'POST',
        path: '/test-barberia/barberos/698bdc3e626399f145648e26/reservar',
        max: 30
      }

    [0m [90m 38 |[39m [90m     */[39m
     [90m 39 |[39m     [36mstatic[39m warn(context[33m,[39m 
message[33m,[39m metadata [33m=[39m {}) {
    [31m[1m>[22m[39m[90m 40 |[39m         
console[33m.[39mwarn([32m`ÔÜá´©Å  [${context}] ${message}`[39m[33m,[39m 
metadata)[33m;[39m
     [90m    |[39m                 [31m[1m^[22m[39m
     [90m 41 |[39m     }
     [90m 42 |[39m
     [90m 43 |[39m     [90m/**[39m[0m

      at Function.warn (src/shared/Logger.js:40:17)
      at Object.warn [as handler] (src/middleware/rateLimit.middleware.js:18:20)
      at node_modules/express-rate-limit/dist/index.cjs:939:16
      at node_modules/express-rate-limit/dist/index.cjs:825:5

    console.log
      ƒôí [POST] 
/api/public/barberias/test-barberia/barberos/698bdc3e626399f145648e26/reservar

      at log (src/app.js:93:11)

    console.warn
      ÔÜá´©Å  [Security] Rate limit exceeded {
        ip: '::ffff:127.0.0.1',
        method: 'POST',
        path: '/test-barberia/barberos/698bdc3e626399f145648e26/reservar',
        max: 30
      }

    [0m [90m 38 |[39m [90m     */[39m
     [90m 39 |[39m     [36mstatic[39m warn(context[33m,[39m 
message[33m,[39m metadata [33m=[39m {}) {
    [31m[1m>[22m[39m[90m 40 |[39m         
console[33m.[39mwarn([32m`ÔÜá´©Å  [${context}] ${message}`[39m[33m,[39m 
metadata)[33m;[39m
     [90m    |[39m                 [31m[1m^[22m[39m
     [90m 41 |[39m     }
     [90m 42 |[39m
     [90m 43 |[39m     [90m/**[39m[0m

      at Function.warn (src/shared/Logger.js:40:17)
      at Object.warn [as handler] (src/middleware/rateLimit.middleware.js:18:20)
      at node_modules/express-rate-limit/dist/index.cjs:939:16
      at node_modules/express-rate-limit/dist/index.cjs:825:5

    console.log
      ƒôí [POST] 
/api/public/barberias/test-barberia/barberos/698bdc3e626399f145648e26/reservar

      at log (src/app.js:93:11)

    console.warn
      ÔÜá´©Å  [Security] Rate limit exceeded {
        ip: '::ffff:127.0.0.1',
        method: 'POST',
        path: '/test-barberia/barberos/698bdc3e626399f145648e26/reservar',
        max: 30
      }

    [0m [90m 38 |[39m [90m     */[39m
     [90m 39 |[39m     [36mstatic[39m warn(context[33m,[39m 
message[33m,[39m metadata [33m=[39m {}) {
    [31m[1m>[22m[39m[90m 40 |[39m         
console[33m.[39mwarn([32m`ÔÜá´©Å  [${context}] ${message}`[39m[33m,[39m 
metadata)[33m;[39m
     [90m    |[39m                 [31m[1m^[22m[39m
     [90m 41 |[39m     }
     [90m 42 |[39m
     [90m 43 |[39m     [90m/**[39m[0m

      at Function.warn (src/shared/Logger.js:40:17)
      at Object.warn [as handler] (src/middleware/rateLimit.middleware.js:18:20)
      at node_modules/express-rate-limit/dist/index.cjs:939:16
      at node_modules/express-rate-limit/dist/index.cjs:825:5

    console.log
      ƒôí [POST] 
/api/public/barberias/test-barberia/barberos/698bdc3e626399f145648e26/reservar

      at log (src/app.js:93:11)

    console.warn
      ÔÜá´©Å  [Security] Rate limit exceeded {
        ip: '::ffff:127.0.0.1',
        method: 'POST',
        path: '/test-barberia/barberos/698bdc3e626399f145648e26/reservar',
        max: 30
      }

    [0m [90m 38 |[39m [90m     */[39m
     [90m 39 |[39m     [36mstatic[39m warn(context[33m,[39m 
message[33m,[39m metadata [33m=[39m {}) {
    [31m[1m>[22m[39m[90m 40 |[39m         
console[33m.[39mwarn([32m`ÔÜá´©Å  [${context}] ${message}`[39m[33m,[39m 
metadata)[33m;[39m
     [90m    |[39m                 [31m[1m^[22m[39m
     [90m 41 |[39m     }
     [90m 42 |[39m
     [90m 43 |[39m     [90m/**[39m[0m

      at Function.warn (src/shared/Logger.js:40:17)
      at Object.warn [as handler] (src/middleware/rateLimit.middleware.js:18:20)
      at node_modules/express-rate-limit/dist/index.cjs:939:16
      at node_modules/express-rate-limit/dist/index.cjs:825:5

    console.log
      ƒôí [POST] 
/api/public/barberias/test-barberia/barberos/698bdc3e626399f145648e26/reservar

      at log (src/app.js:93:11)

    console.warn
      ÔÜá´©Å  [Security] Rate limit exceeded {
        ip: '::ffff:127.0.0.1',
        method: 'POST',
        path: '/test-barberia/barberos/698bdc3e626399f145648e26/reservar',
        max: 30
      }

    [0m [90m 38 |[39m [90m     */[39m
     [90m 39 |[39m     [36mstatic[39m warn(context[33m,[39m 
message[33m,[39m metadata [33m=[39m {}) {
    [31m[1m>[22m[39m[90m 40 |[39m         
console[33m.[39mwarn([32m`ÔÜá´©Å  [${context}] ${message}`[39m[33m,[39m 
metadata)[33m;[39m
     [90m    |[39m                 [31m[1m^[22m[39m
     [90m 41 |[39m     }
     [90m 42 |[39m
     [90m 43 |[39m     [90m/**[39m[0m

      at Function.warn (src/shared/Logger.js:40:17)
      at Object.warn [as handler] (src/middleware/rateLimit.middleware.js:18:20)
      at node_modules/express-rate-limit/dist/index.cjs:939:16
      at node_modules/express-rate-limit/dist/index.cjs:825:5

    console.log
      ƒôí [POST] 
/api/public/barberias/test-barberia/barberos/698bdc3e626399f145648e26/reservar

      at log (src/app.js:93:11)

    console.warn
      ÔÜá´©Å  [Security] Rate limit exceeded {
        ip: '::ffff:127.0.0.1',
        method: 'POST',
        path: '/test-barberia/barberos/698bdc3e626399f145648e26/reservar',
        max: 30
      }

    [0m [90m 38 |[39m [90m     */[39m
     [90m 39 |[39m     [36mstatic[39m warn(context[33m,[39m 
message[33m,[39m metadata [33m=[39m {}) {
    [31m[1m>[22m[39m[90m 40 |[39m         
console[33m.[39mwarn([32m`ÔÜá´©Å  [${context}] ${message}`[39m[33m,[39m 
metadata)[33m;[39m
     [90m    |[39m                 [31m[1m^[22m[39m
     [90m 41 |[39m     }
     [90m 42 |[39m
     [90m 43 |[39m     [90m/**[39m[0m

      at Function.warn (src/shared/Logger.js:40:17)
      at Object.warn [as handler] (src/middleware/rateLimit.middleware.js:18:20)
      at node_modules/express-rate-limit/dist/index.cjs:939:16
      at node_modules/express-rate-limit/dist/index.cjs:825:5

    console.log
      ƒôí [POST] 
/api/public/barberias/test-barberia/barberos/698bdc3e626399f145648e26/reservar

      at log (src/app.js:93:11)

    console.warn
      ÔÜá´©Å  [Security] Rate limit exceeded {
        ip: '::ffff:127.0.0.1',
        method: 'POST',
        path: '/test-barberia/barberos/698bdc3e626399f145648e26/reservar',
        max: 30
      }

    [0m [90m 38 |[39m [90m     */[39m
     [90m 39 |[39m     [36mstatic[39m warn(context[33m,[39m 
message[33m,[39m metadata [33m=[39m {}) {
    [31m[1m>[22m[39m[90m 40 |[39m         
console[33m.[39mwarn([32m`ÔÜá´©Å  [${context}] ${message}`[39m[33m,[39m 
metadata)[33m;[39m
     [90m    |[39m                 [31m[1m^[22m[39m
     [90m 41 |[39m     }
     [90m 42 |[39m
     [90m 43 |[39m     [90m/**[39m[0m

      at Function.warn (src/shared/Logger.js:40:17)
      at Object.warn [as handler] (src/middleware/rateLimit.middleware.js:18:20)
      at node_modules/express-rate-limit/dist/index.cjs:939:16
      at node_modules/express-rate-limit/dist/index.cjs:825:5

    console.log
      ƒôí [POST] 
/api/public/barberias/test-barberia/barberos/698bdc3e626399f145648e26/reservar

      at log (src/app.js:93:11)

    console.warn
      ÔÜá´©Å  [Security] Rate limit exceeded {
        ip: '::ffff:127.0.0.1',
        method: 'POST',
        path: '/test-barberia/barberos/698bdc3e626399f145648e26/reservar',
        max: 30
      }

    [0m [90m 38 |[39m [90m     */[39m
     [90m 39 |[39m     [36mstatic[39m warn(context[33m,[39m 
message[33m,[39m metadata [33m=[39m {}) {
    [31m[1m>[22m[39m[90m 40 |[39m         
console[33m.[39mwarn([32m`ÔÜá´©Å  [${context}] ${message}`[39m[33m,[39m 
metadata)[33m;[39m
     [90m    |[39m                 [31m[1m^[22m[39m
     [90m 41 |[39m     }
     [90m 42 |[39m
     [90m 43 |[39m     [90m/**[39m[0m

      at Function.warn (src/shared/Logger.js:40:17)
      at Object.warn [as handler] (src/middleware/rateLimit.middleware.js:18:20)
      at node_modules/express-rate-limit/dist/index.cjs:939:16
      at node_modules/express-rate-limit/dist/index.cjs:825:5

    console.log
      ƒôí [POST] 
/api/public/barberias/test-barberia/barberos/698bdc3e626399f145648e26/reservar

      at log (src/app.js:93:11)

    console.warn
      ÔÜá´©Å  [Security] Rate limit exceeded {
        ip: '::ffff:127.0.0.1',
        method: 'POST',
        path: '/test-barberia/barberos/698bdc3e626399f145648e26/reservar',
        max: 30
      }

    [0m [90m 38 |[39m [90m     */[39m
     [90m 39 |[39m     [36mstatic[39m warn(context[33m,[39m 
message[33m,[39m metadata [33m=[39m {}) {
    [31m[1m>[22m[39m[90m 40 |[39m         
console[33m.[39mwarn([32m`ÔÜá´©Å  [${context}] ${message}`[39m[33m,[39m 
metadata)[33m;[39m
     [90m    |[39m                 [31m[1m^[22m[39m
     [90m 41 |[39m     }
     [90m 42 |[39m
     [90m 43 |[39m     [90m/**[39m[0m

      at Function.warn (src/shared/Logger.js:40:17)
      at Object.warn [as handler] (src/middleware/rateLimit.middleware.js:18:20)
      at node_modules/express-rate-limit/dist/index.cjs:939:16
      at node_modules/express-rate-limit/dist/index.cjs:825:5

    console.log
      ƒôí [POST] 
/api/public/barberias/test-barberia/barberos/698bdc3e626399f145648e26/reservar

      at log (src/app.js:93:11)

    console.warn
      ÔÜá´©Å  [Security] Rate limit exceeded {
        ip: '::ffff:127.0.0.1',
        method: 'POST',
        path: '/test-barberia/barberos/698bdc3e626399f145648e26/reservar',
        max: 30
      }

    [0m [90m 38 |[39m [90m     */[39m
     [90m 39 |[39m     [36mstatic[39m warn(context[33m,[39m 
message[33m,[39m metadata [33m=[39m {}) {
    [31m[1m>[22m[39m[90m 40 |[39m         
console[33m.[39mwarn([32m`ÔÜá´©Å  [${context}] ${message}`[39m[33m,[39m 
metadata)[33m;[39m
     [90m    |[39m                 [31m[1m^[22m[39m
     [90m 41 |[39m     }
     [90m 42 |[39m
     [90m 43 |[39m     [90m/**[39m[0m

      at Function.warn (src/shared/Logger.js:40:17)
      at Object.warn [as handler] (src/middleware/rateLimit.middleware.js:18:20)
      at node_modules/express-rate-limit/dist/index.cjs:939:16
      at node_modules/express-rate-limit/dist/index.cjs:825:5

    console.log
      ƒôí [POST] 
/api/public/barberias/test-barberia/barberos/698bdc3e626399f145648e26/reservar

      at log (src/app.js:93:11)

    console.warn
      ÔÜá´©Å  [Security] Rate limit exceeded {
        ip: '::ffff:127.0.0.1',
        method: 'POST',
        path: '/test-barberia/barberos/698bdc3e626399f145648e26/reservar',
        max: 30
      }

    [0m [90m 38 |[39m [90m     */[39m
     [90m 39 |[39m     [36mstatic[39m warn(context[33m,[39m 
message[33m,[39m metadata [33m=[39m {}) {
    [31m[1m>[22m[39m[90m 40 |[39m         
console[33m.[39mwarn([32m`ÔÜá´©Å  [${context}] ${message}`[39m[33m,[39m 
metadata)[33m;[39m
     [90m    |[39m                 [31m[1m^[22m[39m
     [90m 41 |[39m     }
     [90m 42 |[39m
     [90m 43 |[39m     [90m/**[39m[0m

      at Function.warn (src/shared/Logger.js:40:17)
      at Object.warn [as handler] (src/middleware/rateLimit.middleware.js:18:20)
      at node_modules/express-rate-limit/dist/index.cjs:939:16
      at node_modules/express-rate-limit/dist/index.cjs:825:5

    console.log
      ƒôí [POST] 
/api/public/barberias/test-barberia/barberos/698bdc3e626399f145648e26/reservar

      at log (src/app.js:93:11)

    console.warn
      ÔÜá´©Å  [Security] Rate limit exceeded {
        ip: '::ffff:127.0.0.1',
        method: 'POST',
        path: '/test-barberia/barberos/698bdc3e626399f145648e26/reservar',
        max: 30
      }

    [0m [90m 38 |[39m [90m     */[39m
     [90m 39 |[39m     [36mstatic[39m warn(context[33m,[39m 
message[33m,[39m metadata [33m=[39m {}) {
    [31m[1m>[22m[39m[90m 40 |[39m         
console[33m.[39mwarn([32m`ÔÜá´©Å  [${context}] ${message}`[39m[33m,[39m 
metadata)[33m;[39m
     [90m    |[39m                 [31m[1m^[22m[39m
     [90m 41 |[39m     }
     [90m 42 |[39m
     [90m 43 |[39m     [90m/**[39m[0m

      at Function.warn (src/shared/Logger.js:40:17)
      at Object.warn [as handler] (src/middleware/rateLimit.middleware.js:18:20)
      at node_modules/express-rate-limit/dist/index.cjs:939:16
      at node_modules/express-rate-limit/dist/index.cjs:825:5

    console.log
      ƒôí [POST] 
/api/public/barberias/test-barberia/barberos/698bdc3e626399f145648e26/reservar

      at log (src/app.js:93:11)

    console.warn
      ÔÜá´©Å  [Security] Rate limit exceeded {
        ip: '::ffff:127.0.0.1',
        method: 'POST',
        path: '/test-barberia/barberos/698bdc3e626399f145648e26/reservar',
        max: 30
      }

    [0m [90m 38 |[39m [90m     */[39m
     [90m 39 |[39m     [36mstatic[39m warn(context[33m,[39m 
message[33m,[39m metadata [33m=[39m {}) {
    [31m[1m>[22m[39m[90m 40 |[39m         
console[33m.[39mwarn([32m`ÔÜá´©Å  [${context}] ${message}`[39m[33m,[39m 
metadata)[33m;[39m
     [90m    |[39m                 [31m[1m^[22m[39m
     [90m 41 |[39m     }
     [90m 42 |[39m
     [90m 43 |[39m     [90m/**[39m[0m

      at Function.warn (src/shared/Logger.js:40:17)
      at Object.warn [as handler] (src/middleware/rateLimit.middleware.js:18:20)
      at node_modules/express-rate-limit/dist/index.cjs:939:16
      at node_modules/express-rate-limit/dist/index.cjs:825:5

    console.log
      ƒôí [POST] 
/api/public/barberias/test-barberia/barberos/698bdc3e626399f145648e26/reservar

      at log (src/app.js:93:11)

    console.warn
      ÔÜá´©Å  [Security] Rate limit exceeded {
        ip: '::ffff:127.0.0.1',
        method: 'POST',
        path: '/test-barberia/barberos/698bdc3e626399f145648e26/reservar',
        max: 30
      }

    [0m [90m 38 |[39m [90m     */[39m
     [90m 39 |[39m     [36mstatic[39m warn(context[33m,[39m 
message[33m,[39m metadata [33m=[39m {}) {
    [31m[1m>[22m[39m[90m 40 |[39m         
console[33m.[39mwarn([32m`ÔÜá´©Å  [${context}] ${message}`[39m[33m,[39m 
metadata)[33m;[39m
     [90m    |[39m                 [31m[1m^[22m[39m
     [90m 41 |[39m     }
     [90m 42 |[39m
     [90m 43 |[39m     [90m/**[39m[0m

      at Function.warn (src/shared/Logger.js:40:17)
      at Object.warn [as handler] (src/middleware/rateLimit.middleware.js:18:20)
      at node_modules/express-rate-limit/dist/index.cjs:939:16
      at node_modules/express-rate-limit/dist/index.cjs:825:5

    console.log
      ƒôí [POST] 
/api/public/barberias/test-barberia/barberos/698bdc3e626399f145648e26/reservar

      at log (src/app.js:93:11)

    console.warn
      ÔÜá´©Å  [Security] Rate limit exceeded {
        ip: '::ffff:127.0.0.1',
        method: 'POST',
        path: '/test-barberia/barberos/698bdc3e626399f145648e26/reservar',
        max: 30
      }

    [0m [90m 38 |[39m [90m     */[39m
     [90m 39 |[39m     [36mstatic[39m warn(context[33m,[39m 
message[33m,[39m metadata [33m=[39m {}) {
    [31m[1m>[22m[39m[90m 40 |[39m         
console[33m.[39mwarn([32m`ÔÜá´©Å  [${context}] ${message}`[39m[33m,[39m 
metadata)[33m;[39m
     [90m    |[39m                 [31m[1m^[22m[39m
     [90m 41 |[39m     }
     [90m 42 |[39m
     [90m 43 |[39m     [90m/**[39m[0m

      at Function.warn (src/shared/Logger.js:40:17)
      at Object.warn [as handler] (src/middleware/rateLimit.middleware.js:18:20)
      at node_modules/express-rate-limit/dist/index.cjs:939:16
      at node_modules/express-rate-limit/dist/index.cjs:825:5

    console.log
      ƒôí [POST] 
/api/public/barberias/test-barberia/barberos/698bdc3e626399f145648e26/reservar

      at log (src/app.js:93:11)

    console.warn
      ÔÜá´©Å  [Security] Rate limit exceeded {
        ip: '::ffff:127.0.0.1',
        method: 'POST',
        path: '/test-barberia/barberos/698bdc3e626399f145648e26/reservar',
        max: 30
      }

    [0m [90m 38 |[39m [90m     */[39m
     [90m 39 |[39m     [36mstatic[39m warn(context[33m,[39m 
message[33m,[39m metadata [33m=[39m {}) {
    [31m[1m>[22m[39m[90m 40 |[39m         
console[33m.[39mwarn([32m`ÔÜá´©Å  [${context}] ${message}`[39m[33m,[39m 
metadata)[33m;[39m
     [90m    |[39m                 [31m[1m^[22m[39m
     [90m 41 |[39m     }
     [90m 42 |[39m
     [90m 43 |[39m     [90m/**[39m[0m

      at Function.warn (src/shared/Logger.js:40:17)
      at Object.warn [as handler] (src/middleware/rateLimit.middleware.js:18:20)
      at node_modules/express-rate-limit/dist/index.cjs:939:16
      at node_modules/express-rate-limit/dist/index.cjs:825:5

    console.log
      ƒôí [POST] 
/api/public/barberias/test-barberia/barberos/698bdc3e626399f145648e26/reservar

      at log (src/app.js:93:11)

    console.warn
      ÔÜá´©Å  [Security] Rate limit exceeded {
        ip: '::ffff:127.0.0.1',
        method: 'POST',
        path: '/test-barberia/barberos/698bdc3e626399f145648e26/reservar',
        max: 30
      }

    [0m [90m 38 |[39m [90m     */[39m
     [90m 39 |[39m     [36mstatic[39m warn(context[33m,[39m 
message[33m,[39m metadata [33m=[39m {}) {
    [31m[1m>[22m[39m[90m 40 |[39m         
console[33m.[39mwarn([32m`ÔÜá´©Å  [${context}] ${message}`[39m[33m,[39m 
metadata)[33m;[39m
     [90m    |[39m                 [31m[1m^[22m[39m
     [90m 41 |[39m     }
     [90m 42 |[39m
     [90m 43 |[39m     [90m/**[39m[0m

      at Function.warn (src/shared/Logger.js:40:17)
      at Object.warn [as handler] (src/middleware/rateLimit.middleware.js:18:20)
      at node_modules/express-rate-limit/dist/index.cjs:939:16
      at node_modules/express-rate-limit/dist/index.cjs:825:5

    console.log
      ƒôí [POST] 
/api/public/barberias/test-barberia/barberos/698bdc3e626399f145648e26/reservar

      at log (src/app.js:93:11)

    console.warn
      ÔÜá´©Å  [Security] Rate limit exceeded {
        ip: '::ffff:127.0.0.1',
        method: 'POST',
        path: '/test-barberia/barberos/698bdc3e626399f145648e26/reservar',
        max: 30
      }

    [0m [90m 38 |[39m [90m     */[39m
     [90m 39 |[39m     [36mstatic[39m warn(context[33m,[39m 
message[33m,[39m metadata [33m=[39m {}) {
    [31m[1m>[22m[39m[90m 40 |[39m         
console[33m.[39mwarn([32m`ÔÜá´©Å  [${context}] ${message}`[39m[33m,[39m 
metadata)[33m;[39m
     [90m    |[39m                 [31m[1m^[22m[39m
     [90m 41 |[39m     }
     [90m 42 |[39m
     [90m 43 |[39m     [90m/**[39m[0m

      at Function.warn (src/shared/Logger.js:40:17)
      at Object.warn [as handler] (src/middleware/rateLimit.middleware.js:18:20)
      at node_modules/express-rate-limit/dist/index.cjs:939:16
      at node_modules/express-rate-limit/dist/index.cjs:825:5

    console.log
      ƒôí [POST] 
/api/public/barberias/test-barberia/barberos/698bdc3e626399f145648e26/reservar

      at log (src/app.js:93:11)

    console.warn
      ÔÜá´©Å  [Security] Rate limit exceeded {
        ip: '::ffff:127.0.0.1',
        method: 'POST',
        path: '/test-barberia/barberos/698bdc3e626399f145648e26/reservar',
        max: 30
      }

    [0m [90m 38 |[39m [90m     */[39m
     [90m 39 |[39m     [36mstatic[39m warn(context[33m,[39m 
message[33m,[39m metadata [33m=[39m {}) {
    [31m[1m>[22m[39m[90m 40 |[39m         
console[33m.[39mwarn([32m`ÔÜá´©Å  [${context}] ${message}`[39m[33m,[39m 
metadata)[33m;[39m
     [90m    |[39m                 [31m[1m^[22m[39m
     [90m 41 |[39m     }
     [90m 42 |[39m
     [90m 43 |[39m     [90m/**[39m[0m

      at Function.warn (src/shared/Logger.js:40:17)
      at Object.warn [as handler] (src/middleware/rateLimit.middleware.js:18:20)
      at node_modules/express-rate-limit/dist/index.cjs:939:16
      at node_modules/express-rate-limit/dist/index.cjs:825:5

    console.log
      ƒôí [POST] 
/api/public/barberias/test-barberia/barberos/698bdc3e626399f145648e26/reservar

      at log (src/app.js:93:11)

    console.warn
      ÔÜá´©Å  [Security] Rate limit exceeded {
        ip: '::ffff:127.0.0.1',
        method: 'POST',
        path: '/test-barberia/barberos/698bdc3e626399f145648e26/reservar',
        max: 30
      }

    [0m [90m 38 |[39m [90m     */[39m
     [90m 39 |[39m     [36mstatic[39m warn(context[33m,[39m 
message[33m,[39m metadata [33m=[39m {}) {
    [31m[1m>[22m[39m[90m 40 |[39m         
console[33m.[39mwarn([32m`ÔÜá´©Å  [${context}] ${message}`[39m[33m,[39m 
metadata)[33m;[39m
     [90m    |[39m                 [31m[1m^[22m[39m
     [90m 41 |[39m     }
     [90m 42 |[39m
     [90m 43 |[39m     [90m/**[39m[0m

      at Function.warn (src/shared/Logger.js:40:17)
      at Object.warn [as handler] (src/middleware/rateLimit.middleware.js:18:20)
      at node_modules/express-rate-limit/dist/index.cjs:939:16
      at node_modules/express-rate-limit/dist/index.cjs:825:5

    console.log
      ƒôí [POST] 
/api/public/barberias/test-barberia/barberos/698bdc3e626399f145648e26/reservar

      at log (src/app.js:93:11)

    console.warn
      ÔÜá´©Å  [Security] Rate limit exceeded {
        ip: '::ffff:127.0.0.1',
        method: 'POST',
        path: '/test-barberia/barberos/698bdc3e626399f145648e26/reservar',
        max: 30
      }

    [0m [90m 38 |[39m [90m     */[39m
     [90m 39 |[39m     [36mstatic[39m warn(context[33m,[39m 
message[33m,[39m metadata [33m=[39m {}) {
    [31m[1m>[22m[39m[90m 40 |[39m         
console[33m.[39mwarn([32m`ÔÜá´©Å  [${context}] ${message}`[39m[33m,[39m 
metadata)[33m;[39m
     [90m    |[39m                 [31m[1m^[22m[39m
     [90m 41 |[39m     }
     [90m 42 |[39m
     [90m 43 |[39m     [90m/**[39m[0m

      at Function.warn (src/shared/Logger.js:40:17)
      at Object.warn [as handler] (src/middleware/rateLimit.middleware.js:18:20)
      at node_modules/express-rate-limit/dist/index.cjs:939:16
      at node_modules/express-rate-limit/dist/index.cjs:825:5

    console.log
      ƒôí [POST] 
/api/public/barberias/test-barberia/barberos/698bdc3e626399f145648e26/reservar

      at log (src/app.js:93:11)

    console.warn
      ÔÜá´©Å  [Security] Rate limit exceeded {
        ip: '::ffff:127.0.0.1',
        method: 'POST',
        path: '/test-barberia/barberos/698bdc3e626399f145648e26/reservar',
        max: 30
      }

    [0m [90m 38 |[39m [90m     */[39m
     [90m 39 |[39m     [36mstatic[39m warn(context[33m,[39m 
message[33m,[39m metadata [33m=[39m {}) {
    [31m[1m>[22m[39m[90m 40 |[39m         
console[33m.[39mwarn([32m`ÔÜá´©Å  [${context}] ${message}`[39m[33m,[39m 
metadata)[33m;[39m
     [90m    |[39m                 [31m[1m^[22m[39m
     [90m 41 |[39m     }
     [90m 42 |[39m
     [90m 43 |[39m     [90m/**[39m[0m

      at Function.warn (src/shared/Logger.js:40:17)
      at Object.warn [as handler] (src/middleware/rateLimit.middleware.js:18:20)
      at node_modules/express-rate-limit/dist/index.cjs:939:16
      at node_modules/express-rate-limit/dist/index.cjs:825:5

    console.log
      ƒôí [POST] 
/api/public/barberias/test-barberia/barberos/698bdc3e626399f145648e26/reservar

      at log (src/app.js:93:11)

    console.warn
      ÔÜá´©Å  [Security] Rate limit exceeded {
        ip: '::ffff:127.0.0.1',
        method: 'POST',
        path: '/test-barberia/barberos/698bdc3e626399f145648e26/reservar',
        max: 30
      }

    [0m [90m 38 |[39m [90m     */[39m
     [90m 39 |[39m     [36mstatic[39m warn(context[33m,[39m 
message[33m,[39m metadata [33m=[39m {}) {
    [31m[1m>[22m[39m[90m 40 |[39m         
console[33m.[39mwarn([32m`ÔÜá´©Å  [${context}] ${message}`[39m[33m,[39m 
metadata)[33m;[39m
     [90m    |[39m                 [31m[1m^[22m[39m
     [90m 41 |[39m     }
     [90m 42 |[39m
     [90m 43 |[39m     [90m/**[39m[0m

      at Function.warn (src/shared/Logger.js:40:17)
      at Object.warn [as handler] (src/middleware/rateLimit.middleware.js:18:20)
      at node_modules/express-rate-limit/dist/index.cjs:939:16
      at node_modules/express-rate-limit/dist/index.cjs:825:5

    console.log
      ƒôí [POST] 
/api/public/barberias/test-barberia/barberos/698bdc3e626399f145648e26/reservar

      at log (src/app.js:93:11)

    console.warn
      ÔÜá´©Å  [Security] Rate limit exceeded {
        ip: '::ffff:127.0.0.1',
        method: 'POST',
        path: '/test-barberia/barberos/698bdc3e626399f145648e26/reservar',
        max: 30
      }

    [0m [90m 38 |[39m [90m     */[39m
     [90m 39 |[39m     [36mstatic[39m warn(context[33m,[39m 
message[33m,[39m metadata [33m=[39m {}) {
    [31m[1m>[22m[39m[90m 40 |[39m         
console[33m.[39mwarn([32m`ÔÜá´©Å  [${context}] ${message}`[39m[33m,[39m 
metadata)[33m;[39m
     [90m    |[39m                 [31m[1m^[22m[39m
     [90m 41 |[39m     }
     [90m 42 |[39m
     [90m 43 |[39m     [90m/**[39m[0m

      at Function.warn (src/shared/Logger.js:40:17)
      at Object.warn [as handler] (src/middleware/rateLimit.middleware.js:18:20)
      at node_modules/express-rate-limit/dist/index.cjs:939:16
      at node_modules/express-rate-limit/dist/index.cjs:825:5

    console.log
      ƒôí [POST] 
/api/public/barberias/test-barberia/barberos/698bdc3e626399f145648e26/reservar

      at log (src/app.js:93:11)

    console.warn
      ÔÜá´©Å  [Security] Rate limit exceeded {
        ip: '::ffff:127.0.0.1',
        method: 'POST',
        path: '/test-barberia/barberos/698bdc3e626399f145648e26/reservar',
        max: 30
      }

    [0m [90m 38 |[39m [90m     */[39m
     [90m 39 |[39m     [36mstatic[39m warn(context[33m,[39m 
message[33m,[39m metadata [33m=[39m {}) {
    [31m[1m>[22m[39m[90m 40 |[39m         
console[33m.[39mwarn([32m`ÔÜá´©Å  [${context}] ${message}`[39m[33m,[39m 
metadata)[33m;[39m
     [90m    |[39m                 [31m[1m^[22m[39m
     [90m 41 |[39m     }
     [90m 42 |[39m
     [90m 43 |[39m     [90m/**[39m[0m

      at Function.warn (src/shared/Logger.js:40:17)
      at Object.warn [as handler] (src/middleware/rateLimit.middleware.js:18:20)
      at node_modules/express-rate-limit/dist/index.cjs:939:16
      at node_modules/express-rate-limit/dist/index.cjs:825:5

    console.log
      ƒôí [POST] 
/api/public/barberias/test-barberia/barberos/698bdc3e626399f145648e26/reservar

      at log (src/app.js:93:11)

    console.warn
      ÔÜá´©Å  [Security] Rate limit exceeded {
        ip: '::ffff:127.0.0.1',
        method: 'POST',
        path: '/test-barberia/barberos/698bdc3e626399f145648e26/reservar',
        max: 30
      }

    [0m [90m 38 |[39m [90m     */[39m
     [90m 39 |[39m     [36mstatic[39m warn(context[33m,[39m 
message[33m,[39m metadata [33m=[39m {}) {
    [31m[1m>[22m[39m[90m 40 |[39m         
console[33m.[39mwarn([32m`ÔÜá´©Å  [${context}] ${message}`[39m[33m,[39m 
metadata)[33m;[39m
     [90m    |[39m                 [31m[1m^[22m[39m
     [90m 41 |[39m     }
     [90m 42 |[39m
     [90m 43 |[39m     [90m/**[39m[0m

      at Function.warn (src/shared/Logger.js:40:17)
      at Object.warn [as handler] (src/middleware/rateLimit.middleware.js:18:20)
      at node_modules/express-rate-limit/dist/index.cjs:939:16
      at node_modules/express-rate-limit/dist/index.cjs:825:5

    console.log
      ƒôí [POST] 
/api/public/barberias/test-barberia/barberos/698bdc3e626399f145648e26/reservar

      at log (src/app.js:93:11)

    console.warn
      ÔÜá´©Å  [Security] Rate limit exceeded {
        ip: '::ffff:127.0.0.1',
        method: 'POST',
        path: '/test-barberia/barberos/698bdc3e626399f145648e26/reservar',
        max: 30
      }

    [0m [90m 38 |[39m [90m     */[39m
     [90m 39 |[39m     [36mstatic[39m warn(context[33m,[39m 
message[33m,[39m metadata [33m=[39m {}) {
    [31m[1m>[22m[39m[90m 40 |[39m         
console[33m.[39mwarn([32m`ÔÜá´©Å  [${context}] ${message}`[39m[33m,[39m 
metadata)[33m;[39m
     [90m    |[39m                 [31m[1m^[22m[39m
     [90m 41 |[39m     }
     [90m 42 |[39m
     [90m 43 |[39m     [90m/**[39m[0m

      at Function.warn (src/shared/Logger.js:40:17)
      at Object.warn [as handler] (src/middleware/rateLimit.middleware.js:18:20)
      at node_modules/express-rate-limit/dist/index.cjs:939:16
      at node_modules/express-rate-limit/dist/index.cjs:825:5

    console.log
      ƒôí [POST] 
/api/public/barberias/test-barberia/barberos/698bdc3e626399f145648e26/reservar

      at log (src/app.js:93:11)

    console.warn
      ÔÜá´©Å  [Security] Rate limit exceeded {
        ip: '::ffff:127.0.0.1',
        method: 'POST',
        path: '/test-barberia/barberos/698bdc3e626399f145648e26/reservar',
        max: 30
      }

    [0m [90m 38 |[39m [90m     */[39m
     [90m 39 |[39m     [36mstatic[39m warn(context[33m,[39m 
message[33m,[39m metadata [33m=[39m {}) {
    [31m[1m>[22m[39m[90m 40 |[39m         
console[33m.[39mwarn([32m`ÔÜá´©Å  [${context}] ${message}`[39m[33m,[39m 
metadata)[33m;[39m
     [90m    |[39m                 [31m[1m^[22m[39m
     [90m 41 |[39m     }
     [90m 42 |[39m
     [90m 43 |[39m     [90m/**[39m[0m

      at Function.warn (src/shared/Logger.js:40:17)
      at Object.warn [as handler] (src/middleware/rateLimit.middleware.js:18:20)
      at node_modules/express-rate-limit/dist/index.cjs:939:16
      at node_modules/express-rate-limit/dist/index.cjs:825:5

    console.log
      [Transaction] Started: CreateReservation (attempt 1/3)

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:54:25)

    console.log
      [Transaction] Started: CreateReservation (attempt 1/3)

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:54:25)

    console.log
      [Transaction] Started: CreateReservation (attempt 1/3)

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:54:25)

    console.log
      [Transaction] Started: CreateReservation (attempt 1/3)

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:54:25)

    console.log
      [Transaction] Started: CreateReservation (attempt 1/3)

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:54:25)

    console.log
      [Transaction] Started: CreateReservation (attempt 1/3)

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:54:25)

    console.log
      [Transaction] Started: CreateReservation (attempt 1/3)

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:54:25)

    console.log
      [Transaction] Started: CreateReservation (attempt 1/3)

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:54:25)

    console.log
      [Transaction] Started: CreateReservation (attempt 1/3)

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:54:25)

    console.log
      [Transaction] Started: CreateReservation (attempt 1/3)

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:54:25)

    console.log
      [Transaction] Started: CreateReservation (attempt 1/3)

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:54:25)

    console.log
      [Transaction] Started: CreateReservation (attempt 1/3)

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:54:25)

    console.log
      [Transaction] Started: CreateReservation (attempt 1/3)

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:54:25)

    console.log
      [Transaction] Started: CreateReservation (attempt 1/3)

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:54:25)

    console.log
      [Transaction] Started: CreateReservation (attempt 1/3)

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:54:25)

    console.log
      [Transaction] Started: CreateReservation (attempt 1/3)

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:54:25)

    console.log
      [Transaction] Started: CreateReservation (attempt 1/3)

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:54:25)

    console.log
      [Transaction] Started: CreateReservation (attempt 1/3)

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:54:25)

    console.log
      [Transaction] Started: CreateReservation (attempt 1/3)

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:54:25)

    console.log
      [Transaction] Started: CreateReservation (attempt 1/3)

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:54:25)

    console.log
      [Transaction] Aborted: CreateReservation

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:69:29)

    console.warn
      [Transaction] Transient error, retrying in 200ms: WriteConflict error: 
this operation conflicted with another operation. Please retry your operation or 
multi-document transaction.

    [0m [90m 74 |[39m                     attempt[33m++[39m[33m;[39m
     [90m 75 |[39m                     [36mconst[39m delay [33m=[39m 
retryDelay [33m*[39m [33mMath[39m[33m.[39mpow([35m2[39m[33m,[39m 
attempt)[33m;[39m [90m// Exponential backoff[39m
    [31m[1m>[22m[39m[90m 76 |[39m                     
console[33m.[39mwarn([32m`[Transaction] Transient error, retrying in 
${delay}ms:`[39m[33m,[39m error[33m.[39mmessage)[33m;[39m
     [90m    |[39m                             [31m[1m^[22m[39m
     [90m 77 |[39m                     [36mawait[39m 
[36mthis[39m[33m.[39msleep(delay)[33m;[39m
     [90m 78 |[39m                     [36mcontinue[39m[33m;[39m
     [90m 79 |[39m                 }[0m

      at Function.warn [as executeInTransaction] 
(src/utils/TransactionManager.js:76:29)
      at CreateReserva.execute 
(src/application/use-cases/reservas/CreateReserva.js:26:34)
      at Object.<anonymous>.exports.crearReservaBySlug 
(src/controllers/public.controller.js:140:25)

    console.log
      [Transaction] Aborted: CreateReservation

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:69:29)

    console.warn
      [Transaction] Transient error, retrying in 200ms: WriteConflict error: 
this operation conflicted with another operation. Please retry your operation or 
multi-document transaction.

    [0m [90m 74 |[39m                     attempt[33m++[39m[33m;[39m
     [90m 75 |[39m                     [36mconst[39m delay [33m=[39m 
retryDelay [33m*[39m [33mMath[39m[33m.[39mpow([35m2[39m[33m,[39m 
attempt)[33m;[39m [90m// Exponential backoff[39m
    [31m[1m>[22m[39m[90m 76 |[39m                     
console[33m.[39mwarn([32m`[Transaction] Transient error, retrying in 
${delay}ms:`[39m[33m,[39m error[33m.[39mmessage)[33m;[39m
     [90m    |[39m                             [31m[1m^[22m[39m
     [90m 77 |[39m                     [36mawait[39m 
[36mthis[39m[33m.[39msleep(delay)[33m;[39m
     [90m 78 |[39m                     [36mcontinue[39m[33m;[39m
     [90m 79 |[39m                 }[0m

      at Function.warn [as executeInTransaction] 
(src/utils/TransactionManager.js:76:29)
      at CreateReserva.execute 
(src/application/use-cases/reservas/CreateReserva.js:26:34)
      at Object.<anonymous>.exports.crearReservaBySlug 
(src/controllers/public.controller.js:140:25)

    console.log
      [Transaction] Aborted: CreateReservation

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:69:29)

    console.warn
      [Transaction] Transient error, retrying in 200ms: WriteConflict error: 
this operation conflicted with another operation. Please retry your operation or 
multi-document transaction.

    [0m [90m 74 |[39m                     attempt[33m++[39m[33m;[39m
     [90m 75 |[39m                     [36mconst[39m delay [33m=[39m 
retryDelay [33m*[39m [33mMath[39m[33m.[39mpow([35m2[39m[33m,[39m 
attempt)[33m;[39m [90m// Exponential backoff[39m
    [31m[1m>[22m[39m[90m 76 |[39m                     
console[33m.[39mwarn([32m`[Transaction] Transient error, retrying in 
${delay}ms:`[39m[33m,[39m error[33m.[39mmessage)[33m;[39m
     [90m    |[39m                             [31m[1m^[22m[39m
     [90m 77 |[39m                     [36mawait[39m 
[36mthis[39m[33m.[39msleep(delay)[33m;[39m
     [90m 78 |[39m                     [36mcontinue[39m[33m;[39m
     [90m 79 |[39m                 }[0m

      at Function.warn [as executeInTransaction] 
(src/utils/TransactionManager.js:76:29)
      at CreateReserva.execute 
(src/application/use-cases/reservas/CreateReserva.js:26:34)
      at Object.<anonymous>.exports.crearReservaBySlug 
(src/controllers/public.controller.js:140:25)

    console.log
      [Transaction] Aborted: CreateReservation

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:69:29)

    console.warn
      [Transaction] Transient error, retrying in 200ms: WriteConflict error: 
this operation conflicted with another operation. Please retry your operation or 
multi-document transaction.

    [0m [90m 74 |[39m                     attempt[33m++[39m[33m;[39m
     [90m 75 |[39m                     [36mconst[39m delay [33m=[39m 
retryDelay [33m*[39m [33mMath[39m[33m.[39mpow([35m2[39m[33m,[39m 
attempt)[33m;[39m [90m// Exponential backoff[39m
    [31m[1m>[22m[39m[90m 76 |[39m                     
console[33m.[39mwarn([32m`[Transaction] Transient error, retrying in 
${delay}ms:`[39m[33m,[39m error[33m.[39mmessage)[33m;[39m
     [90m    |[39m                             [31m[1m^[22m[39m
     [90m 77 |[39m                     [36mawait[39m 
[36mthis[39m[33m.[39msleep(delay)[33m;[39m
     [90m 78 |[39m                     [36mcontinue[39m[33m;[39m
     [90m 79 |[39m                 }[0m

      at Function.warn [as executeInTransaction] 
(src/utils/TransactionManager.js:76:29)
      at CreateReserva.execute 
(src/application/use-cases/reservas/CreateReserva.js:26:34)
      at Object.<anonymous>.exports.crearReservaBySlug 
(src/controllers/public.controller.js:140:25)

    console.log
      [Transaction] Committed: CreateReservation

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:61:25)

    console.log
      [Transaction] Aborted: CreateReservation

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:69:29)

    console.warn
      [Transaction] Transient error, retrying in 200ms: WriteConflict error: 
this operation conflicted with another operation. Please retry your operation or 
multi-document transaction.

    [0m [90m 74 |[39m                     attempt[33m++[39m[33m;[39m
     [90m 75 |[39m                     [36mconst[39m delay [33m=[39m 
retryDelay [33m*[39m [33mMath[39m[33m.[39mpow([35m2[39m[33m,[39m 
attempt)[33m;[39m [90m// Exponential backoff[39m
    [31m[1m>[22m[39m[90m 76 |[39m                     
console[33m.[39mwarn([32m`[Transaction] Transient error, retrying in 
${delay}ms:`[39m[33m,[39m error[33m.[39mmessage)[33m;[39m
     [90m    |[39m                             [31m[1m^[22m[39m
     [90m 77 |[39m                     [36mawait[39m 
[36mthis[39m[33m.[39msleep(delay)[33m;[39m
     [90m 78 |[39m                     [36mcontinue[39m[33m;[39m
     [90m 79 |[39m                 }[0m

      at Function.warn [as executeInTransaction] 
(src/utils/TransactionManager.js:76:29)
      at CreateReserva.execute 
(src/application/use-cases/reservas/CreateReserva.js:26:34)
      at Object.<anonymous>.exports.crearReservaBySlug 
(src/controllers/public.controller.js:140:25)

    console.log
      [Transaction] Aborted: CreateReservation

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:69:29)

    console.warn
      [Transaction] Transient error, retrying in 200ms: WriteConflict error: 
this operation conflicted with another operation. Please retry your operation or 
multi-document transaction.

    [0m [90m 74 |[39m                     attempt[33m++[39m[33m;[39m
     [90m 75 |[39m                     [36mconst[39m delay [33m=[39m 
retryDelay [33m*[39m [33mMath[39m[33m.[39mpow([35m2[39m[33m,[39m 
attempt)[33m;[39m [90m// Exponential backoff[39m
    [31m[1m>[22m[39m[90m 76 |[39m                     
console[33m.[39mwarn([32m`[Transaction] Transient error, retrying in 
${delay}ms:`[39m[33m,[39m error[33m.[39mmessage)[33m;[39m
     [90m    |[39m                             [31m[1m^[22m[39m
     [90m 77 |[39m                     [36mawait[39m 
[36mthis[39m[33m.[39msleep(delay)[33m;[39m
     [90m 78 |[39m                     [36mcontinue[39m[33m;[39m
     [90m 79 |[39m                 }[0m

      at Function.warn [as executeInTransaction] 
(src/utils/TransactionManager.js:76:29)
      at CreateReserva.execute 
(src/application/use-cases/reservas/CreateReserva.js:26:34)
      at Object.<anonymous>.exports.crearReservaBySlug 
(src/controllers/public.controller.js:140:25)

    console.log
      [Transaction] Aborted: CreateReservation

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:69:29)

    console.warn
      [Transaction] Transient error, retrying in 200ms: WriteConflict error: 
this operation conflicted with another operation. Please retry your operation or 
multi-document transaction.

    [0m [90m 74 |[39m                     attempt[33m++[39m[33m;[39m
     [90m 75 |[39m                     [36mconst[39m delay [33m=[39m 
retryDelay [33m*[39m [33mMath[39m[33m.[39mpow([35m2[39m[33m,[39m 
attempt)[33m;[39m [90m// Exponential backoff[39m
    [31m[1m>[22m[39m[90m 76 |[39m                     
console[33m.[39mwarn([32m`[Transaction] Transient error, retrying in 
${delay}ms:`[39m[33m,[39m error[33m.[39mmessage)[33m;[39m
     [90m    |[39m                             [31m[1m^[22m[39m
     [90m 77 |[39m                     [36mawait[39m 
[36mthis[39m[33m.[39msleep(delay)[33m;[39m
     [90m 78 |[39m                     [36mcontinue[39m[33m;[39m
     [90m 79 |[39m                 }[0m

      at Function.warn [as executeInTransaction] 
(src/utils/TransactionManager.js:76:29)
      at CreateReserva.execute 
(src/application/use-cases/reservas/CreateReserva.js:26:34)
      at Object.<anonymous>.exports.crearReservaBySlug 
(src/controllers/public.controller.js:140:25)

    console.log
      [Transaction] Aborted: CreateReservation

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:69:29)

    console.warn
      [Transaction] Transient error, retrying in 200ms: WriteConflict error: 
this operation conflicted with another operation. Please retry your operation or 
multi-document transaction.

    [0m [90m 74 |[39m                     attempt[33m++[39m[33m;[39m
     [90m 75 |[39m                     [36mconst[39m delay [33m=[39m 
retryDelay [33m*[39m [33mMath[39m[33m.[39mpow([35m2[39m[33m,[39m 
attempt)[33m;[39m [90m// Exponential backoff[39m
    [31m[1m>[22m[39m[90m 76 |[39m                     
console[33m.[39mwarn([32m`[Transaction] Transient error, retrying in 
${delay}ms:`[39m[33m,[39m error[33m.[39mmessage)[33m;[39m
     [90m    |[39m                             [31m[1m^[22m[39m
     [90m 77 |[39m                     [36mawait[39m 
[36mthis[39m[33m.[39msleep(delay)[33m;[39m
     [90m 78 |[39m                     [36mcontinue[39m[33m;[39m
     [90m 79 |[39m                 }[0m

      at Function.warn [as executeInTransaction] 
(src/utils/TransactionManager.js:76:29)
      at CreateReserva.execute 
(src/application/use-cases/reservas/CreateReserva.js:26:34)
      at Object.<anonymous>.exports.crearReservaBySlug 
(src/controllers/public.controller.js:140:25)

    console.log
      [Transaction] Aborted: CreateReservation

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:69:29)

    console.warn
      [Transaction] Transient error, retrying in 200ms: WriteConflict error: 
this operation conflicted with another operation. Please retry your operation or 
multi-document transaction.

    [0m [90m 74 |[39m                     attempt[33m++[39m[33m;[39m
     [90m 75 |[39m                     [36mconst[39m delay [33m=[39m 
retryDelay [33m*[39m [33mMath[39m[33m.[39mpow([35m2[39m[33m,[39m 
attempt)[33m;[39m [90m// Exponential backoff[39m
    [31m[1m>[22m[39m[90m 76 |[39m                     
console[33m.[39mwarn([32m`[Transaction] Transient error, retrying in 
${delay}ms:`[39m[33m,[39m error[33m.[39mmessage)[33m;[39m
     [90m    |[39m                             [31m[1m^[22m[39m
     [90m 77 |[39m                     [36mawait[39m 
[36mthis[39m[33m.[39msleep(delay)[33m;[39m
     [90m 78 |[39m                     [36mcontinue[39m[33m;[39m
     [90m 79 |[39m                 }[0m

      at Function.warn [as executeInTransaction] 
(src/utils/TransactionManager.js:76:29)
      at CreateReserva.execute 
(src/application/use-cases/reservas/CreateReserva.js:26:34)
      at Object.<anonymous>.exports.crearReservaBySlug 
(src/controllers/public.controller.js:140:25)

    console.log
      [Transaction] Aborted: CreateReservation

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:69:29)

    console.warn
      [Transaction] Transient error, retrying in 200ms: WriteConflict error: 
this operation conflicted with another operation. Please retry your operation or 
multi-document transaction.

    [0m [90m 74 |[39m                     attempt[33m++[39m[33m;[39m
     [90m 75 |[39m                     [36mconst[39m delay [33m=[39m 
retryDelay [33m*[39m [33mMath[39m[33m.[39mpow([35m2[39m[33m,[39m 
attempt)[33m;[39m [90m// Exponential backoff[39m
    [31m[1m>[22m[39m[90m 76 |[39m                     
console[33m.[39mwarn([32m`[Transaction] Transient error, retrying in 
${delay}ms:`[39m[33m,[39m error[33m.[39mmessage)[33m;[39m
     [90m    |[39m                             [31m[1m^[22m[39m
     [90m 77 |[39m                     [36mawait[39m 
[36mthis[39m[33m.[39msleep(delay)[33m;[39m
     [90m 78 |[39m                     [36mcontinue[39m[33m;[39m
     [90m 79 |[39m                 }[0m

      at Function.warn [as executeInTransaction] 
(src/utils/TransactionManager.js:76:29)
      at CreateReserva.execute 
(src/application/use-cases/reservas/CreateReserva.js:26:34)
      at Object.<anonymous>.exports.crearReservaBySlug 
(src/controllers/public.controller.js:140:25)

    console.log
      [Transaction] Aborted: CreateReservation

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:69:29)

    console.warn
      [Transaction] Transient error, retrying in 200ms: WriteConflict error: 
this operation conflicted with another operation. Please retry your operation or 
multi-document transaction.

    [0m [90m 74 |[39m                     attempt[33m++[39m[33m;[39m
     [90m 75 |[39m                     [36mconst[39m delay [33m=[39m 
retryDelay [33m*[39m [33mMath[39m[33m.[39mpow([35m2[39m[33m,[39m 
attempt)[33m;[39m [90m// Exponential backoff[39m
    [31m[1m>[22m[39m[90m 76 |[39m                     
console[33m.[39mwarn([32m`[Transaction] Transient error, retrying in 
${delay}ms:`[39m[33m,[39m error[33m.[39mmessage)[33m;[39m
     [90m    |[39m                             [31m[1m^[22m[39m
     [90m 77 |[39m                     [36mawait[39m 
[36mthis[39m[33m.[39msleep(delay)[33m;[39m
     [90m 78 |[39m                     [36mcontinue[39m[33m;[39m
     [90m 79 |[39m                 }[0m

      at Function.warn [as executeInTransaction] 
(src/utils/TransactionManager.js:76:29)
      at CreateReserva.execute 
(src/application/use-cases/reservas/CreateReserva.js:26:34)
      at Object.<anonymous>.exports.crearReservaBySlug 
(src/controllers/public.controller.js:140:25)

    console.log
      [Transaction] Aborted: CreateReservation

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:69:29)

    console.warn
      [Transaction] Transient error, retrying in 200ms: WriteConflict error: 
this operation conflicted with another operation. Please retry your operation or 
multi-document transaction.

    [0m [90m 74 |[39m                     attempt[33m++[39m[33m;[39m
     [90m 75 |[39m                     [36mconst[39m delay [33m=[39m 
retryDelay [33m*[39m [33mMath[39m[33m.[39mpow([35m2[39m[33m,[39m 
attempt)[33m;[39m [90m// Exponential backoff[39m
    [31m[1m>[22m[39m[90m 76 |[39m                     
console[33m.[39mwarn([32m`[Transaction] Transient error, retrying in 
${delay}ms:`[39m[33m,[39m error[33m.[39mmessage)[33m;[39m
     [90m    |[39m                             [31m[1m^[22m[39m
     [90m 77 |[39m                     [36mawait[39m 
[36mthis[39m[33m.[39msleep(delay)[33m;[39m
     [90m 78 |[39m                     [36mcontinue[39m[33m;[39m
     [90m 79 |[39m                 }[0m

      at Function.warn [as executeInTransaction] 
(src/utils/TransactionManager.js:76:29)
      at CreateReserva.execute 
(src/application/use-cases/reservas/CreateReserva.js:26:34)
      at Object.<anonymous>.exports.crearReservaBySlug 
(src/controllers/public.controller.js:140:25)

    console.log
      [Transaction] Aborted: CreateReservation

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:69:29)

    console.warn
      [Transaction] Transient error, retrying in 200ms: WriteConflict error: 
this operation conflicted with another operation. Please retry your operation or 
multi-document transaction.

    [0m [90m 74 |[39m                     attempt[33m++[39m[33m;[39m
     [90m 75 |[39m                     [36mconst[39m delay [33m=[39m 
retryDelay [33m*[39m [33mMath[39m[33m.[39mpow([35m2[39m[33m,[39m 
attempt)[33m;[39m [90m// Exponential backoff[39m
    [31m[1m>[22m[39m[90m 76 |[39m                     
console[33m.[39mwarn([32m`[Transaction] Transient error, retrying in 
${delay}ms:`[39m[33m,[39m error[33m.[39mmessage)[33m;[39m
     [90m    |[39m                             [31m[1m^[22m[39m
     [90m 77 |[39m                     [36mawait[39m 
[36mthis[39m[33m.[39msleep(delay)[33m;[39m
     [90m 78 |[39m                     [36mcontinue[39m[33m;[39m
     [90m 79 |[39m                 }[0m

      at Function.warn [as executeInTransaction] 
(src/utils/TransactionManager.js:76:29)
      at CreateReserva.execute 
(src/application/use-cases/reservas/CreateReserva.js:26:34)
      at Object.<anonymous>.exports.crearReservaBySlug 
(src/controllers/public.controller.js:140:25)

    console.log
      [Transaction] Aborted: CreateReservation

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:69:29)

    console.warn
      [Transaction] Transient error, retrying in 200ms: WriteConflict error: 
this operation conflicted with another operation. Please retry your operation or 
multi-document transaction.

    [0m [90m 74 |[39m                     attempt[33m++[39m[33m;[39m
     [90m 75 |[39m                     [36mconst[39m delay [33m=[39m 
retryDelay [33m*[39m [33mMath[39m[33m.[39mpow([35m2[39m[33m,[39m 
attempt)[33m;[39m [90m// Exponential backoff[39m
    [31m[1m>[22m[39m[90m 76 |[39m                     
console[33m.[39mwarn([32m`[Transaction] Transient error, retrying in 
${delay}ms:`[39m[33m,[39m error[33m.[39mmessage)[33m;[39m
     [90m    |[39m                             [31m[1m^[22m[39m
     [90m 77 |[39m                     [36mawait[39m 
[36mthis[39m[33m.[39msleep(delay)[33m;[39m
     [90m 78 |[39m                     [36mcontinue[39m[33m;[39m
     [90m 79 |[39m                 }[0m

      at Function.warn [as executeInTransaction] 
(src/utils/TransactionManager.js:76:29)
      at CreateReserva.execute 
(src/application/use-cases/reservas/CreateReserva.js:26:34)
      at Object.<anonymous>.exports.crearReservaBySlug 
(src/controllers/public.controller.js:140:25)

    console.log
      [Transaction] Aborted: CreateReservation

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:69:29)

    console.warn
      [Transaction] Transient error, retrying in 200ms: WriteConflict error: 
this operation conflicted with another operation. Please retry your operation or 
multi-document transaction.

    [0m [90m 74 |[39m                     attempt[33m++[39m[33m;[39m
     [90m 75 |[39m                     [36mconst[39m delay [33m=[39m 
retryDelay [33m*[39m [33mMath[39m[33m.[39mpow([35m2[39m[33m,[39m 
attempt)[33m;[39m [90m// Exponential backoff[39m
    [31m[1m>[22m[39m[90m 76 |[39m                     
console[33m.[39mwarn([32m`[Transaction] Transient error, retrying in 
${delay}ms:`[39m[33m,[39m error[33m.[39mmessage)[33m;[39m
     [90m    |[39m                             [31m[1m^[22m[39m
     [90m 77 |[39m                     [36mawait[39m 
[36mthis[39m[33m.[39msleep(delay)[33m;[39m
     [90m 78 |[39m                     [36mcontinue[39m[33m;[39m
     [90m 79 |[39m                 }[0m

      at Function.warn [as executeInTransaction] 
(src/utils/TransactionManager.js:76:29)
      at CreateReserva.execute 
(src/application/use-cases/reservas/CreateReserva.js:26:34)
      at Object.<anonymous>.exports.crearReservaBySlug 
(src/controllers/public.controller.js:140:25)

    console.log
      [Transaction] Aborted: CreateReservation

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:69:29)

    console.warn
      [Transaction] Transient error, retrying in 200ms: WriteConflict error: 
this operation conflicted with another operation. Please retry your operation or 
multi-document transaction.

    [0m [90m 74 |[39m                     attempt[33m++[39m[33m;[39m
     [90m 75 |[39m                     [36mconst[39m delay [33m=[39m 
retryDelay [33m*[39m [33mMath[39m[33m.[39mpow([35m2[39m[33m,[39m 
attempt)[33m;[39m [90m// Exponential backoff[39m
    [31m[1m>[22m[39m[90m 76 |[39m                     
console[33m.[39mwarn([32m`[Transaction] Transient error, retrying in 
${delay}ms:`[39m[33m,[39m error[33m.[39mmessage)[33m;[39m
     [90m    |[39m                             [31m[1m^[22m[39m
     [90m 77 |[39m                     [36mawait[39m 
[36mthis[39m[33m.[39msleep(delay)[33m;[39m
     [90m 78 |[39m                     [36mcontinue[39m[33m;[39m
     [90m 79 |[39m                 }[0m

      at Function.warn [as executeInTransaction] 
(src/utils/TransactionManager.js:76:29)
      at CreateReserva.execute 
(src/application/use-cases/reservas/CreateReserva.js:26:34)
      at Object.<anonymous>.exports.crearReservaBySlug 
(src/controllers/public.controller.js:140:25)

    console.log
      [Transaction] Aborted: CreateReservation

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:69:29)

    console.warn
      [Transaction] Transient error, retrying in 200ms: WriteConflict error: 
this operation conflicted with another operation. Please retry your operation or 
multi-document transaction.

    [0m [90m 74 |[39m                     attempt[33m++[39m[33m;[39m
     [90m 75 |[39m                     [36mconst[39m delay [33m=[39m 
retryDelay [33m*[39m [33mMath[39m[33m.[39mpow([35m2[39m[33m,[39m 
attempt)[33m;[39m [90m// Exponential backoff[39m
    [31m[1m>[22m[39m[90m 76 |[39m                     
console[33m.[39mwarn([32m`[Transaction] Transient error, retrying in 
${delay}ms:`[39m[33m,[39m error[33m.[39mmessage)[33m;[39m
     [90m    |[39m                             [31m[1m^[22m[39m
     [90m 77 |[39m                     [36mawait[39m 
[36mthis[39m[33m.[39msleep(delay)[33m;[39m
     [90m 78 |[39m                     [36mcontinue[39m[33m;[39m
     [90m 79 |[39m                 }[0m

      at Function.warn [as executeInTransaction] 
(src/utils/TransactionManager.js:76:29)
      at CreateReserva.execute 
(src/application/use-cases/reservas/CreateReserva.js:26:34)
      at Object.<anonymous>.exports.crearReservaBySlug 
(src/controllers/public.controller.js:140:25)

    console.log
      [Transaction] Aborted: CreateReservation

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:69:29)

    console.warn
      [Transaction] Transient error, retrying in 200ms: WriteConflict error: 
this operation conflicted with another operation. Please retry your operation or 
multi-document transaction.

    [0m [90m 74 |[39m                     attempt[33m++[39m[33m;[39m
     [90m 75 |[39m                     [36mconst[39m delay [33m=[39m 
retryDelay [33m*[39m [33mMath[39m[33m.[39mpow([35m2[39m[33m,[39m 
attempt)[33m;[39m [90m// Exponential backoff[39m
    [31m[1m>[22m[39m[90m 76 |[39m                     
console[33m.[39mwarn([32m`[Transaction] Transient error, retrying in 
${delay}ms:`[39m[33m,[39m error[33m.[39mmessage)[33m;[39m
     [90m    |[39m                             [31m[1m^[22m[39m
     [90m 77 |[39m                     [36mawait[39m 
[36mthis[39m[33m.[39msleep(delay)[33m;[39m
     [90m 78 |[39m                     [36mcontinue[39m[33m;[39m
     [90m 79 |[39m                 }[0m

      at Function.warn [as executeInTransaction] 
(src/utils/TransactionManager.js:76:29)
      at CreateReserva.execute 
(src/application/use-cases/reservas/CreateReserva.js:26:34)
      at Object.<anonymous>.exports.crearReservaBySlug 
(src/controllers/public.controller.js:140:25)

    console.log
      [Transaction] Aborted: CreateReservation

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:69:29)

    console.warn
      [Transaction] Transient error, retrying in 200ms: WriteConflict error: 
this operation conflicted with another operation. Please retry your operation or 
multi-document transaction.

    [0m [90m 74 |[39m                     attempt[33m++[39m[33m;[39m
     [90m 75 |[39m                     [36mconst[39m delay [33m=[39m 
retryDelay [33m*[39m [33mMath[39m[33m.[39mpow([35m2[39m[33m,[39m 
attempt)[33m;[39m [90m// Exponential backoff[39m
    [31m[1m>[22m[39m[90m 76 |[39m                     
console[33m.[39mwarn([32m`[Transaction] Transient error, retrying in 
${delay}ms:`[39m[33m,[39m error[33m.[39mmessage)[33m;[39m
     [90m    |[39m                             [31m[1m^[22m[39m
     [90m 77 |[39m                     [36mawait[39m 
[36mthis[39m[33m.[39msleep(delay)[33m;[39m
     [90m 78 |[39m                     [36mcontinue[39m[33m;[39m
     [90m 79 |[39m                 }[0m

      at Function.warn [as executeInTransaction] 
(src/utils/TransactionManager.js:76:29)
      at CreateReserva.execute 
(src/application/use-cases/reservas/CreateReserva.js:26:34)
      at Object.<anonymous>.exports.crearReservaBySlug 
(src/controllers/public.controller.js:140:25)

    console.log
      [Transaction] Started: CreateReservation (attempt 2/3)

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:54:25)

    console.log
      [Transaction] Started: CreateReservation (attempt 2/3)

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:54:25)

    console.log
      [Transaction] Started: CreateReservation (attempt 2/3)

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:54:25)

    console.log
      [Transaction] Started: CreateReservation (attempt 2/3)

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:54:25)

    console.log
      [Transaction] Started: CreateReservation (attempt 2/3)

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:54:25)

    console.log
      [Transaction] Started: CreateReservation (attempt 2/3)

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:54:25)

    console.log
      [Transaction] Started: CreateReservation (attempt 2/3)

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:54:25)

    console.log
      [Transaction] Started: CreateReservation (attempt 2/3)

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:54:25)

    console.log
      [Transaction] Started: CreateReservation (attempt 2/3)

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:54:25)

    console.log
      [Transaction] Started: CreateReservation (attempt 2/3)

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:54:25)

    console.log
      [Transaction] Started: CreateReservation (attempt 2/3)

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:54:25)

    console.log
      [Transaction] Started: CreateReservation (attempt 2/3)

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:54:25)

    console.log
      [Transaction] Started: CreateReservation (attempt 2/3)

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:54:25)

    console.log
      [Transaction] Started: CreateReservation (attempt 2/3)

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:54:25)

    console.log
      [Transaction] Started: CreateReservation (attempt 2/3)

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:54:25)

    console.log
      [Transaction] Started: CreateReservation (attempt 2/3)

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:54:25)

    console.log
      [Transaction] Started: CreateReservation (attempt 2/3)

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:54:25)

    console.log
      [Transaction] Started: CreateReservation (attempt 2/3)

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:54:25)

    console.log
      [Transaction] Started: CreateReservation (attempt 2/3)

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:54:25)

    console.log
      [Transaction] Aborted: CreateReservation

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:69:29)

    console.error
      [Transaction] Failed: CreateReservation {
        error: `E11000 duplicate key error collection: test.reservas index: 
unique_reservation_slot dup key: { barberoId: 
ObjectId('698bdc3e626399f145648e26'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698bdc3e626399f145648e24') }`,
        attempt: 2,
        stack: `MongoServerError: E11000 duplicate key error collection: 
test.reservas index: unique_reservation_slot dup key: { barberoId: 
ObjectId('698bdc3e626399f145648e26'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698bdc3e626399f145648e24') }\n` +
          '    at InsertOneOperation.handleOk (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\node_modules\\mongodb\\src\\operations\\insert.ts:79:13)\n' +
          '    at tryOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\backen
d\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:294:26)\n' +
          '    at processTicksAndRejections 
(node:internal/process/task_queues:105:5)\n' +
          '    at executeOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\ba
ckend\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:123:12)\n' +
          '    at Collection.insertOne (C:\\Users\\Kristian\\Desktop\\barber-saas
\\backend\\node_modules\\mongodb\\src\\collection.ts:294:12)\n' +
          '    at model.$__save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backe
nd\\node_modules\\mongoose\\lib\\model.js:398:16)\n' +
          '    at model.save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\
\node_modules\\mongoose\\lib\\model.js:609:5)\n' +
          '    at C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\\node_module
s\\mongoose\\lib\\model.js:2722:9\n' +
          '    at async Promise.all (index 0)\n' +
          '    at Function.create (C:\\Users\\Kristian\\Desktop\\barber-saas\\bac
kend\\node_modules\\mongoose\\lib\\model.js:2707:11)\n' +
          '    at MongoReservaRepository.save (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\src\\infrastructure\\database\\mongodb\\repositories\\MongoRese
rvaRepository.js:15:16)\n' +
          '    at TransactionManager.executeInTransaction.operationName (C:\\User
s\\Kristian\\Desktop\\barber-saas\\backend\\src\\application\\use-cases\\reservas
\\CreateReserva.js:72:42)\n' +
          '    at Function.executeInTransaction (C:\\Users\\Kristian\\Desktop\\ba
rber-saas\\backend\\src\\utils\\TransactionManager.js:57:32)\n' +
          '    at CreateReserva.execute (C:\\Users\\Kristian\\Desktop\\barber-saa
s\\backend\\src\\application\\use-cases\\reservas\\CreateReserva.js:26:34)\n' +
          '    at Object.<anonymous>.exports.crearReservaBySlug (C:\\Users\\Krist
ian\\Desktop\\barber-saas\\backend\\src\\controllers\\public.controller.js:140:25
)'
      }

    [0m [90m 80 |[39m
     [90m 81 |[39m                 [90m// Non-transient error or max retries 
reached[39m
    [31m[1m>[22m[39m[90m 82 |[39m                 
console[33m.[39merror([32m`[Transaction] Failed: 
${operationName}`[39m[33m,[39m {
     [90m    |[39m                         [31m[1m^[22m[39m
     [90m 83 |[39m                     error[33m:[39m 
error[33m.[39mmessage[33m,[39m
     [90m 84 |[39m                     attempt[33m:[39m attempt [33m+[39m 
[35m1[39m[33m,[39m
     [90m 85 |[39m                     stack[33m:[39m 
error[33m.[39mstack[0m

      at Function.error [as executeInTransaction] 
(src/utils/TransactionManager.js:82:25)
      at CreateReserva.execute 
(src/application/use-cases/reservas/CreateReserva.js:26:34)
      at Object.<anonymous>.exports.crearReservaBySlug 
(src/controllers/public.controller.js:140:25)

    console.log
      [Transaction] Aborted: CreateReservation

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:69:29)

    console.error
      [Transaction] Failed: CreateReservation {
        error: `E11000 duplicate key error collection: test.reservas index: 
unique_reservation_slot dup key: { barberoId: 
ObjectId('698bdc3e626399f145648e26'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698bdc3e626399f145648e24') }`,
        attempt: 2,
        stack: `MongoServerError: E11000 duplicate key error collection: 
test.reservas index: unique_reservation_slot dup key: { barberoId: 
ObjectId('698bdc3e626399f145648e26'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698bdc3e626399f145648e24') }\n` +
          '    at InsertOneOperation.handleOk (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\node_modules\\mongodb\\src\\operations\\insert.ts:79:13)\n' +
          '    at tryOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\backen
d\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:294:26)\n' +
          '    at processTicksAndRejections 
(node:internal/process/task_queues:105:5)\n' +
          '    at executeOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\ba
ckend\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:123:12)\n' +
          '    at Collection.insertOne (C:\\Users\\Kristian\\Desktop\\barber-saas
\\backend\\node_modules\\mongodb\\src\\collection.ts:294:12)\n' +
          '    at model.$__save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backe
nd\\node_modules\\mongoose\\lib\\model.js:398:16)\n' +
          '    at model.save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\
\node_modules\\mongoose\\lib\\model.js:609:5)\n' +
          '    at C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\\node_module
s\\mongoose\\lib\\model.js:2722:9\n' +
          '    at async Promise.all (index 0)\n' +
          '    at Function.create (C:\\Users\\Kristian\\Desktop\\barber-saas\\bac
kend\\node_modules\\mongoose\\lib\\model.js:2707:11)\n' +
          '    at MongoReservaRepository.save (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\src\\infrastructure\\database\\mongodb\\repositories\\MongoRese
rvaRepository.js:15:16)\n' +
          '    at TransactionManager.executeInTransaction.operationName (C:\\User
s\\Kristian\\Desktop\\barber-saas\\backend\\src\\application\\use-cases\\reservas
\\CreateReserva.js:72:42)\n' +
          '    at Function.executeInTransaction (C:\\Users\\Kristian\\Desktop\\ba
rber-saas\\backend\\src\\utils\\TransactionManager.js:57:32)\n' +
          '    at CreateReserva.execute (C:\\Users\\Kristian\\Desktop\\barber-saa
s\\backend\\src\\application\\use-cases\\reservas\\CreateReserva.js:26:34)\n' +
          '    at Object.<anonymous>.exports.crearReservaBySlug (C:\\Users\\Krist
ian\\Desktop\\barber-saas\\backend\\src\\controllers\\public.controller.js:140:25
)'
      }

    [0m [90m 80 |[39m
     [90m 81 |[39m                 [90m// Non-transient error or max retries 
reached[39m
    [31m[1m>[22m[39m[90m 82 |[39m                 
console[33m.[39merror([32m`[Transaction] Failed: 
${operationName}`[39m[33m,[39m {
     [90m    |[39m                         [31m[1m^[22m[39m
     [90m 83 |[39m                     error[33m:[39m 
error[33m.[39mmessage[33m,[39m
     [90m 84 |[39m                     attempt[33m:[39m attempt [33m+[39m 
[35m1[39m[33m,[39m
     [90m 85 |[39m                     stack[33m:[39m 
error[33m.[39mstack[0m

      at Function.error [as executeInTransaction] 
(src/utils/TransactionManager.js:82:25)
      at CreateReserva.execute 
(src/application/use-cases/reservas/CreateReserva.js:26:34)
      at Object.<anonymous>.exports.crearReservaBySlug 
(src/controllers/public.controller.js:140:25)

    console.error
      ƒö┤ ERROR: TransactionError: Transaction failed for CreateReservation: 
E11000 duplicate key error collection: test.reservas index: 
unique_reservation_slot dup key: { barberoId: 
ObjectId('698bdc3e626399f145648e26'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698bdc3e626399f145648e24') }
          at Function.executeInTransaction (C:\Users\Kristian\Desktop\barber-saas
\backend\src\utils\TransactionManager.js:88:42)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at CreateReserva.execute (C:\Users\Kristian\Desktop\barber-saas\backend
\src\application\use-cases\reservas\CreateReserva.js:26:34)
          at Object.<anonymous>.exports.crearReservaBySlug (C:\Users\Kristian\Des
ktop\barber-saas\backend\src\controllers\public.controller.js:140:25) {
        isTransactionError: true,
        originalError: MongoServerError: E11000 duplicate key error collection: 
test.reservas index: unique_reservation_slot dup key: { barberoId: 
ObjectId('698bdc3e626399f145648e26'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698bdc3e626399f145648e24') }
            at InsertOneOperation.handleOk (C:\Users\Kristian\Desktop\barber-saas
\backend\node_modules\mongodb\src\operations\insert.ts:79:13)
            at tryOperation (C:\Users\Kristian\Desktop\barber-saas\backend\node_m
odules\mongodb\src\operations\execute_operation.ts:294:26)
            at processTicksAndRejections 
(node:internal/process/task_queues:105:5)
            at executeOperation (C:\Users\Kristian\Desktop\barber-saas\backend\no
de_modules\mongodb\src\operations\execute_operation.ts:123:12)
            at Collection.insertOne (C:\Users\Kristian\Desktop\barber-saas\backen
d\node_modules\mongodb\src\collection.ts:294:12)
            at model.$__save (C:\Users\Kristian\Desktop\barber-saas\backend\node_
modules\mongoose\lib\model.js:398:16)
            at model.save (C:\Users\Kristian\Desktop\barber-saas\backend\node_mod
ules\mongoose\lib\model.js:609:5)
            at C:\Users\Kristian\Desktop\barber-saas\backend\node_modules\mongoos
e\lib\model.js:2722:9
            at async Promise.all (index 0)
            at Function.create (C:\Users\Kristian\Desktop\barber-saas\backend\nod
e_modules\mongoose\lib\model.js:2707:11)
            at MongoReservaRepository.save (C:\Users\Kristian\Desktop\barber-saas
\backend\src\infrastructure\database\mongodb\repositories\MongoReservaRepository.
js:15:16)
            at TransactionManager.executeInTransaction.operationName (C:\Users\Kr
istian\Desktop\barber-saas\backend\src\application\use-cases\reservas\CreateReser
va.js:72:42)
            at Function.executeInTransaction (C:\Users\Kristian\Desktop\barber-sa
as\backend\src\utils\TransactionManager.js:57:32)
            at CreateReserva.execute (C:\Users\Kristian\Desktop\barber-saas\backe
nd\src\application\use-cases\reservas\CreateReserva.js:26:34)
            at Object.<anonymous>.exports.crearReservaBySlug (C:\Users\Kristian\D
esktop\barber-saas\backend\src\controllers\public.controller.js:140:25) {
          errorLabelSet: Set(0) {},
          errorResponse: {
            index: 0,
            code: 11000,
            errmsg: `E11000 duplicate key error collection: test.reservas index: 
unique_reservation_slot dup key: { barberoId: 
ObjectId('698bdc3e626399f145648e26'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698bdc3e626399f145648e24') }`,
            keyPattern: [Object],
            keyValue: [Object]
          },
          index: 0,
          code: 11000,
          keyPattern: { barberoId: 1, fecha: 1, hora: 1, barberiaId: 1 },
          keyValue: {
            barberoId: new ObjectId('698bdc3e626399f145648e26'),
            fecha: 2026-03-16T00:00:00.000Z,
            hora: '14:00',
            barberiaId: new ObjectId('698bdc3e626399f145648e24')
          }
        },
        context: { operationName: 'CreateReservation', attempt: 2 },
        timestamp: 2026-02-11T01:32:47.504Z,
        originalStack: `MongoServerError: E11000 duplicate key error collection: 
test.reservas index: unique_reservation_slot dup key: { barberoId: 
ObjectId('698bdc3e626399f145648e26'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698bdc3e626399f145648e24') }\n` +
          '    at InsertOneOperation.handleOk (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\node_modules\\mongodb\\src\\operations\\insert.ts:79:13)\n' +
          '    at tryOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\backen
d\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:294:26)\n' +
          '    at processTicksAndRejections 
(node:internal/process/task_queues:105:5)\n' +
          '    at executeOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\ba
ckend\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:123:12)\n' +
          '    at Collection.insertOne (C:\\Users\\Kristian\\Desktop\\barber-saas
\\backend\\node_modules\\mongodb\\src\\collection.ts:294:12)\n' +
          '    at model.$__save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backe
nd\\node_modules\\mongoose\\lib\\model.js:398:16)\n' +
          '    at model.save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\
\node_modules\\mongoose\\lib\\model.js:609:5)\n' +
          '    at C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\\node_module
s\\mongoose\\lib\\model.js:2722:9\n' +
          '    at async Promise.all (index 0)\n' +
          '    at Function.create (C:\\Users\\Kristian\\Desktop\\barber-saas\\bac
kend\\node_modules\\mongoose\\lib\\model.js:2707:11)\n' +
          '    at MongoReservaRepository.save (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\src\\infrastructure\\database\\mongodb\\repositories\\MongoRese
rvaRepository.js:15:16)\n' +
          '    at TransactionManager.executeInTransaction.operationName (C:\\User
s\\Kristian\\Desktop\\barber-saas\\backend\\src\\application\\use-cases\\reservas
\\CreateReserva.js:72:42)\n' +
          '    at Function.executeInTransaction (C:\\Users\\Kristian\\Desktop\\ba
rber-saas\\backend\\src\\utils\\TransactionManager.js:57:32)\n' +
          '    at CreateReserva.execute (C:\\Users\\Kristian\\Desktop\\barber-saa
s\\backend\\src\\application\\use-cases\\reservas\\CreateReserva.js:26:34)\n' +
          '    at Object.<anonymous>.exports.crearReservaBySlug (C:\\Users\\Krist
ian\\Desktop\\barber-saas\\backend\\src\\controllers\\public.controller.js:140:25
)'
      }

    [0m [90m 4 |[39m
     [90m 5 |[39m [36mconst[39m errorHandler [33m=[39m (err[33m,[39m 
req[33m,[39m res[33m,[39m next) [33m=>[39m {
    [31m[1m>[22m[39m[90m 6 |[39m   console[33m.[39merror([32m"ƒö┤ 
ERROR:"[39m[33m,[39m err)[33m;[39m
     [90m   |[39m           [31m[1m^[22m[39m
     [90m 7 |[39m
     [90m 8 |[39m   [90m// ­ƒöÑ A├æADIR HEADERS CORS SI NO EXISTEN[39m
     [90m 9 |[39m   [36mconst[39m origin [33m=[39m 
req[33m.[39mheaders[33m.[39morigin[33m;[39m[0m

      at error (src/config/middleware/errorHandler.js:6:11)
      at Layer.handleError (node_modules/router/lib/layer.js:116:17)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at Layer.handleError (node_modules/router/lib/layer.js:111:12)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at Immediate.next (node_modules/router/index.js:291:5)
      at Immediate._onImmediate (node_modules/router/index.js:688:15)

    console.error
      ƒö┤ ERROR: TransactionError: Transaction failed for CreateReservation: 
E11000 duplicate key error collection: test.reservas index: 
unique_reservation_slot dup key: { barberoId: 
ObjectId('698bdc3e626399f145648e26'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698bdc3e626399f145648e24') }
          at Function.executeInTransaction (C:\Users\Kristian\Desktop\barber-saas
\backend\src\utils\TransactionManager.js:88:42)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at CreateReserva.execute (C:\Users\Kristian\Desktop\barber-saas\backend
\src\application\use-cases\reservas\CreateReserva.js:26:34)
          at Object.<anonymous>.exports.crearReservaBySlug (C:\Users\Kristian\Des
ktop\barber-saas\backend\src\controllers\public.controller.js:140:25) {
        isTransactionError: true,
        originalError: MongoServerError: E11000 duplicate key error collection: 
test.reservas index: unique_reservation_slot dup key: { barberoId: 
ObjectId('698bdc3e626399f145648e26'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698bdc3e626399f145648e24') }
            at InsertOneOperation.handleOk (C:\Users\Kristian\Desktop\barber-saas
\backend\node_modules\mongodb\src\operations\insert.ts:79:13)
            at tryOperation (C:\Users\Kristian\Desktop\barber-saas\backend\node_m
odules\mongodb\src\operations\execute_operation.ts:294:26)
            at processTicksAndRejections 
(node:internal/process/task_queues:105:5)
            at executeOperation (C:\Users\Kristian\Desktop\barber-saas\backend\no
de_modules\mongodb\src\operations\execute_operation.ts:123:12)
            at Collection.insertOne (C:\Users\Kristian\Desktop\barber-saas\backen
d\node_modules\mongodb\src\collection.ts:294:12)
            at model.$__save (C:\Users\Kristian\Desktop\barber-saas\backend\node_
modules\mongoose\lib\model.js:398:16)
            at model.save (C:\Users\Kristian\Desktop\barber-saas\backend\node_mod
ules\mongoose\lib\model.js:609:5)
            at C:\Users\Kristian\Desktop\barber-saas\backend\node_modules\mongoos
e\lib\model.js:2722:9
            at async Promise.all (index 0)
            at Function.create (C:\Users\Kristian\Desktop\barber-saas\backend\nod
e_modules\mongoose\lib\model.js:2707:11)
            at MongoReservaRepository.save (C:\Users\Kristian\Desktop\barber-saas
\backend\src\infrastructure\database\mongodb\repositories\MongoReservaRepository.
js:15:16)
            at TransactionManager.executeInTransaction.operationName (C:\Users\Kr
istian\Desktop\barber-saas\backend\src\application\use-cases\reservas\CreateReser
va.js:72:42)
            at Function.executeInTransaction (C:\Users\Kristian\Desktop\barber-sa
as\backend\src\utils\TransactionManager.js:57:32)
            at CreateReserva.execute (C:\Users\Kristian\Desktop\barber-saas\backe
nd\src\application\use-cases\reservas\CreateReserva.js:26:34)
            at Object.<anonymous>.exports.crearReservaBySlug (C:\Users\Kristian\D
esktop\barber-saas\backend\src\controllers\public.controller.js:140:25) {
          errorLabelSet: Set(0) {},
          errorResponse: {
            index: 0,
            code: 11000,
            errmsg: `E11000 duplicate key error collection: test.reservas index: 
unique_reservation_slot dup key: { barberoId: 
ObjectId('698bdc3e626399f145648e26'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698bdc3e626399f145648e24') }`,
            keyPattern: [Object],
            keyValue: [Object]
          },
          index: 0,
          code: 11000,
          keyPattern: { barberoId: 1, fecha: 1, hora: 1, barberiaId: 1 },
          keyValue: {
            barberoId: new ObjectId('698bdc3e626399f145648e26'),
            fecha: 2026-03-16T00:00:00.000Z,
            hora: '14:00',
            barberiaId: new ObjectId('698bdc3e626399f145648e24')
          }
        },
        context: { operationName: 'CreateReservation', attempt: 2 },
        timestamp: 2026-02-11T01:32:47.510Z,
        originalStack: `MongoServerError: E11000 duplicate key error collection: 
test.reservas index: unique_reservation_slot dup key: { barberoId: 
ObjectId('698bdc3e626399f145648e26'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698bdc3e626399f145648e24') }\n` +
          '    at InsertOneOperation.handleOk (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\node_modules\\mongodb\\src\\operations\\insert.ts:79:13)\n' +
          '    at tryOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\backen
d\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:294:26)\n' +
          '    at processTicksAndRejections 
(node:internal/process/task_queues:105:5)\n' +
          '    at executeOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\ba
ckend\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:123:12)\n' +
          '    at Collection.insertOne (C:\\Users\\Kristian\\Desktop\\barber-saas
\\backend\\node_modules\\mongodb\\src\\collection.ts:294:12)\n' +
          '    at model.$__save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backe
nd\\node_modules\\mongoose\\lib\\model.js:398:16)\n' +
          '    at model.save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\
\node_modules\\mongoose\\lib\\model.js:609:5)\n' +
          '    at C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\\node_module
s\\mongoose\\lib\\model.js:2722:9\n' +
          '    at async Promise.all (index 0)\n' +
          '    at Function.create (C:\\Users\\Kristian\\Desktop\\barber-saas\\bac
kend\\node_modules\\mongoose\\lib\\model.js:2707:11)\n' +
          '    at MongoReservaRepository.save (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\src\\infrastructure\\database\\mongodb\\repositories\\MongoRese
rvaRepository.js:15:16)\n' +
          '    at TransactionManager.executeInTransaction.operationName (C:\\User
s\\Kristian\\Desktop\\barber-saas\\backend\\src\\application\\use-cases\\reservas
\\CreateReserva.js:72:42)\n' +
          '    at Function.executeInTransaction (C:\\Users\\Kristian\\Desktop\\ba
rber-saas\\backend\\src\\utils\\TransactionManager.js:57:32)\n' +
          '    at CreateReserva.execute (C:\\Users\\Kristian\\Desktop\\barber-saa
s\\backend\\src\\application\\use-cases\\reservas\\CreateReserva.js:26:34)\n' +
          '    at Object.<anonymous>.exports.crearReservaBySlug (C:\\Users\\Krist
ian\\Desktop\\barber-saas\\backend\\src\\controllers\\public.controller.js:140:25
)'
      }

    [0m [90m 4 |[39m
     [90m 5 |[39m [36mconst[39m errorHandler [33m=[39m (err[33m,[39m 
req[33m,[39m res[33m,[39m next) [33m=>[39m {
    [31m[1m>[22m[39m[90m 6 |[39m   console[33m.[39merror([32m"ƒö┤ 
ERROR:"[39m[33m,[39m err)[33m;[39m
     [90m   |[39m           [31m[1m^[22m[39m
     [90m 7 |[39m
     [90m 8 |[39m   [90m// ­ƒöÑ A├æADIR HEADERS CORS SI NO EXISTEN[39m
     [90m 9 |[39m   [36mconst[39m origin [33m=[39m 
req[33m.[39mheaders[33m.[39morigin[33m;[39m[0m

      at error (src/config/middleware/errorHandler.js:6:11)
      at Layer.handleError (node_modules/router/lib/layer.js:116:17)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at Layer.handleError (node_modules/router/lib/layer.js:111:12)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at Immediate.next (node_modules/router/index.js:291:5)
      at Immediate._onImmediate (node_modules/router/index.js:688:15)

    console.log
      [Transaction] Aborted: CreateReservation

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:69:29)

    console.error
      [Transaction] Failed: CreateReservation {
        error: `E11000 duplicate key error collection: test.reservas index: 
unique_reservation_slot dup key: { barberoId: 
ObjectId('698bdc3e626399f145648e26'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698bdc3e626399f145648e24') }`,
        attempt: 2,
        stack: `MongoServerError: E11000 duplicate key error collection: 
test.reservas index: unique_reservation_slot dup key: { barberoId: 
ObjectId('698bdc3e626399f145648e26'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698bdc3e626399f145648e24') }\n` +
          '    at InsertOneOperation.handleOk (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\node_modules\\mongodb\\src\\operations\\insert.ts:79:13)\n' +
          '    at tryOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\backen
d\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:294:26)\n' +
          '    at processTicksAndRejections 
(node:internal/process/task_queues:105:5)\n' +
          '    at executeOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\ba
ckend\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:123:12)\n' +
          '    at Collection.insertOne (C:\\Users\\Kristian\\Desktop\\barber-saas
\\backend\\node_modules\\mongodb\\src\\collection.ts:294:12)\n' +
          '    at model.$__save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backe
nd\\node_modules\\mongoose\\lib\\model.js:398:16)\n' +
          '    at model.save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\
\node_modules\\mongoose\\lib\\model.js:609:5)\n' +
          '    at C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\\node_module
s\\mongoose\\lib\\model.js:2722:9\n' +
          '    at async Promise.all (index 0)\n' +
          '    at Function.create (C:\\Users\\Kristian\\Desktop\\barber-saas\\bac
kend\\node_modules\\mongoose\\lib\\model.js:2707:11)\n' +
          '    at MongoReservaRepository.save (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\src\\infrastructure\\database\\mongodb\\repositories\\MongoRese
rvaRepository.js:15:16)\n' +
          '    at TransactionManager.executeInTransaction.operationName (C:\\User
s\\Kristian\\Desktop\\barber-saas\\backend\\src\\application\\use-cases\\reservas
\\CreateReserva.js:72:42)\n' +
          '    at Function.executeInTransaction (C:\\Users\\Kristian\\Desktop\\ba
rber-saas\\backend\\src\\utils\\TransactionManager.js:57:32)\n' +
          '    at CreateReserva.execute (C:\\Users\\Kristian\\Desktop\\barber-saa
s\\backend\\src\\application\\use-cases\\reservas\\CreateReserva.js:26:34)\n' +
          '    at Object.<anonymous>.exports.crearReservaBySlug (C:\\Users\\Krist
ian\\Desktop\\barber-saas\\backend\\src\\controllers\\public.controller.js:140:25
)'
      }

    [0m [90m 80 |[39m
     [90m 81 |[39m                 [90m// Non-transient error or max retries 
reached[39m
    [31m[1m>[22m[39m[90m 82 |[39m                 
console[33m.[39merror([32m`[Transaction] Failed: 
${operationName}`[39m[33m,[39m {
     [90m    |[39m                         [31m[1m^[22m[39m
     [90m 83 |[39m                     error[33m:[39m 
error[33m.[39mmessage[33m,[39m
     [90m 84 |[39m                     attempt[33m:[39m attempt [33m+[39m 
[35m1[39m[33m,[39m
     [90m 85 |[39m                     stack[33m:[39m 
error[33m.[39mstack[0m

      at Function.error [as executeInTransaction] 
(src/utils/TransactionManager.js:82:25)
      at CreateReserva.execute 
(src/application/use-cases/reservas/CreateReserva.js:26:34)
      at Object.<anonymous>.exports.crearReservaBySlug 
(src/controllers/public.controller.js:140:25)

    console.log
      [Transaction] Aborted: CreateReservation

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:69:29)

    console.error
      [Transaction] Failed: CreateReservation {
        error: `E11000 duplicate key error collection: test.reservas index: 
unique_reservation_slot dup key: { barberoId: 
ObjectId('698bdc3e626399f145648e26'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698bdc3e626399f145648e24') }`,
        attempt: 2,
        stack: `MongoServerError: E11000 duplicate key error collection: 
test.reservas index: unique_reservation_slot dup key: { barberoId: 
ObjectId('698bdc3e626399f145648e26'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698bdc3e626399f145648e24') }\n` +
          '    at InsertOneOperation.handleOk (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\node_modules\\mongodb\\src\\operations\\insert.ts:79:13)\n' +
          '    at tryOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\backen
d\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:294:26)\n' +
          '    at processTicksAndRejections 
(node:internal/process/task_queues:105:5)\n' +
          '    at executeOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\ba
ckend\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:123:12)\n' +
          '    at Collection.insertOne (C:\\Users\\Kristian\\Desktop\\barber-saas
\\backend\\node_modules\\mongodb\\src\\collection.ts:294:12)\n' +
          '    at model.$__save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backe
nd\\node_modules\\mongoose\\lib\\model.js:398:16)\n' +
          '    at model.save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\
\node_modules\\mongoose\\lib\\model.js:609:5)\n' +
          '    at C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\\node_module
s\\mongoose\\lib\\model.js:2722:9\n' +
          '    at async Promise.all (index 0)\n' +
          '    at Function.create (C:\\Users\\Kristian\\Desktop\\barber-saas\\bac
kend\\node_modules\\mongoose\\lib\\model.js:2707:11)\n' +
          '    at MongoReservaRepository.save (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\src\\infrastructure\\database\\mongodb\\repositories\\MongoRese
rvaRepository.js:15:16)\n' +
          '    at TransactionManager.executeInTransaction.operationName (C:\\User
s\\Kristian\\Desktop\\barber-saas\\backend\\src\\application\\use-cases\\reservas
\\CreateReserva.js:72:42)\n' +
          '    at Function.executeInTransaction (C:\\Users\\Kristian\\Desktop\\ba
rber-saas\\backend\\src\\utils\\TransactionManager.js:57:32)\n' +
          '    at CreateReserva.execute (C:\\Users\\Kristian\\Desktop\\barber-saa
s\\backend\\src\\application\\use-cases\\reservas\\CreateReserva.js:26:34)\n' +
          '    at Object.<anonymous>.exports.crearReservaBySlug (C:\\Users\\Krist
ian\\Desktop\\barber-saas\\backend\\src\\controllers\\public.controller.js:140:25
)'
      }

    [0m [90m 80 |[39m
     [90m 81 |[39m                 [90m// Non-transient error or max retries 
reached[39m
    [31m[1m>[22m[39m[90m 82 |[39m                 
console[33m.[39merror([32m`[Transaction] Failed: 
${operationName}`[39m[33m,[39m {
     [90m    |[39m                         [31m[1m^[22m[39m
     [90m 83 |[39m                     error[33m:[39m 
error[33m.[39mmessage[33m,[39m
     [90m 84 |[39m                     attempt[33m:[39m attempt [33m+[39m 
[35m1[39m[33m,[39m
     [90m 85 |[39m                     stack[33m:[39m 
error[33m.[39mstack[0m

      at Function.error [as executeInTransaction] 
(src/utils/TransactionManager.js:82:25)
      at CreateReserva.execute 
(src/application/use-cases/reservas/CreateReserva.js:26:34)
      at Object.<anonymous>.exports.crearReservaBySlug 
(src/controllers/public.controller.js:140:25)

    console.log
      [Transaction] Aborted: CreateReservation

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:69:29)

    console.error
      [Transaction] Failed: CreateReservation {
        error: `E11000 duplicate key error collection: test.reservas index: 
unique_reservation_slot dup key: { barberoId: 
ObjectId('698bdc3e626399f145648e26'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698bdc3e626399f145648e24') }`,
        attempt: 2,
        stack: `MongoServerError: E11000 duplicate key error collection: 
test.reservas index: unique_reservation_slot dup key: { barberoId: 
ObjectId('698bdc3e626399f145648e26'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698bdc3e626399f145648e24') }\n` +
          '    at InsertOneOperation.handleOk (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\node_modules\\mongodb\\src\\operations\\insert.ts:79:13)\n' +
          '    at tryOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\backen
d\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:294:26)\n' +
          '    at processTicksAndRejections 
(node:internal/process/task_queues:105:5)\n' +
          '    at executeOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\ba
ckend\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:123:12)\n' +
          '    at Collection.insertOne (C:\\Users\\Kristian\\Desktop\\barber-saas
\\backend\\node_modules\\mongodb\\src\\collection.ts:294:12)\n' +
          '    at model.$__save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backe
nd\\node_modules\\mongoose\\lib\\model.js:398:16)\n' +
          '    at model.save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\
\node_modules\\mongoose\\lib\\model.js:609:5)\n' +
          '    at C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\\node_module
s\\mongoose\\lib\\model.js:2722:9\n' +
          '    at async Promise.all (index 0)\n' +
          '    at Function.create (C:\\Users\\Kristian\\Desktop\\barber-saas\\bac
kend\\node_modules\\mongoose\\lib\\model.js:2707:11)\n' +
          '    at MongoReservaRepository.save (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\src\\infrastructure\\database\\mongodb\\repositories\\MongoRese
rvaRepository.js:15:16)\n' +
          '    at TransactionManager.executeInTransaction.operationName (C:\\User
s\\Kristian\\Desktop\\barber-saas\\backend\\src\\application\\use-cases\\reservas
\\CreateReserva.js:72:42)\n' +
          '    at Function.executeInTransaction (C:\\Users\\Kristian\\Desktop\\ba
rber-saas\\backend\\src\\utils\\TransactionManager.js:57:32)\n' +
          '    at CreateReserva.execute (C:\\Users\\Kristian\\Desktop\\barber-saa
s\\backend\\src\\application\\use-cases\\reservas\\CreateReserva.js:26:34)\n' +
          '    at Object.<anonymous>.exports.crearReservaBySlug (C:\\Users\\Krist
ian\\Desktop\\barber-saas\\backend\\src\\controllers\\public.controller.js:140:25
)'
      }

    [0m [90m 80 |[39m
     [90m 81 |[39m                 [90m// Non-transient error or max retries 
reached[39m
    [31m[1m>[22m[39m[90m 82 |[39m                 
console[33m.[39merror([32m`[Transaction] Failed: 
${operationName}`[39m[33m,[39m {
     [90m    |[39m                         [31m[1m^[22m[39m
     [90m 83 |[39m                     error[33m:[39m 
error[33m.[39mmessage[33m,[39m
     [90m 84 |[39m                     attempt[33m:[39m attempt [33m+[39m 
[35m1[39m[33m,[39m
     [90m 85 |[39m                     stack[33m:[39m 
error[33m.[39mstack[0m

      at Function.error [as executeInTransaction] 
(src/utils/TransactionManager.js:82:25)
      at CreateReserva.execute 
(src/application/use-cases/reservas/CreateReserva.js:26:34)
      at Object.<anonymous>.exports.crearReservaBySlug 
(src/controllers/public.controller.js:140:25)

    console.log
      [Transaction] Aborted: CreateReservation

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:69:29)

    console.error
      [Transaction] Failed: CreateReservation {
        error: `E11000 duplicate key error collection: test.reservas index: 
unique_reservation_slot dup key: { barberoId: 
ObjectId('698bdc3e626399f145648e26'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698bdc3e626399f145648e24') }`,
        attempt: 2,
        stack: `MongoServerError: E11000 duplicate key error collection: 
test.reservas index: unique_reservation_slot dup key: { barberoId: 
ObjectId('698bdc3e626399f145648e26'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698bdc3e626399f145648e24') }\n` +
          '    at InsertOneOperation.handleOk (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\node_modules\\mongodb\\src\\operations\\insert.ts:79:13)\n' +
          '    at tryOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\backen
d\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:294:26)\n' +
          '    at processTicksAndRejections 
(node:internal/process/task_queues:105:5)\n' +
          '    at executeOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\ba
ckend\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:123:12)\n' +
          '    at Collection.insertOne (C:\\Users\\Kristian\\Desktop\\barber-saas
\\backend\\node_modules\\mongodb\\src\\collection.ts:294:12)\n' +
          '    at model.$__save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backe
nd\\node_modules\\mongoose\\lib\\model.js:398:16)\n' +
          '    at model.save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\
\node_modules\\mongoose\\lib\\model.js:609:5)\n' +
          '    at C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\\node_module
s\\mongoose\\lib\\model.js:2722:9\n' +
          '    at async Promise.all (index 0)\n' +
          '    at Function.create (C:\\Users\\Kristian\\Desktop\\barber-saas\\bac
kend\\node_modules\\mongoose\\lib\\model.js:2707:11)\n' +
          '    at MongoReservaRepository.save (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\src\\infrastructure\\database\\mongodb\\repositories\\MongoRese
rvaRepository.js:15:16)\n' +
          '    at TransactionManager.executeInTransaction.operationName (C:\\User
s\\Kristian\\Desktop\\barber-saas\\backend\\src\\application\\use-cases\\reservas
\\CreateReserva.js:72:42)\n' +
          '    at Function.executeInTransaction (C:\\Users\\Kristian\\Desktop\\ba
rber-saas\\backend\\src\\utils\\TransactionManager.js:57:32)\n' +
          '    at CreateReserva.execute (C:\\Users\\Kristian\\Desktop\\barber-saa
s\\backend\\src\\application\\use-cases\\reservas\\CreateReserva.js:26:34)\n' +
          '    at Object.<anonymous>.exports.crearReservaBySlug (C:\\Users\\Krist
ian\\Desktop\\barber-saas\\backend\\src\\controllers\\public.controller.js:140:25
)'
      }

    [0m [90m 80 |[39m
     [90m 81 |[39m                 [90m// Non-transient error or max retries 
reached[39m
    [31m[1m>[22m[39m[90m 82 |[39m                 
console[33m.[39merror([32m`[Transaction] Failed: 
${operationName}`[39m[33m,[39m {
     [90m    |[39m                         [31m[1m^[22m[39m
     [90m 83 |[39m                     error[33m:[39m 
error[33m.[39mmessage[33m,[39m
     [90m 84 |[39m                     attempt[33m:[39m attempt [33m+[39m 
[35m1[39m[33m,[39m
     [90m 85 |[39m                     stack[33m:[39m 
error[33m.[39mstack[0m

      at Function.error [as executeInTransaction] 
(src/utils/TransactionManager.js:82:25)
      at CreateReserva.execute 
(src/application/use-cases/reservas/CreateReserva.js:26:34)
      at Object.<anonymous>.exports.crearReservaBySlug 
(src/controllers/public.controller.js:140:25)

    console.error
      ƒö┤ ERROR: TransactionError: Transaction failed for CreateReservation: 
E11000 duplicate key error collection: test.reservas index: 
unique_reservation_slot dup key: { barberoId: 
ObjectId('698bdc3e626399f145648e26'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698bdc3e626399f145648e24') }
          at Function.executeInTransaction (C:\Users\Kristian\Desktop\barber-saas
\backend\src\utils\TransactionManager.js:88:42)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at CreateReserva.execute (C:\Users\Kristian\Desktop\barber-saas\backend
\src\application\use-cases\reservas\CreateReserva.js:26:34)
          at Object.<anonymous>.exports.crearReservaBySlug (C:\Users\Kristian\Des
ktop\barber-saas\backend\src\controllers\public.controller.js:140:25) {
        isTransactionError: true,
        originalError: MongoServerError: E11000 duplicate key error collection: 
test.reservas index: unique_reservation_slot dup key: { barberoId: 
ObjectId('698bdc3e626399f145648e26'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698bdc3e626399f145648e24') }
            at InsertOneOperation.handleOk (C:\Users\Kristian\Desktop\barber-saas
\backend\node_modules\mongodb\src\operations\insert.ts:79:13)
            at tryOperation (C:\Users\Kristian\Desktop\barber-saas\backend\node_m
odules\mongodb\src\operations\execute_operation.ts:294:26)
            at processTicksAndRejections 
(node:internal/process/task_queues:105:5)
            at executeOperation (C:\Users\Kristian\Desktop\barber-saas\backend\no
de_modules\mongodb\src\operations\execute_operation.ts:123:12)
            at Collection.insertOne (C:\Users\Kristian\Desktop\barber-saas\backen
d\node_modules\mongodb\src\collection.ts:294:12)
            at model.$__save (C:\Users\Kristian\Desktop\barber-saas\backend\node_
modules\mongoose\lib\model.js:398:16)
            at model.save (C:\Users\Kristian\Desktop\barber-saas\backend\node_mod
ules\mongoose\lib\model.js:609:5)
            at C:\Users\Kristian\Desktop\barber-saas\backend\node_modules\mongoos
e\lib\model.js:2722:9
            at async Promise.all (index 0)
            at Function.create (C:\Users\Kristian\Desktop\barber-saas\backend\nod
e_modules\mongoose\lib\model.js:2707:11)
            at MongoReservaRepository.save (C:\Users\Kristian\Desktop\barber-saas
\backend\src\infrastructure\database\mongodb\repositories\MongoReservaRepository.
js:15:16)
            at TransactionManager.executeInTransaction.operationName (C:\Users\Kr
istian\Desktop\barber-saas\backend\src\application\use-cases\reservas\CreateReser
va.js:72:42)
            at Function.executeInTransaction (C:\Users\Kristian\Desktop\barber-sa
as\backend\src\utils\TransactionManager.js:57:32)
            at CreateReserva.execute (C:\Users\Kristian\Desktop\barber-saas\backe
nd\src\application\use-cases\reservas\CreateReserva.js:26:34)
            at Object.<anonymous>.exports.crearReservaBySlug (C:\Users\Kristian\D
esktop\barber-saas\backend\src\controllers\public.controller.js:140:25) {
          errorLabelSet: Set(0) {},
          errorResponse: {
            index: 0,
            code: 11000,
            errmsg: `E11000 duplicate key error collection: test.reservas index: 
unique_reservation_slot dup key: { barberoId: 
ObjectId('698bdc3e626399f145648e26'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698bdc3e626399f145648e24') }`,
            keyPattern: [Object],
            keyValue: [Object]
          },
          index: 0,
          code: 11000,
          keyPattern: { barberoId: 1, fecha: 1, hora: 1, barberiaId: 1 },
          keyValue: {
            barberoId: new ObjectId('698bdc3e626399f145648e26'),
            fecha: 2026-03-16T00:00:00.000Z,
            hora: '14:00',
            barberiaId: new ObjectId('698bdc3e626399f145648e24')
          }
        },
        context: { operationName: 'CreateReservation', attempt: 2 },
        timestamp: 2026-02-11T01:32:47.598Z,
        originalStack: `MongoServerError: E11000 duplicate key error collection: 
test.reservas index: unique_reservation_slot dup key: { barberoId: 
ObjectId('698bdc3e626399f145648e26'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698bdc3e626399f145648e24') }\n` +
          '    at InsertOneOperation.handleOk (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\node_modules\\mongodb\\src\\operations\\insert.ts:79:13)\n' +
          '    at tryOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\backen
d\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:294:26)\n' +
          '    at processTicksAndRejections 
(node:internal/process/task_queues:105:5)\n' +
          '    at executeOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\ba
ckend\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:123:12)\n' +
          '    at Collection.insertOne (C:\\Users\\Kristian\\Desktop\\barber-saas
\\backend\\node_modules\\mongodb\\src\\collection.ts:294:12)\n' +
          '    at model.$__save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backe
nd\\node_modules\\mongoose\\lib\\model.js:398:16)\n' +
          '    at model.save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\
\node_modules\\mongoose\\lib\\model.js:609:5)\n' +
          '    at C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\\node_module
s\\mongoose\\lib\\model.js:2722:9\n' +
          '    at async Promise.all (index 0)\n' +
          '    at Function.create (C:\\Users\\Kristian\\Desktop\\barber-saas\\bac
kend\\node_modules\\mongoose\\lib\\model.js:2707:11)\n' +
          '    at MongoReservaRepository.save (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\src\\infrastructure\\database\\mongodb\\repositories\\MongoRese
rvaRepository.js:15:16)\n' +
          '    at TransactionManager.executeInTransaction.operationName (C:\\User
s\\Kristian\\Desktop\\barber-saas\\backend\\src\\application\\use-cases\\reservas
\\CreateReserva.js:72:42)\n' +
          '    at Function.executeInTransaction (C:\\Users\\Kristian\\Desktop\\ba
rber-saas\\backend\\src\\utils\\TransactionManager.js:57:32)\n' +
          '    at CreateReserva.execute (C:\\Users\\Kristian\\Desktop\\barber-saa
s\\backend\\src\\application\\use-cases\\reservas\\CreateReserva.js:26:34)\n' +
          '    at Object.<anonymous>.exports.crearReservaBySlug (C:\\Users\\Krist
ian\\Desktop\\barber-saas\\backend\\src\\controllers\\public.controller.js:140:25
)'
      }

    [0m [90m 4 |[39m
     [90m 5 |[39m [36mconst[39m errorHandler [33m=[39m (err[33m,[39m 
req[33m,[39m res[33m,[39m next) [33m=>[39m {
    [31m[1m>[22m[39m[90m 6 |[39m   console[33m.[39merror([32m"ƒö┤ 
ERROR:"[39m[33m,[39m err)[33m;[39m
     [90m   |[39m           [31m[1m^[22m[39m
     [90m 7 |[39m
     [90m 8 |[39m   [90m// ­ƒöÑ A├æADIR HEADERS CORS SI NO EXISTEN[39m
     [90m 9 |[39m   [36mconst[39m origin [33m=[39m 
req[33m.[39mheaders[33m.[39morigin[33m;[39m[0m

      at error (src/config/middleware/errorHandler.js:6:11)
      at Layer.handleError (node_modules/router/lib/layer.js:116:17)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at Layer.handleError (node_modules/router/lib/layer.js:111:12)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at Immediate.next (node_modules/router/index.js:291:5)
      at Immediate._onImmediate (node_modules/router/index.js:688:15)

    console.error
      ƒö┤ ERROR: TransactionError: Transaction failed for CreateReservation: 
E11000 duplicate key error collection: test.reservas index: 
unique_reservation_slot dup key: { barberoId: 
ObjectId('698bdc3e626399f145648e26'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698bdc3e626399f145648e24') }
          at Function.executeInTransaction (C:\Users\Kristian\Desktop\barber-saas
\backend\src\utils\TransactionManager.js:88:42)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at CreateReserva.execute (C:\Users\Kristian\Desktop\barber-saas\backend
\src\application\use-cases\reservas\CreateReserva.js:26:34)
          at Object.<anonymous>.exports.crearReservaBySlug (C:\Users\Kristian\Des
ktop\barber-saas\backend\src\controllers\public.controller.js:140:25) {
        isTransactionError: true,
        originalError: MongoServerError: E11000 duplicate key error collection: 
test.reservas index: unique_reservation_slot dup key: { barberoId: 
ObjectId('698bdc3e626399f145648e26'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698bdc3e626399f145648e24') }
            at InsertOneOperation.handleOk (C:\Users\Kristian\Desktop\barber-saas
\backend\node_modules\mongodb\src\operations\insert.ts:79:13)
            at tryOperation (C:\Users\Kristian\Desktop\barber-saas\backend\node_m
odules\mongodb\src\operations\execute_operation.ts:294:26)
            at processTicksAndRejections 
(node:internal/process/task_queues:105:5)
            at executeOperation (C:\Users\Kristian\Desktop\barber-saas\backend\no
de_modules\mongodb\src\operations\execute_operation.ts:123:12)
            at Collection.insertOne (C:\Users\Kristian\Desktop\barber-saas\backen
d\node_modules\mongodb\src\collection.ts:294:12)
            at model.$__save (C:\Users\Kristian\Desktop\barber-saas\backend\node_
modules\mongoose\lib\model.js:398:16)
            at model.save (C:\Users\Kristian\Desktop\barber-saas\backend\node_mod
ules\mongoose\lib\model.js:609:5)
            at C:\Users\Kristian\Desktop\barber-saas\backend\node_modules\mongoos
e\lib\model.js:2722:9
            at async Promise.all (index 0)
            at Function.create (C:\Users\Kristian\Desktop\barber-saas\backend\nod
e_modules\mongoose\lib\model.js:2707:11)
            at MongoReservaRepository.save (C:\Users\Kristian\Desktop\barber-saas
\backend\src\infrastructure\database\mongodb\repositories\MongoReservaRepository.
js:15:16)
            at TransactionManager.executeInTransaction.operationName (C:\Users\Kr
istian\Desktop\barber-saas\backend\src\application\use-cases\reservas\CreateReser
va.js:72:42)
            at Function.executeInTransaction (C:\Users\Kristian\Desktop\barber-sa
as\backend\src\utils\TransactionManager.js:57:32)
            at CreateReserva.execute (C:\Users\Kristian\Desktop\barber-saas\backe
nd\src\application\use-cases\reservas\CreateReserva.js:26:34)
            at Object.<anonymous>.exports.crearReservaBySlug (C:\Users\Kristian\D
esktop\barber-saas\backend\src\controllers\public.controller.js:140:25) {
          errorLabelSet: Set(0) {},
          errorResponse: {
            index: 0,
            code: 11000,
            errmsg: `E11000 duplicate key error collection: test.reservas index: 
unique_reservation_slot dup key: { barberoId: 
ObjectId('698bdc3e626399f145648e26'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698bdc3e626399f145648e24') }`,
            keyPattern: [Object],
            keyValue: [Object]
          },
          index: 0,
          code: 11000,
          keyPattern: { barberoId: 1, fecha: 1, hora: 1, barberiaId: 1 },
          keyValue: {
            barberoId: new ObjectId('698bdc3e626399f145648e26'),
            fecha: 2026-03-16T00:00:00.000Z,
            hora: '14:00',
            barberiaId: new ObjectId('698bdc3e626399f145648e24')
          }
        },
        context: { operationName: 'CreateReservation', attempt: 2 },
        timestamp: 2026-02-11T01:32:47.629Z,
        originalStack: `MongoServerError: E11000 duplicate key error collection: 
test.reservas index: unique_reservation_slot dup key: { barberoId: 
ObjectId('698bdc3e626399f145648e26'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698bdc3e626399f145648e24') }\n` +
          '    at InsertOneOperation.handleOk (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\node_modules\\mongodb\\src\\operations\\insert.ts:79:13)\n' +
          '    at tryOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\backen
d\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:294:26)\n' +
          '    at processTicksAndRejections 
(node:internal/process/task_queues:105:5)\n' +
          '    at executeOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\ba
ckend\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:123:12)\n' +
          '    at Collection.insertOne (C:\\Users\\Kristian\\Desktop\\barber-saas
\\backend\\node_modules\\mongodb\\src\\collection.ts:294:12)\n' +
          '    at model.$__save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backe
nd\\node_modules\\mongoose\\lib\\model.js:398:16)\n' +
          '    at model.save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\
\node_modules\\mongoose\\lib\\model.js:609:5)\n' +
          '    at C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\\node_module
s\\mongoose\\lib\\model.js:2722:9\n' +
          '    at async Promise.all (index 0)\n' +
          '    at Function.create (C:\\Users\\Kristian\\Desktop\\barber-saas\\bac
kend\\node_modules\\mongoose\\lib\\model.js:2707:11)\n' +
          '    at MongoReservaRepository.save (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\src\\infrastructure\\database\\mongodb\\repositories\\MongoRese
rvaRepository.js:15:16)\n' +
          '    at TransactionManager.executeInTransaction.operationName (C:\\User
s\\Kristian\\Desktop\\barber-saas\\backend\\src\\application\\use-cases\\reservas
\\CreateReserva.js:72:42)\n' +
          '    at Function.executeInTransaction (C:\\Users\\Kristian\\Desktop\\ba
rber-saas\\backend\\src\\utils\\TransactionManager.js:57:32)\n' +
          '    at CreateReserva.execute (C:\\Users\\Kristian\\Desktop\\barber-saa
s\\backend\\src\\application\\use-cases\\reservas\\CreateReserva.js:26:34)\n' +
          '    at Object.<anonymous>.exports.crearReservaBySlug (C:\\Users\\Krist
ian\\Desktop\\barber-saas\\backend\\src\\controllers\\public.controller.js:140:25
)'
      }

    [0m [90m 4 |[39m
     [90m 5 |[39m [36mconst[39m errorHandler [33m=[39m (err[33m,[39m 
req[33m,[39m res[33m,[39m next) [33m=>[39m {
    [31m[1m>[22m[39m[90m 6 |[39m   console[33m.[39merror([32m"ƒö┤ 
ERROR:"[39m[33m,[39m err)[33m;[39m
     [90m   |[39m           [31m[1m^[22m[39m
     [90m 7 |[39m
     [90m 8 |[39m   [90m// ­ƒöÑ A├æADIR HEADERS CORS SI NO EXISTEN[39m
     [90m 9 |[39m   [36mconst[39m origin [33m=[39m 
req[33m.[39mheaders[33m.[39morigin[33m;[39m[0m

      at error (src/config/middleware/errorHandler.js:6:11)
      at Layer.handleError (node_modules/router/lib/layer.js:116:17)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at Layer.handleError (node_modules/router/lib/layer.js:111:12)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at Immediate.next (node_modules/router/index.js:291:5)
      at Immediate._onImmediate (node_modules/router/index.js:688:15)

    console.error
      ƒö┤ ERROR: TransactionError: Transaction failed for CreateReservation: 
E11000 duplicate key error collection: test.reservas index: 
unique_reservation_slot dup key: { barberoId: 
ObjectId('698bdc3e626399f145648e26'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698bdc3e626399f145648e24') }
          at Function.executeInTransaction (C:\Users\Kristian\Desktop\barber-saas
\backend\src\utils\TransactionManager.js:88:42)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at CreateReserva.execute (C:\Users\Kristian\Desktop\barber-saas\backend
\src\application\use-cases\reservas\CreateReserva.js:26:34)
          at Object.<anonymous>.exports.crearReservaBySlug (C:\Users\Kristian\Des
ktop\barber-saas\backend\src\controllers\public.controller.js:140:25) {
        isTransactionError: true,
        originalError: MongoServerError: E11000 duplicate key error collection: 
test.reservas index: unique_reservation_slot dup key: { barberoId: 
ObjectId('698bdc3e626399f145648e26'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698bdc3e626399f145648e24') }
            at InsertOneOperation.handleOk (C:\Users\Kristian\Desktop\barber-saas
\backend\node_modules\mongodb\src\operations\insert.ts:79:13)
            at tryOperation (C:\Users\Kristian\Desktop\barber-saas\backend\node_m
odules\mongodb\src\operations\execute_operation.ts:294:26)
            at processTicksAndRejections 
(node:internal/process/task_queues:105:5)
            at executeOperation (C:\Users\Kristian\Desktop\barber-saas\backend\no
de_modules\mongodb\src\operations\execute_operation.ts:123:12)
            at Collection.insertOne (C:\Users\Kristian\Desktop\barber-saas\backen
d\node_modules\mongodb\src\collection.ts:294:12)
            at model.$__save (C:\Users\Kristian\Desktop\barber-saas\backend\node_
modules\mongoose\lib\model.js:398:16)
            at model.save (C:\Users\Kristian\Desktop\barber-saas\backend\node_mod
ules\mongoose\lib\model.js:609:5)
            at C:\Users\Kristian\Desktop\barber-saas\backend\node_modules\mongoos
e\lib\model.js:2722:9
            at async Promise.all (index 0)
            at Function.create (C:\Users\Kristian\Desktop\barber-saas\backend\nod
e_modules\mongoose\lib\model.js:2707:11)
            at MongoReservaRepository.save (C:\Users\Kristian\Desktop\barber-saas
\backend\src\infrastructure\database\mongodb\repositories\MongoReservaRepository.
js:15:16)
            at TransactionManager.executeInTransaction.operationName (C:\Users\Kr
istian\Desktop\barber-saas\backend\src\application\use-cases\reservas\CreateReser
va.js:72:42)
            at Function.executeInTransaction (C:\Users\Kristian\Desktop\barber-sa
as\backend\src\utils\TransactionManager.js:57:32)
            at CreateReserva.execute (C:\Users\Kristian\Desktop\barber-saas\backe
nd\src\application\use-cases\reservas\CreateReserva.js:26:34)
            at Object.<anonymous>.exports.crearReservaBySlug (C:\Users\Kristian\D
esktop\barber-saas\backend\src\controllers\public.controller.js:140:25) {
          errorLabelSet: Set(0) {},
          errorResponse: {
            index: 0,
            code: 11000,
            errmsg: `E11000 duplicate key error collection: test.reservas index: 
unique_reservation_slot dup key: { barberoId: 
ObjectId('698bdc3e626399f145648e26'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698bdc3e626399f145648e24') }`,
            keyPattern: [Object],
            keyValue: [Object]
          },
          index: 0,
          code: 11000,
          keyPattern: { barberoId: 1, fecha: 1, hora: 1, barberiaId: 1 },
          keyValue: {
            barberoId: new ObjectId('698bdc3e626399f145648e26'),
            fecha: 2026-03-16T00:00:00.000Z,
            hora: '14:00',
            barberiaId: new ObjectId('698bdc3e626399f145648e24')
          }
        },
        context: { operationName: 'CreateReservation', attempt: 2 },
        timestamp: 2026-02-11T01:32:47.631Z,
        originalStack: `MongoServerError: E11000 duplicate key error collection: 
test.reservas index: unique_reservation_slot dup key: { barberoId: 
ObjectId('698bdc3e626399f145648e26'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698bdc3e626399f145648e24') }\n` +
          '    at InsertOneOperation.handleOk (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\node_modules\\mongodb\\src\\operations\\insert.ts:79:13)\n' +
          '    at tryOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\backen
d\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:294:26)\n' +
          '    at processTicksAndRejections 
(node:internal/process/task_queues:105:5)\n' +
          '    at executeOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\ba
ckend\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:123:12)\n' +
          '    at Collection.insertOne (C:\\Users\\Kristian\\Desktop\\barber-saas
\\backend\\node_modules\\mongodb\\src\\collection.ts:294:12)\n' +
          '    at model.$__save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backe
nd\\node_modules\\mongoose\\lib\\model.js:398:16)\n' +
          '    at model.save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\
\node_modules\\mongoose\\lib\\model.js:609:5)\n' +
          '    at C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\\node_module
s\\mongoose\\lib\\model.js:2722:9\n' +
          '    at async Promise.all (index 0)\n' +
          '    at Function.create (C:\\Users\\Kristian\\Desktop\\barber-saas\\bac
kend\\node_modules\\mongoose\\lib\\model.js:2707:11)\n' +
          '    at MongoReservaRepository.save (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\src\\infrastructure\\database\\mongodb\\repositories\\MongoRese
rvaRepository.js:15:16)\n' +
          '    at TransactionManager.executeInTransaction.operationName (C:\\User
s\\Kristian\\Desktop\\barber-saas\\backend\\src\\application\\use-cases\\reservas
\\CreateReserva.js:72:42)\n' +
          '    at Function.executeInTransaction (C:\\Users\\Kristian\\Desktop\\ba
rber-saas\\backend\\src\\utils\\TransactionManager.js:57:32)\n' +
          '    at CreateReserva.execute (C:\\Users\\Kristian\\Desktop\\barber-saa
s\\backend\\src\\application\\use-cases\\reservas\\CreateReserva.js:26:34)\n' +
          '    at Object.<anonymous>.exports.crearReservaBySlug (C:\\Users\\Krist
ian\\Desktop\\barber-saas\\backend\\src\\controllers\\public.controller.js:140:25
)'
      }

    [0m [90m 4 |[39m
     [90m 5 |[39m [36mconst[39m errorHandler [33m=[39m (err[33m,[39m 
req[33m,[39m res[33m,[39m next) [33m=>[39m {
    [31m[1m>[22m[39m[90m 6 |[39m   console[33m.[39merror([32m"ƒö┤ 
ERROR:"[39m[33m,[39m err)[33m;[39m
     [90m   |[39m           [31m[1m^[22m[39m
     [90m 7 |[39m
     [90m 8 |[39m   [90m// ­ƒöÑ A├æADIR HEADERS CORS SI NO EXISTEN[39m
     [90m 9 |[39m   [36mconst[39m origin [33m=[39m 
req[33m.[39mheaders[33m.[39morigin[33m;[39m[0m

      at error (src/config/middleware/errorHandler.js:6:11)
      at Layer.handleError (node_modules/router/lib/layer.js:116:17)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at Layer.handleError (node_modules/router/lib/layer.js:111:12)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at Immediate.next (node_modules/router/index.js:291:5)
      at Immediate._onImmediate (node_modules/router/index.js:688:15)

    console.error
      ƒö┤ ERROR: TransactionError: Transaction failed for CreateReservation: 
E11000 duplicate key error collection: test.reservas index: 
unique_reservation_slot dup key: { barberoId: 
ObjectId('698bdc3e626399f145648e26'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698bdc3e626399f145648e24') }
          at Function.executeInTransaction (C:\Users\Kristian\Desktop\barber-saas
\backend\src\utils\TransactionManager.js:88:42)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at CreateReserva.execute (C:\Users\Kristian\Desktop\barber-saas\backend
\src\application\use-cases\reservas\CreateReserva.js:26:34)
          at Object.<anonymous>.exports.crearReservaBySlug (C:\Users\Kristian\Des
ktop\barber-saas\backend\src\controllers\public.controller.js:140:25) {
        isTransactionError: true,
        originalError: MongoServerError: E11000 duplicate key error collection: 
test.reservas index: unique_reservation_slot dup key: { barberoId: 
ObjectId('698bdc3e626399f145648e26'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698bdc3e626399f145648e24') }
            at InsertOneOperation.handleOk (C:\Users\Kristian\Desktop\barber-saas
\backend\node_modules\mongodb\src\operations\insert.ts:79:13)
            at tryOperation (C:\Users\Kristian\Desktop\barber-saas\backend\node_m
odules\mongodb\src\operations\execute_operation.ts:294:26)
            at processTicksAndRejections 
(node:internal/process/task_queues:105:5)
            at executeOperation (C:\Users\Kristian\Desktop\barber-saas\backend\no
de_modules\mongodb\src\operations\execute_operation.ts:123:12)
            at Collection.insertOne (C:\Users\Kristian\Desktop\barber-saas\backen
d\node_modules\mongodb\src\collection.ts:294:12)
            at model.$__save (C:\Users\Kristian\Desktop\barber-saas\backend\node_
modules\mongoose\lib\model.js:398:16)
            at model.save (C:\Users\Kristian\Desktop\barber-saas\backend\node_mod
ules\mongoose\lib\model.js:609:5)
            at C:\Users\Kristian\Desktop\barber-saas\backend\node_modules\mongoos
e\lib\model.js:2722:9
            at async Promise.all (index 0)
            at Function.create (C:\Users\Kristian\Desktop\barber-saas\backend\nod
e_modules\mongoose\lib\model.js:2707:11)
            at MongoReservaRepository.save (C:\Users\Kristian\Desktop\barber-saas
\backend\src\infrastructure\database\mongodb\repositories\MongoReservaRepository.
js:15:16)
            at TransactionManager.executeInTransaction.operationName (C:\Users\Kr
istian\Desktop\barber-saas\backend\src\application\use-cases\reservas\CreateReser
va.js:72:42)
            at Function.executeInTransaction (C:\Users\Kristian\Desktop\barber-sa
as\backend\src\utils\TransactionManager.js:57:32)
            at CreateReserva.execute (C:\Users\Kristian\Desktop\barber-saas\backe
nd\src\application\use-cases\reservas\CreateReserva.js:26:34)
            at Object.<anonymous>.exports.crearReservaBySlug (C:\Users\Kristian\D
esktop\barber-saas\backend\src\controllers\public.controller.js:140:25) {
          errorLabelSet: Set(0) {},
          errorResponse: {
            index: 0,
            code: 11000,
            errmsg: `E11000 duplicate key error collection: test.reservas index: 
unique_reservation_slot dup key: { barberoId: 
ObjectId('698bdc3e626399f145648e26'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698bdc3e626399f145648e24') }`,
            keyPattern: [Object],
            keyValue: [Object]
          },
          index: 0,
          code: 11000,
          keyPattern: { barberoId: 1, fecha: 1, hora: 1, barberiaId: 1 },
          keyValue: {
            barberoId: new ObjectId('698bdc3e626399f145648e26'),
            fecha: 2026-03-16T00:00:00.000Z,
            hora: '14:00',
            barberiaId: new ObjectId('698bdc3e626399f145648e24')
          }
        },
        context: { operationName: 'CreateReservation', attempt: 2 },
        timestamp: 2026-02-11T01:32:47.632Z,
        originalStack: `MongoServerError: E11000 duplicate key error collection: 
test.reservas index: unique_reservation_slot dup key: { barberoId: 
ObjectId('698bdc3e626399f145648e26'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698bdc3e626399f145648e24') }\n` +
          '    at InsertOneOperation.handleOk (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\node_modules\\mongodb\\src\\operations\\insert.ts:79:13)\n' +
          '    at tryOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\backen
d\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:294:26)\n' +
          '    at processTicksAndRejections 
(node:internal/process/task_queues:105:5)\n' +
          '    at executeOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\ba
ckend\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:123:12)\n' +
          '    at Collection.insertOne (C:\\Users\\Kristian\\Desktop\\barber-saas
\\backend\\node_modules\\mongodb\\src\\collection.ts:294:12)\n' +
          '    at model.$__save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backe
nd\\node_modules\\mongoose\\lib\\model.js:398:16)\n' +
          '    at model.save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\
\node_modules\\mongoose\\lib\\model.js:609:5)\n' +
          '    at C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\\node_module
s\\mongoose\\lib\\model.js:2722:9\n' +
          '    at async Promise.all (index 0)\n' +
          '    at Function.create (C:\\Users\\Kristian\\Desktop\\barber-saas\\bac
kend\\node_modules\\mongoose\\lib\\model.js:2707:11)\n' +
          '    at MongoReservaRepository.save (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\src\\infrastructure\\database\\mongodb\\repositories\\MongoRese
rvaRepository.js:15:16)\n' +
          '    at TransactionManager.executeInTransaction.operationName (C:\\User
s\\Kristian\\Desktop\\barber-saas\\backend\\src\\application\\use-cases\\reservas
\\CreateReserva.js:72:42)\n' +
          '    at Function.executeInTransaction (C:\\Users\\Kristian\\Desktop\\ba
rber-saas\\backend\\src\\utils\\TransactionManager.js:57:32)\n' +
          '    at CreateReserva.execute (C:\\Users\\Kristian\\Desktop\\barber-saa
s\\backend\\src\\application\\use-cases\\reservas\\CreateReserva.js:26:34)\n' +
          '    at Object.<anonymous>.exports.crearReservaBySlug (C:\\Users\\Krist
ian\\Desktop\\barber-saas\\backend\\src\\controllers\\public.controller.js:140:25
)'
      }

    [0m [90m 4 |[39m
     [90m 5 |[39m [36mconst[39m errorHandler [33m=[39m (err[33m,[39m 
req[33m,[39m res[33m,[39m next) [33m=>[39m {
    [31m[1m>[22m[39m[90m 6 |[39m   console[33m.[39merror([32m"ƒö┤ 
ERROR:"[39m[33m,[39m err)[33m;[39m
     [90m   |[39m           [31m[1m^[22m[39m
     [90m 7 |[39m
     [90m 8 |[39m   [90m// ­ƒöÑ A├æADIR HEADERS CORS SI NO EXISTEN[39m
     [90m 9 |[39m   [36mconst[39m origin [33m=[39m 
req[33m.[39mheaders[33m.[39morigin[33m;[39m[0m

      at error (src/config/middleware/errorHandler.js:6:11)
      at Layer.handleError (node_modules/router/lib/layer.js:116:17)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at Layer.handleError (node_modules/router/lib/layer.js:111:12)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at Immediate.next (node_modules/router/index.js:291:5)
      at Immediate._onImmediate (node_modules/router/index.js:688:15)

    console.log
      [Transaction] Aborted: CreateReservation

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:69:29)

    console.error
      [Transaction] Failed: CreateReservation {
        error: `E11000 duplicate key error collection: test.reservas index: 
unique_reservation_slot dup key: { barberoId: 
ObjectId('698bdc3e626399f145648e26'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698bdc3e626399f145648e24') }`,
        attempt: 2,
        stack: `MongoServerError: E11000 duplicate key error collection: 
test.reservas index: unique_reservation_slot dup key: { barberoId: 
ObjectId('698bdc3e626399f145648e26'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698bdc3e626399f145648e24') }\n` +
          '    at InsertOneOperation.handleOk (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\node_modules\\mongodb\\src\\operations\\insert.ts:79:13)\n' +
          '    at tryOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\backen
d\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:294:26)\n' +
          '    at processTicksAndRejections 
(node:internal/process/task_queues:105:5)\n' +
          '    at executeOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\ba
ckend\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:123:12)\n' +
          '    at Collection.insertOne (C:\\Users\\Kristian\\Desktop\\barber-saas
\\backend\\node_modules\\mongodb\\src\\collection.ts:294:12)\n' +
          '    at model.$__save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backe
nd\\node_modules\\mongoose\\lib\\model.js:398:16)\n' +
          '    at model.save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\
\node_modules\\mongoose\\lib\\model.js:609:5)\n' +
          '    at C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\\node_module
s\\mongoose\\lib\\model.js:2722:9\n' +
          '    at async Promise.all (index 0)\n' +
          '    at Function.create (C:\\Users\\Kristian\\Desktop\\barber-saas\\bac
kend\\node_modules\\mongoose\\lib\\model.js:2707:11)\n' +
          '    at MongoReservaRepository.save (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\src\\infrastructure\\database\\mongodb\\repositories\\MongoRese
rvaRepository.js:15:16)\n' +
          '    at TransactionManager.executeInTransaction.operationName (C:\\User
s\\Kristian\\Desktop\\barber-saas\\backend\\src\\application\\use-cases\\reservas
\\CreateReserva.js:72:42)\n' +
          '    at Function.executeInTransaction (C:\\Users\\Kristian\\Desktop\\ba
rber-saas\\backend\\src\\utils\\TransactionManager.js:57:32)\n' +
          '    at CreateReserva.execute (C:\\Users\\Kristian\\Desktop\\barber-saa
s\\backend\\src\\application\\use-cases\\reservas\\CreateReserva.js:26:34)\n' +
          '    at Object.<anonymous>.exports.crearReservaBySlug (C:\\Users\\Krist
ian\\Desktop\\barber-saas\\backend\\src\\controllers\\public.controller.js:140:25
)'
      }

    [0m [90m 80 |[39m
     [90m 81 |[39m                 [90m// Non-transient error or max retries 
reached[39m
    [31m[1m>[22m[39m[90m 82 |[39m                 
console[33m.[39merror([32m`[Transaction] Failed: 
${operationName}`[39m[33m,[39m {
     [90m    |[39m                         [31m[1m^[22m[39m
     [90m 83 |[39m                     error[33m:[39m 
error[33m.[39mmessage[33m,[39m
     [90m 84 |[39m                     attempt[33m:[39m attempt [33m+[39m 
[35m1[39m[33m,[39m
     [90m 85 |[39m                     stack[33m:[39m 
error[33m.[39mstack[0m

      at Function.error [as executeInTransaction] 
(src/utils/TransactionManager.js:82:25)
      at CreateReserva.execute 
(src/application/use-cases/reservas/CreateReserva.js:26:34)
      at Object.<anonymous>.exports.crearReservaBySlug 
(src/controllers/public.controller.js:140:25)

    console.log
      [Transaction] Aborted: CreateReservation

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:69:29)

    console.error
      [Transaction] Failed: CreateReservation {
        error: `E11000 duplicate key error collection: test.reservas index: 
unique_reservation_slot dup key: { barberoId: 
ObjectId('698bdc3e626399f145648e26'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698bdc3e626399f145648e24') }`,
        attempt: 2,
        stack: `MongoServerError: E11000 duplicate key error collection: 
test.reservas index: unique_reservation_slot dup key: { barberoId: 
ObjectId('698bdc3e626399f145648e26'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698bdc3e626399f145648e24') }\n` +
          '    at InsertOneOperation.handleOk (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\node_modules\\mongodb\\src\\operations\\insert.ts:79:13)\n' +
          '    at tryOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\backen
d\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:294:26)\n' +
          '    at processTicksAndRejections 
(node:internal/process/task_queues:105:5)\n' +
          '    at executeOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\ba
ckend\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:123:12)\n' +
          '    at Collection.insertOne (C:\\Users\\Kristian\\Desktop\\barber-saas
\\backend\\node_modules\\mongodb\\src\\collection.ts:294:12)\n' +
          '    at model.$__save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backe
nd\\node_modules\\mongoose\\lib\\model.js:398:16)\n' +
          '    at model.save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\
\node_modules\\mongoose\\lib\\model.js:609:5)\n' +
          '    at C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\\node_module
s\\mongoose\\lib\\model.js:2722:9\n' +
          '    at async Promise.all (index 0)\n' +
          '    at Function.create (C:\\Users\\Kristian\\Desktop\\barber-saas\\bac
kend\\node_modules\\mongoose\\lib\\model.js:2707:11)\n' +
          '    at MongoReservaRepository.save (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\src\\infrastructure\\database\\mongodb\\repositories\\MongoRese
rvaRepository.js:15:16)\n' +
          '    at TransactionManager.executeInTransaction.operationName (C:\\User
s\\Kristian\\Desktop\\barber-saas\\backend\\src\\application\\use-cases\\reservas
\\CreateReserva.js:72:42)\n' +
          '    at Function.executeInTransaction (C:\\Users\\Kristian\\Desktop\\ba
rber-saas\\backend\\src\\utils\\TransactionManager.js:57:32)\n' +
          '    at CreateReserva.execute (C:\\Users\\Kristian\\Desktop\\barber-saa
s\\backend\\src\\application\\use-cases\\reservas\\CreateReserva.js:26:34)\n' +
          '    at Object.<anonymous>.exports.crearReservaBySlug (C:\\Users\\Krist
ian\\Desktop\\barber-saas\\backend\\src\\controllers\\public.controller.js:140:25
)'
      }

    [0m [90m 80 |[39m
     [90m 81 |[39m                 [90m// Non-transient error or max retries 
reached[39m
    [31m[1m>[22m[39m[90m 82 |[39m                 
console[33m.[39merror([32m`[Transaction] Failed: 
${operationName}`[39m[33m,[39m {
     [90m    |[39m                         [31m[1m^[22m[39m
     [90m 83 |[39m                     error[33m:[39m 
error[33m.[39mmessage[33m,[39m
     [90m 84 |[39m                     attempt[33m:[39m attempt [33m+[39m 
[35m1[39m[33m,[39m
     [90m 85 |[39m                     stack[33m:[39m 
error[33m.[39mstack[0m

      at Function.error [as executeInTransaction] 
(src/utils/TransactionManager.js:82:25)
      at CreateReserva.execute 
(src/application/use-cases/reservas/CreateReserva.js:26:34)
      at Object.<anonymous>.exports.crearReservaBySlug 
(src/controllers/public.controller.js:140:25)

    console.log
      [Transaction] Aborted: CreateReservation

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:69:29)

    console.error
      [Transaction] Failed: CreateReservation {
        error: `E11000 duplicate key error collection: test.reservas index: 
unique_reservation_slot dup key: { barberoId: 
ObjectId('698bdc3e626399f145648e26'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698bdc3e626399f145648e24') }`,
        attempt: 2,
        stack: `MongoServerError: E11000 duplicate key error collection: 
test.reservas index: unique_reservation_slot dup key: { barberoId: 
ObjectId('698bdc3e626399f145648e26'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698bdc3e626399f145648e24') }\n` +
          '    at InsertOneOperation.handleOk (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\node_modules\\mongodb\\src\\operations\\insert.ts:79:13)\n' +
          '    at tryOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\backen
d\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:294:26)\n' +
          '    at processTicksAndRejections 
(node:internal/process/task_queues:105:5)\n' +
          '    at executeOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\ba
ckend\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:123:12)\n' +
          '    at Collection.insertOne (C:\\Users\\Kristian\\Desktop\\barber-saas
\\backend\\node_modules\\mongodb\\src\\collection.ts:294:12)\n' +
          '    at model.$__save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backe
nd\\node_modules\\mongoose\\lib\\model.js:398:16)\n' +
          '    at model.save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\
\node_modules\\mongoose\\lib\\model.js:609:5)\n' +
          '    at C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\\node_module
s\\mongoose\\lib\\model.js:2722:9\n' +
          '    at async Promise.all (index 0)\n' +
          '    at Function.create (C:\\Users\\Kristian\\Desktop\\barber-saas\\bac
kend\\node_modules\\mongoose\\lib\\model.js:2707:11)\n' +
          '    at MongoReservaRepository.save (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\src\\infrastructure\\database\\mongodb\\repositories\\MongoRese
rvaRepository.js:15:16)\n' +
          '    at TransactionManager.executeInTransaction.operationName (C:\\User
s\\Kristian\\Desktop\\barber-saas\\backend\\src\\application\\use-cases\\reservas
\\CreateReserva.js:72:42)\n' +
          '    at Function.executeInTransaction (C:\\Users\\Kristian\\Desktop\\ba
rber-saas\\backend\\src\\utils\\TransactionManager.js:57:32)\n' +
          '    at CreateReserva.execute (C:\\Users\\Kristian\\Desktop\\barber-saa
s\\backend\\src\\application\\use-cases\\reservas\\CreateReserva.js:26:34)\n' +
          '    at Object.<anonymous>.exports.crearReservaBySlug (C:\\Users\\Krist
ian\\Desktop\\barber-saas\\backend\\src\\controllers\\public.controller.js:140:25
)'
      }

    [0m [90m 80 |[39m
     [90m 81 |[39m                 [90m// Non-transient error or max retries 
reached[39m
    [31m[1m>[22m[39m[90m 82 |[39m                 
console[33m.[39merror([32m`[Transaction] Failed: 
${operationName}`[39m[33m,[39m {
     [90m    |[39m                         [31m[1m^[22m[39m
     [90m 83 |[39m                     error[33m:[39m 
error[33m.[39mmessage[33m,[39m
     [90m 84 |[39m                     attempt[33m:[39m attempt [33m+[39m 
[35m1[39m[33m,[39m
     [90m 85 |[39m                     stack[33m:[39m 
error[33m.[39mstack[0m

      at Function.error [as executeInTransaction] 
(src/utils/TransactionManager.js:82:25)
      at CreateReserva.execute 
(src/application/use-cases/reservas/CreateReserva.js:26:34)
      at Object.<anonymous>.exports.crearReservaBySlug 
(src/controllers/public.controller.js:140:25)

    console.log
      [Transaction] Aborted: CreateReservation

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:69:29)

    console.error
      [Transaction] Failed: CreateReservation {
        error: `E11000 duplicate key error collection: test.reservas index: 
unique_reservation_slot dup key: { barberoId: 
ObjectId('698bdc3e626399f145648e26'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698bdc3e626399f145648e24') }`,
        attempt: 2,
        stack: `MongoServerError: E11000 duplicate key error collection: 
test.reservas index: unique_reservation_slot dup key: { barberoId: 
ObjectId('698bdc3e626399f145648e26'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698bdc3e626399f145648e24') }\n` +
          '    at InsertOneOperation.handleOk (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\node_modules\\mongodb\\src\\operations\\insert.ts:79:13)\n' +
          '    at tryOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\backen
d\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:294:26)\n' +
          '    at processTicksAndRejections 
(node:internal/process/task_queues:105:5)\n' +
          '    at executeOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\ba
ckend\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:123:12)\n' +
          '    at Collection.insertOne (C:\\Users\\Kristian\\Desktop\\barber-saas
\\backend\\node_modules\\mongodb\\src\\collection.ts:294:12)\n' +
          '    at model.$__save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backe
nd\\node_modules\\mongoose\\lib\\model.js:398:16)\n' +
          '    at model.save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\
\node_modules\\mongoose\\lib\\model.js:609:5)\n' +
          '    at C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\\node_module
s\\mongoose\\lib\\model.js:2722:9\n' +
          '    at async Promise.all (index 0)\n' +
          '    at Function.create (C:\\Users\\Kristian\\Desktop\\barber-saas\\bac
kend\\node_modules\\mongoose\\lib\\model.js:2707:11)\n' +
          '    at MongoReservaRepository.save (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\src\\infrastructure\\database\\mongodb\\repositories\\MongoRese
rvaRepository.js:15:16)\n' +
          '    at TransactionManager.executeInTransaction.operationName (C:\\User
s\\Kristian\\Desktop\\barber-saas\\backend\\src\\application\\use-cases\\reservas
\\CreateReserva.js:72:42)\n' +
          '    at Function.executeInTransaction (C:\\Users\\Kristian\\Desktop\\ba
rber-saas\\backend\\src\\utils\\TransactionManager.js:57:32)\n' +
          '    at CreateReserva.execute (C:\\Users\\Kristian\\Desktop\\barber-saa
s\\backend\\src\\application\\use-cases\\reservas\\CreateReserva.js:26:34)\n' +
          '    at Object.<anonymous>.exports.crearReservaBySlug (C:\\Users\\Krist
ian\\Desktop\\barber-saas\\backend\\src\\controllers\\public.controller.js:140:25
)'
      }

    [0m [90m 80 |[39m
     [90m 81 |[39m                 [90m// Non-transient error or max retries 
reached[39m
    [31m[1m>[22m[39m[90m 82 |[39m                 
console[33m.[39merror([32m`[Transaction] Failed: 
${operationName}`[39m[33m,[39m {
     [90m    |[39m                         [31m[1m^[22m[39m
     [90m 83 |[39m                     error[33m:[39m 
error[33m.[39mmessage[33m,[39m
     [90m 84 |[39m                     attempt[33m:[39m attempt [33m+[39m 
[35m1[39m[33m,[39m
     [90m 85 |[39m                     stack[33m:[39m 
error[33m.[39mstack[0m

      at Function.error [as executeInTransaction] 
(src/utils/TransactionManager.js:82:25)
      at CreateReserva.execute 
(src/application/use-cases/reservas/CreateReserva.js:26:34)
      at Object.<anonymous>.exports.crearReservaBySlug 
(src/controllers/public.controller.js:140:25)

    console.log
      [Transaction] Aborted: CreateReservation

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:69:29)

    console.error
      [Transaction] Failed: CreateReservation {
        error: `E11000 duplicate key error collection: test.reservas index: 
unique_reservation_slot dup key: { barberoId: 
ObjectId('698bdc3e626399f145648e26'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698bdc3e626399f145648e24') }`,
        attempt: 2,
        stack: `MongoServerError: E11000 duplicate key error collection: 
test.reservas index: unique_reservation_slot dup key: { barberoId: 
ObjectId('698bdc3e626399f145648e26'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698bdc3e626399f145648e24') }\n` +
          '    at InsertOneOperation.handleOk (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\node_modules\\mongodb\\src\\operations\\insert.ts:79:13)\n' +
          '    at tryOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\backen
d\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:294:26)\n' +
          '    at processTicksAndRejections 
(node:internal/process/task_queues:105:5)\n' +
          '    at executeOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\ba
ckend\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:123:12)\n' +
          '    at Collection.insertOne (C:\\Users\\Kristian\\Desktop\\barber-saas
\\backend\\node_modules\\mongodb\\src\\collection.ts:294:12)\n' +
          '    at model.$__save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backe
nd\\node_modules\\mongoose\\lib\\model.js:398:16)\n' +
          '    at model.save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\
\node_modules\\mongoose\\lib\\model.js:609:5)\n' +
          '    at C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\\node_module
s\\mongoose\\lib\\model.js:2722:9\n' +
          '    at async Promise.all (index 0)\n' +
          '    at Function.create (C:\\Users\\Kristian\\Desktop\\barber-saas\\bac
kend\\node_modules\\mongoose\\lib\\model.js:2707:11)\n' +
          '    at MongoReservaRepository.save (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\src\\infrastructure\\database\\mongodb\\repositories\\MongoRese
rvaRepository.js:15:16)\n' +
          '    at TransactionManager.executeInTransaction.operationName (C:\\User
s\\Kristian\\Desktop\\barber-saas\\backend\\src\\application\\use-cases\\reservas
\\CreateReserva.js:72:42)\n' +
          '    at Function.executeInTransaction (C:\\Users\\Kristian\\Desktop\\ba
rber-saas\\backend\\src\\utils\\TransactionManager.js:57:32)\n' +
          '    at CreateReserva.execute (C:\\Users\\Kristian\\Desktop\\barber-saa
s\\backend\\src\\application\\use-cases\\reservas\\CreateReserva.js:26:34)\n' +
          '    at Object.<anonymous>.exports.crearReservaBySlug (C:\\Users\\Krist
ian\\Desktop\\barber-saas\\backend\\src\\controllers\\public.controller.js:140:25
)'
      }

    [0m [90m 80 |[39m
     [90m 81 |[39m                 [90m// Non-transient error or max retries 
reached[39m
    [31m[1m>[22m[39m[90m 82 |[39m                 
console[33m.[39merror([32m`[Transaction] Failed: 
${operationName}`[39m[33m,[39m {
     [90m    |[39m                         [31m[1m^[22m[39m
     [90m 83 |[39m                     error[33m:[39m 
error[33m.[39mmessage[33m,[39m
     [90m 84 |[39m                     attempt[33m:[39m attempt [33m+[39m 
[35m1[39m[33m,[39m
     [90m 85 |[39m                     stack[33m:[39m 
error[33m.[39mstack[0m

      at Function.error [as executeInTransaction] 
(src/utils/TransactionManager.js:82:25)
      at CreateReserva.execute 
(src/application/use-cases/reservas/CreateReserva.js:26:34)
      at Object.<anonymous>.exports.crearReservaBySlug 
(src/controllers/public.controller.js:140:25)

    console.log
      [Transaction] Aborted: CreateReservation

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:69:29)

    console.error
      [Transaction] Failed: CreateReservation {
        error: `E11000 duplicate key error collection: test.reservas index: 
unique_reservation_slot dup key: { barberoId: 
ObjectId('698bdc3e626399f145648e26'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698bdc3e626399f145648e24') }`,
        attempt: 2,
        stack: `MongoServerError: E11000 duplicate key error collection: 
test.reservas index: unique_reservation_slot dup key: { barberoId: 
ObjectId('698bdc3e626399f145648e26'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698bdc3e626399f145648e24') }\n` +
          '    at InsertOneOperation.handleOk (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\node_modules\\mongodb\\src\\operations\\insert.ts:79:13)\n' +
          '    at tryOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\backen
d\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:294:26)\n' +
          '    at processTicksAndRejections 
(node:internal/process/task_queues:105:5)\n' +
          '    at executeOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\ba
ckend\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:123:12)\n' +
          '    at Collection.insertOne (C:\\Users\\Kristian\\Desktop\\barber-saas
\\backend\\node_modules\\mongodb\\src\\collection.ts:294:12)\n' +
          '    at model.$__save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backe
nd\\node_modules\\mongoose\\lib\\model.js:398:16)\n' +
          '    at model.save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\
\node_modules\\mongoose\\lib\\model.js:609:5)\n' +
          '    at C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\\node_module
s\\mongoose\\lib\\model.js:2722:9\n' +
          '    at async Promise.all (index 0)\n' +
          '    at Function.create (C:\\Users\\Kristian\\Desktop\\barber-saas\\bac
kend\\node_modules\\mongoose\\lib\\model.js:2707:11)\n' +
          '    at MongoReservaRepository.save (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\src\\infrastructure\\database\\mongodb\\repositories\\MongoRese
rvaRepository.js:15:16)\n' +
          '    at TransactionManager.executeInTransaction.operationName (C:\\User
s\\Kristian\\Desktop\\barber-saas\\backend\\src\\application\\use-cases\\reservas
\\CreateReserva.js:72:42)\n' +
          '    at Function.executeInTransaction (C:\\Users\\Kristian\\Desktop\\ba
rber-saas\\backend\\src\\utils\\TransactionManager.js:57:32)\n' +
          '    at CreateReserva.execute (C:\\Users\\Kristian\\Desktop\\barber-saa
s\\backend\\src\\application\\use-cases\\reservas\\CreateReserva.js:26:34)\n' +
          '    at Object.<anonymous>.exports.crearReservaBySlug (C:\\Users\\Krist
ian\\Desktop\\barber-saas\\backend\\src\\controllers\\public.controller.js:140:25
)'
      }

    [0m [90m 80 |[39m
     [90m 81 |[39m                 [90m// Non-transient error or max retries 
reached[39m
    [31m[1m>[22m[39m[90m 82 |[39m                 
console[33m.[39merror([32m`[Transaction] Failed: 
${operationName}`[39m[33m,[39m {
     [90m    |[39m                         [31m[1m^[22m[39m
     [90m 83 |[39m                     error[33m:[39m 
error[33m.[39mmessage[33m,[39m
     [90m 84 |[39m                     attempt[33m:[39m attempt [33m+[39m 
[35m1[39m[33m,[39m
     [90m 85 |[39m                     stack[33m:[39m 
error[33m.[39mstack[0m

      at Function.error [as executeInTransaction] 
(src/utils/TransactionManager.js:82:25)
      at CreateReserva.execute 
(src/application/use-cases/reservas/CreateReserva.js:26:34)
      at Object.<anonymous>.exports.crearReservaBySlug 
(src/controllers/public.controller.js:140:25)

    console.log
      [Transaction] Aborted: CreateReservation

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:69:29)

    console.error
      [Transaction] Failed: CreateReservation {
        error: `E11000 duplicate key error collection: test.reservas index: 
unique_reservation_slot dup key: { barberoId: 
ObjectId('698bdc3e626399f145648e26'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698bdc3e626399f145648e24') }`,
        attempt: 2,
        stack: `MongoServerError: E11000 duplicate key error collection: 
test.reservas index: unique_reservation_slot dup key: { barberoId: 
ObjectId('698bdc3e626399f145648e26'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698bdc3e626399f145648e24') }\n` +
          '    at InsertOneOperation.handleOk (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\node_modules\\mongodb\\src\\operations\\insert.ts:79:13)\n' +
          '    at tryOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\backen
d\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:294:26)\n' +
          '    at processTicksAndRejections 
(node:internal/process/task_queues:105:5)\n' +
          '    at executeOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\ba
ckend\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:123:12)\n' +
          '    at Collection.insertOne (C:\\Users\\Kristian\\Desktop\\barber-saas
\\backend\\node_modules\\mongodb\\src\\collection.ts:294:12)\n' +
          '    at model.$__save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backe
nd\\node_modules\\mongoose\\lib\\model.js:398:16)\n' +
          '    at model.save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\
\node_modules\\mongoose\\lib\\model.js:609:5)\n' +
          '    at C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\\node_module
s\\mongoose\\lib\\model.js:2722:9\n' +
          '    at async Promise.all (index 0)\n' +
          '    at Function.create (C:\\Users\\Kristian\\Desktop\\barber-saas\\bac
kend\\node_modules\\mongoose\\lib\\model.js:2707:11)\n' +
          '    at MongoReservaRepository.save (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\src\\infrastructure\\database\\mongodb\\repositories\\MongoRese
rvaRepository.js:15:16)\n' +
          '    at TransactionManager.executeInTransaction.operationName (C:\\User
s\\Kristian\\Desktop\\barber-saas\\backend\\src\\application\\use-cases\\reservas
\\CreateReserva.js:72:42)\n' +
          '    at Function.executeInTransaction (C:\\Users\\Kristian\\Desktop\\ba
rber-saas\\backend\\src\\utils\\TransactionManager.js:57:32)\n' +
          '    at CreateReserva.execute (C:\\Users\\Kristian\\Desktop\\barber-saa
s\\backend\\src\\application\\use-cases\\reservas\\CreateReserva.js:26:34)\n' +
          '    at Object.<anonymous>.exports.crearReservaBySlug (C:\\Users\\Krist
ian\\Desktop\\barber-saas\\backend\\src\\controllers\\public.controller.js:140:25
)'
      }

    [0m [90m 80 |[39m
     [90m 81 |[39m                 [90m// Non-transient error or max retries 
reached[39m
    [31m[1m>[22m[39m[90m 82 |[39m                 
console[33m.[39merror([32m`[Transaction] Failed: 
${operationName}`[39m[33m,[39m {
     [90m    |[39m                         [31m[1m^[22m[39m
     [90m 83 |[39m                     error[33m:[39m 
error[33m.[39mmessage[33m,[39m
     [90m 84 |[39m                     attempt[33m:[39m attempt [33m+[39m 
[35m1[39m[33m,[39m
     [90m 85 |[39m                     stack[33m:[39m 
error[33m.[39mstack[0m

      at Function.error [as executeInTransaction] 
(src/utils/TransactionManager.js:82:25)
      at CreateReserva.execute 
(src/application/use-cases/reservas/CreateReserva.js:26:34)
      at Object.<anonymous>.exports.crearReservaBySlug 
(src/controllers/public.controller.js:140:25)

    console.log
      [Transaction] Aborted: CreateReservation

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:69:29)

    console.error
      [Transaction] Failed: CreateReservation {
        error: `E11000 duplicate key error collection: test.reservas index: 
unique_reservation_slot dup key: { barberoId: 
ObjectId('698bdc3e626399f145648e26'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698bdc3e626399f145648e24') }`,
        attempt: 2,
        stack: `MongoServerError: E11000 duplicate key error collection: 
test.reservas index: unique_reservation_slot dup key: { barberoId: 
ObjectId('698bdc3e626399f145648e26'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698bdc3e626399f145648e24') }\n` +
          '    at InsertOneOperation.handleOk (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\node_modules\\mongodb\\src\\operations\\insert.ts:79:13)\n' +
          '    at tryOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\backen
d\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:294:26)\n' +
          '    at processTicksAndRejections 
(node:internal/process/task_queues:105:5)\n' +
          '    at executeOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\ba
ckend\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:123:12)\n' +
          '    at Collection.insertOne (C:\\Users\\Kristian\\Desktop\\barber-saas
\\backend\\node_modules\\mongodb\\src\\collection.ts:294:12)\n' +
          '    at model.$__save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backe
nd\\node_modules\\mongoose\\lib\\model.js:398:16)\n' +
          '    at model.save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\
\node_modules\\mongoose\\lib\\model.js:609:5)\n' +
          '    at C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\\node_module
s\\mongoose\\lib\\model.js:2722:9\n' +
          '    at async Promise.all (index 0)\n' +
          '    at Function.create (C:\\Users\\Kristian\\Desktop\\barber-saas\\bac
kend\\node_modules\\mongoose\\lib\\model.js:2707:11)\n' +
          '    at MongoReservaRepository.save (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\src\\infrastructure\\database\\mongodb\\repositories\\MongoRese
rvaRepository.js:15:16)\n' +
          '    at TransactionManager.executeInTransaction.operationName (C:\\User
s\\Kristian\\Desktop\\barber-saas\\backend\\src\\application\\use-cases\\reservas
\\CreateReserva.js:72:42)\n' +
          '    at Function.executeInTransaction (C:\\Users\\Kristian\\Desktop\\ba
rber-saas\\backend\\src\\utils\\TransactionManager.js:57:32)\n' +
          '    at CreateReserva.execute (C:\\Users\\Kristian\\Desktop\\barber-saa
s\\backend\\src\\application\\use-cases\\reservas\\CreateReserva.js:26:34)\n' +
          '    at Object.<anonymous>.exports.crearReservaBySlug (C:\\Users\\Krist
ian\\Desktop\\barber-saas\\backend\\src\\controllers\\public.controller.js:140:25
)'
      }

    [0m [90m 80 |[39m
     [90m 81 |[39m                 [90m// Non-transient error or max retries 
reached[39m
    [31m[1m>[22m[39m[90m 82 |[39m                 
console[33m.[39merror([32m`[Transaction] Failed: 
${operationName}`[39m[33m,[39m {
     [90m    |[39m                         [31m[1m^[22m[39m
     [90m 83 |[39m                     error[33m:[39m 
error[33m.[39mmessage[33m,[39m
     [90m 84 |[39m                     attempt[33m:[39m attempt [33m+[39m 
[35m1[39m[33m,[39m
     [90m 85 |[39m                     stack[33m:[39m 
error[33m.[39mstack[0m

      at Function.error [as executeInTransaction] 
(src/utils/TransactionManager.js:82:25)
      at CreateReserva.execute 
(src/application/use-cases/reservas/CreateReserva.js:26:34)
      at Object.<anonymous>.exports.crearReservaBySlug 
(src/controllers/public.controller.js:140:25)

    console.log
      [Transaction] Aborted: CreateReservation

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:69:29)

    console.error
      [Transaction] Failed: CreateReservation {
        error: `E11000 duplicate key error collection: test.reservas index: 
unique_reservation_slot dup key: { barberoId: 
ObjectId('698bdc3e626399f145648e26'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698bdc3e626399f145648e24') }`,
        attempt: 2,
        stack: `MongoServerError: E11000 duplicate key error collection: 
test.reservas index: unique_reservation_slot dup key: { barberoId: 
ObjectId('698bdc3e626399f145648e26'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698bdc3e626399f145648e24') }\n` +
          '    at InsertOneOperation.handleOk (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\node_modules\\mongodb\\src\\operations\\insert.ts:79:13)\n' +
          '    at tryOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\backen
d\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:294:26)\n' +
          '    at processTicksAndRejections 
(node:internal/process/task_queues:105:5)\n' +
          '    at executeOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\ba
ckend\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:123:12)\n' +
          '    at Collection.insertOne (C:\\Users\\Kristian\\Desktop\\barber-saas
\\backend\\node_modules\\mongodb\\src\\collection.ts:294:12)\n' +
          '    at model.$__save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backe
nd\\node_modules\\mongoose\\lib\\model.js:398:16)\n' +
          '    at model.save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\
\node_modules\\mongoose\\lib\\model.js:609:5)\n' +
          '    at C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\\node_module
s\\mongoose\\lib\\model.js:2722:9\n' +
          '    at async Promise.all (index 0)\n' +
          '    at Function.create (C:\\Users\\Kristian\\Desktop\\barber-saas\\bac
kend\\node_modules\\mongoose\\lib\\model.js:2707:11)\n' +
          '    at MongoReservaRepository.save (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\src\\infrastructure\\database\\mongodb\\repositories\\MongoRese
rvaRepository.js:15:16)\n' +
          '    at TransactionManager.executeInTransaction.operationName (C:\\User
s\\Kristian\\Desktop\\barber-saas\\backend\\src\\application\\use-cases\\reservas
\\CreateReserva.js:72:42)\n' +
          '    at Function.executeInTransaction (C:\\Users\\Kristian\\Desktop\\ba
rber-saas\\backend\\src\\utils\\TransactionManager.js:57:32)\n' +
          '    at CreateReserva.execute (C:\\Users\\Kristian\\Desktop\\barber-saa
s\\backend\\src\\application\\use-cases\\reservas\\CreateReserva.js:26:34)\n' +
          '    at Object.<anonymous>.exports.crearReservaBySlug (C:\\Users\\Krist
ian\\Desktop\\barber-saas\\backend\\src\\controllers\\public.controller.js:140:25
)'
      }

    [0m [90m 80 |[39m
     [90m 81 |[39m                 [90m// Non-transient error or max retries 
reached[39m
    [31m[1m>[22m[39m[90m 82 |[39m                 
console[33m.[39merror([32m`[Transaction] Failed: 
${operationName}`[39m[33m,[39m {
     [90m    |[39m                         [31m[1m^[22m[39m
     [90m 83 |[39m                     error[33m:[39m 
error[33m.[39mmessage[33m,[39m
     [90m 84 |[39m                     attempt[33m:[39m attempt [33m+[39m 
[35m1[39m[33m,[39m
     [90m 85 |[39m                     stack[33m:[39m 
error[33m.[39mstack[0m

      at Function.error [as executeInTransaction] 
(src/utils/TransactionManager.js:82:25)
      at CreateReserva.execute 
(src/application/use-cases/reservas/CreateReserva.js:26:34)
      at Object.<anonymous>.exports.crearReservaBySlug 
(src/controllers/public.controller.js:140:25)

    console.error
      ƒö┤ ERROR: TransactionError: Transaction failed for CreateReservation: 
E11000 duplicate key error collection: test.reservas index: 
unique_reservation_slot dup key: { barberoId: 
ObjectId('698bdc3e626399f145648e26'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698bdc3e626399f145648e24') }
          at Function.executeInTransaction (C:\Users\Kristian\Desktop\barber-saas
\backend\src\utils\TransactionManager.js:88:42)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at CreateReserva.execute (C:\Users\Kristian\Desktop\barber-saas\backend
\src\application\use-cases\reservas\CreateReserva.js:26:34)
          at Object.<anonymous>.exports.crearReservaBySlug (C:\Users\Kristian\Des
ktop\barber-saas\backend\src\controllers\public.controller.js:140:25) {
        isTransactionError: true,
        originalError: MongoServerError: E11000 duplicate key error collection: 
test.reservas index: unique_reservation_slot dup key: { barberoId: 
ObjectId('698bdc3e626399f145648e26'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698bdc3e626399f145648e24') }
            at InsertOneOperation.handleOk (C:\Users\Kristian\Desktop\barber-saas
\backend\node_modules\mongodb\src\operations\insert.ts:79:13)
            at tryOperation (C:\Users\Kristian\Desktop\barber-saas\backend\node_m
odules\mongodb\src\operations\execute_operation.ts:294:26)
            at processTicksAndRejections 
(node:internal/process/task_queues:105:5)
            at executeOperation (C:\Users\Kristian\Desktop\barber-saas\backend\no
de_modules\mongodb\src\operations\execute_operation.ts:123:12)
            at Collection.insertOne (C:\Users\Kristian\Desktop\barber-saas\backen
d\node_modules\mongodb\src\collection.ts:294:12)
            at model.$__save (C:\Users\Kristian\Desktop\barber-saas\backend\node_
modules\mongoose\lib\model.js:398:16)
            at model.save (C:\Users\Kristian\Desktop\barber-saas\backend\node_mod
ules\mongoose\lib\model.js:609:5)
            at C:\Users\Kristian\Desktop\barber-saas\backend\node_modules\mongoos
e\lib\model.js:2722:9
            at async Promise.all (index 0)
            at Function.create (C:\Users\Kristian\Desktop\barber-saas\backend\nod
e_modules\mongoose\lib\model.js:2707:11)
            at MongoReservaRepository.save (C:\Users\Kristian\Desktop\barber-saas
\backend\src\infrastructure\database\mongodb\repositories\MongoReservaRepository.
js:15:16)
            at TransactionManager.executeInTransaction.operationName (C:\Users\Kr
istian\Desktop\barber-saas\backend\src\application\use-cases\reservas\CreateReser
va.js:72:42)
            at Function.executeInTransaction (C:\Users\Kristian\Desktop\barber-sa
as\backend\src\utils\TransactionManager.js:57:32)
            at CreateReserva.execute (C:\Users\Kristian\Desktop\barber-saas\backe
nd\src\application\use-cases\reservas\CreateReserva.js:26:34)
            at Object.<anonymous>.exports.crearReservaBySlug (C:\Users\Kristian\D
esktop\barber-saas\backend\src\controllers\public.controller.js:140:25) {
          errorLabelSet: Set(0) {},
          errorResponse: {
            index: 0,
            code: 11000,
            errmsg: `E11000 duplicate key error collection: test.reservas index: 
unique_reservation_slot dup key: { barberoId: 
ObjectId('698bdc3e626399f145648e26'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698bdc3e626399f145648e24') }`,
            keyPattern: [Object],
            keyValue: [Object]
          },
          index: 0,
          code: 11000,
          keyPattern: { barberoId: 1, fecha: 1, hora: 1, barberiaId: 1 },
          keyValue: {
            barberoId: new ObjectId('698bdc3e626399f145648e26'),
            fecha: 2026-03-16T00:00:00.000Z,
            hora: '14:00',
            barberiaId: new ObjectId('698bdc3e626399f145648e24')
          }
        },
        context: { operationName: 'CreateReservation', attempt: 2 },
        timestamp: 2026-02-11T01:32:47.655Z,
        originalStack: `MongoServerError: E11000 duplicate key error collection: 
test.reservas index: unique_reservation_slot dup key: { barberoId: 
ObjectId('698bdc3e626399f145648e26'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698bdc3e626399f145648e24') }\n` +
          '    at InsertOneOperation.handleOk (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\node_modules\\mongodb\\src\\operations\\insert.ts:79:13)\n' +
          '    at tryOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\backen
d\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:294:26)\n' +
          '    at processTicksAndRejections 
(node:internal/process/task_queues:105:5)\n' +
          '    at executeOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\ba
ckend\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:123:12)\n' +
          '    at Collection.insertOne (C:\\Users\\Kristian\\Desktop\\barber-saas
\\backend\\node_modules\\mongodb\\src\\collection.ts:294:12)\n' +
          '    at model.$__save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backe
nd\\node_modules\\mongoose\\lib\\model.js:398:16)\n' +
          '    at model.save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\
\node_modules\\mongoose\\lib\\model.js:609:5)\n' +
          '    at C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\\node_module
s\\mongoose\\lib\\model.js:2722:9\n' +
          '    at async Promise.all (index 0)\n' +
          '    at Function.create (C:\\Users\\Kristian\\Desktop\\barber-saas\\bac
kend\\node_modules\\mongoose\\lib\\model.js:2707:11)\n' +
          '    at MongoReservaRepository.save (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\src\\infrastructure\\database\\mongodb\\repositories\\MongoRese
rvaRepository.js:15:16)\n' +
          '    at TransactionManager.executeInTransaction.operationName (C:\\User
s\\Kristian\\Desktop\\barber-saas\\backend\\src\\application\\use-cases\\reservas
\\CreateReserva.js:72:42)\n' +
          '    at Function.executeInTransaction (C:\\Users\\Kristian\\Desktop\\ba
rber-saas\\backend\\src\\utils\\TransactionManager.js:57:32)\n' +
          '    at CreateReserva.execute (C:\\Users\\Kristian\\Desktop\\barber-saa
s\\backend\\src\\application\\use-cases\\reservas\\CreateReserva.js:26:34)\n' +
          '    at Object.<anonymous>.exports.crearReservaBySlug (C:\\Users\\Krist
ian\\Desktop\\barber-saas\\backend\\src\\controllers\\public.controller.js:140:25
)'
      }

    [0m [90m 4 |[39m
     [90m 5 |[39m [36mconst[39m errorHandler [33m=[39m (err[33m,[39m 
req[33m,[39m res[33m,[39m next) [33m=>[39m {
    [31m[1m>[22m[39m[90m 6 |[39m   console[33m.[39merror([32m"ƒö┤ 
ERROR:"[39m[33m,[39m err)[33m;[39m
     [90m   |[39m           [31m[1m^[22m[39m
     [90m 7 |[39m
     [90m 8 |[39m   [90m// ­ƒöÑ A├æADIR HEADERS CORS SI NO EXISTEN[39m
     [90m 9 |[39m   [36mconst[39m origin [33m=[39m 
req[33m.[39mheaders[33m.[39morigin[33m;[39m[0m

      at error (src/config/middleware/errorHandler.js:6:11)
      at Layer.handleError (node_modules/router/lib/layer.js:116:17)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at Layer.handleError (node_modules/router/lib/layer.js:111:12)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at Immediate.next (node_modules/router/index.js:291:5)
      at Immediate._onImmediate (node_modules/router/index.js:688:15)

    console.error
      ƒö┤ ERROR: TransactionError: Transaction failed for CreateReservation: 
E11000 duplicate key error collection: test.reservas index: 
unique_reservation_slot dup key: { barberoId: 
ObjectId('698bdc3e626399f145648e26'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698bdc3e626399f145648e24') }
          at Function.executeInTransaction (C:\Users\Kristian\Desktop\barber-saas
\backend\src\utils\TransactionManager.js:88:42)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at CreateReserva.execute (C:\Users\Kristian\Desktop\barber-saas\backend
\src\application\use-cases\reservas\CreateReserva.js:26:34)
          at Object.<anonymous>.exports.crearReservaBySlug (C:\Users\Kristian\Des
ktop\barber-saas\backend\src\controllers\public.controller.js:140:25) {
        isTransactionError: true,
        originalError: MongoServerError: E11000 duplicate key error collection: 
test.reservas index: unique_reservation_slot dup key: { barberoId: 
ObjectId('698bdc3e626399f145648e26'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698bdc3e626399f145648e24') }
            at InsertOneOperation.handleOk (C:\Users\Kristian\Desktop\barber-saas
\backend\node_modules\mongodb\src\operations\insert.ts:79:13)
            at tryOperation (C:\Users\Kristian\Desktop\barber-saas\backend\node_m
odules\mongodb\src\operations\execute_operation.ts:294:26)
            at processTicksAndRejections 
(node:internal/process/task_queues:105:5)
            at executeOperation (C:\Users\Kristian\Desktop\barber-saas\backend\no
de_modules\mongodb\src\operations\execute_operation.ts:123:12)
            at Collection.insertOne (C:\Users\Kristian\Desktop\barber-saas\backen
d\node_modules\mongodb\src\collection.ts:294:12)
            at model.$__save (C:\Users\Kristian\Desktop\barber-saas\backend\node_
modules\mongoose\lib\model.js:398:16)
            at model.save (C:\Users\Kristian\Desktop\barber-saas\backend\node_mod
ules\mongoose\lib\model.js:609:5)
            at C:\Users\Kristian\Desktop\barber-saas\backend\node_modules\mongoos
e\lib\model.js:2722:9
            at async Promise.all (index 0)
            at Function.create (C:\Users\Kristian\Desktop\barber-saas\backend\nod
e_modules\mongoose\lib\model.js:2707:11)
            at MongoReservaRepository.save (C:\Users\Kristian\Desktop\barber-saas
\backend\src\infrastructure\database\mongodb\repositories\MongoReservaRepository.
js:15:16)
            at TransactionManager.executeInTransaction.operationName (C:\Users\Kr
istian\Desktop\barber-saas\backend\src\application\use-cases\reservas\CreateReser
va.js:72:42)
            at Function.executeInTransaction (C:\Users\Kristian\Desktop\barber-sa
as\backend\src\utils\TransactionManager.js:57:32)
            at CreateReserva.execute (C:\Users\Kristian\Desktop\barber-saas\backe
nd\src\application\use-cases\reservas\CreateReserva.js:26:34)
            at Object.<anonymous>.exports.crearReservaBySlug (C:\Users\Kristian\D
esktop\barber-saas\backend\src\controllers\public.controller.js:140:25) {
          errorLabelSet: Set(0) {},
          errorResponse: {
            index: 0,
            code: 11000,
            errmsg: `E11000 duplicate key error collection: test.reservas index: 
unique_reservation_slot dup key: { barberoId: 
ObjectId('698bdc3e626399f145648e26'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698bdc3e626399f145648e24') }`,
            keyPattern: [Object],
            keyValue: [Object]
          },
          index: 0,
          code: 11000,
          keyPattern: { barberoId: 1, fecha: 1, hora: 1, barberiaId: 1 },
          keyValue: {
            barberoId: new ObjectId('698bdc3e626399f145648e26'),
            fecha: 2026-03-16T00:00:00.000Z,
            hora: '14:00',
            barberiaId: new ObjectId('698bdc3e626399f145648e24')
          }
        },
        context: { operationName: 'CreateReservation', attempt: 2 },
        timestamp: 2026-02-11T01:32:47.656Z,
        originalStack: `MongoServerError: E11000 duplicate key error collection: 
test.reservas index: unique_reservation_slot dup key: { barberoId: 
ObjectId('698bdc3e626399f145648e26'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698bdc3e626399f145648e24') }\n` +
          '    at InsertOneOperation.handleOk (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\node_modules\\mongodb\\src\\operations\\insert.ts:79:13)\n' +
          '    at tryOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\backen
d\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:294:26)\n' +
          '    at processTicksAndRejections 
(node:internal/process/task_queues:105:5)\n' +
          '    at executeOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\ba
ckend\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:123:12)\n' +
          '    at Collection.insertOne (C:\\Users\\Kristian\\Desktop\\barber-saas
\\backend\\node_modules\\mongodb\\src\\collection.ts:294:12)\n' +
          '    at model.$__save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backe
nd\\node_modules\\mongoose\\lib\\model.js:398:16)\n' +
          '    at model.save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\
\node_modules\\mongoose\\lib\\model.js:609:5)\n' +
          '    at C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\\node_module
s\\mongoose\\lib\\model.js:2722:9\n' +
          '    at async Promise.all (index 0)\n' +
          '    at Function.create (C:\\Users\\Kristian\\Desktop\\barber-saas\\bac
kend\\node_modules\\mongoose\\lib\\model.js:2707:11)\n' +
          '    at MongoReservaRepository.save (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\src\\infrastructure\\database\\mongodb\\repositories\\MongoRese
rvaRepository.js:15:16)\n' +
          '    at TransactionManager.executeInTransaction.operationName (C:\\User
s\\Kristian\\Desktop\\barber-saas\\backend\\src\\application\\use-cases\\reservas
\\CreateReserva.js:72:42)\n' +
          '    at Function.executeInTransaction (C:\\Users\\Kristian\\Desktop\\ba
rber-saas\\backend\\src\\utils\\TransactionManager.js:57:32)\n' +
          '    at CreateReserva.execute (C:\\Users\\Kristian\\Desktop\\barber-saa
s\\backend\\src\\application\\use-cases\\reservas\\CreateReserva.js:26:34)\n' +
          '    at Object.<anonymous>.exports.crearReservaBySlug (C:\\Users\\Krist
ian\\Desktop\\barber-saas\\backend\\src\\controllers\\public.controller.js:140:25
)'
      }

    [0m [90m 4 |[39m
     [90m 5 |[39m [36mconst[39m errorHandler [33m=[39m (err[33m,[39m 
req[33m,[39m res[33m,[39m next) [33m=>[39m {
    [31m[1m>[22m[39m[90m 6 |[39m   console[33m.[39merror([32m"ƒö┤ 
ERROR:"[39m[33m,[39m err)[33m;[39m
     [90m   |[39m           [31m[1m^[22m[39m
     [90m 7 |[39m
     [90m 8 |[39m   [90m// ­ƒöÑ A├æADIR HEADERS CORS SI NO EXISTEN[39m
     [90m 9 |[39m   [36mconst[39m origin [33m=[39m 
req[33m.[39mheaders[33m.[39morigin[33m;[39m[0m

      at error (src/config/middleware/errorHandler.js:6:11)
      at Layer.handleError (node_modules/router/lib/layer.js:116:17)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at Layer.handleError (node_modules/router/lib/layer.js:111:12)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at Immediate.next (node_modules/router/index.js:291:5)
      at Immediate._onImmediate (node_modules/router/index.js:688:15)

    console.error
      ƒö┤ ERROR: TransactionError: Transaction failed for CreateReservation: 
E11000 duplicate key error collection: test.reservas index: 
unique_reservation_slot dup key: { barberoId: 
ObjectId('698bdc3e626399f145648e26'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698bdc3e626399f145648e24') }
          at Function.executeInTransaction (C:\Users\Kristian\Desktop\barber-saas
\backend\src\utils\TransactionManager.js:88:42)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at CreateReserva.execute (C:\Users\Kristian\Desktop\barber-saas\backend
\src\application\use-cases\reservas\CreateReserva.js:26:34)
          at Object.<anonymous>.exports.crearReservaBySlug (C:\Users\Kristian\Des
ktop\barber-saas\backend\src\controllers\public.controller.js:140:25) {
        isTransactionError: true,
        originalError: MongoServerError: E11000 duplicate key error collection: 
test.reservas index: unique_reservation_slot dup key: { barberoId: 
ObjectId('698bdc3e626399f145648e26'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698bdc3e626399f145648e24') }
            at InsertOneOperation.handleOk (C:\Users\Kristian\Desktop\barber-saas
\backend\node_modules\mongodb\src\operations\insert.ts:79:13)
            at tryOperation (C:\Users\Kristian\Desktop\barber-saas\backend\node_m
odules\mongodb\src\operations\execute_operation.ts:294:26)
            at processTicksAndRejections 
(node:internal/process/task_queues:105:5)
            at executeOperation (C:\Users\Kristian\Desktop\barber-saas\backend\no
de_modules\mongodb\src\operations\execute_operation.ts:123:12)
            at Collection.insertOne (C:\Users\Kristian\Desktop\barber-saas\backen
d\node_modules\mongodb\src\collection.ts:294:12)
            at model.$__save (C:\Users\Kristian\Desktop\barber-saas\backend\node_
modules\mongoose\lib\model.js:398:16)
            at model.save (C:\Users\Kristian\Desktop\barber-saas\backend\node_mod
ules\mongoose\lib\model.js:609:5)
            at C:\Users\Kristian\Desktop\barber-saas\backend\node_modules\mongoos
e\lib\model.js:2722:9
            at async Promise.all (index 0)
            at Function.create (C:\Users\Kristian\Desktop\barber-saas\backend\nod
e_modules\mongoose\lib\model.js:2707:11)
            at MongoReservaRepository.save (C:\Users\Kristian\Desktop\barber-saas
\backend\src\infrastructure\database\mongodb\repositories\MongoReservaRepository.
js:15:16)
            at TransactionManager.executeInTransaction.operationName (C:\Users\Kr
istian\Desktop\barber-saas\backend\src\application\use-cases\reservas\CreateReser
va.js:72:42)
            at Function.executeInTransaction (C:\Users\Kristian\Desktop\barber-sa
as\backend\src\utils\TransactionManager.js:57:32)
            at CreateReserva.execute (C:\Users\Kristian\Desktop\barber-saas\backe
nd\src\application\use-cases\reservas\CreateReserva.js:26:34)
            at Object.<anonymous>.exports.crearReservaBySlug (C:\Users\Kristian\D
esktop\barber-saas\backend\src\controllers\public.controller.js:140:25) {
          errorLabelSet: Set(0) {},
          errorResponse: {
            index: 0,
            code: 11000,
            errmsg: `E11000 duplicate key error collection: test.reservas index: 
unique_reservation_slot dup key: { barberoId: 
ObjectId('698bdc3e626399f145648e26'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698bdc3e626399f145648e24') }`,
            keyPattern: [Object],
            keyValue: [Object]
          },
          index: 0,
          code: 11000,
          keyPattern: { barberoId: 1, fecha: 1, hora: 1, barberiaId: 1 },
          keyValue: {
            barberoId: new ObjectId('698bdc3e626399f145648e26'),
            fecha: 2026-03-16T00:00:00.000Z,
            hora: '14:00',
            barberiaId: new ObjectId('698bdc3e626399f145648e24')
          }
        },
        context: { operationName: 'CreateReservation', attempt: 2 },
        timestamp: 2026-02-11T01:32:47.657Z,
        originalStack: `MongoServerError: E11000 duplicate key error collection: 
test.reservas index: unique_reservation_slot dup key: { barberoId: 
ObjectId('698bdc3e626399f145648e26'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698bdc3e626399f145648e24') }\n` +
          '    at InsertOneOperation.handleOk (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\node_modules\\mongodb\\src\\operations\\insert.ts:79:13)\n' +
          '    at tryOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\backen
d\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:294:26)\n' +
          '    at processTicksAndRejections 
(node:internal/process/task_queues:105:5)\n' +
          '    at executeOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\ba
ckend\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:123:12)\n' +
          '    at Collection.insertOne (C:\\Users\\Kristian\\Desktop\\barber-saas
\\backend\\node_modules\\mongodb\\src\\collection.ts:294:12)\n' +
          '    at model.$__save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backe
nd\\node_modules\\mongoose\\lib\\model.js:398:16)\n' +
          '    at model.save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\
\node_modules\\mongoose\\lib\\model.js:609:5)\n' +
          '    at C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\\node_module
s\\mongoose\\lib\\model.js:2722:9\n' +
          '    at async Promise.all (index 0)\n' +
          '    at Function.create (C:\\Users\\Kristian\\Desktop\\barber-saas\\bac
kend\\node_modules\\mongoose\\lib\\model.js:2707:11)\n' +
          '    at MongoReservaRepository.save (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\src\\infrastructure\\database\\mongodb\\repositories\\MongoRese
rvaRepository.js:15:16)\n' +
          '    at TransactionManager.executeInTransaction.operationName (C:\\User
s\\Kristian\\Desktop\\barber-saas\\backend\\src\\application\\use-cases\\reservas
\\CreateReserva.js:72:42)\n' +
          '    at Function.executeInTransaction (C:\\Users\\Kristian\\Desktop\\ba
rber-saas\\backend\\src\\utils\\TransactionManager.js:57:32)\n' +
          '    at CreateReserva.execute (C:\\Users\\Kristian\\Desktop\\barber-saa
s\\backend\\src\\application\\use-cases\\reservas\\CreateReserva.js:26:34)\n' +
          '    at Object.<anonymous>.exports.crearReservaBySlug (C:\\Users\\Krist
ian\\Desktop\\barber-saas\\backend\\src\\controllers\\public.controller.js:140:25
)'
      }

    [0m [90m 4 |[39m
     [90m 5 |[39m [36mconst[39m errorHandler [33m=[39m (err[33m,[39m 
req[33m,[39m res[33m,[39m next) [33m=>[39m {
    [31m[1m>[22m[39m[90m 6 |[39m   console[33m.[39merror([32m"ƒö┤ 
ERROR:"[39m[33m,[39m err)[33m;[39m
     [90m   |[39m           [31m[1m^[22m[39m
     [90m 7 |[39m
     [90m 8 |[39m   [90m// ­ƒöÑ A├æADIR HEADERS CORS SI NO EXISTEN[39m
     [90m 9 |[39m   [36mconst[39m origin [33m=[39m 
req[33m.[39mheaders[33m.[39morigin[33m;[39m[0m

      at error (src/config/middleware/errorHandler.js:6:11)
      at Layer.handleError (node_modules/router/lib/layer.js:116:17)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at Layer.handleError (node_modules/router/lib/layer.js:111:12)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at Immediate.next (node_modules/router/index.js:291:5)
      at Immediate._onImmediate (node_modules/router/index.js:688:15)

    console.error
      ƒö┤ ERROR: TransactionError: Transaction failed for CreateReservation: 
E11000 duplicate key error collection: test.reservas index: 
unique_reservation_slot dup key: { barberoId: 
ObjectId('698bdc3e626399f145648e26'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698bdc3e626399f145648e24') }
          at Function.executeInTransaction (C:\Users\Kristian\Desktop\barber-saas
\backend\src\utils\TransactionManager.js:88:42)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at CreateReserva.execute (C:\Users\Kristian\Desktop\barber-saas\backend
\src\application\use-cases\reservas\CreateReserva.js:26:34)
          at Object.<anonymous>.exports.crearReservaBySlug (C:\Users\Kristian\Des
ktop\barber-saas\backend\src\controllers\public.controller.js:140:25) {
        isTransactionError: true,
        originalError: MongoServerError: E11000 duplicate key error collection: 
test.reservas index: unique_reservation_slot dup key: { barberoId: 
ObjectId('698bdc3e626399f145648e26'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698bdc3e626399f145648e24') }
            at InsertOneOperation.handleOk (C:\Users\Kristian\Desktop\barber-saas
\backend\node_modules\mongodb\src\operations\insert.ts:79:13)
            at tryOperation (C:\Users\Kristian\Desktop\barber-saas\backend\node_m
odules\mongodb\src\operations\execute_operation.ts:294:26)
            at processTicksAndRejections 
(node:internal/process/task_queues:105:5)
            at executeOperation (C:\Users\Kristian\Desktop\barber-saas\backend\no
de_modules\mongodb\src\operations\execute_operation.ts:123:12)
            at Collection.insertOne (C:\Users\Kristian\Desktop\barber-saas\backen
d\node_modules\mongodb\src\collection.ts:294:12)
            at model.$__save (C:\Users\Kristian\Desktop\barber-saas\backend\node_
modules\mongoose\lib\model.js:398:16)
            at model.save (C:\Users\Kristian\Desktop\barber-saas\backend\node_mod
ules\mongoose\lib\model.js:609:5)
            at C:\Users\Kristian\Desktop\barber-saas\backend\node_modules\mongoos
e\lib\model.js:2722:9
            at async Promise.all (index 0)
            at Function.create (C:\Users\Kristian\Desktop\barber-saas\backend\nod
e_modules\mongoose\lib\model.js:2707:11)
            at MongoReservaRepository.save (C:\Users\Kristian\Desktop\barber-saas
\backend\src\infrastructure\database\mongodb\repositories\MongoReservaRepository.
js:15:16)
            at TransactionManager.executeInTransaction.operationName (C:\Users\Kr
istian\Desktop\barber-saas\backend\src\application\use-cases\reservas\CreateReser
va.js:72:42)
            at Function.executeInTransaction (C:\Users\Kristian\Desktop\barber-sa
as\backend\src\utils\TransactionManager.js:57:32)
            at CreateReserva.execute (C:\Users\Kristian\Desktop\barber-saas\backe
nd\src\application\use-cases\reservas\CreateReserva.js:26:34)
            at Object.<anonymous>.exports.crearReservaBySlug (C:\Users\Kristian\D
esktop\barber-saas\backend\src\controllers\public.controller.js:140:25) {
          errorLabelSet: Set(0) {},
          errorResponse: {
            index: 0,
            code: 11000,
            errmsg: `E11000 duplicate key error collection: test.reservas index: 
unique_reservation_slot dup key: { barberoId: 
ObjectId('698bdc3e626399f145648e26'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698bdc3e626399f145648e24') }`,
            keyPattern: [Object],
            keyValue: [Object]
          },
          index: 0,
          code: 11000,
          keyPattern: { barberoId: 1, fecha: 1, hora: 1, barberiaId: 1 },
          keyValue: {
            barberoId: new ObjectId('698bdc3e626399f145648e26'),
            fecha: 2026-03-16T00:00:00.000Z,
            hora: '14:00',
            barberiaId: new ObjectId('698bdc3e626399f145648e24')
          }
        },
        context: { operationName: 'CreateReservation', attempt: 2 },
        timestamp: 2026-02-11T01:32:47.659Z,
        originalStack: `MongoServerError: E11000 duplicate key error collection: 
test.reservas index: unique_reservation_slot dup key: { barberoId: 
ObjectId('698bdc3e626399f145648e26'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698bdc3e626399f145648e24') }\n` +
          '    at InsertOneOperation.handleOk (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\node_modules\\mongodb\\src\\operations\\insert.ts:79:13)\n' +
          '    at tryOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\backen
d\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:294:26)\n' +
          '    at processTicksAndRejections 
(node:internal/process/task_queues:105:5)\n' +
          '    at executeOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\ba
ckend\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:123:12)\n' +
          '    at Collection.insertOne (C:\\Users\\Kristian\\Desktop\\barber-saas
\\backend\\node_modules\\mongodb\\src\\collection.ts:294:12)\n' +
          '    at model.$__save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backe
nd\\node_modules\\mongoose\\lib\\model.js:398:16)\n' +
          '    at model.save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\
\node_modules\\mongoose\\lib\\model.js:609:5)\n' +
          '    at C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\\node_module
s\\mongoose\\lib\\model.js:2722:9\n' +
          '    at async Promise.all (index 0)\n' +
          '    at Function.create (C:\\Users\\Kristian\\Desktop\\barber-saas\\bac
kend\\node_modules\\mongoose\\lib\\model.js:2707:11)\n' +
          '    at MongoReservaRepository.save (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\src\\infrastructure\\database\\mongodb\\repositories\\MongoRese
rvaRepository.js:15:16)\n' +
          '    at TransactionManager.executeInTransaction.operationName (C:\\User
s\\Kristian\\Desktop\\barber-saas\\backend\\src\\application\\use-cases\\reservas
\\CreateReserva.js:72:42)\n' +
          '    at Function.executeInTransaction (C:\\Users\\Kristian\\Desktop\\ba
rber-saas\\backend\\src\\utils\\TransactionManager.js:57:32)\n' +
          '    at CreateReserva.execute (C:\\Users\\Kristian\\Desktop\\barber-saa
s\\backend\\src\\application\\use-cases\\reservas\\CreateReserva.js:26:34)\n' +
          '    at Object.<anonymous>.exports.crearReservaBySlug (C:\\Users\\Krist
ian\\Desktop\\barber-saas\\backend\\src\\controllers\\public.controller.js:140:25
)'
      }

    [0m [90m 4 |[39m
     [90m 5 |[39m [36mconst[39m errorHandler [33m=[39m (err[33m,[39m 
req[33m,[39m res[33m,[39m next) [33m=>[39m {
    [31m[1m>[22m[39m[90m 6 |[39m   console[33m.[39merror([32m"ƒö┤ 
ERROR:"[39m[33m,[39m err)[33m;[39m
     [90m   |[39m           [31m[1m^[22m[39m
     [90m 7 |[39m
     [90m 8 |[39m   [90m// ­ƒöÑ A├æADIR HEADERS CORS SI NO EXISTEN[39m
     [90m 9 |[39m   [36mconst[39m origin [33m=[39m 
req[33m.[39mheaders[33m.[39morigin[33m;[39m[0m

      at error (src/config/middleware/errorHandler.js:6:11)
      at Layer.handleError (node_modules/router/lib/layer.js:116:17)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at Layer.handleError (node_modules/router/lib/layer.js:111:12)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at Immediate.next (node_modules/router/index.js:291:5)
      at Immediate._onImmediate (node_modules/router/index.js:688:15)

    console.error
      ƒö┤ ERROR: TransactionError: Transaction failed for CreateReservation: 
E11000 duplicate key error collection: test.reservas index: 
unique_reservation_slot dup key: { barberoId: 
ObjectId('698bdc3e626399f145648e26'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698bdc3e626399f145648e24') }
          at Function.executeInTransaction (C:\Users\Kristian\Desktop\barber-saas
\backend\src\utils\TransactionManager.js:88:42)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at CreateReserva.execute (C:\Users\Kristian\Desktop\barber-saas\backend
\src\application\use-cases\reservas\CreateReserva.js:26:34)
          at Object.<anonymous>.exports.crearReservaBySlug (C:\Users\Kristian\Des
ktop\barber-saas\backend\src\controllers\public.controller.js:140:25) {
        isTransactionError: true,
        originalError: MongoServerError: E11000 duplicate key error collection: 
test.reservas index: unique_reservation_slot dup key: { barberoId: 
ObjectId('698bdc3e626399f145648e26'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698bdc3e626399f145648e24') }
            at InsertOneOperation.handleOk (C:\Users\Kristian\Desktop\barber-saas
\backend\node_modules\mongodb\src\operations\insert.ts:79:13)
            at tryOperation (C:\Users\Kristian\Desktop\barber-saas\backend\node_m
odules\mongodb\src\operations\execute_operation.ts:294:26)
            at processTicksAndRejections 
(node:internal/process/task_queues:105:5)
            at executeOperation (C:\Users\Kristian\Desktop\barber-saas\backend\no
de_modules\mongodb\src\operations\execute_operation.ts:123:12)
            at Collection.insertOne (C:\Users\Kristian\Desktop\barber-saas\backen
d\node_modules\mongodb\src\collection.ts:294:12)
            at model.$__save (C:\Users\Kristian\Desktop\barber-saas\backend\node_
modules\mongoose\lib\model.js:398:16)
            at model.save (C:\Users\Kristian\Desktop\barber-saas\backend\node_mod
ules\mongoose\lib\model.js:609:5)
            at C:\Users\Kristian\Desktop\barber-saas\backend\node_modules\mongoos
e\lib\model.js:2722:9
            at async Promise.all (index 0)
            at Function.create (C:\Users\Kristian\Desktop\barber-saas\backend\nod
e_modules\mongoose\lib\model.js:2707:11)
            at MongoReservaRepository.save (C:\Users\Kristian\Desktop\barber-saas
\backend\src\infrastructure\database\mongodb\repositories\MongoReservaRepository.
js:15:16)
            at TransactionManager.executeInTransaction.operationName (C:\Users\Kr
istian\Desktop\barber-saas\backend\src\application\use-cases\reservas\CreateReser
va.js:72:42)
            at Function.executeInTransaction (C:\Users\Kristian\Desktop\barber-sa
as\backend\src\utils\TransactionManager.js:57:32)
            at CreateReserva.execute (C:\Users\Kristian\Desktop\barber-saas\backe
nd\src\application\use-cases\reservas\CreateReserva.js:26:34)
            at Object.<anonymous>.exports.crearReservaBySlug (C:\Users\Kristian\D
esktop\barber-saas\backend\src\controllers\public.controller.js:140:25) {
          errorLabelSet: Set(0) {},
          errorResponse: {
            index: 0,
            code: 11000,
            errmsg: `E11000 duplicate key error collection: test.reservas index: 
unique_reservation_slot dup key: { barberoId: 
ObjectId('698bdc3e626399f145648e26'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698bdc3e626399f145648e24') }`,
            keyPattern: [Object],
            keyValue: [Object]
          },
          index: 0,
          code: 11000,
          keyPattern: { barberoId: 1, fecha: 1, hora: 1, barberiaId: 1 },
          keyValue: {
            barberoId: new ObjectId('698bdc3e626399f145648e26'),
            fecha: 2026-03-16T00:00:00.000Z,
            hora: '14:00',
            barberiaId: new ObjectId('698bdc3e626399f145648e24')
          }
        },
        context: { operationName: 'CreateReservation', attempt: 2 },
        timestamp: 2026-02-11T01:32:47.661Z,
        originalStack: `MongoServerError: E11000 duplicate key error collection: 
test.reservas index: unique_reservation_slot dup key: { barberoId: 
ObjectId('698bdc3e626399f145648e26'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698bdc3e626399f145648e24') }\n` +
          '    at InsertOneOperation.handleOk (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\node_modules\\mongodb\\src\\operations\\insert.ts:79:13)\n' +
          '    at tryOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\backen
d\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:294:26)\n' +
          '    at processTicksAndRejections 
(node:internal/process/task_queues:105:5)\n' +
          '    at executeOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\ba
ckend\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:123:12)\n' +
          '    at Collection.insertOne (C:\\Users\\Kristian\\Desktop\\barber-saas
\\backend\\node_modules\\mongodb\\src\\collection.ts:294:12)\n' +
          '    at model.$__save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backe
nd\\node_modules\\mongoose\\lib\\model.js:398:16)\n' +
          '    at model.save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\
\node_modules\\mongoose\\lib\\model.js:609:5)\n' +
          '    at C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\\node_module
s\\mongoose\\lib\\model.js:2722:9\n' +
          '    at async Promise.all (index 0)\n' +
          '    at Function.create (C:\\Users\\Kristian\\Desktop\\barber-saas\\bac
kend\\node_modules\\mongoose\\lib\\model.js:2707:11)\n' +
          '    at MongoReservaRepository.save (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\src\\infrastructure\\database\\mongodb\\repositories\\MongoRese
rvaRepository.js:15:16)\n' +
          '    at TransactionManager.executeInTransaction.operationName (C:\\User
s\\Kristian\\Desktop\\barber-saas\\backend\\src\\application\\use-cases\\reservas
\\CreateReserva.js:72:42)\n' +
          '    at Function.executeInTransaction (C:\\Users\\Kristian\\Desktop\\ba
rber-saas\\backend\\src\\utils\\TransactionManager.js:57:32)\n' +
          '    at CreateReserva.execute (C:\\Users\\Kristian\\Desktop\\barber-saa
s\\backend\\src\\application\\use-cases\\reservas\\CreateReserva.js:26:34)\n' +
          '    at Object.<anonymous>.exports.crearReservaBySlug (C:\\Users\\Krist
ian\\Desktop\\barber-saas\\backend\\src\\controllers\\public.controller.js:140:25
)'
      }

    [0m [90m 4 |[39m
     [90m 5 |[39m [36mconst[39m errorHandler [33m=[39m (err[33m,[39m 
req[33m,[39m res[33m,[39m next) [33m=>[39m {
    [31m[1m>[22m[39m[90m 6 |[39m   console[33m.[39merror([32m"ƒö┤ 
ERROR:"[39m[33m,[39m err)[33m;[39m
     [90m   |[39m           [31m[1m^[22m[39m
     [90m 7 |[39m
     [90m 8 |[39m   [90m// ­ƒöÑ A├æADIR HEADERS CORS SI NO EXISTEN[39m
     [90m 9 |[39m   [36mconst[39m origin [33m=[39m 
req[33m.[39mheaders[33m.[39morigin[33m;[39m[0m

      at error (src/config/middleware/errorHandler.js:6:11)
      at Layer.handleError (node_modules/router/lib/layer.js:116:17)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at Layer.handleError (node_modules/router/lib/layer.js:111:12)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at Immediate.next (node_modules/router/index.js:291:5)
      at Immediate._onImmediate (node_modules/router/index.js:688:15)

    console.error
      ƒö┤ ERROR: TransactionError: Transaction failed for CreateReservation: 
E11000 duplicate key error collection: test.reservas index: 
unique_reservation_slot dup key: { barberoId: 
ObjectId('698bdc3e626399f145648e26'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698bdc3e626399f145648e24') }
          at Function.executeInTransaction (C:\Users\Kristian\Desktop\barber-saas
\backend\src\utils\TransactionManager.js:88:42)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at CreateReserva.execute (C:\Users\Kristian\Desktop\barber-saas\backend
\src\application\use-cases\reservas\CreateReserva.js:26:34)
          at Object.<anonymous>.exports.crearReservaBySlug (C:\Users\Kristian\Des
ktop\barber-saas\backend\src\controllers\public.controller.js:140:25) {
        isTransactionError: true,
        originalError: MongoServerError: E11000 duplicate key error collection: 
test.reservas index: unique_reservation_slot dup key: { barberoId: 
ObjectId('698bdc3e626399f145648e26'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698bdc3e626399f145648e24') }
            at InsertOneOperation.handleOk (C:\Users\Kristian\Desktop\barber-saas
\backend\node_modules\mongodb\src\operations\insert.ts:79:13)
            at tryOperation (C:\Users\Kristian\Desktop\barber-saas\backend\node_m
odules\mongodb\src\operations\execute_operation.ts:294:26)
            at processTicksAndRejections 
(node:internal/process/task_queues:105:5)
            at executeOperation (C:\Users\Kristian\Desktop\barber-saas\backend\no
de_modules\mongodb\src\operations\execute_operation.ts:123:12)
            at Collection.insertOne (C:\Users\Kristian\Desktop\barber-saas\backen
d\node_modules\mongodb\src\collection.ts:294:12)
            at model.$__save (C:\Users\Kristian\Desktop\barber-saas\backend\node_
modules\mongoose\lib\model.js:398:16)
            at model.save (C:\Users\Kristian\Desktop\barber-saas\backend\node_mod
ules\mongoose\lib\model.js:609:5)
            at C:\Users\Kristian\Desktop\barber-saas\backend\node_modules\mongoos
e\lib\model.js:2722:9
            at async Promise.all (index 0)
            at Function.create (C:\Users\Kristian\Desktop\barber-saas\backend\nod
e_modules\mongoose\lib\model.js:2707:11)
            at MongoReservaRepository.save (C:\Users\Kristian\Desktop\barber-saas
\backend\src\infrastructure\database\mongodb\repositories\MongoReservaRepository.
js:15:16)
            at TransactionManager.executeInTransaction.operationName (C:\Users\Kr
istian\Desktop\barber-saas\backend\src\application\use-cases\reservas\CreateReser
va.js:72:42)
            at Function.executeInTransaction (C:\Users\Kristian\Desktop\barber-sa
as\backend\src\utils\TransactionManager.js:57:32)
            at CreateReserva.execute (C:\Users\Kristian\Desktop\barber-saas\backe
nd\src\application\use-cases\reservas\CreateReserva.js:26:34)
            at Object.<anonymous>.exports.crearReservaBySlug (C:\Users\Kristian\D
esktop\barber-saas\backend\src\controllers\public.controller.js:140:25) {
          errorLabelSet: Set(0) {},
          errorResponse: {
            index: 0,
            code: 11000,
            errmsg: `E11000 duplicate key error collection: test.reservas index: 
unique_reservation_slot dup key: { barberoId: 
ObjectId('698bdc3e626399f145648e26'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698bdc3e626399f145648e24') }`,
            keyPattern: [Object],
            keyValue: [Object]
          },
          index: 0,
          code: 11000,
          keyPattern: { barberoId: 1, fecha: 1, hora: 1, barberiaId: 1 },
          keyValue: {
            barberoId: new ObjectId('698bdc3e626399f145648e26'),
            fecha: 2026-03-16T00:00:00.000Z,
            hora: '14:00',
            barberiaId: new ObjectId('698bdc3e626399f145648e24')
          }
        },
        context: { operationName: 'CreateReservation', attempt: 2 },
        timestamp: 2026-02-11T01:32:47.666Z,
        originalStack: `MongoServerError: E11000 duplicate key error collection: 
test.reservas index: unique_reservation_slot dup key: { barberoId: 
ObjectId('698bdc3e626399f145648e26'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698bdc3e626399f145648e24') }\n` +
          '    at InsertOneOperation.handleOk (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\node_modules\\mongodb\\src\\operations\\insert.ts:79:13)\n' +
          '    at tryOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\backen
d\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:294:26)\n' +
          '    at processTicksAndRejections 
(node:internal/process/task_queues:105:5)\n' +
          '    at executeOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\ba
ckend\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:123:12)\n' +
          '    at Collection.insertOne (C:\\Users\\Kristian\\Desktop\\barber-saas
\\backend\\node_modules\\mongodb\\src\\collection.ts:294:12)\n' +
          '    at model.$__save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backe
nd\\node_modules\\mongoose\\lib\\model.js:398:16)\n' +
          '    at model.save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\
\node_modules\\mongoose\\lib\\model.js:609:5)\n' +
          '    at C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\\node_module
s\\mongoose\\lib\\model.js:2722:9\n' +
          '    at async Promise.all (index 0)\n' +
          '    at Function.create (C:\\Users\\Kristian\\Desktop\\barber-saas\\bac
kend\\node_modules\\mongoose\\lib\\model.js:2707:11)\n' +
          '    at MongoReservaRepository.save (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\src\\infrastructure\\database\\mongodb\\repositories\\MongoRese
rvaRepository.js:15:16)\n' +
          '    at TransactionManager.executeInTransaction.operationName (C:\\User
s\\Kristian\\Desktop\\barber-saas\\backend\\src\\application\\use-cases\\reservas
\\CreateReserva.js:72:42)\n' +
          '    at Function.executeInTransaction (C:\\Users\\Kristian\\Desktop\\ba
rber-saas\\backend\\src\\utils\\TransactionManager.js:57:32)\n' +
          '    at CreateReserva.execute (C:\\Users\\Kristian\\Desktop\\barber-saa
s\\backend\\src\\application\\use-cases\\reservas\\CreateReserva.js:26:34)\n' +
          '    at Object.<anonymous>.exports.crearReservaBySlug (C:\\Users\\Krist
ian\\Desktop\\barber-saas\\backend\\src\\controllers\\public.controller.js:140:25
)'
      }

    [0m [90m 4 |[39m
     [90m 5 |[39m [36mconst[39m errorHandler [33m=[39m (err[33m,[39m 
req[33m,[39m res[33m,[39m next) [33m=>[39m {
    [31m[1m>[22m[39m[90m 6 |[39m   console[33m.[39merror([32m"ƒö┤ 
ERROR:"[39m[33m,[39m err)[33m;[39m
     [90m   |[39m           [31m[1m^[22m[39m
     [90m 7 |[39m
     [90m 8 |[39m   [90m// ­ƒöÑ A├æADIR HEADERS CORS SI NO EXISTEN[39m
     [90m 9 |[39m   [36mconst[39m origin [33m=[39m 
req[33m.[39mheaders[33m.[39morigin[33m;[39m[0m

      at error (src/config/middleware/errorHandler.js:6:11)
      at Layer.handleError (node_modules/router/lib/layer.js:116:17)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at Layer.handleError (node_modules/router/lib/layer.js:111:12)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at Immediate.next (node_modules/router/index.js:291:5)
      at Immediate._onImmediate (node_modules/router/index.js:688:15)

    console.error
      ƒö┤ ERROR: TransactionError: Transaction failed for CreateReservation: 
E11000 duplicate key error collection: test.reservas index: 
unique_reservation_slot dup key: { barberoId: 
ObjectId('698bdc3e626399f145648e26'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698bdc3e626399f145648e24') }
          at Function.executeInTransaction (C:\Users\Kristian\Desktop\barber-saas
\backend\src\utils\TransactionManager.js:88:42)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at CreateReserva.execute (C:\Users\Kristian\Desktop\barber-saas\backend
\src\application\use-cases\reservas\CreateReserva.js:26:34)
          at Object.<anonymous>.exports.crearReservaBySlug (C:\Users\Kristian\Des
ktop\barber-saas\backend\src\controllers\public.controller.js:140:25) {
        isTransactionError: true,
        originalError: MongoServerError: E11000 duplicate key error collection: 
test.reservas index: unique_reservation_slot dup key: { barberoId: 
ObjectId('698bdc3e626399f145648e26'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698bdc3e626399f145648e24') }
            at InsertOneOperation.handleOk (C:\Users\Kristian\Desktop\barber-saas
\backend\node_modules\mongodb\src\operations\insert.ts:79:13)
            at tryOperation (C:\Users\Kristian\Desktop\barber-saas\backend\node_m
odules\mongodb\src\operations\execute_operation.ts:294:26)
            at processTicksAndRejections 
(node:internal/process/task_queues:105:5)
            at executeOperation (C:\Users\Kristian\Desktop\barber-saas\backend\no
de_modules\mongodb\src\operations\execute_operation.ts:123:12)
            at Collection.insertOne (C:\Users\Kristian\Desktop\barber-saas\backen
d\node_modules\mongodb\src\collection.ts:294:12)
            at model.$__save (C:\Users\Kristian\Desktop\barber-saas\backend\node_
modules\mongoose\lib\model.js:398:16)
            at model.save (C:\Users\Kristian\Desktop\barber-saas\backend\node_mod
ules\mongoose\lib\model.js:609:5)
            at C:\Users\Kristian\Desktop\barber-saas\backend\node_modules\mongoos
e\lib\model.js:2722:9
            at async Promise.all (index 0)
            at Function.create (C:\Users\Kristian\Desktop\barber-saas\backend\nod
e_modules\mongoose\lib\model.js:2707:11)
            at MongoReservaRepository.save (C:\Users\Kristian\Desktop\barber-saas
\backend\src\infrastructure\database\mongodb\repositories\MongoReservaRepository.
js:15:16)
            at TransactionManager.executeInTransaction.operationName (C:\Users\Kr
istian\Desktop\barber-saas\backend\src\application\use-cases\reservas\CreateReser
va.js:72:42)
            at Function.executeInTransaction (C:\Users\Kristian\Desktop\barber-sa
as\backend\src\utils\TransactionManager.js:57:32)
            at CreateReserva.execute (C:\Users\Kristian\Desktop\barber-saas\backe
nd\src\application\use-cases\reservas\CreateReserva.js:26:34)
            at Object.<anonymous>.exports.crearReservaBySlug (C:\Users\Kristian\D
esktop\barber-saas\backend\src\controllers\public.controller.js:140:25) {
          errorLabelSet: Set(0) {},
          errorResponse: {
            index: 0,
            code: 11000,
            errmsg: `E11000 duplicate key error collection: test.reservas index: 
unique_reservation_slot dup key: { barberoId: 
ObjectId('698bdc3e626399f145648e26'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698bdc3e626399f145648e24') }`,
            keyPattern: [Object],
            keyValue: [Object]
          },
          index: 0,
          code: 11000,
          keyPattern: { barberoId: 1, fecha: 1, hora: 1, barberiaId: 1 },
          keyValue: {
            barberoId: new ObjectId('698bdc3e626399f145648e26'),
            fecha: 2026-03-16T00:00:00.000Z,
            hora: '14:00',
            barberiaId: new ObjectId('698bdc3e626399f145648e24')
          }
        },
        context: { operationName: 'CreateReservation', attempt: 2 },
        timestamp: 2026-02-11T01:32:47.669Z,
        originalStack: `MongoServerError: E11000 duplicate key error collection: 
test.reservas index: unique_reservation_slot dup key: { barberoId: 
ObjectId('698bdc3e626399f145648e26'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698bdc3e626399f145648e24') }\n` +
          '    at InsertOneOperation.handleOk (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\node_modules\\mongodb\\src\\operations\\insert.ts:79:13)\n' +
          '    at tryOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\backen
d\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:294:26)\n' +
          '    at processTicksAndRejections 
(node:internal/process/task_queues:105:5)\n' +
          '    at executeOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\ba
ckend\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:123:12)\n' +
          '    at Collection.insertOne (C:\\Users\\Kristian\\Desktop\\barber-saas
\\backend\\node_modules\\mongodb\\src\\collection.ts:294:12)\n' +
          '    at model.$__save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backe
nd\\node_modules\\mongoose\\lib\\model.js:398:16)\n' +
          '    at model.save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\
\node_modules\\mongoose\\lib\\model.js:609:5)\n' +
          '    at C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\\node_module
s\\mongoose\\lib\\model.js:2722:9\n' +
          '    at async Promise.all (index 0)\n' +
          '    at Function.create (C:\\Users\\Kristian\\Desktop\\barber-saas\\bac
kend\\node_modules\\mongoose\\lib\\model.js:2707:11)\n' +
          '    at MongoReservaRepository.save (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\src\\infrastructure\\database\\mongodb\\repositories\\MongoRese
rvaRepository.js:15:16)\n' +
          '    at TransactionManager.executeInTransaction.operationName (C:\\User
s\\Kristian\\Desktop\\barber-saas\\backend\\src\\application\\use-cases\\reservas
\\CreateReserva.js:72:42)\n' +
          '    at Function.executeInTransaction (C:\\Users\\Kristian\\Desktop\\ba
rber-saas\\backend\\src\\utils\\TransactionManager.js:57:32)\n' +
          '    at CreateReserva.execute (C:\\Users\\Kristian\\Desktop\\barber-saa
s\\backend\\src\\application\\use-cases\\reservas\\CreateReserva.js:26:34)\n' +
          '    at Object.<anonymous>.exports.crearReservaBySlug (C:\\Users\\Krist
ian\\Desktop\\barber-saas\\backend\\src\\controllers\\public.controller.js:140:25
)'
      }

    [0m [90m 4 |[39m
     [90m 5 |[39m [36mconst[39m errorHandler [33m=[39m (err[33m,[39m 
req[33m,[39m res[33m,[39m next) [33m=>[39m {
    [31m[1m>[22m[39m[90m 6 |[39m   console[33m.[39merror([32m"ƒö┤ 
ERROR:"[39m[33m,[39m err)[33m;[39m
     [90m   |[39m           [31m[1m^[22m[39m
     [90m 7 |[39m
     [90m 8 |[39m   [90m// ­ƒöÑ A├æADIR HEADERS CORS SI NO EXISTEN[39m
     [90m 9 |[39m   [36mconst[39m origin [33m=[39m 
req[33m.[39mheaders[33m.[39morigin[33m;[39m[0m

      at error (src/config/middleware/errorHandler.js:6:11)
      at Layer.handleError (node_modules/router/lib/layer.js:116:17)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at Layer.handleError (node_modules/router/lib/layer.js:111:12)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at Immediate.next (node_modules/router/index.js:291:5)
      at Immediate._onImmediate (node_modules/router/index.js:688:15)

    console.error
      ƒö┤ ERROR: TransactionError: Transaction failed for CreateReservation: 
E11000 duplicate key error collection: test.reservas index: 
unique_reservation_slot dup key: { barberoId: 
ObjectId('698bdc3e626399f145648e26'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698bdc3e626399f145648e24') }
          at Function.executeInTransaction (C:\Users\Kristian\Desktop\barber-saas
\backend\src\utils\TransactionManager.js:88:42)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at CreateReserva.execute (C:\Users\Kristian\Desktop\barber-saas\backend
\src\application\use-cases\reservas\CreateReserva.js:26:34)
          at Object.<anonymous>.exports.crearReservaBySlug (C:\Users\Kristian\Des
ktop\barber-saas\backend\src\controllers\public.controller.js:140:25) {
        isTransactionError: true,
        originalError: MongoServerError: E11000 duplicate key error collection: 
test.reservas index: unique_reservation_slot dup key: { barberoId: 
ObjectId('698bdc3e626399f145648e26'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698bdc3e626399f145648e24') }
            at InsertOneOperation.handleOk (C:\Users\Kristian\Desktop\barber-saas
\backend\node_modules\mongodb\src\operations\insert.ts:79:13)
            at tryOperation (C:\Users\Kristian\Desktop\barber-saas\backend\node_m
odules\mongodb\src\operations\execute_operation.ts:294:26)
            at processTicksAndRejections 
(node:internal/process/task_queues:105:5)
            at executeOperation (C:\Users\Kristian\Desktop\barber-saas\backend\no
de_modules\mongodb\src\operations\execute_operation.ts:123:12)
            at Collection.insertOne (C:\Users\Kristian\Desktop\barber-saas\backen
d\node_modules\mongodb\src\collection.ts:294:12)
            at model.$__save (C:\Users\Kristian\Desktop\barber-saas\backend\node_
modules\mongoose\lib\model.js:398:16)
            at model.save (C:\Users\Kristian\Desktop\barber-saas\backend\node_mod
ules\mongoose\lib\model.js:609:5)
            at C:\Users\Kristian\Desktop\barber-saas\backend\node_modules\mongoos
e\lib\model.js:2722:9
            at async Promise.all (index 0)
            at Function.create (C:\Users\Kristian\Desktop\barber-saas\backend\nod
e_modules\mongoose\lib\model.js:2707:11)
            at MongoReservaRepository.save (C:\Users\Kristian\Desktop\barber-saas
\backend\src\infrastructure\database\mongodb\repositories\MongoReservaRepository.
js:15:16)
            at TransactionManager.executeInTransaction.operationName (C:\Users\Kr
istian\Desktop\barber-saas\backend\src\application\use-cases\reservas\CreateReser
va.js:72:42)
            at Function.executeInTransaction (C:\Users\Kristian\Desktop\barber-sa
as\backend\src\utils\TransactionManager.js:57:32)
            at CreateReserva.execute (C:\Users\Kristian\Desktop\barber-saas\backe
nd\src\application\use-cases\reservas\CreateReserva.js:26:34)
            at Object.<anonymous>.exports.crearReservaBySlug (C:\Users\Kristian\D
esktop\barber-saas\backend\src\controllers\public.controller.js:140:25) {
          errorLabelSet: Set(0) {},
          errorResponse: {
            index: 0,
            code: 11000,
            errmsg: `E11000 duplicate key error collection: test.reservas index: 
unique_reservation_slot dup key: { barberoId: 
ObjectId('698bdc3e626399f145648e26'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698bdc3e626399f145648e24') }`,
            keyPattern: [Object],
            keyValue: [Object]
          },
          index: 0,
          code: 11000,
          keyPattern: { barberoId: 1, fecha: 1, hora: 1, barberiaId: 1 },
          keyValue: {
            barberoId: new ObjectId('698bdc3e626399f145648e26'),
            fecha: 2026-03-16T00:00:00.000Z,
            hora: '14:00',
            barberiaId: new ObjectId('698bdc3e626399f145648e24')
          }
        },
        context: { operationName: 'CreateReservation', attempt: 2 },
        timestamp: 2026-02-11T01:32:47.670Z,
        originalStack: `MongoServerError: E11000 duplicate key error collection: 
test.reservas index: unique_reservation_slot dup key: { barberoId: 
ObjectId('698bdc3e626399f145648e26'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698bdc3e626399f145648e24') }\n` +
          '    at InsertOneOperation.handleOk (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\node_modules\\mongodb\\src\\operations\\insert.ts:79:13)\n' +
          '    at tryOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\backen
d\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:294:26)\n' +
          '    at processTicksAndRejections 
(node:internal/process/task_queues:105:5)\n' +
          '    at executeOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\ba
ckend\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:123:12)\n' +
          '    at Collection.insertOne (C:\\Users\\Kristian\\Desktop\\barber-saas
\\backend\\node_modules\\mongodb\\src\\collection.ts:294:12)\n' +
          '    at model.$__save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backe
nd\\node_modules\\mongoose\\lib\\model.js:398:16)\n' +
          '    at model.save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\
\node_modules\\mongoose\\lib\\model.js:609:5)\n' +
          '    at C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\\node_module
s\\mongoose\\lib\\model.js:2722:9\n' +
          '    at async Promise.all (index 0)\n' +
          '    at Function.create (C:\\Users\\Kristian\\Desktop\\barber-saas\\bac
kend\\node_modules\\mongoose\\lib\\model.js:2707:11)\n' +
          '    at MongoReservaRepository.save (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\src\\infrastructure\\database\\mongodb\\repositories\\MongoRese
rvaRepository.js:15:16)\n' +
          '    at TransactionManager.executeInTransaction.operationName (C:\\User
s\\Kristian\\Desktop\\barber-saas\\backend\\src\\application\\use-cases\\reservas
\\CreateReserva.js:72:42)\n' +
          '    at Function.executeInTransaction (C:\\Users\\Kristian\\Desktop\\ba
rber-saas\\backend\\src\\utils\\TransactionManager.js:57:32)\n' +
          '    at CreateReserva.execute (C:\\Users\\Kristian\\Desktop\\barber-saa
s\\backend\\src\\application\\use-cases\\reservas\\CreateReserva.js:26:34)\n' +
          '    at Object.<anonymous>.exports.crearReservaBySlug (C:\\Users\\Krist
ian\\Desktop\\barber-saas\\backend\\src\\controllers\\public.controller.js:140:25
)'
      }

    [0m [90m 4 |[39m
     [90m 5 |[39m [36mconst[39m errorHandler [33m=[39m (err[33m,[39m 
req[33m,[39m res[33m,[39m next) [33m=>[39m {
    [31m[1m>[22m[39m[90m 6 |[39m   console[33m.[39merror([32m"ƒö┤ 
ERROR:"[39m[33m,[39m err)[33m;[39m
     [90m   |[39m           [31m[1m^[22m[39m
     [90m 7 |[39m
     [90m 8 |[39m   [90m// ­ƒöÑ A├æADIR HEADERS CORS SI NO EXISTEN[39m
     [90m 9 |[39m   [36mconst[39m origin [33m=[39m 
req[33m.[39mheaders[33m.[39morigin[33m;[39m[0m

      at error (src/config/middleware/errorHandler.js:6:11)
      at Layer.handleError (node_modules/router/lib/layer.js:116:17)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at Layer.handleError (node_modules/router/lib/layer.js:111:12)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at Immediate.next (node_modules/router/index.js:291:5)
      at Immediate._onImmediate (node_modules/router/index.js:688:15)

    console.error
      ƒö┤ ERROR: TransactionError: Transaction failed for CreateReservation: 
E11000 duplicate key error collection: test.reservas index: 
unique_reservation_slot dup key: { barberoId: 
ObjectId('698bdc3e626399f145648e26'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698bdc3e626399f145648e24') }
          at Function.executeInTransaction (C:\Users\Kristian\Desktop\barber-saas
\backend\src\utils\TransactionManager.js:88:42)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at CreateReserva.execute (C:\Users\Kristian\Desktop\barber-saas\backend
\src\application\use-cases\reservas\CreateReserva.js:26:34)
          at Object.<anonymous>.exports.crearReservaBySlug (C:\Users\Kristian\Des
ktop\barber-saas\backend\src\controllers\public.controller.js:140:25) {
        isTransactionError: true,
        originalError: MongoServerError: E11000 duplicate key error collection: 
test.reservas index: unique_reservation_slot dup key: { barberoId: 
ObjectId('698bdc3e626399f145648e26'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698bdc3e626399f145648e24') }
            at InsertOneOperation.handleOk (C:\Users\Kristian\Desktop\barber-saas
\backend\node_modules\mongodb\src\operations\insert.ts:79:13)
            at tryOperation (C:\Users\Kristian\Desktop\barber-saas\backend\node_m
odules\mongodb\src\operations\execute_operation.ts:294:26)
            at processTicksAndRejections 
(node:internal/process/task_queues:105:5)
            at executeOperation (C:\Users\Kristian\Desktop\barber-saas\backend\no
de_modules\mongodb\src\operations\execute_operation.ts:123:12)
            at Collection.insertOne (C:\Users\Kristian\Desktop\barber-saas\backen
d\node_modules\mongodb\src\collection.ts:294:12)
            at model.$__save (C:\Users\Kristian\Desktop\barber-saas\backend\node_
modules\mongoose\lib\model.js:398:16)
            at model.save (C:\Users\Kristian\Desktop\barber-saas\backend\node_mod
ules\mongoose\lib\model.js:609:5)
            at C:\Users\Kristian\Desktop\barber-saas\backend\node_modules\mongoos
e\lib\model.js:2722:9
            at async Promise.all (index 0)
            at Function.create (C:\Users\Kristian\Desktop\barber-saas\backend\nod
e_modules\mongoose\lib\model.js:2707:11)
            at MongoReservaRepository.save (C:\Users\Kristian\Desktop\barber-saas
\backend\src\infrastructure\database\mongodb\repositories\MongoReservaRepository.
js:15:16)
            at TransactionManager.executeInTransaction.operationName (C:\Users\Kr
istian\Desktop\barber-saas\backend\src\application\use-cases\reservas\CreateReser
va.js:72:42)
            at Function.executeInTransaction (C:\Users\Kristian\Desktop\barber-sa
as\backend\src\utils\TransactionManager.js:57:32)
            at CreateReserva.execute (C:\Users\Kristian\Desktop\barber-saas\backe
nd\src\application\use-cases\reservas\CreateReserva.js:26:34)
            at Object.<anonymous>.exports.crearReservaBySlug (C:\Users\Kristian\D
esktop\barber-saas\backend\src\controllers\public.controller.js:140:25) {
          errorLabelSet: Set(0) {},
          errorResponse: {
            index: 0,
            code: 11000,
            errmsg: `E11000 duplicate key error collection: test.reservas index: 
unique_reservation_slot dup key: { barberoId: 
ObjectId('698bdc3e626399f145648e26'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698bdc3e626399f145648e24') }`,
            keyPattern: [Object],
            keyValue: [Object]
          },
          index: 0,
          code: 11000,
          keyPattern: { barberoId: 1, fecha: 1, hora: 1, barberiaId: 1 },
          keyValue: {
            barberoId: new ObjectId('698bdc3e626399f145648e26'),
            fecha: 2026-03-16T00:00:00.000Z,
            hora: '14:00',
            barberiaId: new ObjectId('698bdc3e626399f145648e24')
          }
        },
        context: { operationName: 'CreateReservation', attempt: 2 },
        timestamp: 2026-02-11T01:32:47.671Z,
        originalStack: `MongoServerError: E11000 duplicate key error collection: 
test.reservas index: unique_reservation_slot dup key: { barberoId: 
ObjectId('698bdc3e626399f145648e26'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698bdc3e626399f145648e24') }\n` +
          '    at InsertOneOperation.handleOk (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\node_modules\\mongodb\\src\\operations\\insert.ts:79:13)\n' +
          '    at tryOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\backen
d\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:294:26)\n' +
          '    at processTicksAndRejections 
(node:internal/process/task_queues:105:5)\n' +
          '    at executeOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\ba
ckend\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:123:12)\n' +
          '    at Collection.insertOne (C:\\Users\\Kristian\\Desktop\\barber-saas
\\backend\\node_modules\\mongodb\\src\\collection.ts:294:12)\n' +
          '    at model.$__save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backe
nd\\node_modules\\mongoose\\lib\\model.js:398:16)\n' +
          '    at model.save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\
\node_modules\\mongoose\\lib\\model.js:609:5)\n' +
          '    at C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\\node_module
s\\mongoose\\lib\\model.js:2722:9\n' +
          '    at async Promise.all (index 0)\n' +
          '    at Function.create (C:\\Users\\Kristian\\Desktop\\barber-saas\\bac
kend\\node_modules\\mongoose\\lib\\model.js:2707:11)\n' +
          '    at MongoReservaRepository.save (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\src\\infrastructure\\database\\mongodb\\repositories\\MongoRese
rvaRepository.js:15:16)\n' +
          '    at TransactionManager.executeInTransaction.operationName (C:\\User
s\\Kristian\\Desktop\\barber-saas\\backend\\src\\application\\use-cases\\reservas
\\CreateReserva.js:72:42)\n' +
          '    at Function.executeInTransaction (C:\\Users\\Kristian\\Desktop\\ba
rber-saas\\backend\\src\\utils\\TransactionManager.js:57:32)\n' +
          '    at CreateReserva.execute (C:\\Users\\Kristian\\Desktop\\barber-saa
s\\backend\\src\\application\\use-cases\\reservas\\CreateReserva.js:26:34)\n' +
          '    at Object.<anonymous>.exports.crearReservaBySlug (C:\\Users\\Krist
ian\\Desktop\\barber-saas\\backend\\src\\controllers\\public.controller.js:140:25
)'
      }

    [0m [90m 4 |[39m
     [90m 5 |[39m [36mconst[39m errorHandler [33m=[39m (err[33m,[39m 
req[33m,[39m res[33m,[39m next) [33m=>[39m {
    [31m[1m>[22m[39m[90m 6 |[39m   console[33m.[39merror([32m"ƒö┤ 
ERROR:"[39m[33m,[39m err)[33m;[39m
     [90m   |[39m           [31m[1m^[22m[39m
     [90m 7 |[39m
     [90m 8 |[39m   [90m// ­ƒöÑ A├æADIR HEADERS CORS SI NO EXISTEN[39m
     [90m 9 |[39m   [36mconst[39m origin [33m=[39m 
req[33m.[39mheaders[33m.[39morigin[33m;[39m[0m

      at error (src/config/middleware/errorHandler.js:6:11)
      at Layer.handleError (node_modules/router/lib/layer.js:116:17)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at Layer.handleError (node_modules/router/lib/layer.js:111:12)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at Immediate.next (node_modules/router/index.js:291:5)
      at Immediate._onImmediate (node_modules/router/index.js:688:15)

    console.log
      [Transaction] Aborted: CreateReservation

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:69:29)

    console.error
      [Transaction] Failed: CreateReservation {
        error: `E11000 duplicate key error collection: test.reservas index: 
unique_reservation_slot dup key: { barberoId: 
ObjectId('698bdc3e626399f145648e26'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698bdc3e626399f145648e24') }`,
        attempt: 2,
        stack: `MongoServerError: E11000 duplicate key error collection: 
test.reservas index: unique_reservation_slot dup key: { barberoId: 
ObjectId('698bdc3e626399f145648e26'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698bdc3e626399f145648e24') }\n` +
          '    at InsertOneOperation.handleOk (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\node_modules\\mongodb\\src\\operations\\insert.ts:79:13)\n' +
          '    at tryOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\backen
d\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:294:26)\n' +
          '    at processTicksAndRejections 
(node:internal/process/task_queues:105:5)\n' +
          '    at executeOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\ba
ckend\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:123:12)\n' +
          '    at Collection.insertOne (C:\\Users\\Kristian\\Desktop\\barber-saas
\\backend\\node_modules\\mongodb\\src\\collection.ts:294:12)\n' +
          '    at model.$__save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backe
nd\\node_modules\\mongoose\\lib\\model.js:398:16)\n' +
          '    at model.save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\
\node_modules\\mongoose\\lib\\model.js:609:5)\n' +
          '    at C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\\node_module
s\\mongoose\\lib\\model.js:2722:9\n' +
          '    at async Promise.all (index 0)\n' +
          '    at Function.create (C:\\Users\\Kristian\\Desktop\\barber-saas\\bac
kend\\node_modules\\mongoose\\lib\\model.js:2707:11)\n' +
          '    at MongoReservaRepository.save (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\src\\infrastructure\\database\\mongodb\\repositories\\MongoRese
rvaRepository.js:15:16)\n' +
          '    at TransactionManager.executeInTransaction.operationName (C:\\User
s\\Kristian\\Desktop\\barber-saas\\backend\\src\\application\\use-cases\\reservas
\\CreateReserva.js:72:42)\n' +
          '    at Function.executeInTransaction (C:\\Users\\Kristian\\Desktop\\ba
rber-saas\\backend\\src\\utils\\TransactionManager.js:57:32)\n' +
          '    at CreateReserva.execute (C:\\Users\\Kristian\\Desktop\\barber-saa
s\\backend\\src\\application\\use-cases\\reservas\\CreateReserva.js:26:34)\n' +
          '    at Object.<anonymous>.exports.crearReservaBySlug (C:\\Users\\Krist
ian\\Desktop\\barber-saas\\backend\\src\\controllers\\public.controller.js:140:25
)'
      }

    [0m [90m 80 |[39m
     [90m 81 |[39m                 [90m// Non-transient error or max retries 
reached[39m
    [31m[1m>[22m[39m[90m 82 |[39m                 
console[33m.[39merror([32m`[Transaction] Failed: 
${operationName}`[39m[33m,[39m {
     [90m    |[39m                         [31m[1m^[22m[39m
     [90m 83 |[39m                     error[33m:[39m 
error[33m.[39mmessage[33m,[39m
     [90m 84 |[39m                     attempt[33m:[39m attempt [33m+[39m 
[35m1[39m[33m,[39m
     [90m 85 |[39m                     stack[33m:[39m 
error[33m.[39mstack[0m

      at Function.error [as executeInTransaction] 
(src/utils/TransactionManager.js:82:25)
      at CreateReserva.execute 
(src/application/use-cases/reservas/CreateReserva.js:26:34)
      at Object.<anonymous>.exports.crearReservaBySlug 
(src/controllers/public.controller.js:140:25)

    console.log
      [Transaction] Aborted: CreateReservation

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:69:29)

    console.error
      [Transaction] Failed: CreateReservation {
        error: `E11000 duplicate key error collection: test.reservas index: 
unique_reservation_slot dup key: { barberoId: 
ObjectId('698bdc3e626399f145648e26'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698bdc3e626399f145648e24') }`,
        attempt: 2,
        stack: `MongoServerError: E11000 duplicate key error collection: 
test.reservas index: unique_reservation_slot dup key: { barberoId: 
ObjectId('698bdc3e626399f145648e26'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698bdc3e626399f145648e24') }\n` +
          '    at InsertOneOperation.handleOk (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\node_modules\\mongodb\\src\\operations\\insert.ts:79:13)\n' +
          '    at tryOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\backen
d\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:294:26)\n' +
          '    at processTicksAndRejections 
(node:internal/process/task_queues:105:5)\n' +
          '    at executeOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\ba
ckend\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:123:12)\n' +
          '    at Collection.insertOne (C:\\Users\\Kristian\\Desktop\\barber-saas
\\backend\\node_modules\\mongodb\\src\\collection.ts:294:12)\n' +
          '    at model.$__save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backe
nd\\node_modules\\mongoose\\lib\\model.js:398:16)\n' +
          '    at model.save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\
\node_modules\\mongoose\\lib\\model.js:609:5)\n' +
          '    at C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\\node_module
s\\mongoose\\lib\\model.js:2722:9\n' +
          '    at async Promise.all (index 0)\n' +
          '    at Function.create (C:\\Users\\Kristian\\Desktop\\barber-saas\\bac
kend\\node_modules\\mongoose\\lib\\model.js:2707:11)\n' +
          '    at MongoReservaRepository.save (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\src\\infrastructure\\database\\mongodb\\repositories\\MongoRese
rvaRepository.js:15:16)\n' +
          '    at TransactionManager.executeInTransaction.operationName (C:\\User
s\\Kristian\\Desktop\\barber-saas\\backend\\src\\application\\use-cases\\reservas
\\CreateReserva.js:72:42)\n' +
          '    at Function.executeInTransaction (C:\\Users\\Kristian\\Desktop\\ba
rber-saas\\backend\\src\\utils\\TransactionManager.js:57:32)\n' +
          '    at CreateReserva.execute (C:\\Users\\Kristian\\Desktop\\barber-saa
s\\backend\\src\\application\\use-cases\\reservas\\CreateReserva.js:26:34)\n' +
          '    at Object.<anonymous>.exports.crearReservaBySlug (C:\\Users\\Krist
ian\\Desktop\\barber-saas\\backend\\src\\controllers\\public.controller.js:140:25
)'
      }

    [0m [90m 80 |[39m
     [90m 81 |[39m                 [90m// Non-transient error or max retries 
reached[39m
    [31m[1m>[22m[39m[90m 82 |[39m                 
console[33m.[39merror([32m`[Transaction] Failed: 
${operationName}`[39m[33m,[39m {
     [90m    |[39m                         [31m[1m^[22m[39m
     [90m 83 |[39m                     error[33m:[39m 
error[33m.[39mmessage[33m,[39m
     [90m 84 |[39m                     attempt[33m:[39m attempt [33m+[39m 
[35m1[39m[33m,[39m
     [90m 85 |[39m                     stack[33m:[39m 
error[33m.[39mstack[0m

      at Function.error [as executeInTransaction] 
(src/utils/TransactionManager.js:82:25)
      at CreateReserva.execute 
(src/application/use-cases/reservas/CreateReserva.js:26:34)
      at Object.<anonymous>.exports.crearReservaBySlug 
(src/controllers/public.controller.js:140:25)

    console.error
      ƒö┤ ERROR: TransactionError: Transaction failed for CreateReservation: 
E11000 duplicate key error collection: test.reservas index: 
unique_reservation_slot dup key: { barberoId: 
ObjectId('698bdc3e626399f145648e26'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698bdc3e626399f145648e24') }
          at Function.executeInTransaction (C:\Users\Kristian\Desktop\barber-saas
\backend\src\utils\TransactionManager.js:88:42)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at CreateReserva.execute (C:\Users\Kristian\Desktop\barber-saas\backend
\src\application\use-cases\reservas\CreateReserva.js:26:34)
          at Object.<anonymous>.exports.crearReservaBySlug (C:\Users\Kristian\Des
ktop\barber-saas\backend\src\controllers\public.controller.js:140:25) {
        isTransactionError: true,
        originalError: MongoServerError: E11000 duplicate key error collection: 
test.reservas index: unique_reservation_slot dup key: { barberoId: 
ObjectId('698bdc3e626399f145648e26'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698bdc3e626399f145648e24') }
            at InsertOneOperation.handleOk (C:\Users\Kristian\Desktop\barber-saas
\backend\node_modules\mongodb\src\operations\insert.ts:79:13)
            at tryOperation (C:\Users\Kristian\Desktop\barber-saas\backend\node_m
odules\mongodb\src\operations\execute_operation.ts:294:26)
            at processTicksAndRejections 
(node:internal/process/task_queues:105:5)
            at executeOperation (C:\Users\Kristian\Desktop\barber-saas\backend\no
de_modules\mongodb\src\operations\execute_operation.ts:123:12)
            at Collection.insertOne (C:\Users\Kristian\Desktop\barber-saas\backen
d\node_modules\mongodb\src\collection.ts:294:12)
            at model.$__save (C:\Users\Kristian\Desktop\barber-saas\backend\node_
modules\mongoose\lib\model.js:398:16)
            at model.save (C:\Users\Kristian\Desktop\barber-saas\backend\node_mod
ules\mongoose\lib\model.js:609:5)
            at C:\Users\Kristian\Desktop\barber-saas\backend\node_modules\mongoos
e\lib\model.js:2722:9
            at async Promise.all (index 0)
            at Function.create (C:\Users\Kristian\Desktop\barber-saas\backend\nod
e_modules\mongoose\lib\model.js:2707:11)
            at MongoReservaRepository.save (C:\Users\Kristian\Desktop\barber-saas
\backend\src\infrastructure\database\mongodb\repositories\MongoReservaRepository.
js:15:16)
            at TransactionManager.executeInTransaction.operationName (C:\Users\Kr
istian\Desktop\barber-saas\backend\src\application\use-cases\reservas\CreateReser
va.js:72:42)
            at Function.executeInTransaction (C:\Users\Kristian\Desktop\barber-sa
as\backend\src\utils\TransactionManager.js:57:32)
            at CreateReserva.execute (C:\Users\Kristian\Desktop\barber-saas\backe
nd\src\application\use-cases\reservas\CreateReserva.js:26:34)
            at Object.<anonymous>.exports.crearReservaBySlug (C:\Users\Kristian\D
esktop\barber-saas\backend\src\controllers\public.controller.js:140:25) {
          errorLabelSet: Set(0) {},
          errorResponse: {
            index: 0,
            code: 11000,
            errmsg: `E11000 duplicate key error collection: test.reservas index: 
unique_reservation_slot dup key: { barberoId: 
ObjectId('698bdc3e626399f145648e26'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698bdc3e626399f145648e24') }`,
            keyPattern: [Object],
            keyValue: [Object]
          },
          index: 0,
          code: 11000,
          keyPattern: { barberoId: 1, fecha: 1, hora: 1, barberiaId: 1 },
          keyValue: {
            barberoId: new ObjectId('698bdc3e626399f145648e26'),
            fecha: 2026-03-16T00:00:00.000Z,
            hora: '14:00',
            barberiaId: new ObjectId('698bdc3e626399f145648e24')
          }
        },
        context: { operationName: 'CreateReservation', attempt: 2 },
        timestamp: 2026-02-11T01:32:47.693Z,
        originalStack: `MongoServerError: E11000 duplicate key error collection: 
test.reservas index: unique_reservation_slot dup key: { barberoId: 
ObjectId('698bdc3e626399f145648e26'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698bdc3e626399f145648e24') }\n` +
          '    at InsertOneOperation.handleOk (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\node_modules\\mongodb\\src\\operations\\insert.ts:79:13)\n' +
          '    at tryOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\backen
d\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:294:26)\n' +
          '    at processTicksAndRejections 
(node:internal/process/task_queues:105:5)\n' +
          '    at executeOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\ba
ckend\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:123:12)\n' +
          '    at Collection.insertOne (C:\\Users\\Kristian\\Desktop\\barber-saas
\\backend\\node_modules\\mongodb\\src\\collection.ts:294:12)\n' +
          '    at model.$__save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backe
nd\\node_modules\\mongoose\\lib\\model.js:398:16)\n' +
          '    at model.save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\
\node_modules\\mongoose\\lib\\model.js:609:5)\n' +
          '    at C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\\node_module
s\\mongoose\\lib\\model.js:2722:9\n' +
          '    at async Promise.all (index 0)\n' +
          '    at Function.create (C:\\Users\\Kristian\\Desktop\\barber-saas\\bac
kend\\node_modules\\mongoose\\lib\\model.js:2707:11)\n' +
          '    at MongoReservaRepository.save (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\src\\infrastructure\\database\\mongodb\\repositories\\MongoRese
rvaRepository.js:15:16)\n' +
          '    at TransactionManager.executeInTransaction.operationName (C:\\User
s\\Kristian\\Desktop\\barber-saas\\backend\\src\\application\\use-cases\\reservas
\\CreateReserva.js:72:42)\n' +
          '    at Function.executeInTransaction (C:\\Users\\Kristian\\Desktop\\ba
rber-saas\\backend\\src\\utils\\TransactionManager.js:57:32)\n' +
          '    at CreateReserva.execute (C:\\Users\\Kristian\\Desktop\\barber-saa
s\\backend\\src\\application\\use-cases\\reservas\\CreateReserva.js:26:34)\n' +
          '    at Object.<anonymous>.exports.crearReservaBySlug (C:\\Users\\Krist
ian\\Desktop\\barber-saas\\backend\\src\\controllers\\public.controller.js:140:25
)'
      }

    [0m [90m 4 |[39m
     [90m 5 |[39m [36mconst[39m errorHandler [33m=[39m (err[33m,[39m 
req[33m,[39m res[33m,[39m next) [33m=>[39m {
    [31m[1m>[22m[39m[90m 6 |[39m   console[33m.[39merror([32m"ƒö┤ 
ERROR:"[39m[33m,[39m err)[33m;[39m
     [90m   |[39m           [31m[1m^[22m[39m
     [90m 7 |[39m
     [90m 8 |[39m   [90m// ­ƒöÑ A├æADIR HEADERS CORS SI NO EXISTEN[39m
     [90m 9 |[39m   [36mconst[39m origin [33m=[39m 
req[33m.[39mheaders[33m.[39morigin[33m;[39m[0m

      at error (src/config/middleware/errorHandler.js:6:11)
      at Layer.handleError (node_modules/router/lib/layer.js:116:17)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at Layer.handleError (node_modules/router/lib/layer.js:111:12)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at Immediate.next (node_modules/router/index.js:291:5)
      at Immediate._onImmediate (node_modules/router/index.js:688:15)

    console.error
      ƒö┤ ERROR: TransactionError: Transaction failed for CreateReservation: 
E11000 duplicate key error collection: test.reservas index: 
unique_reservation_slot dup key: { barberoId: 
ObjectId('698bdc3e626399f145648e26'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698bdc3e626399f145648e24') }
          at Function.executeInTransaction (C:\Users\Kristian\Desktop\barber-saas
\backend\src\utils\TransactionManager.js:88:42)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at CreateReserva.execute (C:\Users\Kristian\Desktop\barber-saas\backend
\src\application\use-cases\reservas\CreateReserva.js:26:34)
          at Object.<anonymous>.exports.crearReservaBySlug (C:\Users\Kristian\Des
ktop\barber-saas\backend\src\controllers\public.controller.js:140:25) {
        isTransactionError: true,
        originalError: MongoServerError: E11000 duplicate key error collection: 
test.reservas index: unique_reservation_slot dup key: { barberoId: 
ObjectId('698bdc3e626399f145648e26'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698bdc3e626399f145648e24') }
            at InsertOneOperation.handleOk (C:\Users\Kristian\Desktop\barber-saas
\backend\node_modules\mongodb\src\operations\insert.ts:79:13)
            at tryOperation (C:\Users\Kristian\Desktop\barber-saas\backend\node_m
odules\mongodb\src\operations\execute_operation.ts:294:26)
            at processTicksAndRejections 
(node:internal/process/task_queues:105:5)
            at executeOperation (C:\Users\Kristian\Desktop\barber-saas\backend\no
de_modules\mongodb\src\operations\execute_operation.ts:123:12)
            at Collection.insertOne (C:\Users\Kristian\Desktop\barber-saas\backen
d\node_modules\mongodb\src\collection.ts:294:12)
            at model.$__save (C:\Users\Kristian\Desktop\barber-saas\backend\node_
modules\mongoose\lib\model.js:398:16)
            at model.save (C:\Users\Kristian\Desktop\barber-saas\backend\node_mod
ules\mongoose\lib\model.js:609:5)
            at C:\Users\Kristian\Desktop\barber-saas\backend\node_modules\mongoos
e\lib\model.js:2722:9
            at async Promise.all (index 0)
            at Function.create (C:\Users\Kristian\Desktop\barber-saas\backend\nod
e_modules\mongoose\lib\model.js:2707:11)
            at MongoReservaRepository.save (C:\Users\Kristian\Desktop\barber-saas
\backend\src\infrastructure\database\mongodb\repositories\MongoReservaRepository.
js:15:16)
            at TransactionManager.executeInTransaction.operationName (C:\Users\Kr
istian\Desktop\barber-saas\backend\src\application\use-cases\reservas\CreateReser
va.js:72:42)
            at Function.executeInTransaction (C:\Users\Kristian\Desktop\barber-sa
as\backend\src\utils\TransactionManager.js:57:32)
            at CreateReserva.execute (C:\Users\Kristian\Desktop\barber-saas\backe
nd\src\application\use-cases\reservas\CreateReserva.js:26:34)
            at Object.<anonymous>.exports.crearReservaBySlug (C:\Users\Kristian\D
esktop\barber-saas\backend\src\controllers\public.controller.js:140:25) {
          errorLabelSet: Set(0) {},
          errorResponse: {
            index: 0,
            code: 11000,
            errmsg: `E11000 duplicate key error collection: test.reservas index: 
unique_reservation_slot dup key: { barberoId: 
ObjectId('698bdc3e626399f145648e26'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698bdc3e626399f145648e24') }`,
            keyPattern: [Object],
            keyValue: [Object]
          },
          index: 0,
          code: 11000,
          keyPattern: { barberoId: 1, fecha: 1, hora: 1, barberiaId: 1 },
          keyValue: {
            barberoId: new ObjectId('698bdc3e626399f145648e26'),
            fecha: 2026-03-16T00:00:00.000Z,
            hora: '14:00',
            barberiaId: new ObjectId('698bdc3e626399f145648e24')
          }
        },
        context: { operationName: 'CreateReservation', attempt: 2 },
        timestamp: 2026-02-11T01:32:47.694Z,
        originalStack: `MongoServerError: E11000 duplicate key error collection: 
test.reservas index: unique_reservation_slot dup key: { barberoId: 
ObjectId('698bdc3e626399f145648e26'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698bdc3e626399f145648e24') }\n` +
          '    at InsertOneOperation.handleOk (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\node_modules\\mongodb\\src\\operations\\insert.ts:79:13)\n' +
          '    at tryOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\backen
d\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:294:26)\n' +
          '    at processTicksAndRejections 
(node:internal/process/task_queues:105:5)\n' +
          '    at executeOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\ba
ckend\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:123:12)\n' +
          '    at Collection.insertOne (C:\\Users\\Kristian\\Desktop\\barber-saas
\\backend\\node_modules\\mongodb\\src\\collection.ts:294:12)\n' +
          '    at model.$__save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backe
nd\\node_modules\\mongoose\\lib\\model.js:398:16)\n' +
          '    at model.save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\
\node_modules\\mongoose\\lib\\model.js:609:5)\n' +
          '    at C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\\node_module
s\\mongoose\\lib\\model.js:2722:9\n' +
          '    at async Promise.all (index 0)\n' +
          '    at Function.create (C:\\Users\\Kristian\\Desktop\\barber-saas\\bac
kend\\node_modules\\mongoose\\lib\\model.js:2707:11)\n' +
          '    at MongoReservaRepository.save (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\src\\infrastructure\\database\\mongodb\\repositories\\MongoRese
rvaRepository.js:15:16)\n' +
          '    at TransactionManager.executeInTransaction.operationName (C:\\User
s\\Kristian\\Desktop\\barber-saas\\backend\\src\\application\\use-cases\\reservas
\\CreateReserva.js:72:42)\n' +
          '    at Function.executeInTransaction (C:\\Users\\Kristian\\Desktop\\ba
rber-saas\\backend\\src\\utils\\TransactionManager.js:57:32)\n' +
          '    at CreateReserva.execute (C:\\Users\\Kristian\\Desktop\\barber-saa
s\\backend\\src\\application\\use-cases\\reservas\\CreateReserva.js:26:34)\n' +
          '    at Object.<anonymous>.exports.crearReservaBySlug (C:\\Users\\Krist
ian\\Desktop\\barber-saas\\backend\\src\\controllers\\public.controller.js:140:25
)'
      }

    [0m [90m 4 |[39m
     [90m 5 |[39m [36mconst[39m errorHandler [33m=[39m (err[33m,[39m 
req[33m,[39m res[33m,[39m next) [33m=>[39m {
    [31m[1m>[22m[39m[90m 6 |[39m   console[33m.[39merror([32m"ƒö┤ 
ERROR:"[39m[33m,[39m err)[33m;[39m
     [90m   |[39m           [31m[1m^[22m[39m
     [90m 7 |[39m
     [90m 8 |[39m   [90m// ­ƒöÑ A├æADIR HEADERS CORS SI NO EXISTEN[39m
     [90m 9 |[39m   [36mconst[39m origin [33m=[39m 
req[33m.[39mheaders[33m.[39morigin[33m;[39m[0m

      at error (src/config/middleware/errorHandler.js:6:11)
      at Layer.handleError (node_modules/router/lib/layer.js:116:17)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at Layer.handleError (node_modules/router/lib/layer.js:111:12)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at Immediate.next (node_modules/router/index.js:291:5)
      at Immediate._onImmediate (node_modules/router/index.js:688:15)

    console.log
      [Transaction] Aborted: CreateReservation

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:69:29)

    console.error
      [Transaction] Failed: CreateReservation {
        error: `E11000 duplicate key error collection: test.reservas index: 
unique_reservation_slot dup key: { barberoId: 
ObjectId('698bdc3e626399f145648e26'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698bdc3e626399f145648e24') }`,
        attempt: 2,
        stack: `MongoServerError: E11000 duplicate key error collection: 
test.reservas index: unique_reservation_slot dup key: { barberoId: 
ObjectId('698bdc3e626399f145648e26'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698bdc3e626399f145648e24') }\n` +
          '    at InsertOneOperation.handleOk (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\node_modules\\mongodb\\src\\operations\\insert.ts:79:13)\n' +
          '    at tryOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\backen
d\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:294:26)\n' +
          '    at processTicksAndRejections 
(node:internal/process/task_queues:105:5)\n' +
          '    at executeOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\ba
ckend\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:123:12)\n' +
          '    at Collection.insertOne (C:\\Users\\Kristian\\Desktop\\barber-saas
\\backend\\node_modules\\mongodb\\src\\collection.ts:294:12)\n' +
          '    at model.$__save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backe
nd\\node_modules\\mongoose\\lib\\model.js:398:16)\n' +
          '    at model.save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\
\node_modules\\mongoose\\lib\\model.js:609:5)\n' +
          '    at C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\\node_module
s\\mongoose\\lib\\model.js:2722:9\n' +
          '    at async Promise.all (index 0)\n' +
          '    at Function.create (C:\\Users\\Kristian\\Desktop\\barber-saas\\bac
kend\\node_modules\\mongoose\\lib\\model.js:2707:11)\n' +
          '    at MongoReservaRepository.save (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\src\\infrastructure\\database\\mongodb\\repositories\\MongoRese
rvaRepository.js:15:16)\n' +
          '    at TransactionManager.executeInTransaction.operationName (C:\\User
s\\Kristian\\Desktop\\barber-saas\\backend\\src\\application\\use-cases\\reservas
\\CreateReserva.js:72:42)\n' +
          '    at Function.executeInTransaction (C:\\Users\\Kristian\\Desktop\\ba
rber-saas\\backend\\src\\utils\\TransactionManager.js:57:32)\n' +
          '    at CreateReserva.execute (C:\\Users\\Kristian\\Desktop\\barber-saa
s\\backend\\src\\application\\use-cases\\reservas\\CreateReserva.js:26:34)\n' +
          '    at Object.<anonymous>.exports.crearReservaBySlug (C:\\Users\\Krist
ian\\Desktop\\barber-saas\\backend\\src\\controllers\\public.controller.js:140:25
)'
      }

    [0m [90m 80 |[39m
     [90m 81 |[39m                 [90m// Non-transient error or max retries 
reached[39m
    [31m[1m>[22m[39m[90m 82 |[39m                 
console[33m.[39merror([32m`[Transaction] Failed: 
${operationName}`[39m[33m,[39m {
     [90m    |[39m                         [31m[1m^[22m[39m
     [90m 83 |[39m                     error[33m:[39m 
error[33m.[39mmessage[33m,[39m
     [90m 84 |[39m                     attempt[33m:[39m attempt [33m+[39m 
[35m1[39m[33m,[39m
     [90m 85 |[39m                     stack[33m:[39m 
error[33m.[39mstack[0m

      at Function.error [as executeInTransaction] 
(src/utils/TransactionManager.js:82:25)
      at CreateReserva.execute 
(src/application/use-cases/reservas/CreateReserva.js:26:34)
      at Object.<anonymous>.exports.crearReservaBySlug 
(src/controllers/public.controller.js:140:25)

    console.log
      [Transaction] Aborted: CreateReservation

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:69:29)

    console.error
      [Transaction] Failed: CreateReservation {
        error: `E11000 duplicate key error collection: test.reservas index: 
unique_reservation_slot dup key: { barberoId: 
ObjectId('698bdc3e626399f145648e26'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698bdc3e626399f145648e24') }`,
        attempt: 2,
        stack: `MongoServerError: E11000 duplicate key error collection: 
test.reservas index: unique_reservation_slot dup key: { barberoId: 
ObjectId('698bdc3e626399f145648e26'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698bdc3e626399f145648e24') }\n` +
          '    at InsertOneOperation.handleOk (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\node_modules\\mongodb\\src\\operations\\insert.ts:79:13)\n' +
          '    at tryOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\backen
d\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:294:26)\n' +
          '    at processTicksAndRejections 
(node:internal/process/task_queues:105:5)\n' +
          '    at executeOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\ba
ckend\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:123:12)\n' +
          '    at Collection.insertOne (C:\\Users\\Kristian\\Desktop\\barber-saas
\\backend\\node_modules\\mongodb\\src\\collection.ts:294:12)\n' +
          '    at model.$__save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backe
nd\\node_modules\\mongoose\\lib\\model.js:398:16)\n' +
          '    at model.save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\
\node_modules\\mongoose\\lib\\model.js:609:5)\n' +
          '    at C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\\node_module
s\\mongoose\\lib\\model.js:2722:9\n' +
          '    at async Promise.all (index 0)\n' +
          '    at Function.create (C:\\Users\\Kristian\\Desktop\\barber-saas\\bac
kend\\node_modules\\mongoose\\lib\\model.js:2707:11)\n' +
          '    at MongoReservaRepository.save (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\src\\infrastructure\\database\\mongodb\\repositories\\MongoRese
rvaRepository.js:15:16)\n' +
          '    at TransactionManager.executeInTransaction.operationName (C:\\User
s\\Kristian\\Desktop\\barber-saas\\backend\\src\\application\\use-cases\\reservas
\\CreateReserva.js:72:42)\n' +
          '    at Function.executeInTransaction (C:\\Users\\Kristian\\Desktop\\ba
rber-saas\\backend\\src\\utils\\TransactionManager.js:57:32)\n' +
          '    at CreateReserva.execute (C:\\Users\\Kristian\\Desktop\\barber-saa
s\\backend\\src\\application\\use-cases\\reservas\\CreateReserva.js:26:34)\n' +
          '    at Object.<anonymous>.exports.crearReservaBySlug (C:\\Users\\Krist
ian\\Desktop\\barber-saas\\backend\\src\\controllers\\public.controller.js:140:25
)'
      }

    [0m [90m 80 |[39m
     [90m 81 |[39m                 [90m// Non-transient error or max retries 
reached[39m
    [31m[1m>[22m[39m[90m 82 |[39m                 
console[33m.[39merror([32m`[Transaction] Failed: 
${operationName}`[39m[33m,[39m {
     [90m    |[39m                         [31m[1m^[22m[39m
     [90m 83 |[39m                     error[33m:[39m 
error[33m.[39mmessage[33m,[39m
     [90m 84 |[39m                     attempt[33m:[39m attempt [33m+[39m 
[35m1[39m[33m,[39m
     [90m 85 |[39m                     stack[33m:[39m 
error[33m.[39mstack[0m

      at Function.error [as executeInTransaction] 
(src/utils/TransactionManager.js:82:25)
      at CreateReserva.execute 
(src/application/use-cases/reservas/CreateReserva.js:26:34)
      at Object.<anonymous>.exports.crearReservaBySlug 
(src/controllers/public.controller.js:140:25)

    console.error
      ƒö┤ ERROR: TransactionError: Transaction failed for CreateReservation: 
E11000 duplicate key error collection: test.reservas index: 
unique_reservation_slot dup key: { barberoId: 
ObjectId('698bdc3e626399f145648e26'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698bdc3e626399f145648e24') }
          at Function.executeInTransaction (C:\Users\Kristian\Desktop\barber-saas
\backend\src\utils\TransactionManager.js:88:42)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at CreateReserva.execute (C:\Users\Kristian\Desktop\barber-saas\backend
\src\application\use-cases\reservas\CreateReserva.js:26:34)
          at Object.<anonymous>.exports.crearReservaBySlug (C:\Users\Kristian\Des
ktop\barber-saas\backend\src\controllers\public.controller.js:140:25) {
        isTransactionError: true,
        originalError: MongoServerError: E11000 duplicate key error collection: 
test.reservas index: unique_reservation_slot dup key: { barberoId: 
ObjectId('698bdc3e626399f145648e26'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698bdc3e626399f145648e24') }
            at InsertOneOperation.handleOk (C:\Users\Kristian\Desktop\barber-saas
\backend\node_modules\mongodb\src\operations\insert.ts:79:13)
            at tryOperation (C:\Users\Kristian\Desktop\barber-saas\backend\node_m
odules\mongodb\src\operations\execute_operation.ts:294:26)
            at processTicksAndRejections 
(node:internal/process/task_queues:105:5)
            at executeOperation (C:\Users\Kristian\Desktop\barber-saas\backend\no
de_modules\mongodb\src\operations\execute_operation.ts:123:12)
            at Collection.insertOne (C:\Users\Kristian\Desktop\barber-saas\backen
d\node_modules\mongodb\src\collection.ts:294:12)
            at model.$__save (C:\Users\Kristian\Desktop\barber-saas\backend\node_
modules\mongoose\lib\model.js:398:16)
            at model.save (C:\Users\Kristian\Desktop\barber-saas\backend\node_mod
ules\mongoose\lib\model.js:609:5)
            at C:\Users\Kristian\Desktop\barber-saas\backend\node_modules\mongoos
e\lib\model.js:2722:9
            at async Promise.all (index 0)
            at Function.create (C:\Users\Kristian\Desktop\barber-saas\backend\nod
e_modules\mongoose\lib\model.js:2707:11)
            at MongoReservaRepository.save (C:\Users\Kristian\Desktop\barber-saas
\backend\src\infrastructure\database\mongodb\repositories\MongoReservaRepository.
js:15:16)
            at TransactionManager.executeInTransaction.operationName (C:\Users\Kr
istian\Desktop\barber-saas\backend\src\application\use-cases\reservas\CreateReser
va.js:72:42)
            at Function.executeInTransaction (C:\Users\Kristian\Desktop\barber-sa
as\backend\src\utils\TransactionManager.js:57:32)
            at CreateReserva.execute (C:\Users\Kristian\Desktop\barber-saas\backe
nd\src\application\use-cases\reservas\CreateReserva.js:26:34)
            at Object.<anonymous>.exports.crearReservaBySlug (C:\Users\Kristian\D
esktop\barber-saas\backend\src\controllers\public.controller.js:140:25) {
          errorLabelSet: Set(0) {},
          errorResponse: {
            index: 0,
            code: 11000,
            errmsg: `E11000 duplicate key error collection: test.reservas index: 
unique_reservation_slot dup key: { barberoId: 
ObjectId('698bdc3e626399f145648e26'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698bdc3e626399f145648e24') }`,
            keyPattern: [Object],
            keyValue: [Object]
          },
          index: 0,
          code: 11000,
          keyPattern: { barberoId: 1, fecha: 1, hora: 1, barberiaId: 1 },
          keyValue: {
            barberoId: new ObjectId('698bdc3e626399f145648e26'),
            fecha: 2026-03-16T00:00:00.000Z,
            hora: '14:00',
            barberiaId: new ObjectId('698bdc3e626399f145648e24')
          }
        },
        context: { operationName: 'CreateReservation', attempt: 2 },
        timestamp: 2026-02-11T01:32:47.700Z,
        originalStack: `MongoServerError: E11000 duplicate key error collection: 
test.reservas index: unique_reservation_slot dup key: { barberoId: 
ObjectId('698bdc3e626399f145648e26'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698bdc3e626399f145648e24') }\n` +
          '    at InsertOneOperation.handleOk (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\node_modules\\mongodb\\src\\operations\\insert.ts:79:13)\n' +
          '    at tryOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\backen
d\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:294:26)\n' +
          '    at processTicksAndRejections 
(node:internal/process/task_queues:105:5)\n' +
          '    at executeOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\ba
ckend\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:123:12)\n' +
          '    at Collection.insertOne (C:\\Users\\Kristian\\Desktop\\barber-saas
\\backend\\node_modules\\mongodb\\src\\collection.ts:294:12)\n' +
          '    at model.$__save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backe
nd\\node_modules\\mongoose\\lib\\model.js:398:16)\n' +
          '    at model.save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\
\node_modules\\mongoose\\lib\\model.js:609:5)\n' +
          '    at C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\\node_module
s\\mongoose\\lib\\model.js:2722:9\n' +
          '    at async Promise.all (index 0)\n' +
          '    at Function.create (C:\\Users\\Kristian\\Desktop\\barber-saas\\bac
kend\\node_modules\\mongoose\\lib\\model.js:2707:11)\n' +
          '    at MongoReservaRepository.save (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\src\\infrastructure\\database\\mongodb\\repositories\\MongoRese
rvaRepository.js:15:16)\n' +
          '    at TransactionManager.executeInTransaction.operationName (C:\\User
s\\Kristian\\Desktop\\barber-saas\\backend\\src\\application\\use-cases\\reservas
\\CreateReserva.js:72:42)\n' +
          '    at Function.executeInTransaction (C:\\Users\\Kristian\\Desktop\\ba
rber-saas\\backend\\src\\utils\\TransactionManager.js:57:32)\n' +
          '    at CreateReserva.execute (C:\\Users\\Kristian\\Desktop\\barber-saa
s\\backend\\src\\application\\use-cases\\reservas\\CreateReserva.js:26:34)\n' +
          '    at Object.<anonymous>.exports.crearReservaBySlug (C:\\Users\\Krist
ian\\Desktop\\barber-saas\\backend\\src\\controllers\\public.controller.js:140:25
)'
      }

    [0m [90m 4 |[39m
     [90m 5 |[39m [36mconst[39m errorHandler [33m=[39m (err[33m,[39m 
req[33m,[39m res[33m,[39m next) [33m=>[39m {
    [31m[1m>[22m[39m[90m 6 |[39m   console[33m.[39merror([32m"ƒö┤ 
ERROR:"[39m[33m,[39m err)[33m;[39m
     [90m   |[39m           [31m[1m^[22m[39m
     [90m 7 |[39m
     [90m 8 |[39m   [90m// ­ƒöÑ A├æADIR HEADERS CORS SI NO EXISTEN[39m
     [90m 9 |[39m   [36mconst[39m origin [33m=[39m 
req[33m.[39mheaders[33m.[39morigin[33m;[39m[0m

      at error (src/config/middleware/errorHandler.js:6:11)
      at Layer.handleError (node_modules/router/lib/layer.js:116:17)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at Layer.handleError (node_modules/router/lib/layer.js:111:12)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at Immediate.next (node_modules/router/index.js:291:5)
      at Immediate._onImmediate (node_modules/router/index.js:688:15)

    console.error
      ƒö┤ ERROR: TransactionError: Transaction failed for CreateReservation: 
E11000 duplicate key error collection: test.reservas index: 
unique_reservation_slot dup key: { barberoId: 
ObjectId('698bdc3e626399f145648e26'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698bdc3e626399f145648e24') }
          at Function.executeInTransaction (C:\Users\Kristian\Desktop\barber-saas
\backend\src\utils\TransactionManager.js:88:42)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at CreateReserva.execute (C:\Users\Kristian\Desktop\barber-saas\backend
\src\application\use-cases\reservas\CreateReserva.js:26:34)
          at Object.<anonymous>.exports.crearReservaBySlug (C:\Users\Kristian\Des
ktop\barber-saas\backend\src\controllers\public.controller.js:140:25) {
        isTransactionError: true,
        originalError: MongoServerError: E11000 duplicate key error collection: 
test.reservas index: unique_reservation_slot dup key: { barberoId: 
ObjectId('698bdc3e626399f145648e26'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698bdc3e626399f145648e24') }
            at InsertOneOperation.handleOk (C:\Users\Kristian\Desktop\barber-saas
\backend\node_modules\mongodb\src\operations\insert.ts:79:13)
            at tryOperation (C:\Users\Kristian\Desktop\barber-saas\backend\node_m
odules\mongodb\src\operations\execute_operation.ts:294:26)
            at processTicksAndRejections 
(node:internal/process/task_queues:105:5)
            at executeOperation (C:\Users\Kristian\Desktop\barber-saas\backend\no
de_modules\mongodb\src\operations\execute_operation.ts:123:12)
            at Collection.insertOne (C:\Users\Kristian\Desktop\barber-saas\backen
d\node_modules\mongodb\src\collection.ts:294:12)
            at model.$__save (C:\Users\Kristian\Desktop\barber-saas\backend\node_
modules\mongoose\lib\model.js:398:16)
            at model.save (C:\Users\Kristian\Desktop\barber-saas\backend\node_mod
ules\mongoose\lib\model.js:609:5)
            at C:\Users\Kristian\Desktop\barber-saas\backend\node_modules\mongoos
e\lib\model.js:2722:9
            at async Promise.all (index 0)
            at Function.create (C:\Users\Kristian\Desktop\barber-saas\backend\nod
e_modules\mongoose\lib\model.js:2707:11)
            at MongoReservaRepository.save (C:\Users\Kristian\Desktop\barber-saas
\backend\src\infrastructure\database\mongodb\repositories\MongoReservaRepository.
js:15:16)
            at TransactionManager.executeInTransaction.operationName (C:\Users\Kr
istian\Desktop\barber-saas\backend\src\application\use-cases\reservas\CreateReser
va.js:72:42)
            at Function.executeInTransaction (C:\Users\Kristian\Desktop\barber-sa
as\backend\src\utils\TransactionManager.js:57:32)
            at CreateReserva.execute (C:\Users\Kristian\Desktop\barber-saas\backe
nd\src\application\use-cases\reservas\CreateReserva.js:26:34)
            at Object.<anonymous>.exports.crearReservaBySlug (C:\Users\Kristian\D
esktop\barber-saas\backend\src\controllers\public.controller.js:140:25) {
          errorLabelSet: Set(0) {},
          errorResponse: {
            index: 0,
            code: 11000,
            errmsg: `E11000 duplicate key error collection: test.reservas index: 
unique_reservation_slot dup key: { barberoId: 
ObjectId('698bdc3e626399f145648e26'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698bdc3e626399f145648e24') }`,
            keyPattern: [Object],
            keyValue: [Object]
          },
          index: 0,
          code: 11000,
          keyPattern: { barberoId: 1, fecha: 1, hora: 1, barberiaId: 1 },
          keyValue: {
            barberoId: new ObjectId('698bdc3e626399f145648e26'),
            fecha: 2026-03-16T00:00:00.000Z,
            hora: '14:00',
            barberiaId: new ObjectId('698bdc3e626399f145648e24')
          }
        },
        context: { operationName: 'CreateReservation', attempt: 2 },
        timestamp: 2026-02-11T01:32:47.701Z,
        originalStack: `MongoServerError: E11000 duplicate key error collection: 
test.reservas index: unique_reservation_slot dup key: { barberoId: 
ObjectId('698bdc3e626399f145648e26'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698bdc3e626399f145648e24') }\n` +
          '    at InsertOneOperation.handleOk (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\node_modules\\mongodb\\src\\operations\\insert.ts:79:13)\n' +
          '    at tryOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\backen
d\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:294:26)\n' +
          '    at processTicksAndRejections 
(node:internal/process/task_queues:105:5)\n' +
          '    at executeOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\ba
ckend\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:123:12)\n' +
          '    at Collection.insertOne (C:\\Users\\Kristian\\Desktop\\barber-saas
\\backend\\node_modules\\mongodb\\src\\collection.ts:294:12)\n' +
          '    at model.$__save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backe
nd\\node_modules\\mongoose\\lib\\model.js:398:16)\n' +
          '    at model.save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\
\node_modules\\mongoose\\lib\\model.js:609:5)\n' +
          '    at C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\\node_module
s\\mongoose\\lib\\model.js:2722:9\n' +
          '    at async Promise.all (index 0)\n' +
          '    at Function.create (C:\\Users\\Kristian\\Desktop\\barber-saas\\bac
kend\\node_modules\\mongoose\\lib\\model.js:2707:11)\n' +
          '    at MongoReservaRepository.save (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\src\\infrastructure\\database\\mongodb\\repositories\\MongoRese
rvaRepository.js:15:16)\n' +
          '    at TransactionManager.executeInTransaction.operationName (C:\\User
s\\Kristian\\Desktop\\barber-saas\\backend\\src\\application\\use-cases\\reservas
\\CreateReserva.js:72:42)\n' +
          '    at Function.executeInTransaction (C:\\Users\\Kristian\\Desktop\\ba
rber-saas\\backend\\src\\utils\\TransactionManager.js:57:32)\n' +
          '    at CreateReserva.execute (C:\\Users\\Kristian\\Desktop\\barber-saa
s\\backend\\src\\application\\use-cases\\reservas\\CreateReserva.js:26:34)\n' +
          '    at Object.<anonymous>.exports.crearReservaBySlug (C:\\Users\\Krist
ian\\Desktop\\barber-saas\\backend\\src\\controllers\\public.controller.js:140:25
)'
      }

    [0m [90m 4 |[39m
     [90m 5 |[39m [36mconst[39m errorHandler [33m=[39m (err[33m,[39m 
req[33m,[39m res[33m,[39m next) [33m=>[39m {
    [31m[1m>[22m[39m[90m 6 |[39m   console[33m.[39merror([32m"ƒö┤ 
ERROR:"[39m[33m,[39m err)[33m;[39m
     [90m   |[39m           [31m[1m^[22m[39m
     [90m 7 |[39m
     [90m 8 |[39m   [90m// ­ƒöÑ A├æADIR HEADERS CORS SI NO EXISTEN[39m
     [90m 9 |[39m   [36mconst[39m origin [33m=[39m 
req[33m.[39mheaders[33m.[39morigin[33m;[39m[0m

      at error (src/config/middleware/errorHandler.js:6:11)
      at Layer.handleError (node_modules/router/lib/layer.js:116:17)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at Layer.handleError (node_modules/router/lib/layer.js:111:12)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at Immediate.next (node_modules/router/index.js:291:5)
      at Immediate._onImmediate (node_modules/router/index.js:688:15)

    console.log
      ƒôí [POST] 
/api/public/barberias/test-barberia/barberos/698bdc40626399f145648f39/reservar

      at log (src/app.js:93:11)

    console.warn
      ÔÜá´©Å  [Security] Rate limit exceeded {
        ip: '::ffff:127.0.0.1',
        method: 'POST',
        path: '/test-barberia/barberos/698bdc40626399f145648f39/reservar',
        max: 30
      }

    [0m [90m 38 |[39m [90m     */[39m
     [90m 39 |[39m     [36mstatic[39m warn(context[33m,[39m 
message[33m,[39m metadata [33m=[39m {}) {
    [31m[1m>[22m[39m[90m 40 |[39m         
console[33m.[39mwarn([32m`ÔÜá´©Å  [${context}] ${message}`[39m[33m,[39m 
metadata)[33m;[39m
     [90m    |[39m                 [31m[1m^[22m[39m
     [90m 41 |[39m     }
     [90m 42 |[39m
     [90m 43 |[39m     [90m/**[39m[0m

      at Function.warn (src/shared/Logger.js:40:17)
      at Object.warn [as handler] (src/middleware/rateLimit.middleware.js:18:20)
      at node_modules/express-rate-limit/dist/index.cjs:939:16
      at node_modules/express-rate-limit/dist/index.cjs:825:5

    console.log
      ƒôí [POST] 
/api/public/barberias/test-barberia/barberos/698bdc40626399f145648f59/reservar

      at log (src/app.js:93:11)

    console.warn
      ÔÜá´©Å  [Security] Rate limit exceeded {
        ip: '::ffff:127.0.0.1',
        method: 'POST',
        path: '/test-barberia/barberos/698bdc40626399f145648f59/reservar',
        max: 30
      }

    [0m [90m 38 |[39m [90m     */[39m
     [90m 39 |[39m     [36mstatic[39m warn(context[33m,[39m 
message[33m,[39m metadata [33m=[39m {}) {
    [31m[1m>[22m[39m[90m 40 |[39m         
console[33m.[39mwarn([32m`ÔÜá´©Å  [${context}] ${message}`[39m[33m,[39m 
metadata)[33m;[39m
     [90m    |[39m                 [31m[1m^[22m[39m
     [90m 41 |[39m     }
     [90m 42 |[39m
     [90m 43 |[39m     [90m/**[39m[0m

      at Function.warn (src/shared/Logger.js:40:17)
      at Object.warn [as handler] (src/middleware/rateLimit.middleware.js:18:20)
      at node_modules/express-rate-limit/dist/index.cjs:939:16
      at node_modules/express-rate-limit/dist/index.cjs:825:5

    console.log
      ƒôí [POST] 
/api/public/barberias/test-barberia/barberos/698bdc40626399f145648f59/reservar

      at log (src/app.js:93:11)

    console.warn
      ÔÜá´©Å  [Security] Rate limit exceeded {
        ip: '::ffff:127.0.0.1',
        method: 'POST',
        path: '/test-barberia/barberos/698bdc40626399f145648f59/reservar',
        max: 30
      }

    [0m [90m 38 |[39m [90m     */[39m
     [90m 39 |[39m     [36mstatic[39m warn(context[33m,[39m 
message[33m,[39m metadata [33m=[39m {}) {
    [31m[1m>[22m[39m[90m 40 |[39m         
console[33m.[39mwarn([32m`ÔÜá´©Å  [${context}] ${message}`[39m[33m,[39m 
metadata)[33m;[39m
     [90m    |[39m                 [31m[1m^[22m[39m
     [90m 41 |[39m     }
     [90m 42 |[39m
     [90m 43 |[39m     [90m/**[39m[0m

      at Function.warn (src/shared/Logger.js:40:17)
      at Object.warn [as handler] (src/middleware/rateLimit.middleware.js:18:20)
      at node_modules/express-rate-limit/dist/index.cjs:939:16
      at node_modules/express-rate-limit/dist/index.cjs:825:5

    console.log
      ƒôí [POST] 
/api/public/barberias/test-barberia/barberos/698bdc40626399f145648f59/reservar

      at log (src/app.js:93:11)

    console.warn
      ÔÜá´©Å  [Security] Rate limit exceeded {
        ip: '::ffff:127.0.0.1',
        method: 'POST',
        path: '/test-barberia/barberos/698bdc40626399f145648f59/reservar',
        max: 30
      }

    [0m [90m 38 |[39m [90m     */[39m
     [90m 39 |[39m     [36mstatic[39m warn(context[33m,[39m 
message[33m,[39m metadata [33m=[39m {}) {
    [31m[1m>[22m[39m[90m 40 |[39m         
console[33m.[39mwarn([32m`ÔÜá´©Å  [${context}] ${message}`[39m[33m,[39m 
metadata)[33m;[39m
     [90m    |[39m                 [31m[1m^[22m[39m
     [90m 41 |[39m     }
     [90m 42 |[39m
     [90m 43 |[39m     [90m/**[39m[0m

      at Function.warn (src/shared/Logger.js:40:17)
      at Object.warn [as handler] (src/middleware/rateLimit.middleware.js:18:20)
      at node_modules/express-rate-limit/dist/index.cjs:939:16
      at node_modules/express-rate-limit/dist/index.cjs:825:5

    console.log
      ƒôí [POST] 
/api/public/barberias/test-barberia/barberos/698bdc40626399f145648f59/reservar

      at log (src/app.js:93:11)

    console.warn
      ÔÜá´©Å  [Security] Rate limit exceeded {
        ip: '::ffff:127.0.0.1',
        method: 'POST',
        path: '/test-barberia/barberos/698bdc40626399f145648f59/reservar',
        max: 30
      }

    [0m [90m 38 |[39m [90m     */[39m
     [90m 39 |[39m     [36mstatic[39m warn(context[33m,[39m 
message[33m,[39m metadata [33m=[39m {}) {
    [31m[1m>[22m[39m[90m 40 |[39m         
console[33m.[39mwarn([32m`ÔÜá´©Å  [${context}] ${message}`[39m[33m,[39m 
metadata)[33m;[39m
     [90m    |[39m                 [31m[1m^[22m[39m
     [90m 41 |[39m     }
     [90m 42 |[39m
     [90m 43 |[39m     [90m/**[39m[0m

      at Function.warn (src/shared/Logger.js:40:17)
      at Object.warn [as handler] (src/middleware/rateLimit.middleware.js:18:20)
      at node_modules/express-rate-limit/dist/index.cjs:939:16
      at node_modules/express-rate-limit/dist/index.cjs:825:5

    console.log
      ƒôí [POST] 
/api/public/barberias/test-barberia/barberos/698bdc40626399f145648f59/reservar

      at log (src/app.js:93:11)

    console.warn
      ÔÜá´©Å  [Security] Rate limit exceeded {
        ip: '::ffff:127.0.0.1',
        method: 'POST',
        path: '/test-barberia/barberos/698bdc40626399f145648f59/reservar',
        max: 30
      }

    [0m [90m 38 |[39m [90m     */[39m
     [90m 39 |[39m     [36mstatic[39m warn(context[33m,[39m 
message[33m,[39m metadata [33m=[39m {}) {
    [31m[1m>[22m[39m[90m 40 |[39m         
console[33m.[39mwarn([32m`ÔÜá´©Å  [${context}] ${message}`[39m[33m,[39m 
metadata)[33m;[39m
     [90m    |[39m                 [31m[1m^[22m[39m
     [90m 41 |[39m     }
     [90m 42 |[39m
     [90m 43 |[39m     [90m/**[39m[0m

      at Function.warn (src/shared/Logger.js:40:17)
      at Object.warn [as handler] (src/middleware/rateLimit.middleware.js:18:20)
      at node_modules/express-rate-limit/dist/index.cjs:939:16
      at node_modules/express-rate-limit/dist/index.cjs:825:5

    console.log
      ƒôí [POST] 
/api/public/barberias/test-barberia/barberos/698bdc40626399f145648f59/reservar

      at log (src/app.js:93:11)

    console.warn
      ÔÜá´©Å  [Security] Rate limit exceeded {
        ip: '::ffff:127.0.0.1',
        method: 'POST',
        path: '/test-barberia/barberos/698bdc40626399f145648f59/reservar',
        max: 30
      }

    [0m [90m 38 |[39m [90m     */[39m
     [90m 39 |[39m     [36mstatic[39m warn(context[33m,[39m 
message[33m,[39m metadata [33m=[39m {}) {
    [31m[1m>[22m[39m[90m 40 |[39m         
console[33m.[39mwarn([32m`ÔÜá´©Å  [${context}] ${message}`[39m[33m,[39m 
metadata)[33m;[39m
     [90m    |[39m                 [31m[1m^[22m[39m
     [90m 41 |[39m     }
     [90m 42 |[39m
     [90m 43 |[39m     [90m/**[39m[0m

      at Function.warn (src/shared/Logger.js:40:17)
      at Object.warn [as handler] (src/middleware/rateLimit.middleware.js:18:20)
      at node_modules/express-rate-limit/dist/index.cjs:939:16
      at node_modules/express-rate-limit/dist/index.cjs:825:5

    console.log
      ƒôí [POST] 
/api/public/barberias/test-barberia/barberos/698bdc40626399f145648f59/reservar

      at log (src/app.js:93:11)

    console.warn
      ÔÜá´©Å  [Security] Rate limit exceeded {
        ip: '::ffff:127.0.0.1',
        method: 'POST',
        path: '/test-barberia/barberos/698bdc40626399f145648f59/reservar',
        max: 30
      }

    [0m [90m 38 |[39m [90m     */[39m
     [90m 39 |[39m     [36mstatic[39m warn(context[33m,[39m 
message[33m,[39m metadata [33m=[39m {}) {
    [31m[1m>[22m[39m[90m 40 |[39m         
console[33m.[39mwarn([32m`ÔÜá´©Å  [${context}] ${message}`[39m[33m,[39m 
metadata)[33m;[39m
     [90m    |[39m                 [31m[1m^[22m[39m
     [90m 41 |[39m     }
     [90m 42 |[39m
     [90m 43 |[39m     [90m/**[39m[0m

      at Function.warn (src/shared/Logger.js:40:17)
      at Object.warn [as handler] (src/middleware/rateLimit.middleware.js:18:20)
      at node_modules/express-rate-limit/dist/index.cjs:939:16
      at node_modules/express-rate-limit/dist/index.cjs:825:5

    console.log
      ƒôí [POST] 
/api/public/barberias/test-barberia/barberos/698bdc40626399f145648f59/reservar

      at log (src/app.js:93:11)

    console.warn
      ÔÜá´©Å  [Security] Rate limit exceeded {
        ip: '::ffff:127.0.0.1',
        method: 'POST',
        path: '/test-barberia/barberos/698bdc40626399f145648f59/reservar',
        max: 30
      }

    [0m [90m 38 |[39m [90m     */[39m
     [90m 39 |[39m     [36mstatic[39m warn(context[33m,[39m 
message[33m,[39m metadata [33m=[39m {}) {
    [31m[1m>[22m[39m[90m 40 |[39m         
console[33m.[39mwarn([32m`ÔÜá´©Å  [${context}] ${message}`[39m[33m,[39m 
metadata)[33m;[39m
     [90m    |[39m                 [31m[1m^[22m[39m
     [90m 41 |[39m     }
     [90m 42 |[39m
     [90m 43 |[39m     [90m/**[39m[0m

      at Function.warn (src/shared/Logger.js:40:17)
      at Object.warn [as handler] (src/middleware/rateLimit.middleware.js:18:20)
      at node_modules/express-rate-limit/dist/index.cjs:939:16
      at node_modules/express-rate-limit/dist/index.cjs:825:5

    console.log
      ƒôí [POST] 
/api/public/barberias/test-barberia/barberos/698bdc40626399f145648f59/reservar

      at log (src/app.js:93:11)

    console.warn
      ÔÜá´©Å  [Security] Rate limit exceeded {
        ip: '::ffff:127.0.0.1',
        method: 'POST',
        path: '/test-barberia/barberos/698bdc40626399f145648f59/reservar',
        max: 30
      }

    [0m [90m 38 |[39m [90m     */[39m
     [90m 39 |[39m     [36mstatic[39m warn(context[33m,[39m 
message[33m,[39m metadata [33m=[39m {}) {
    [31m[1m>[22m[39m[90m 40 |[39m         
console[33m.[39mwarn([32m`ÔÜá´©Å  [${context}] ${message}`[39m[33m,[39m 
metadata)[33m;[39m
     [90m    |[39m                 [31m[1m^[22m[39m
     [90m 41 |[39m     }
     [90m 42 |[39m
     [90m 43 |[39m     [90m/**[39m[0m

      at Function.warn (src/shared/Logger.js:40:17)
      at Object.warn [as handler] (src/middleware/rateLimit.middleware.js:18:20)
      at node_modules/express-rate-limit/dist/index.cjs:939:16
      at node_modules/express-rate-limit/dist/index.cjs:825:5

    console.log
      ƒôí [POST] 
/api/public/barberias/test-barberia/barberos/698bdc40626399f145648f59/reservar

      at log (src/app.js:93:11)

    console.warn
      ÔÜá´©Å  [Security] Rate limit exceeded {
        ip: '::ffff:127.0.0.1',
        method: 'POST',
        path: '/test-barberia/barberos/698bdc40626399f145648f59/reservar',
        max: 30
      }

    [0m [90m 38 |[39m [90m     */[39m
     [90m 39 |[39m     [36mstatic[39m warn(context[33m,[39m 
message[33m,[39m metadata [33m=[39m {}) {
    [31m[1m>[22m[39m[90m 40 |[39m         
console[33m.[39mwarn([32m`ÔÜá´©Å  [${context}] ${message}`[39m[33m,[39m 
metadata)[33m;[39m
     [90m    |[39m                 [31m[1m^[22m[39m
     [90m 41 |[39m     }
     [90m 42 |[39m
     [90m 43 |[39m     [90m/**[39m[0m

      at Function.warn (src/shared/Logger.js:40:17)
      at Object.warn [as handler] (src/middleware/rateLimit.middleware.js:18:20)
      at node_modules/express-rate-limit/dist/index.cjs:939:16
      at node_modules/express-rate-limit/dist/index.cjs:825:5

    console.log
      ƒôí [POST] 
/api/public/barberias/test-barberia/barberos/698bdc40626399f145648f59/reservar

      at log (src/app.js:93:11)

    console.warn
      ÔÜá´©Å  [Security] Rate limit exceeded {
        ip: '::ffff:127.0.0.1',
        method: 'POST',
        path: '/test-barberia/barberos/698bdc40626399f145648f59/reservar',
        max: 30
      }

    [0m [90m 38 |[39m [90m     */[39m
     [90m 39 |[39m     [36mstatic[39m warn(context[33m,[39m 
message[33m,[39m metadata [33m=[39m {}) {
    [31m[1m>[22m[39m[90m 40 |[39m         
console[33m.[39mwarn([32m`ÔÜá´©Å  [${context}] ${message}`[39m[33m,[39m 
metadata)[33m;[39m
     [90m    |[39m                 [31m[1m^[22m[39m
     [90m 41 |[39m     }
     [90m 42 |[39m
     [90m 43 |[39m     [90m/**[39m[0m

      at Function.warn (src/shared/Logger.js:40:17)
      at Object.warn [as handler] (src/middleware/rateLimit.middleware.js:18:20)
      at node_modules/express-rate-limit/dist/index.cjs:939:16
      at node_modules/express-rate-limit/dist/index.cjs:825:5

    console.log
      ƒôí [POST] 
/api/public/barberias/test-barberia/barberos/698bdc40626399f145648f59/reservar

      at log (src/app.js:93:11)

    console.warn
      ÔÜá´©Å  [Security] Rate limit exceeded {
        ip: '::ffff:127.0.0.1',
        method: 'POST',
        path: '/test-barberia/barberos/698bdc40626399f145648f59/reservar',
        max: 30
      }

    [0m [90m 38 |[39m [90m     */[39m
     [90m 39 |[39m     [36mstatic[39m warn(context[33m,[39m 
message[33m,[39m metadata [33m=[39m {}) {
    [31m[1m>[22m[39m[90m 40 |[39m         
console[33m.[39mwarn([32m`ÔÜá´©Å  [${context}] ${message}`[39m[33m,[39m 
metadata)[33m;[39m
     [90m    |[39m                 [31m[1m^[22m[39m
     [90m 41 |[39m     }
     [90m 42 |[39m
     [90m 43 |[39m     [90m/**[39m[0m

      at Function.warn (src/shared/Logger.js:40:17)
      at Object.warn [as handler] (src/middleware/rateLimit.middleware.js:18:20)
      at node_modules/express-rate-limit/dist/index.cjs:939:16
      at node_modules/express-rate-limit/dist/index.cjs:825:5

    console.log
      ƒôí [POST] 
/api/public/barberias/test-barberia/barberos/698bdc40626399f145648f59/reservar

      at log (src/app.js:93:11)

    console.warn
      ÔÜá´©Å  [Security] Rate limit exceeded {
        ip: '::ffff:127.0.0.1',
        method: 'POST',
        path: '/test-barberia/barberos/698bdc40626399f145648f59/reservar',
        max: 30
      }

    [0m [90m 38 |[39m [90m     */[39m
     [90m 39 |[39m     [36mstatic[39m warn(context[33m,[39m 
message[33m,[39m metadata [33m=[39m {}) {
    [31m[1m>[22m[39m[90m 40 |[39m         
console[33m.[39mwarn([32m`ÔÜá´©Å  [${context}] ${message}`[39m[33m,[39m 
metadata)[33m;[39m
     [90m    |[39m                 [31m[1m^[22m[39m
     [90m 41 |[39m     }
     [90m 42 |[39m
     [90m 43 |[39m     [90m/**[39m[0m

      at Function.warn (src/shared/Logger.js:40:17)
      at Object.warn [as handler] (src/middleware/rateLimit.middleware.js:18:20)
      at node_modules/express-rate-limit/dist/index.cjs:939:16
      at node_modules/express-rate-limit/dist/index.cjs:825:5

    console.log
      ƒôí [POST] 
/api/public/barberias/test-barberia/barberos/698bdc40626399f145648f59/reservar

      at log (src/app.js:93:11)

    console.warn
      ÔÜá´©Å  [Security] Rate limit exceeded {
        ip: '::ffff:127.0.0.1',
        method: 'POST',
        path: '/test-barberia/barberos/698bdc40626399f145648f59/reservar',
        max: 30
      }

    [0m [90m 38 |[39m [90m     */[39m
     [90m 39 |[39m     [36mstatic[39m warn(context[33m,[39m 
message[33m,[39m metadata [33m=[39m {}) {
    [31m[1m>[22m[39m[90m 40 |[39m         
console[33m.[39mwarn([32m`ÔÜá´©Å  [${context}] ${message}`[39m[33m,[39m 
metadata)[33m;[39m
     [90m    |[39m                 [31m[1m^[22m[39m
     [90m 41 |[39m     }
     [90m 42 |[39m
     [90m 43 |[39m     [90m/**[39m[0m

      at Function.warn (src/shared/Logger.js:40:17)
      at Object.warn [as handler] (src/middleware/rateLimit.middleware.js:18:20)
      at node_modules/express-rate-limit/dist/index.cjs:939:16
      at node_modules/express-rate-limit/dist/index.cjs:825:5

    console.log
      ƒôí [POST] 
/api/public/barberias/test-barberia/barberos/698bdc40626399f145648f59/reservar

      at log (src/app.js:93:11)

    console.warn
      ÔÜá´©Å  [Security] Rate limit exceeded {
        ip: '::ffff:127.0.0.1',
        method: 'POST',
        path: '/test-barberia/barberos/698bdc40626399f145648f59/reservar',
        max: 30
      }

    [0m [90m 38 |[39m [90m     */[39m
     [90m 39 |[39m     [36mstatic[39m warn(context[33m,[39m 
message[33m,[39m metadata [33m=[39m {}) {
    [31m[1m>[22m[39m[90m 40 |[39m         
console[33m.[39mwarn([32m`ÔÜá´©Å  [${context}] ${message}`[39m[33m,[39m 
metadata)[33m;[39m
     [90m    |[39m                 [31m[1m^[22m[39m
     [90m 41 |[39m     }
     [90m 42 |[39m
     [90m 43 |[39m     [90m/**[39m[0m

      at Function.warn (src/shared/Logger.js:40:17)
      at Object.warn [as handler] (src/middleware/rateLimit.middleware.js:18:20)
      at node_modules/express-rate-limit/dist/index.cjs:939:16
      at node_modules/express-rate-limit/dist/index.cjs:825:5

    console.log
      ƒôí [POST] 
/api/public/barberias/test-barberia/barberos/698bdc40626399f145648f59/reservar

      at log (src/app.js:93:11)

    console.warn
      ÔÜá´©Å  [Security] Rate limit exceeded {
        ip: '::ffff:127.0.0.1',
        method: 'POST',
        path: '/test-barberia/barberos/698bdc40626399f145648f59/reservar',
        max: 30
      }

    [0m [90m 38 |[39m [90m     */[39m
     [90m 39 |[39m     [36mstatic[39m warn(context[33m,[39m 
message[33m,[39m metadata [33m=[39m {}) {
    [31m[1m>[22m[39m[90m 40 |[39m         
console[33m.[39mwarn([32m`ÔÜá´©Å  [${context}] ${message}`[39m[33m,[39m 
metadata)[33m;[39m
     [90m    |[39m                 [31m[1m^[22m[39m
     [90m 41 |[39m     }
     [90m 42 |[39m
     [90m 43 |[39m     [90m/**[39m[0m

      at Function.warn (src/shared/Logger.js:40:17)
      at Object.warn [as handler] (src/middleware/rateLimit.middleware.js:18:20)
      at node_modules/express-rate-limit/dist/index.cjs:939:16
      at node_modules/express-rate-limit/dist/index.cjs:825:5

    console.log
      ƒôí [POST] 
/api/public/barberias/test-barberia/barberos/698bdc40626399f145648f59/reservar

      at log (src/app.js:93:11)

    console.warn
      ÔÜá´©Å  [Security] Rate limit exceeded {
        ip: '::ffff:127.0.0.1',
        method: 'POST',
        path: '/test-barberia/barberos/698bdc40626399f145648f59/reservar',
        max: 30
      }

    [0m [90m 38 |[39m [90m     */[39m
     [90m 39 |[39m     [36mstatic[39m warn(context[33m,[39m 
message[33m,[39m metadata [33m=[39m {}) {
    [31m[1m>[22m[39m[90m 40 |[39m         
console[33m.[39mwarn([32m`ÔÜá´©Å  [${context}] ${message}`[39m[33m,[39m 
metadata)[33m;[39m
     [90m    |[39m                 [31m[1m^[22m[39m
     [90m 41 |[39m     }
     [90m 42 |[39m
     [90m 43 |[39m     [90m/**[39m[0m

      at Function.warn (src/shared/Logger.js:40:17)
      at Object.warn [as handler] (src/middleware/rateLimit.middleware.js:18:20)
      at node_modules/express-rate-limit/dist/index.cjs:939:16
      at node_modules/express-rate-limit/dist/index.cjs:825:5

    console.log
      ƒôí [POST] 
/api/public/barberias/test-barberia/barberos/698bdc40626399f145648f59/reservar

      at log (src/app.js:93:11)

    console.warn
      ÔÜá´©Å  [Security] Rate limit exceeded {
        ip: '::ffff:127.0.0.1',
        method: 'POST',
        path: '/test-barberia/barberos/698bdc40626399f145648f59/reservar',
        max: 30
      }

    [0m [90m 38 |[39m [90m     */[39m
     [90m 39 |[39m     [36mstatic[39m warn(context[33m,[39m 
message[33m,[39m metadata [33m=[39m {}) {
    [31m[1m>[22m[39m[90m 40 |[39m         
console[33m.[39mwarn([32m`ÔÜá´©Å  [${context}] ${message}`[39m[33m,[39m 
metadata)[33m;[39m
     [90m    |[39m                 [31m[1m^[22m[39m
     [90m 41 |[39m     }
     [90m 42 |[39m
     [90m 43 |[39m     [90m/**[39m[0m

      at Function.warn (src/shared/Logger.js:40:17)
      at Object.warn [as handler] (src/middleware/rateLimit.middleware.js:18:20)
      at node_modules/express-rate-limit/dist/index.cjs:939:16
      at node_modules/express-rate-limit/dist/index.cjs:825:5

    console.log
      ƒôí [POST] 
/api/public/barberias/test-barberia/barberos/698bdc40626399f145648f59/reservar

      at log (src/app.js:93:11)

    console.warn
      ÔÜá´©Å  [Security] Rate limit exceeded {
        ip: '::ffff:127.0.0.1',
        method: 'POST',
        path: '/test-barberia/barberos/698bdc40626399f145648f59/reservar',
        max: 30
      }

    [0m [90m 38 |[39m [90m     */[39m
     [90m 39 |[39m     [36mstatic[39m warn(context[33m,[39m 
message[33m,[39m metadata [33m=[39m {}) {
    [31m[1m>[22m[39m[90m 40 |[39m         
console[33m.[39mwarn([32m`ÔÜá´©Å  [${context}] ${message}`[39m[33m,[39m 
metadata)[33m;[39m
     [90m    |[39m                 [31m[1m^[22m[39m
     [90m 41 |[39m     }
     [90m 42 |[39m
     [90m 43 |[39m     [90m/**[39m[0m

      at Function.warn (src/shared/Logger.js:40:17)
      at Object.warn [as handler] (src/middleware/rateLimit.middleware.js:18:20)
      at node_modules/express-rate-limit/dist/index.cjs:939:16
      at node_modules/express-rate-limit/dist/index.cjs:825:5

    console.log
      ƒôí [POST] 
/api/public/barberias/test-barberia/barberos/698bdc40626399f145648f59/reservar

      at log (src/app.js:93:11)

    console.warn
      ÔÜá´©Å  [Security] Rate limit exceeded {
        ip: '::ffff:127.0.0.1',
        method: 'POST',
        path: '/test-barberia/barberos/698bdc40626399f145648f59/reservar',
        max: 30
      }

    [0m [90m 38 |[39m [90m     */[39m
     [90m 39 |[39m     [36mstatic[39m warn(context[33m,[39m 
message[33m,[39m metadata [33m=[39m {}) {
    [31m[1m>[22m[39m[90m 40 |[39m         
console[33m.[39mwarn([32m`ÔÜá´©Å  [${context}] ${message}`[39m[33m,[39m 
metadata)[33m;[39m
     [90m    |[39m                 [31m[1m^[22m[39m
     [90m 41 |[39m     }
     [90m 42 |[39m
     [90m 43 |[39m     [90m/**[39m[0m

      at Function.warn (src/shared/Logger.js:40:17)
      at Object.warn [as handler] (src/middleware/rateLimit.middleware.js:18:20)
      at node_modules/express-rate-limit/dist/index.cjs:939:16
      at node_modules/express-rate-limit/dist/index.cjs:825:5

  ÔùÅ ƒöÑ Race Condition Stress Tests ÔÇ║ Performance bajo carga ÔÇ║ Maneja 20 
reservas diferentes simult├íneas sin problemas

    expect(received).toBeGreaterThan(expected)

    Expected: > 15
    Received:   0

    [0m [90m 255 |[39m
     [90m 256 |[39m             [90m// Todas deber├¡an tener ├®xito 
(diferentes horarios)[39m
    [31m[1m>[22m[39m[90m 257 |[39m             expect(successful[33m.[39m
length)[33m.[39mtoBeGreaterThan([35m15[39m)[33m;[39m [90m// Al menos 75% 
de ├®xito[39m
     [90m     |[39m                                       [31m[1m^[22m[39m
     [90m 258 |[39m
     [90m 259 |[39m             [90m// Verificar que no hay duplicados[39m
     [90m 260 |[39m             [36mconst[39m reservas [33m=[39m 
[36mawait[39m [33mReserva[39m[33m.[39mfind({[0m

      at Object.toBeGreaterThan (tests/race-condition-stress.test.js:257:39)

(node:25328) [MONGOOSE] Warning: Duplicate schema index on {"reviewToken":1} 
found. This is often due to declaring an index using both "index: true" and 
"schema.index()". Please remove the duplicate index definition.
(node:25328) [MONGOOSE] Warning: Duplicate schema index on {"reviewToken":1} 
found. This is often due to declaring an index using both "index: true" and 
"schema.index()". Please remove the duplicate index definition.
[0mPOST /api/auth/login [33m400[0m 2.751 ms - 132[0m
[0mPOST /api/auth/register [33m400[0m 0.970 ms - 356[0m
PASS tests/validation.test.js (10.868 s)
  ÔùÅ Console

    console.log
      [dotenv@17.2.3] injecting env (13) from .env -- tip: ƒöæ add access 
controls to secrets: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

    console.log
      ­ƒôí [POST] /api/auth/login

      at log (src/app.js:93:11)

    console.log
      ­ƒôí [POST] /api/auth/register

      at log (src/app.js:93:11)

    console.log
      ­ƒôí [POST] /api/auth/login

      at log (src/app.js:93:11)

    console.error
      ƒö┤ ERROR: MongooseError: Operation `users.findOne()` buffering timed out 
after 10000ms
          at Timeout.<anonymous> (C:\Users\Kristian\Desktop\barber-saas\backend\n
ode_modules\mongoose\lib\drivers\node-mongodb-native\collection.js:187:23)
          at listOnTimeout (node:internal/timers:588:17)
          at processTimers (node:internal/timers:523:7)

    [0m [90m 4 |[39m
     [90m 5 |[39m [36mconst[39m errorHandler [33m=[39m (err[33m,[39m 
req[33m,[39m res[33m,[39m next) [33m=>[39m {
    [31m[1m>[22m[39m[90m 6 |[39m   console[33m.[39merror([32m"ƒö┤ 
ERROR:"[39m[33m,[39m err)[33m;[39m
     [90m   |[39m           [31m[1m^[22m[39m
     [90m 7 |[39m
     [90m 8 |[39m   [90m// ­ƒöÑ A├æADIR HEADERS CORS SI NO EXISTEN[39m
     [90m 9 |[39m   [36mconst[39m origin [33m=[39m 
req[33m.[39mheaders[33m.[39morigin[33m;[39m[0m

      at error (src/config/middleware/errorHandler.js:6:11)
      at Layer.handleError (node_modules/router/lib/layer.js:116:17)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at Layer.handleError (node_modules/router/lib/layer.js:111:12)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at Immediate.next (node_modules/router/index.js:291:5)
      at Immediate._onImmediate (node_modules/router/index.js:688:15)

    console.log
      ­ƒôí [POST] /api/reservas/barberos/invalid-id/reservar

      at log (src/app.js:93:11)

    console.log
      ­ƒôí [POST] /api/reservas/barberos/507f1f77bcf86cd799439011/reservar

      at log (src/app.js:93:11)

    console.log
      ­ƒôí [POST] /api/reservas/barberos/507f1f77bcf86cd799439011/reservar

      at log (src/app.js:93:11)

    console.log
      ­ƒôí [POST] /api/barberias/test-slug/admin/servicios

      at log (src/app.js:93:11)

    console.log
      ­ƒôí [POST] /api/barberias/test-slug/admin/servicios

      at log (src/app.js:93:11)

    console.log
      ­ƒôí [GET] /api/reservas?barberoId%5B%24ne%5D

      at log (src/app.js:93:11)

    console.log
      ­ƒôí [POST] /api/auth/login

      at log (src/app.js:93:11)

    console.log
      ­ƒôí [POST] /api/reservas/barberos/507f1f77bcf86cd799439011/reservar

      at log (src/app.js:93:11)

    console.log
      ­ƒôí [POST] /api/reservas/barberos/507f1f77bcf86cd799439011/reservar

      at log (src/app.js:93:11)

    console.log
      ­ƒôí [POST] /api/auth/register

      at log (src/app.js:93:11)

[0mPOST /api/auth/login [31m500[0m 10008.645 ms - 467[0m
[0mPOST /api/reservas/barberos/invalid-id/reservar [33m400[0m 1.235 ms - 139[0m
[0mPOST /api/reservas/barberos/507f1f77bcf86cd799439011/reservar [33m400[0m 1.264 ms - 258[0m
[0mPOST /api/reservas/barberos/507f1f77bcf86cd799439011/reservar [33m400[0m 0.730 ms - 147[0m
[0mPOST /api/barberias/test-slug/admin/servicios [33m400[0m 0.877 ms - 135[0m
[0mPOST /api/barberias/test-slug/admin/servicios [33m400[0m 0.745 ms - 145[0m
[0mGET /api/reservas?barberoId%5B%24ne%5D [33m401[0m 0.180 ms - 27[0m
[0mPOST /api/auth/login [33m400[0m 0.648 ms - 157[0m
[0mPOST /api/reservas/barberos/507f1f77bcf86cd799439011/reservar [33m400[0m 0.706 ms - 149[0m
[0mPOST /api/reservas/barberos/507f1f77bcf86cd799439011/reservar [33m400[0m 0.708 ms - 149[0m
[0mPOST /api/auth/register [33m400[0m 0.795 ms - 606[0m
PASS tests/transactions.test.js
  ÔùÅ Console

    console.log
      [Transaction] Started: TestSuccessfulTransaction (attempt 1/3)

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:54:25)

    console.log
      [Transaction] Committed: TestSuccessfulTransaction

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:61:25)

    console.log
      [Transaction] Started: TestRollback (attempt 1/3)

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:54:25)

    console.log
      [Transaction] Aborted: TestRollback

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:69:29)

    console.error
      [Transaction] Failed: TestRollback {
        error: 'Simulated error',
        attempt: 1,
        stack: 'Error: Simulated error\n' +
          '    at TransactionManager.executeInTransaction.operationName (C:\\User
s\\Kristian\\Desktop\\barber-saas\\backend\\tests\\transactions.test.js:36:31)\n'
 +
          '    at Function.operation [as executeInTransaction] (C:\\Users\\Kristi
an\\Desktop\\barber-saas\\backend\\src\\utils\\TransactionManager.js:57:38)\n' +
          '    at processTicksAndRejections 
(node:internal/process/task_queues:105:5)\n' +
          '    at Object.<anonymous> (C:\\Users\\Kristian\\Desktop\\barber-saas\\
backend\\tests\\transactions.test.js:33:13)'
      }

    [0m [90m 80 |[39m
     [90m 81 |[39m                 [90m// Non-transient error or max retries 
reached[39m
    [31m[1m>[22m[39m[90m 82 |[39m                 
console[33m.[39merror([32m`[Transaction] Failed: 
${operationName}`[39m[33m,[39m {
     [90m    |[39m                         [31m[1m^[22m[39m
     [90m 83 |[39m                     error[33m:[39m 
error[33m.[39mmessage[33m,[39m
     [90m 84 |[39m                     attempt[33m:[39m attempt [33m+[39m 
[35m1[39m[33m,[39m
     [90m 85 |[39m                     stack[33m:[39m 
error[33m.[39mstack[0m

      at Function.error [as executeInTransaction] 
(src/utils/TransactionManager.js:82:25)
      at Object.<anonymous> (tests/transactions.test.js:33:13)

    console.log
      [Transaction] Started: TestRetry (attempt 1/3)

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:54:25)

    console.log
      [Transaction] Aborted: TestRetry

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:69:29)

    console.warn
      [Transaction] Transient error, retrying in 200ms: WriteConflict

    [0m [90m 74 |[39m                     attempt[33m++[39m[33m;[39m
     [90m 75 |[39m                     [36mconst[39m delay [33m=[39m 
retryDelay [33m*[39m [33mMath[39m[33m.[39mpow([35m2[39m[33m,[39m 
attempt)[33m;[39m [90m// Exponential backoff[39m
    [31m[1m>[22m[39m[90m 76 |[39m                     
console[33m.[39mwarn([32m`[Transaction] Transient error, retrying in 
${delay}ms:`[39m[33m,[39m error[33m.[39mmessage)[33m;[39m
     [90m    |[39m                             [31m[1m^[22m[39m
     [90m 77 |[39m                     [36mawait[39m 
[36mthis[39m[33m.[39msleep(delay)[33m;[39m
     [90m 78 |[39m                     [36mcontinue[39m[33m;[39m
     [90m 79 |[39m                 }[0m

      at Function.warn [as executeInTransaction] 
(src/utils/TransactionManager.js:76:29)
      at Object.<anonymous> (tests/transactions.test.js:46:28)

    console.log
      [Transaction] Started: TestRetry (attempt 2/3)

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:54:25)

    console.log
      [Transaction] Committed: TestRetry

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:61:25)

    console.log
      [Transaction] Started: TestNoRetry (attempt 1/3)

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:54:25)

    console.log
      [Transaction] Aborted: TestNoRetry

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:69:29)

    console.error
      [Transaction] Failed: TestNoRetry {
        error: 'Reserva no encontrada',
        attempt: 1,
        stack: 'Error: Reserva no encontrada\n' +
          '    at TransactionManager.executeInTransaction.operationName (C:\\User
s\\Kristian\\Desktop\\barber-saas\\backend\\tests\\transactions.test.js:71:31)\n'
 +
          '    at Function.operation [as executeInTransaction] (C:\\Users\\Kristi
an\\Desktop\\barber-saas\\backend\\src\\utils\\TransactionManager.js:57:38)\n' +
          '    at Object.<anonymous> (C:\\Users\\Kristian\\Desktop\\barber-saas\\
backend\\tests\\transactions.test.js:67:13)'
      }

    [0m [90m 80 |[39m
     [90m 81 |[39m                 [90m// Non-transient error or max retries 
reached[39m
    [31m[1m>[22m[39m[90m 82 |[39m                 
console[33m.[39merror([32m`[Transaction] Failed: 
${operationName}`[39m[33m,[39m {
     [90m    |[39m                         [31m[1m^[22m[39m
     [90m 83 |[39m                     error[33m:[39m 
error[33m.[39mmessage[33m,[39m
     [90m 84 |[39m                     attempt[33m:[39m attempt [33m+[39m 
[35m1[39m[33m,[39m
     [90m 85 |[39m                     stack[33m:[39m 
error[33m.[39mstack[0m

      at Function.error [as executeInTransaction] 
(src/utils/TransactionManager.js:82:25)
      at Object.<anonymous> (tests/transactions.test.js:67:13)

    console.log
      Ô£à MongoDB transactions are supported

      at Function.log [as validateTransactionSupport] 
(src/utils/TransactionManager.js:192:21)

PASS tests/revenue.test.js

Test Suites: 5 failed, 3 passed, 8 total
Tests:       20 failed, 54 passed, 74 total
Snapshots:   0 total
Time:        41.662 s
Ran all test suites.
