
> backend@1.0.0 test
> jest --runInBand --detectOpenHandles tests/multi-tenant-security.test.js

  console.log
    [dotenv@17.2.3] injecting env (13) from .env -- tip: ­ƒøá´©Å  run anywhere with `dotenvx run -- yourcommand`

      at _log (node_modules/dotenv/lib/main.js:142:11)

node.exe : (node:13292) [MONGOOSE] Warning: Duplicate schema index on {"reviewToken":1} 
found. This is often due to declaring an index using both "index: true" and 
"schema.index()". Please remove the duplicate index definition.
En línea: 1 Carácter: 1
+ & "C:\Program Files\nodejs/node.exe" "C:\Program Files\nodejs/node_mo ...
+ ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : NotSpecified: ((node:13292) [M...dex definition.:String) [] 
   , RemoteException
    + FullyQualifiedErrorId : NativeCommandError
 
(Use `node --trace-warnings ...` to show where the warning was created)
(node:13292) [MONGOOSE] Warning: Duplicate schema index on {"numeroPedido":1} found. This 
is often due to declaring an index using both "index: true" and "schema.index()". Please 
remove the duplicate index definition.
(node:13292) [MONGOOSE] Warning: Duplicate schema index on {"expiraEn":1} found. This is 
often due to declaring an index using both "index: true" and "schema.index()". Please 
remove the duplicate index definition.
(node:13292) [MONGOOSE] Warning: Duplicate schema index on {"reviewToken":1} found. This 
is often due to declaring an index using both "index: true" and "schema.index()". Please 
remove the duplicate index definition.
  console.log
    ­ƒôí [GET] /api/reservas/698a9287d94bdc45e57eb6ff

      at log (src/app.js:98:11)

[0mGET /api/reservas/698a9287d94bdc45e57eb6ff [33m404[0m 20.196 ms - 35[0m
  console.log
    ­ƒôí [PATCH] /api/reservas/698a9287d94bdc45e57eb72d/completar

      at log (src/app.js:98:11)

  console.log
    [Transaction] Started: CompleteReservation (attempt 1/3)

      at Function.log [as executeInTransaction] (src/utils/TransactionManager.js:54:25)

  console.log
    [Transaction] Aborted: CompleteReservation

      at Function.log [as executeInTransaction] (src/utils/TransactionManager.js:69:29)

  console.error
    [Transaction] Failed: CompleteReservation {
      error: 'Reserva no encontrada',
      attempt: 1,
      stack: 'Error: Reserva no encontrada\n' +
        '    at TransactionManager.executeInTransaction.operationName (C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\\src\\application\\use-cases\\reservas\\CompleteReserva.js:30:35)\n' +
        '    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n' +
        '    at Function.executeInTransaction (C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\\src\\utils\\TransactionManager.js:57:32)\n' +
        '    at CompleteReserva.execute (C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\\src\\application\\use-cases\\reservas\\CompleteReserva.js:24:24)\n' +
        '    at Object.<anonymous>.exports.completarReserva (C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\\src\\controllers\\reservas.controller.js:87:25)'
    }

    [0m [90m 80 |[39m
     [90m 81 |[39m                 [90m// Non-transient error or max retries reached[39m
    [31m[1m>[22m[39m[90m 82 |[39m                 console[33m.[39merror([32m`[Transaction] Failed: ${operationName}`[39m[33m,[39m {
     [90m    |[39m                         [31m[1m^[22m[39m
     [90m 83 |[39m                     error[33m:[39m error[33m.[39mmessage[33m,[39m
     [90m 84 |[39m                     attempt[33m:[39m attempt [33m+[39m [35m1[39m[33m,[39m
     [90m 85 |[39m                     stack[33m:[39m error[33m.[39mstack[0m

      at Function.error [as executeInTransaction] (src/utils/TransactionManager.js:82:25)
      at CompleteReserva.execute (src/application/use-cases/reservas/CompleteReserva.js:24:24)
      at Object.<anonymous>.exports.completarReserva (src/controllers/reservas.controller.js:87:25)

  console.error
    ­ƒö┤ ERROR: TransactionError: Transaction failed for CompleteReservation: Reserva no encontrada
        at Function.executeInTransaction (C:\Users\Kristian\Desktop\barber-saas\backend\src\utils\TransactionManager.js:88:42)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at CompleteReserva.execute (C:\Users\Kristian\Desktop\barber-saas\backend\src\application\use-cases\reservas\CompleteReserva.js:24:24)
        at Object.<anonymous>.exports.completarReserva (C:\Users\Kristian\Desktop\barber-saas\backend\src\controllers\reservas.controller.js:87:25) {
      isTransactionError: true,
      originalError: Error: Reserva no encontrada
          at TransactionManager.executeInTransaction.operationName (C:\Users\Kristian\Desktop\barber-saas\backend\src\application\use-cases\reservas\CompleteReserva.js:30:35)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at Function.executeInTransaction (C:\Users\Kristian\Desktop\barber-saas\backend\src\utils\TransactionManager.js:57:32)
          at CompleteReserva.execute (C:\Users\Kristian\Desktop\barber-saas\backend\src\application\use-cases\reservas\CompleteReserva.js:24:24)
          at Object.<anonymous>.exports.completarReserva (C:\Users\Kristian\Desktop\barber-saas\backend\src\controllers\reservas.controller.js:87:25) {
        statusCode: 404
      },
      context: { operationName: 'CompleteReservation', attempt: 1 },
      timestamp: 2026-02-10T02:05:59.799Z,
      originalStack: 'Error: Reserva no encontrada\n' +
        '    at TransactionManager.executeInTransaction.operationName (C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\\src\\application\\use-cases\\reservas\\CompleteReserva.js:30:35)\n' +
        '    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n' +
        '    at Function.executeInTransaction (C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\\src\\utils\\TransactionManager.js:57:32)\n' +
        '    at CompleteReserva.execute (C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\\src\\application\\use-cases\\reservas\\CompleteReserva.js:24:24)\n' +
        '    at Object.<anonymous>.exports.completarReserva (C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\\src\\controllers\\reservas.controller.js:87:25)',
      statusCode: 404
    }

    [0m [90m 4 |[39m
     [90m 5 |[39m [36mconst[39m errorHandler [33m=[39m (err[33m,[39m req[33m,[39m res[33m,[39m next) [33m=>[39m {
    [31m[1m>[22m[39m[90m 6 |[39m   console[33m.[39merror([32m"­ƒö┤ ERROR:"[39m[33m,[39m err)[33m;[39m
     [90m   |[39m           [31m[1m^[22m[39m
     [90m 7 |[39m
     [90m 8 |[39m   [90m// ­ƒöÑ A├æADIR HEADERS CORS SI NO EXISTEN[39m
     [90m 9 |[39m   [36mconst[39m origin [33m=[39m req[33m.[39mheaders[33m.[39morigin[33m;[39m[0m

      at error (src/config/middleware/errorHandler.js:6:11)
      at Layer.handleError (node_modules/router/lib/layer.js:116:17)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at node_modules/router/index.js:688:15
      at next (node_modules/router/index.js:276:14)
      at next (node_modules/router/lib/route.js:132:14)
      at next (src/controllers/reservas.controller.js:97:9)

[0mPATCH /api/reservas/698a9287d94bdc45e57eb72d/completar [33m404[0m 19.098 ms - 736[0m
  console.log
    ­ƒôí [PATCH] /api/reservas/698a9287d94bdc45e57eb75b/cancelar

      at log (src/app.js:98:11)

  console.log
    [Transaction] Started: CancelReservation (attempt 1/3)

      at Function.log [as executeInTransaction] (src/utils/TransactionManager.js:54:25)

  console.log
    [Transaction] Aborted: CancelReservation

      at Function.log [as executeInTransaction] (src/utils/TransactionManager.js:69:29)

  console.error
    [Transaction] Failed: CancelReservation {
      error: 'Reserva no encontrada',
      attempt: 1,
      stack: 'Error: Reserva no encontrada\n' +
        '    at TransactionManager.executeInTransaction.operationName (C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\\src\\application\\use-cases\\reservas\\CancelReserva.js:28:35)\n' +
        '    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n' +
        '    at Function.executeInTransaction (C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\\src\\utils\\TransactionManager.js:57:32)\n' +
        '    at CancelReserva.execute (C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\\src\\application\\use-cases\\reservas\\CancelReserva.js:22:25)\n' +
        '    at Object.<anonymous>.exports.cancelarReserva (C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\\src\\controllers\\reservas.controller.js:45:25)'
    }

    [0m [90m 80 |[39m
     [90m 81 |[39m                 [90m// Non-transient error or max retries reached[39m
    [31m[1m>[22m[39m[90m 82 |[39m                 console[33m.[39merror([32m`[Transaction] Failed: ${operationName}`[39m[33m,[39m {
     [90m    |[39m                         [31m[1m^[22m[39m
     [90m 83 |[39m                     error[33m:[39m error[33m.[39mmessage[33m,[39m
     [90m 84 |[39m                     attempt[33m:[39m attempt [33m+[39m [35m1[39m[33m,[39m
     [90m 85 |[39m                     stack[33m:[39m error[33m.[39mstack[0m

      at Function.error [as executeInTransaction] (src/utils/TransactionManager.js:82:25)
      at CancelReserva.execute (src/application/use-cases/reservas/CancelReserva.js:22:25)
      at Object.<anonymous>.exports.cancelarReserva (src/controllers/reservas.controller.js:45:25)

  console.error
    ­ƒö┤ ERROR: TransactionError: Transaction failed for CancelReservation: Reserva no encontrada
        at Function.executeInTransaction (C:\Users\Kristian\Desktop\barber-saas\backend\src\utils\TransactionManager.js:88:42)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at CancelReserva.execute (C:\Users\Kristian\Desktop\barber-saas\backend\src\application\use-cases\reservas\CancelReserva.js:22:25)
        at Object.<anonymous>.exports.cancelarReserva (C:\Users\Kristian\Desktop\barber-saas\backend\src\controllers\reservas.controller.js:45:25) {
      isTransactionError: true,
      originalError: Error: Reserva no encontrada
          at TransactionManager.executeInTransaction.operationName (C:\Users\Kristian\Desktop\barber-saas\backend\src\application\use-cases\reservas\CancelReserva.js:28:35)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at Function.executeInTransaction (C:\Users\Kristian\Desktop\barber-saas\backend\src\utils\TransactionManager.js:57:32)
          at CancelReserva.execute (C:\Users\Kristian\Desktop\barber-saas\backend\src\application\use-cases\reservas\CancelReserva.js:22:25)
          at Object.<anonymous>.exports.cancelarReserva (C:\Users\Kristian\Desktop\barber-saas\backend\src\controllers\reservas.controller.js:45:25) {
        statusCode: 404
      },
      context: { operationName: 'CancelReservation', attempt: 1 },
      timestamp: 2026-02-10T02:05:59.990Z,
      originalStack: 'Error: Reserva no encontrada\n' +
        '    at TransactionManager.executeInTransaction.operationName (C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\\src\\application\\use-cases\\reservas\\CancelReserva.js:28:35)\n' +
        '    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n' +
        '    at Function.executeInTransaction (C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\\src\\utils\\TransactionManager.js:57:32)\n' +
        '    at CancelReserva.execute (C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\\src\\application\\use-cases\\reservas\\CancelReserva.js:22:25)\n' +
        '    at Object.<anonymous>.exports.cancelarReserva (C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\\src\\controllers\\reservas.controller.js:45:25)',
      statusCode: 404
    }

    [0m [90m 4 |[39m
     [90m 5 |[39m [36mconst[39m errorHandler [33m=[39m (err[33m,[39m req[33m,[39m res[33m,[39m next) [33m=>[39m {
    [31m[1m>[22m[39m[90m 6 |[39m   console[33m.[39merror([32m"­ƒö┤ ERROR:"[39m[33m,[39m err)[33m;[39m
     [90m   |[39m           [31m[1m^[22m[39m
     [90m 7 |[39m
     [90m 8 |[39m   [90m// ­ƒöÑ A├æADIR HEADERS CORS SI NO EXISTEN[39m
     [90m 9 |[39m   [36mconst[39m origin [33m=[39m req[33m.[39mheaders[33m.[39morigin[33m;[39m[0m

      at error (src/config/middleware/errorHandler.js:6:11)
      at Layer.handleError (node_modules/router/lib/layer.js:116:17)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at node_modules/router/index.js:688:15
      at next (node_modules/router/index.js:276:14)
      at next (node_modules/router/lib/route.js:132:14)
      at next (src/controllers/reservas.controller.js:57:9)

[0mPATCH /api/reservas/698a9287d94bdc45e57eb75b/cancelar [33m404[0m 11.065 ms - 727[0m
  console.log
    ­ƒôí [GET] /api/reservas

      at log (src/app.js:98:11)

[0mGET /api/reservas [32m200[0m 19.796 ms - 243[0m
  console.log
    ­ƒôí [GET] /api/barberias/test-barberia-b/admin/servicios

      at log (src/app.js:98:11)

[33mwarn[39m: Intento de acceso cross-tenant bloqueado {"method":"GET","requestedBarberiaId":"698a9288d94bdc45e57eb7a9","timestamp":"2026-02-10T02:06:00.371Z","url":"/api/barberias/test-barberia-b/admin/servicios","userBarberiaId":"698a9288d94bdc45e57eb7a7","userId":"698a9288d94bdc45e57eb7ab"}
[0mGET /api/barberias/test-barberia-b/admin/servicios [33m403[0m 10.085 ms - 74[0m
  console.log
    ­ƒôí [POST] /api/barberias/test-barberia-b/admin/servicios

      at log (src/app.js:98:11)

[33mwarn[39m: Intento de acceso cross-tenant bloqueado {"method":"POST","requestedBarberiaId":"698a9288d94bdc45e57eb7d7","timestamp":"2026-02-10T02:06:00.565Z","url":"/api/barberias/test-barberia-b/admin/servicios","userBarberiaId":"698a9288d94bdc45e57eb7d5","userId":"698a9288d94bdc45e57eb7d9"}
[0mPOST /api/barberias/test-barberia-b/admin/servicios [33m403[0m 7.966 ms - 74[0m
  console.log
    ­ƒôí [PUT] /api/barberias/test-barberia-b/admin/servicios/698a9288d94bdc45e57eb811

      at log (src/app.js:98:11)

[33mwarn[39m: Intento de acceso cross-tenant bloqueado {"method":"PUT","requestedBarberiaId":"698a9288d94bdc45e57eb805","timestamp":"2026-02-10T02:06:00.747Z","url":"/api/barberias/test-barberia-b/admin/servicios/698a9288d94bdc45e57eb811","userBarberiaId":"698a9288d94bdc45e57eb803","userId":"698a9288d94bdc45e57eb807"}
[0mPUT /api/barberias/test-barberia-b/admin/servicios/698a9288d94bdc45e57eb811 [33m403[0m 6.210 ms - 74[0m
  console.log
    ­ƒôí [GET] /api/barberias/test-barberia-b/barbero

      at log (src/app.js:98:11)

[33mwarn[39m: Intento de acceso cross-tenant bloqueado {"method":"GET","requestedBarberiaId":"698a9288d94bdc45e57eb833","timestamp":"2026-02-10T02:06:00.930Z","url":"/api/barberias/test-barberia-b/barbero","userBarberiaId":"698a9288d94bdc45e57eb831","userId":"698a9288d94bdc45e57eb835"}
[0mGET /api/barberias/test-barberia-b/barbero [33m403[0m 6.538 ms - 74[0m
  console.log
    ­ƒôí [POST] /api/barberias/test-barberia-b/barbero

      at log (src/app.js:98:11)

[33mwarn[39m: Intento de acceso cross-tenant bloqueado {"method":"POST","requestedBarberiaId":"698a9288d94bdc45e57eb861","timestamp":"2026-02-10T02:06:01.116Z","url":"/api/barberias/test-barberia-b/barbero","userBarberiaId":"698a9288d94bdc45e57eb85f","userId":"698a9288d94bdc45e57eb863"}
[0mPOST /api/barberias/test-barberia-b/barbero [33m403[0m 7.153 ms - 74[0m
  console.log
    ­ƒôí [GET] /api/barberias/test-barberia-b/admin/servicios

      at log (src/app.js:98:11)

[33mwarn[39m: Intento de acceso cross-tenant bloqueado {"method":"GET","requestedBarberiaId":"698a9289d94bdc45e57eb88f","timestamp":"2026-02-10T02:06:01.298Z","url":"/api/barberias/test-barberia-b/admin/servicios","userBarberiaId":"698a9289d94bdc45e57eb88d","userId":"698a9289d94bdc45e57eb891"}
[0mGET /api/barberias/test-barberia-b/admin/servicios [33m403[0m 6.603 ms - 74[0m
  console.log
    ­ƒôí [GET] /api/barberias/slug-inexistente/admin/servicios

      at log (src/app.js:98:11)

[0mGET /api/barberias/slug-inexistente/admin/servicios [33m404[0m 5.911 ms - 37[0m
  console.log
    ­ƒôí [GET] /api/reservas?barberiaId=698a9289d94bdc45e57eb8eb

      at log (src/app.js:98:11)

[0mGET /api/reservas?barberiaId=698a9289d94bdc45e57eb8eb [32m200[0m 12.260 ms - 243[0m
  console.log
    ­ƒôí [POST] /api/barberias/test-barberia-a/admin/servicios

      at log (src/app.js:98:11)

[0mPOST /api/barberias/test-barberia-a/admin/servicios [33m400[0m 12.885 ms - 58[0m
  console.log
    ­ƒôí [GET] /api/reservas/698a928ad94bdc45e57eb959

      at log (src/app.js:98:11)

[0mGET /api/reservas/698a928ad94bdc45e57eb959 [32m200[0m 11.294 ms - 218[0m
  console.log
    ­ƒôí [GET] /api/barberias/test-barberia-a/admin/servicios

      at log (src/app.js:98:11)

[0mGET /api/barberias/test-barberia-a/admin/servicios [32m200[0m 15.333 ms - 257[0m
  console.log
    ­ƒôí [GET] /api/barberias/test-barberia-b/admin/servicios

      at log (src/app.js:98:11)

[0mGET /api/barberias/test-barberia-b/admin/servicios [32m200[0m 14.922 ms - 257[0m
  console.log
    ­ƒôí [GET] /api/barberias/test-barberia-b/admin/servicios

      at log (src/app.js:98:11)

[33mwarn[39m: Intento de acceso cross-tenant bloqueado {"method":"GET","requestedBarberiaId":"698a928ad94bdc45e57eb9dd","timestamp":"2026-02-10T02:06:02.619Z","url":"/api/barberias/test-barberia-b/admin/servicios","userBarberiaId":"698a928ad94bdc45e57eb9db","userId":"698a928ad94bdc45e57eb9df"}
[0mGET /api/barberias/test-barberia-b/admin/servicios [33m403[0m 7.122 ms - 74[0m
  console.log
    ­ƒôí [GET] /api/barberias/test-barberia-a/admin/servicios

      at log (src/app.js:98:11)

[32minfo[39m: Acceso SUPER_ADMIN permitido {"barberiaId":"698a928ad94bdc45e57eba09","timestamp":"2026-02-10T02:06:02.854Z","userId":"698a928ad94bdc45e57eba1d"}
[0mGET /api/barberias/test-barberia-a/admin/servicios [33m403[0m 10.950 ms - 50[0m
  console.log
    ­ƒôí [GET] /api/barberias/test-barberia-b/admin/servicios

      at log (src/app.js:98:11)

[32minfo[39m: Acceso SUPER_ADMIN permitido {"barberiaId":"698a928ad94bdc45e57eba0b","timestamp":"2026-02-10T02:06:02.873Z","userId":"698a928ad94bdc45e57eba1d"}
[0mGET /api/barberias/test-barberia-b/admin/servicios [33m403[0m 12.078 ms - 50[0m
  console.warn
    ÔÜá´©Å MongoDB desconectado

    [0m [90m 89 |[39m   mongoose[33m.[39mconnection[33m.[39mon([32m'disconnected'[39m[33m,[39m () [33m=>[39m {
     [90m 90 |[39m     isConnected [33m=[39m [36mfalse[39m[33m;[39m
    [31m[1m>[22m[39m[90m 91 |[39m     console[33m.[39mwarn([32m'ÔÜá´©Å MongoDB desconectado'[39m)[33m;[39m
     [90m    |[39m             [31m[1m^[22m[39m
     [90m 92 |[39m   })[33m;[39m
     [90m 93 |[39m
     [90m 94 |[39m   mongoose[33m.[39mconnection[33m.[39mon([32m'error'[39m[33m,[39m (err) [33m=>[39m {[0m

      at NativeConnection.warn (src/config/db.js:91:13)
      at NativeConnection.set (node_modules/mongoose/lib/connection.js:149:12)
      at NativeConnection.onClose (node_modules/mongoose/lib/connection.js:1319:19)
      at NativeConnection._close (node_modules/mongoose/lib/connection.js:1268:12)
      at closeDB (tests/setup.js:29:5)
      at Object.<anonymous> (tests/multi-tenant-security.test.js:24:9)

FAIL tests/multi-tenant-security.test.js (6.076 s)
  ­ƒöÉ Multi-Tenant Security Tests
    ­ƒÜ½ Reservas - Cross-Tenant Access Prevention
      ÔêÜ Admin A NO puede ver reserva de Barber├¡a B (472 ms)
      ÔêÜ Admin A NO puede editar reserva de Barber├¡a B (197 ms)
      ÔêÜ Admin A NO puede cancelar reserva de Barber├¡a B (189 ms)
      ÔêÜ Admin A solo ve sus propias reservas al listar (197 ms)
    ­ƒÜ½ Servicios - Cross-Tenant Access Prevention
      ÔêÜ Admin A NO puede acceder a servicios de Barber├¡a B v├¡a slug (185 ms)
      ÔêÜ Admin A NO puede crear servicio en Barber├¡a B (192 ms)
      ÔêÜ Admin A NO puede editar servicio de Barber├¡a B (181 ms)
    ­ƒÜ½ Barberos - Cross-Tenant Access Prevention
      ÔêÜ Admin A NO puede ver barberos de Barber├¡a B (182 ms)
      ÔêÜ Admin A NO puede crear barbero en Barber├¡a B (186 ms)
    ­ƒöÆ URL Slug Manipulation Attempts
      ÔêÜ Rechaza intento de acceder con slug incorrecto (182 ms)
      ÔêÜ Rechaza slug inexistente (203 ms)
    ­ƒöÆ Query Parameter Injection Prevention
      ÔêÜ Ignora barberiaId inyectado en query params (187 ms)
      ├ù Ignora barberiaId inyectado en request body (188 ms)
    Ô£à Legitimate Access Allowed
      ÔêÜ Admin A puede ver sus propias reservas (185 ms)
      ÔêÜ Admin A puede acceder a sus servicios (187 ms)
      ÔêÜ Admin B puede acceder a sus propios datos (189 ms)
    ­ƒöì Logging and Monitoring
      ÔêÜ Loguea intentos de acceso cross-tenant (180 ms)
    ­ƒææ SUPERADMIN Access
      ├ù SUPERADMIN puede acceder a cualquier barber├¡a (259 ms)

  ÔùÅ ƒöÉ Multi-Tenant Security Tests ÔÇ║ ƒöÆ Query Parameter Injection Prevention ÔÇ║ 
Ignora barberiaId inyectado en request body

    expect(received).toBe(expected) // Object.is equality

    Expected: 201
    Received: 400

    [0m [90m 277 |[39m                 })[33m;[39m
     [90m 278 |[39m
    [31m[1m>[22m[39m[90m 279 |[39m             
expect(res[33m.[39mstatus)[33m.[39mtoBe([35m201[39m)[33m;[39m
     [90m     |[39m                                [31m[1m^[22m[39m
     [90m 280 |[39m
     [90m 281 |[39m             [90m// Verificar que se cre├│ con barberiaId 
correcto[39m
     [90m 282 |[39m             [90m// Use .id from hexagonal entity[39m[0m

      at Object.toBe (tests/multi-tenant-security.test.js:279:32)

  ÔùÅ ƒöÉ Multi-Tenant Security Tests ÔÇ║ ƒææ SUPERADMIN Access ÔÇ║ SUPERADMIN puede 
acceder a cualquier barber├¡a

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 403

    [0m [90m 353 |[39m                 
[33m.[39m[36mset[39m([32m'Authorization'[39m[33m,[39m [32m`Bearer 
${tokenSuperAdmin}`[39m)[33m;[39m
     [90m 354 |[39m
    [31m[1m>[22m[39m[90m 355 |[39m             
expect(resA[33m.[39mstatus)[33m.[39mtoBe([35m200[39m)[33m;[39m
     [90m     |[39m                                 [31m[1m^[22m[39m
     [90m 356 |[39m             
expect(resB[33m.[39mstatus)[33m.[39mtoBe([35m200[39m)[33m;[39m
     [90m 357 |[39m             
expect(resA[33m.[39mbody[33m.[39mservicios)[33m.[39mtoBeDefined()[33m;[39m
     [90m 358 |[39m             
expect(resB[33m.[39mbody[33m.[39mservicios)[33m.[39mtoBeDefined()[33m;[39m[0m

      at Object.toBe (tests/multi-tenant-security.test.js:355:33)

Test Suites: 1 failed, 1 total
Tests:       2 failed, 16 passed, 18 total
Snapshots:   0 total
Time:        6.128 s, estimated 7 s
Ran all test suites matching /tests\\multi-tenant-security.test.js/i.
