
> backend@1.0.0 test
> jest --runInBand --detectOpenHandles

node.exe : (node:25200) [MONGOOSE] Warning: Duplicate schema index on 
{"reviewToken":1} found. This is often due to declaring an index using both 
"index: true" and "schema.index()". Please remove the duplicate index definition.
En línea: 1 Carácter: 1
+ & "C:\Program Files\nodejs/node.exe" "C:\Program Files\nodejs/node_mo ...
+ ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : NotSpecified: ((node:25200) [M...dex definition.:S 
   tring) [], RemoteException
    + FullyQualifiedErrorId : NativeCommandError
 
(Use `node --trace-warnings ...` to show where the warning was created)
(node:25200) [MONGOOSE] Warning: Duplicate schema index on {"reviewToken":1} 
found. This is often due to declaring an index using both "index: true" and 
"schema.index()". Please remove the duplicate index definition.
[0mGET /api/reservas/698be971b71d0699d6e378c7 [33m404[0m 40.500 ms - 35[0m
[0mPATCH /api/reservas/698be972b71d0699d6e378f5/completar [33m404[0m 39.973 ms - 727[0m
[0mPATCH /api/reservas/698be972b71d0699d6e37923/cancelar [33m404[0m 14.503 ms - 718[0m
[0mGET /api/reservas [32m200[0m 41.733 ms - 243[0m
[0mGET /api/barberias/test-barberia-b/admin/servicios [33m400[0m 1.216 ms - 51[0m
[0mPOST /api/barberias/test-barberia-b/admin/servicios [33m400[0m 2.029 ms - 51[0m
[0mPUT /api/barberias/test-barberia-b/admin/servicios/698be974b71d0699d6e379d5 [33m400[0m 0.745 ms - 51[0m
[0mGET /api/barberias/test-barberia-b/barbero [33m404[0m 20.834 ms - 37[0m
[0mPOST /api/barberias/test-barberia-b/barbero [33m404[0m 20.509 ms - 37[0m
[0mGET /api/barberias/test-barberia-b/admin/servicios [33m400[0m 1.947 ms - 51[0m
[0mGET /api/barberias/slug-inexistente/admin/servicios [33m400[0m 0.332 ms - 51[0m
[0mGET /api/reservas?barberiaId=698be977b71d0699d6e37aa9 [32m200[0m 31.630 ms - 243[0m
[0mPOST /api/barberias/test-barberia-a/admin/servicios [33m400[0m 1.926 ms - 51[0m
[0mGET /api/reservas/698be978b71d0699d6e37b13 [32m200[0m 25.384 ms - 218[0m
[0mGET /api/barberias/test-barberia-a/admin/servicios [33m400[0m 0.265 ms - 51[0m
[0mGET /api/barberias/test-barberia-b/admin/servicios [33m400[0m 0.314 ms - 51[0m
[0mGET /api/barberias/test-barberia-b/admin/servicios [33m400[0m 0.327 ms - 51[0m
[0mGET /api/barberias/test-barberia-a/admin/servicios [33m400[0m 0.456 ms - 51[0m
[0mGET /api/barberias/test-barberia-b/admin/servicios [33m400[0m 0.613 ms - 51[0m
FAIL tests/multi-tenant-security.test.js (20.062 s)
  ÔùÅ Console

    console.log
      [dotenv@17.2.3] injecting env (13) from .env -- tip: ƒöÉ prevent 
committing .env to code: https://dotenvx.com/precommit

      at _log (node_modules/dotenv/lib/main.js:142:11)

    console.log
      ­ƒôí [GET] /api/reservas/698be971b71d0699d6e378c7

      at log (src/app.js:93:11)

    console.log
      ­ƒôí [PATCH] /api/reservas/698be972b71d0699d6e378f5/completar

      at log (src/app.js:93:11)

    console.log
      [Transaction] Started: CompleteReservation (attempt 1/3)

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:54:25)

    console.log
      [Transaction] Aborted: CompleteReservation

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:69:29)

    console.error
      [Transaction] Failed: CompleteReservation {
        error: 'Reserva no encontrada',
        attempt: 1,
        stack: 'Error: Reserva no encontrada\n' +
          '    at TransactionManager.executeInTransaction.operationName (C:\\User
s\\Kristian\\Desktop\\barber-saas\\backend\\src\\application\\use-cases\\reservas
\\CompleteReserva.js:30:35)\n' +
          '    at processTicksAndRejections 
(node:internal/process/task_queues:105:5)\n' +
          '    at Function.executeInTransaction (C:\\Users\\Kristian\\Desktop\\ba
rber-saas\\backend\\src\\utils\\TransactionManager.js:57:32)\n' +
          '    at CompleteReserva.execute (C:\\Users\\Kristian\\Desktop\\barber-s
aas\\backend\\src\\application\\use-cases\\reservas\\CompleteReserva.js:24:24)\n'
 +
          '    at Object.<anonymous>.exports.completarReserva (C:\\Users\\Kristia
n\\Desktop\\barber-saas\\backend\\src\\controllers\\reservas.controller.js:92:25)
'
      }

    [0m [90m 80 |[39m
     [90m 81 |[39m                 [90m// Non-transient error or max retries 
reached[39m
    [31m[1m>[22m[39m[90m 82 |[39m                 
console[33m.[39merror([32m`[Transaction] Failed: 
${operationName}`[39m[33m,[39m {
     [90m    |[39m                         [31m[1m^[22m[39m
     [90m 83 |[39m                     error[33m:[39m 
error[33m.[39mmessage[33m,[39m
     [90m 84 |[39m                     attempt[33m:[39m attempt [33m+[39m 
[35m1[39m[33m,[39m
     [90m 85 |[39m                     stack[33m:[39m 
error[33m.[39mstack[0m

      at Function.error [as executeInTransaction] 
(src/utils/TransactionManager.js:82:25)
      at CompleteReserva.execute 
(src/application/use-cases/reservas/CompleteReserva.js:24:24)
      at Object.<anonymous>.exports.completarReserva 
(src/controllers/reservas.controller.js:92:25)

    console.error
      ƒö┤ ERROR: TransactionError: Transaction failed for CompleteReservation: 
Reserva no encontrada
          at Function.executeInTransaction (C:\Users\Kristian\Desktop\barber-saas
\backend\src\utils\TransactionManager.js:88:42)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at CompleteReserva.execute (C:\Users\Kristian\Desktop\barber-saas\backe
nd\src\application\use-cases\reservas\CompleteReserva.js:24:24)
          at Object.<anonymous>.exports.completarReserva (C:\Users\Kristian\Deskt
op\barber-saas\backend\src\controllers\reservas.controller.js:92:25) {
        isTransactionError: true,
        originalError: Error: Reserva no encontrada
            at TransactionManager.executeInTransaction.operationName (C:\Users\Kr
istian\Desktop\barber-saas\backend\src\application\use-cases\reservas\CompleteRes
erva.js:30:35)
            at processTicksAndRejections 
(node:internal/process/task_queues:105:5)
            at Function.executeInTransaction (C:\Users\Kristian\Desktop\barber-sa
as\backend\src\utils\TransactionManager.js:57:32)
            at CompleteReserva.execute (C:\Users\Kristian\Desktop\barber-saas\bac
kend\src\application\use-cases\reservas\CompleteReserva.js:24:24)
            at Object.<anonymous>.exports.completarReserva (C:\Users\Kristian\Des
ktop\barber-saas\backend\src\controllers\reservas.controller.js:92:25) {
          statusCode: 404
        },
        context: { operationName: 'CompleteReservation', attempt: 1 },
        timestamp: 2026-02-11T02:29:06.503Z,
        originalStack: 'Error: Reserva no encontrada\n' +
          '    at TransactionManager.executeInTransaction.operationName (C:\\User
s\\Kristian\\Desktop\\barber-saas\\backend\\src\\application\\use-cases\\reservas
\\CompleteReserva.js:30:35)\n' +
          '    at processTicksAndRejections 
(node:internal/process/task_queues:105:5)\n' +
          '    at Function.executeInTransaction (C:\\Users\\Kristian\\Desktop\\ba
rber-saas\\backend\\src\\utils\\TransactionManager.js:57:32)\n' +
          '    at CompleteReserva.execute (C:\\Users\\Kristian\\Desktop\\barber-s
aas\\backend\\src\\application\\use-cases\\reservas\\CompleteReserva.js:24:24)\n'
 +
          '    at Object.<anonymous>.exports.completarReserva (C:\\Users\\Kristia
n\\Desktop\\barber-saas\\backend\\src\\controllers\\reservas.controller.js:92:25)
',
        statusCode: 404
      }

    [0m [90m 4 |[39m
     [90m 5 |[39m [36mconst[39m errorHandler [33m=[39m (err[33m,[39m 
req[33m,[39m res[33m,[39m next) [33m=>[39m {
    [31m[1m>[22m[39m[90m 6 |[39m   console[33m.[39merror([32m"ƒö┤ 
ERROR:"[39m[33m,[39m err)[33m;[39m
     [90m   |[39m           [31m[1m^[22m[39m
     [90m 7 |[39m
     [90m 8 |[39m   [90m// ­ƒöÑ A├æADIR HEADERS CORS SI NO EXISTEN[39m
     [90m 9 |[39m   [36mconst[39m origin [33m=[39m 
req[33m.[39mheaders[33m.[39morigin[33m;[39m[0m

      at error (src/config/middleware/errorHandler.js:6:11)
      at Layer.handleError (node_modules/router/lib/layer.js:116:17)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at node_modules/router/index.js:688:15
      at next (node_modules/router/index.js:276:14)
      at next (node_modules/router/lib/route.js:132:14)
      at next (src/controllers/reservas.controller.js:102:9)

    console.log
      ­ƒôí [PATCH] /api/reservas/698be972b71d0699d6e37923/cancelar

      at log (src/app.js:93:11)

    console.log
      [Transaction] Started: CancelReservation (attempt 1/3)

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:54:25)

    console.log
      [Transaction] Aborted: CancelReservation

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:69:29)

    console.error
      [Transaction] Failed: CancelReservation {
        error: 'Reserva no encontrada',
        attempt: 1,
        stack: 'Error: Reserva no encontrada\n' +
          '    at TransactionManager.executeInTransaction.operationName (C:\\User
s\\Kristian\\Desktop\\barber-saas\\backend\\src\\application\\use-cases\\reservas
\\CancelReserva.js:28:35)\n' +
          '    at processTicksAndRejections 
(node:internal/process/task_queues:105:5)\n' +
          '    at Function.executeInTransaction (C:\\Users\\Kristian\\Desktop\\ba
rber-saas\\backend\\src\\utils\\TransactionManager.js:57:32)\n' +
          '    at CancelReserva.execute (C:\\Users\\Kristian\\Desktop\\barber-saa
s\\backend\\src\\application\\use-cases\\reservas\\CancelReserva.js:22:25)\n' +
          '    at Object.<anonymous>.exports.cancelarReserva (C:\\Users\\Kristian
\\Desktop\\barber-saas\\backend\\src\\controllers\\reservas.controller.js:45:25)'
      }

    [0m [90m 80 |[39m
     [90m 81 |[39m                 [90m// Non-transient error or max retries 
reached[39m
    [31m[1m>[22m[39m[90m 82 |[39m                 
console[33m.[39merror([32m`[Transaction] Failed: 
${operationName}`[39m[33m,[39m {
     [90m    |[39m                         [31m[1m^[22m[39m
     [90m 83 |[39m                     error[33m:[39m 
error[33m.[39mmessage[33m,[39m
     [90m 84 |[39m                     attempt[33m:[39m attempt [33m+[39m 
[35m1[39m[33m,[39m
     [90m 85 |[39m                     stack[33m:[39m 
error[33m.[39mstack[0m

      at Function.error [as executeInTransaction] 
(src/utils/TransactionManager.js:82:25)
      at CancelReserva.execute 
(src/application/use-cases/reservas/CancelReserva.js:22:25)
      at Object.<anonymous>.exports.cancelarReserva 
(src/controllers/reservas.controller.js:45:25)

    console.error
      ƒö┤ ERROR: TransactionError: Transaction failed for CancelReservation: 
Reserva no encontrada
          at Function.executeInTransaction (C:\Users\Kristian\Desktop\barber-saas
\backend\src\utils\TransactionManager.js:88:42)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at CancelReserva.execute (C:\Users\Kristian\Desktop\barber-saas\backend
\src\application\use-cases\reservas\CancelReserva.js:22:25)
          at Object.<anonymous>.exports.cancelarReserva (C:\Users\Kristian\Deskto
p\barber-saas\backend\src\controllers\reservas.controller.js:45:25) {
        isTransactionError: true,
        originalError: Error: Reserva no encontrada
            at TransactionManager.executeInTransaction.operationName (C:\Users\Kr
istian\Desktop\barber-saas\backend\src\application\use-cases\reservas\CancelReser
va.js:28:35)
            at processTicksAndRejections 
(node:internal/process/task_queues:105:5)
            at Function.executeInTransaction (C:\Users\Kristian\Desktop\barber-sa
as\backend\src\utils\TransactionManager.js:57:32)
            at CancelReserva.execute (C:\Users\Kristian\Desktop\barber-saas\backe
nd\src\application\use-cases\reservas\CancelReserva.js:22:25)
            at Object.<anonymous>.exports.cancelarReserva (C:\Users\Kristian\Desk
top\barber-saas\backend\src\controllers\reservas.controller.js:45:25) {
          statusCode: 404
        },
        context: { operationName: 'CancelReservation', attempt: 1 },
        timestamp: 2026-02-11T02:29:06.965Z,
        originalStack: 'Error: Reserva no encontrada\n' +
          '    at TransactionManager.executeInTransaction.operationName (C:\\User
s\\Kristian\\Desktop\\barber-saas\\backend\\src\\application\\use-cases\\reservas
\\CancelReserva.js:28:35)\n' +
          '    at processTicksAndRejections 
(node:internal/process/task_queues:105:5)\n' +
          '    at Function.executeInTransaction (C:\\Users\\Kristian\\Desktop\\ba
rber-saas\\backend\\src\\utils\\TransactionManager.js:57:32)\n' +
          '    at CancelReserva.execute (C:\\Users\\Kristian\\Desktop\\barber-saa
s\\backend\\src\\application\\use-cases\\reservas\\CancelReserva.js:22:25)\n' +
          '    at Object.<anonymous>.exports.cancelarReserva (C:\\Users\\Kristian
\\Desktop\\barber-saas\\backend\\src\\controllers\\reservas.controller.js:45:25)'
,
        statusCode: 404
      }

    [0m [90m 4 |[39m
     [90m 5 |[39m [36mconst[39m errorHandler [33m=[39m (err[33m,[39m 
req[33m,[39m res[33m,[39m next) [33m=>[39m {
    [31m[1m>[22m[39m[90m 6 |[39m   console[33m.[39merror([32m"ƒö┤ 
ERROR:"[39m[33m,[39m err)[33m;[39m
     [90m   |[39m           [31m[1m^[22m[39m
     [90m 7 |[39m
     [90m 8 |[39m   [90m// ­ƒöÑ A├æADIR HEADERS CORS SI NO EXISTEN[39m
     [90m 9 |[39m   [36mconst[39m origin [33m=[39m 
req[33m.[39mheaders[33m.[39morigin[33m;[39m[0m

      at error (src/config/middleware/errorHandler.js:6:11)
      at Layer.handleError (node_modules/router/lib/layer.js:116:17)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at node_modules/router/index.js:688:15
      at next (node_modules/router/index.js:276:14)
      at next (node_modules/router/lib/route.js:132:14)
      at next (src/controllers/reservas.controller.js:57:9)

    console.log
      ­ƒôí [GET] /api/reservas

      at log (src/app.js:93:11)

    console.log
      ­ƒôí [GET] /api/barberias/test-barberia-b/admin/servicios

      at log (src/app.js:93:11)

    console.log
      ­ƒôí [POST] /api/barberias/test-barberia-b/admin/servicios

      at log (src/app.js:93:11)

    console.log
      ƒôí [PUT] 
/api/barberias/test-barberia-b/admin/servicios/698be974b71d0699d6e379d5

      at log (src/app.js:93:11)

    console.log
      ­ƒôí [GET] /api/barberias/test-barberia-b/barbero

      at log (src/app.js:93:11)

    console.log
      ­ƒôí [POST] /api/barberias/test-barberia-b/barbero

      at log (src/app.js:93:11)

    console.log
      ­ƒôí [GET] /api/barberias/test-barberia-b/admin/servicios

      at log (src/app.js:93:11)

    console.log
      ­ƒôí [GET] /api/barberias/slug-inexistente/admin/servicios

      at log (src/app.js:93:11)

    console.log
      ­ƒôí [GET] /api/reservas?barberiaId=698be977b71d0699d6e37aa9

      at log (src/app.js:93:11)

    console.log
      ­ƒôí [POST] /api/barberias/test-barberia-a/admin/servicios

      at log (src/app.js:93:11)

    console.log
      ­ƒôí [GET] /api/reservas/698be978b71d0699d6e37b13

      at log (src/app.js:93:11)

    console.log
      ­ƒôí [GET] /api/barberias/test-barberia-a/admin/servicios

      at log (src/app.js:93:11)

    console.log
      ­ƒôí [GET] /api/barberias/test-barberia-b/admin/servicios

      at log (src/app.js:93:11)

    console.log
      ­ƒôí [GET] /api/barberias/test-barberia-b/admin/servicios

      at log (src/app.js:93:11)

    console.log
      ­ƒôí [GET] /api/barberias/test-barberia-a/admin/servicios

      at log (src/app.js:93:11)

    console.log
      ­ƒôí [GET] /api/barberias/test-barberia-b/admin/servicios

      at log (src/app.js:93:11)

  ÔùÅ ƒöÉ Multi-Tenant Security Tests ÔÇ║ ƒÜ½ Servicios - Cross-Tenant Access 
Prevention ÔÇ║ Admin A NO puede acceder a servicios de Barber├¡a B v├¡a slug

    expect(received).toBe(expected) // Object.is equality

    Expected: 403
    Received: 400

    [0m [90m 182 |[39m                 
[33m.[39m[36mset[39m([32m'Authorization'[39m[33m,[39m [32m`Bearer 
${tokenAdminA}`[39m)[33m;[39m
     [90m 183 |[39m
    [31m[1m>[22m[39m[90m 184 |[39m             
expect(res[33m.[39mstatus)[33m.[39mtoBe([35m403[39m)[33m;[39m
     [90m     |[39m                                [31m[1m^[22m[39m
     [90m 185 |[39m             expect(res[33m.[39mbody[33m.[39mmessage)[3
3m.[39mtoContain([32m'permiso'[39m)[33m;[39m
     [90m 186 |[39m         })[33m;[39m
     [90m 187 |[39m[0m

      at Object.toBe (tests/multi-tenant-security.test.js:184:32)

  ÔùÅ ƒöÉ Multi-Tenant Security Tests ÔÇ║ ƒÜ½ Servicios - Cross-Tenant Access 
Prevention ÔÇ║ Admin A NO puede crear servicio en Barber├¡a B

    expect(received).toBe(expected) // Object.is equality

    Expected: 403
    Received: 400

    [0m [90m 196 |[39m                 })[33m;[39m
     [90m 197 |[39m
    [31m[1m>[22m[39m[90m 198 |[39m             
expect(res[33m.[39mstatus)[33m.[39mtoBe([35m403[39m)[33m;[39m
     [90m     |[39m                                [31m[1m^[22m[39m
     [90m 199 |[39m         })[33m;[39m
     [90m 200 |[39m
     [90m 201 |[39m         it([32m'Admin A NO puede editar servicio de 
Barber├¡a B'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.toBe (tests/multi-tenant-security.test.js:198:32)

  ÔùÅ ƒöÉ Multi-Tenant Security Tests ÔÇ║ ƒÜ½ Servicios - Cross-Tenant Access 
Prevention ÔÇ║ Admin A NO puede editar servicio de Barber├¡a B

    expect(received).toBe(expected) // Object.is equality

    Expected: 403
    Received: 400

    [0m [90m 208 |[39m                 })[33m;[39m
     [90m 209 |[39m
    [31m[1m>[22m[39m[90m 210 |[39m             
expect(res[33m.[39mstatus)[33m.[39mtoBe([35m403[39m)[33m;[39m
     [90m     |[39m                                [31m[1m^[22m[39m
     [90m 211 |[39m         })[33m;[39m
     [90m 212 |[39m     })[33m;[39m
     [90m 213 |[39m[0m

      at Object.toBe (tests/multi-tenant-security.test.js:210:32)

  ÔùÅ ƒöÉ Multi-Tenant Security Tests ÔÇ║ ƒÜ½ Barberos - Cross-Tenant Access 
Prevention ÔÇ║ Admin A NO puede ver barberos de Barber├¡a B

    expect(received).toBe(expected) // Object.is equality

    Expected: 403
    Received: 404

    [0m [90m 218 |[39m                 
[33m.[39m[36mset[39m([32m'Authorization'[39m[33m,[39m [32m`Bearer 
${tokenAdminA}`[39m)[33m;[39m
     [90m 219 |[39m
    [31m[1m>[22m[39m[90m 220 |[39m             
expect(res[33m.[39mstatus)[33m.[39mtoBe([35m403[39m)[33m;[39m
     [90m     |[39m                                [31m[1m^[22m[39m
     [90m 221 |[39m         })[33m;[39m
     [90m 222 |[39m
     [90m 223 |[39m         it([32m'Admin A NO puede crear barbero en 
Barber├¡a B'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.toBe (tests/multi-tenant-security.test.js:220:32)

  ÔùÅ ƒöÉ Multi-Tenant Security Tests ÔÇ║ ƒÜ½ Barberos - Cross-Tenant Access 
Prevention ÔÇ║ Admin A NO puede crear barbero en Barber├¡a B

    expect(received).toBe(expected) // Object.is equality

    Expected: 403
    Received: 404

    [0m [90m 230 |[39m                 })[33m;[39m
     [90m 231 |[39m
    [31m[1m>[22m[39m[90m 232 |[39m             
expect(res[33m.[39mstatus)[33m.[39mtoBe([35m403[39m)[33m;[39m
     [90m     |[39m                                [31m[1m^[22m[39m
     [90m 233 |[39m         })[33m;[39m
     [90m 234 |[39m     })[33m;[39m
     [90m 235 |[39m[0m

      at Object.toBe (tests/multi-tenant-security.test.js:232:32)

  ÔùÅ ƒöÉ Multi-Tenant Security Tests ÔÇ║ ƒöÆ URL Slug Manipulation Attempts ÔÇ║ 
Rechaza intento de acceder con slug incorrecto

    expect(received).toBe(expected) // Object.is equality

    Expected: 403
    Received: 400

    [0m [90m 240 |[39m                 
[33m.[39m[36mset[39m([32m'Authorization'[39m[33m,[39m [32m`Bearer 
${tokenAdminA}`[39m)[33m;[39m
     [90m 241 |[39m
    [31m[1m>[22m[39m[90m 242 |[39m             
expect(res[33m.[39mstatus)[33m.[39mtoBe([35m403[39m)[33m;[39m
     [90m     |[39m                                [31m[1m^[22m[39m
     [90m 243 |[39m             expect(res[33m.[39mbody[33m.[39mmessage)[3
3m.[39mtoMatch([35m/permiso|barber├¡a/i[39m)[33m;[39m
     [90m 244 |[39m         })[33m;[39m
     [90m 245 |[39m[0m

      at Object.toBe (tests/multi-tenant-security.test.js:242:32)

  ÔùÅ ƒöÉ Multi-Tenant Security Tests ÔÇ║ ƒöÆ URL Slug Manipulation Attempts ÔÇ║ 
Rechaza slug inexistente

    expect(received).toBe(expected) // Object.is equality

    Expected: 404
    Received: 400

    [0m [90m 249 |[39m                 
[33m.[39m[36mset[39m([32m'Authorization'[39m[33m,[39m [32m`Bearer 
${tokenAdminA}`[39m)[33m;[39m
     [90m 250 |[39m
    [31m[1m>[22m[39m[90m 251 |[39m             
expect(res[33m.[39mstatus)[33m.[39mtoBe([35m404[39m)[33m;[39m
     [90m     |[39m                                [31m[1m^[22m[39m
     [90m 252 |[39m             expect(res[33m.[39mbody[33m.[39mmessage)[3
3m.[39mtoMatch([35m/barber├¡a.*encontrada/i[39m)[33m;[39m
     [90m 253 |[39m         })[33m;[39m
     [90m 254 |[39m     })[33m;[39m[0m

      at Object.toBe (tests/multi-tenant-security.test.js:251:32)

  ÔùÅ ƒöÉ Multi-Tenant Security Tests ÔÇ║ ƒöÆ Query Parameter Injection 
Prevention ÔÇ║ Ignora barberiaId inyectado en request body

    expect(received).toBe(expected) // Object.is equality

    Expected: 201
    Received: 400

    [0m [90m 280 |[39m                 })[33m;[39m
     [90m 281 |[39m
    [31m[1m>[22m[39m[90m 282 |[39m             
expect(res[33m.[39mstatus)[33m.[39mtoBe([35m201[39m)[33m;[39m
     [90m     |[39m                                [31m[1m^[22m[39m
     [90m 283 |[39m
     [90m 284 |[39m             [90m// Verificar que se cre├│ con barberiaId 
correcto[39m
     [90m 285 |[39m             [90m// Use .id from hexagonal entity[39m[0m

      at Object.toBe (tests/multi-tenant-security.test.js:282:32)

  ÔùÅ ƒöÉ Multi-Tenant Security Tests ÔÇ║ Ô£à Legitimate Access Allowed ÔÇ║ 
Admin A puede acceder a sus servicios

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 400

    [0m [90m 305 |[39m                 
[33m.[39m[36mset[39m([32m'Authorization'[39m[33m,[39m [32m`Bearer 
${tokenAdminA}`[39m)[33m;[39m
     [90m 306 |[39m
    [31m[1m>[22m[39m[90m 307 |[39m             
expect(res[33m.[39mstatus)[33m.[39mtoBe([35m200[39m)[33m;[39m
     [90m     |[39m                                [31m[1m^[22m[39m
     [90m 308 |[39m             
expect(res[33m.[39mbody[33m.[39mservicios)[33m.[39mtoBeDefined()[33m;[39m
     [90m 309 |[39m             expect([33mArray[39m[33m.[39misArray(res[3
3m.[39mbody[33m.[39mservicios))[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m 310 |[39m         })[33m;[39m[0m

      at Object.toBe (tests/multi-tenant-security.test.js:307:32)

  ÔùÅ ƒöÉ Multi-Tenant Security Tests ÔÇ║ Ô£à Legitimate Access Allowed ÔÇ║ 
Admin B puede acceder a sus propios datos

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 400

    [0m [90m 315 |[39m                 
[33m.[39m[36mset[39m([32m'Authorization'[39m[33m,[39m [32m`Bearer 
${tokenAdminB}`[39m)[33m;[39m
     [90m 316 |[39m
    [31m[1m>[22m[39m[90m 317 |[39m             
expect(res[33m.[39mstatus)[33m.[39mtoBe([35m200[39m)[33m;[39m
     [90m     |[39m                                [31m[1m^[22m[39m
     [90m 318 |[39m         })[33m;[39m
     [90m 319 |[39m     })[33m;[39m
     [90m 320 |[39m[0m

      at Object.toBe (tests/multi-tenant-security.test.js:317:32)

  ÔùÅ ƒöÉ Multi-Tenant Security Tests ÔÇ║ ƒöì Logging and Monitoring ÔÇ║ Loguea 
intentos de acceso cross-tenant

    expect(received).toBe(expected) // Object.is equality

    Expected: 403
    Received: 400

    [0m [90m 327 |[39m                 
[33m.[39m[36mset[39m([32m'Authorization'[39m[33m,[39m [32m`Bearer 
${tokenAdminA}`[39m)[33m;[39m
     [90m 328 |[39m
    [31m[1m>[22m[39m[90m 329 |[39m             
expect(res[33m.[39mstatus)[33m.[39mtoBe([35m403[39m)[33m;[39m
     [90m     |[39m                                [31m[1m^[22m[39m
     [90m 330 |[39m             [90m// En producci├│n, verificar├¡amos que se 
gener├│ un log de warning[39m
     [90m 331 |[39m         })[33m;[39m
     [90m 332 |[39m     })[33m;[39m[0m

      at Object.toBe (tests/multi-tenant-security.test.js:329:32)

  ÔùÅ ƒöÉ Multi-Tenant Security Tests ÔÇ║ ƒææ SUPERADMIN Access ÔÇ║ SUPERADMIN 
puede acceder a cualquier barber├¡a

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 400

    [0m [90m 356 |[39m                 
[33m.[39m[36mset[39m([32m'Authorization'[39m[33m,[39m [32m`Bearer 
${tokenSuperAdmin}`[39m)[33m;[39m
     [90m 357 |[39m
    [31m[1m>[22m[39m[90m 358 |[39m             
expect(resA[33m.[39mstatus)[33m.[39mtoBe([35m200[39m)[33m;[39m
     [90m     |[39m                                 [31m[1m^[22m[39m
     [90m 359 |[39m             
expect(resB[33m.[39mstatus)[33m.[39mtoBe([35m200[39m)[33m;[39m
     [90m 360 |[39m             expect(resA[33m.[39mbody[33m.[39mservicios)
[33m.[39mtoBeDefined()[33m;[39m
     [90m 361 |[39m             expect(resB[33m.[39mbody[33m.[39mservicios)
[33m.[39mtoBeDefined()[33m;[39m[0m

      at Object.toBe (tests/multi-tenant-security.test.js:358:33)

(node:25200) [MONGOOSE] Warning: Duplicate schema index on {"reviewToken":1} 
found. This is often due to declaring an index using both "index: true" and 
"schema.index()". Please remove the duplicate index definition.
(node:25200) [MONGOOSE] Warning: Duplicate schema index on {"reviewToken":1} 
found. This is often due to declaring an index using both "index: true" and 
"schema.index()". Please remove the duplicate index definition.
[0mPOST /api/public/barberias/barberia-test/resenas?reviewToken=eea322d0e03c788992a7c3cf638287a1af3ffc336daad8053ac216fb4d98e772 [32m201[0m 45.882 ms - 646[0m
[0mPOST /api/public/barberias/barberia-test/resenas [33m404[0m 17.945 ms - 51[0m
[0mPOST /api/public/barberias/barberia-test/resenas?reviewToken=invalid-token [33m404[0m 12.468 ms - 51[0m
[0mPOST /api/public/barberias/barberia-test/resenas?reviewToken=ed0c20a9a6f54236c705377e04c7a22f35986c5288bee192c847de9b82f857f5 [32m201[0m 30.508 ms - 611[0m
[0mPOST /api/public/barberia-test/resenas?reviewToken=ed0c20a9a6f54236c705377e04c7a22f35986c5288bee192c847de9b82f857f5 [33m404[0m 10.373 ms - 172[0m
[0mPOST /api/public/barberia-test/resenas?reviewToken=1ae4d8ed2c1eb4aece589107e5037b72e7f71c6b4a48a9a697169ca1177b5122 [33m404[0m 2.600 ms - 172[0m
[0mGET /api/public/barberias/barberia-test/resenas/validar-token?reviewToken=841018c92f4f788998bf6a1d75c863ff9c66f9e3fbb75c9a1008d0d7af43b7cb [32m200[0m 30.105 ms - 158[0m
[0mGET /api/public/barberias/barberia-test/resenas/validar-token?reviewToken=invalid [33m404[0m 13.583 ms - 60[0m
[0mGET /api/public/barberias/barberia-test/resenas [32m200[0m 30.810 ms - 864[0m
[0mGET /api/public/barberias/barberia-test/resenas [32m200[0m 20.615 ms - 864[0m
[0mGET /api/admin/resenas/pendientes [32m200[0m 18.082 ms - 424[0m
[0mGET /api/admin/resenas/pendientes [33m401[0m 0.190 ms - 27[0m
[0mPATCH /api/admin/resenas/698be983468d6e9eb45f296b/aprobar [32m200[0m 24.474 ms - 448[0m
[0mPATCH /api/admin/resenas/698be984468d6e9eb45f297f/aprobar [33m401[0m 0.376 ms - 27[0m
[0mGET /api/admin/resenas/estadisticas [32m200[0m 15.485 ms - 141[0m
[0mGET /api/public/barberias/barberia-test/resenas [32m200[0m 16.188 ms - 477[0m
[0mGET /api/public/barberias/barberia-2/resenas [32m200[0m 25.109 ms - 474[0m
FAIL tests/resenas.test.js (9.582 s)
  ÔùÅ Console

    console.log
      [dotenv@17.2.3] injecting env (13) from .env -- tip: ƒùé´©Å backup and 
recover secrets: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

    console.log
      ƒôí [POST] /api/public/barberias/barberia-test/resenas?reviewToken=eea322d0
e03c788992a7c3cf638287a1af3ffc336daad8053ac216fb4d98e772

      at log (src/app.js:93:11)

    console.log
      ­ƒôí [POST] /api/public/barberias/barberia-test/resenas

      at log (src/app.js:93:11)

    console.log
      ƒôí [POST] 
/api/public/barberias/barberia-test/resenas?reviewToken=invalid-token

      at log (src/app.js:93:11)

    console.log
      ƒôí [POST] /api/public/barberias/barberia-test/resenas?reviewToken=ed0c20a9
a6f54236c705377e04c7a22f35986c5288bee192c847de9b82f857f5

      at log (src/app.js:93:11)

    console.log
      ƒôí [POST] /api/public/barberia-test/resenas?reviewToken=ed0c20a9a6f54236c7
05377e04c7a22f35986c5288bee192c847de9b82f857f5

      at log (src/app.js:93:11)

    console.log
      ƒôí [POST] /api/public/barberia-test/resenas?reviewToken=1ae4d8ed2c1eb4aece
589107e5037b72e7f71c6b4a48a9a697169ca1177b5122

      at log (src/app.js:93:11)

    console.log
      ƒôí [GET] /api/public/barberias/barberia-test/resenas/validar-token?reviewT
oken=841018c92f4f788998bf6a1d75c863ff9c66f9e3fbb75c9a1008d0d7af43b7cb

      at log (src/app.js:93:11)

    console.log
      ƒôí [GET] 
/api/public/barberias/barberia-test/resenas/validar-token?reviewToken=invalid

      at log (src/app.js:93:11)

    console.log
      ­ƒôí [GET] /api/public/barberias/barberia-test/resenas

      at log (src/app.js:93:11)

    console.log
      ­ƒôí [GET] /api/public/barberias/barberia-test/resenas

      at log (src/app.js:93:11)

    console.log
      ­ƒôí [GET] /api/admin/resenas/pendientes

      at log (src/app.js:93:11)

    console.log
      ­ƒôí [GET] /api/admin/resenas/pendientes

      at log (src/app.js:93:11)

    console.log
      ­ƒôí [PATCH] /api/admin/resenas/698be983468d6e9eb45f296b/aprobar

      at log (src/app.js:93:11)

    console.log
      ­ƒôí [PATCH] /api/admin/resenas/698be984468d6e9eb45f297f/aprobar

      at log (src/app.js:93:11)

    console.log
      ­ƒôí [GET] /api/admin/resenas/estadisticas

      at log (src/app.js:93:11)

    console.log
      ­ƒôí [GET] /api/public/barberias/barberia-test/resenas

      at log (src/app.js:93:11)

    console.log
      ­ƒôí [GET] /api/public/barberias/barberia-2/resenas

      at log (src/app.js:93:11)

  ÔùÅ Sistema de Rese├▒as - Tests ÔÇ║ POST /api/public/:slug/resenas - Crear 
Rese├▒a ÔÇ║ Debe rechazar rese├▒a duplicada

    expect(received).toBe(expected) // Object.is equality

    Expected: false
    Received: undefined

    [0m [90m 158 |[39m
     [90m 159 |[39m             
expect(response[33m.[39mstatus)[33m.[39mtoBe([35m404[39m)[33m;[39m 
[90m// 404 porque la ruta no existe sin 'barberias'[39m
    [31m[1m>[22m[39m[90m 160 |[39m             expect(response[33m.[39mbo
dy[33m.[39msuccess)[33m.[39mtoBe([36mfalse[39m)[33m;[39m
     [90m     |[39m                                           
[31m[1m^[22m[39m
     [90m 161 |[39m         })[33m;[39m
     [90m 162 |[39m
     [90m 163 |[39m         test([32m'Debe rechazar rese├▒a sin calificaci├│n 
general'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.toBe (tests/resenas.test.js:160:43)

  ÔùÅ Sistema de Rese├▒as - Tests ÔÇ║ POST /api/public/:slug/resenas - Crear 
Rese├▒a ÔÇ║ Debe rechazar rese├▒a sin calificaci├│n general

    expect(received).toBe(expected) // Object.is equality

    Expected: false
    Received: undefined

    [0m [90m 169 |[39m
     [90m 170 |[39m             
expect(response[33m.[39mstatus)[33m.[39mtoBe([35m404[39m)[33m;[39m 
[90m// 404 porque la ruta no existe sin 'barberias'[39m
    [31m[1m>[22m[39m[90m 171 |[39m             expect(response[33m.[39mbo
dy[33m.[39msuccess)[33m.[39mtoBe([36mfalse[39m)[33m;[39m
     [90m     |[39m                                           
[31m[1m^[22m[39m
     [90m 172 |[39m         })[33m;[39m
     [90m 173 |[39m     })[33m;[39m
     [90m 174 |[39m[0m

      at Object.toBe (tests/resenas.test.js:171:43)

(node:25200) [MONGOOSE] Warning: Duplicate schema index on {"reviewToken":1} 
found. This is often due to declaring an index using both "index: true" and 
"schema.index()". Please remove the duplicate index definition.
(node:25200) [MONGOOSE] Warning: Duplicate schema index on {"reviewToken":1} 
found. This is often due to declaring an index using both "index: true" and 
"schema.index()". Please remove the duplicate index definition.
[0mPOST /api/public/barberias/test-barberia/barberos/698be98a6a05e103eb4701ae/reservar [32m201[0m 327.548 ms - 641[0m
[0mPOST /api/public/barberias/test-barberia/barberos/698be98a6a05e103eb4701ae/reservar [31m500[0m 384.211 ms - 1164[0m
[0mPOST /api/public/barberias/test-barberia/barberos/698be98a6a05e103eb4701ae/reservar [31m500[0m 414.221 ms - 1164[0m
[0mPOST /api/public/barberias/test-barberia/barberos/698be98a6a05e103eb4701ae/reservar [31m500[0m 693.837 ms - 1164[0m
[0mPOST /api/public/barberias/test-barberia/barberos/698be98a6a05e103eb4701ae/reservar [31m500[0m 678.921 ms - 1164[0m
[0mPOST /api/public/barberias/test-barberia/barberos/698be98a6a05e103eb4701ae/reservar [31m500[0m 697.562 ms - 1164[0m
[0mPOST /api/public/barberias/test-barberia/barberos/698be98a6a05e103eb4701ae/reservar [31m500[0m 783.159 ms - 1164[0m
[0mPOST /api/public/barberias/test-barberia/barberos/698be98a6a05e103eb4701ae/reservar [31m500[0m 731.615 ms - 1164[0m
[0mPOST /api/public/barberias/test-barberia/barberos/698be98a6a05e103eb4701ae/reservar [31m500[0m 715.051 ms - 1164[0m
[0mPOST /api/public/barberias/test-barberia/barberos/698be98a6a05e103eb4701ae/reservar [31m500[0m 748.491 ms - 1164[0m
[0mPOST /api/public/barberias/test-barberia/barberos/698be98b6a05e103eb47021b/reservar [33m429[0m 2.286 ms - 61[0m
[0mPOST /api/public/barberias/test-barberia/barberos/698be98b6a05e103eb47021b/reservar [33m429[0m 2.569 ms - 61[0m
[0mPOST /api/public/barberias/test-barberia/barberos/698be98b6a05e103eb47021b/reservar [33m429[0m 1.125 ms - 61[0m
[0mPOST /api/public/barberias/test-barberia/barberos/698be98b6a05e103eb47021b/reservar [33m429[0m 1.096 ms - 61[0m
[0mPOST /api/public/barberias/test-barberia/barberos/698be98b6a05e103eb47021b/reservar [33m429[0m 4.287 ms - 61[0m
[0mPOST /api/public/barberias/test-barberia/barberos/698be98b6a05e103eb47021b/reservar [33m429[0m 1.096 ms - 61[0m
[0mPOST /api/public/barberias/test-barberia/barberos/698be98b6a05e103eb47021b/reservar [33m429[0m 2.286 ms - 61[0m
[0mPOST /api/public/barberias/test-barberia/barberos/698be98b6a05e103eb47021b/reservar [33m429[0m 0.836 ms - 61[0m
[0mPOST /api/public/barberias/test-barberia/barberos/698be98b6a05e103eb47021b/reservar [33m429[0m 0.926 ms - 61[0m
[0mPOST /api/public/barberias/test-barberia/barberos/698be98b6a05e103eb47021b/reservar [33m429[0m 2.001 ms - 61[0m
[0mPOST /api/public/barberias/test-barberia/barberos/698be98b6a05e103eb47021b/reservar [33m429[0m 1.351 ms - 61[0m
[0mPOST /api/public/barberias/test-barberia/barberos/698be98b6a05e103eb47021b/reservar [33m429[0m 2.145 ms - 61[0m
[0mPOST /api/public/barberias/test-barberia/barberos/698be98b6a05e103eb47021b/reservar [33m429[0m 1.147 ms - 61[0m
[0mPOST /api/public/barberias/test-barberia/barberos/698be98b6a05e103eb47021b/reservar [33m429[0m 0.755 ms - 61[0m
[0mPOST /api/public/barberias/test-barberia/barberos/698be98b6a05e103eb47021b/reservar [33m429[0m 0.623 ms - 61[0m
[0mPOST /api/public/barberias/test-barberia/barberos/698be98b6a05e103eb47021b/reservar [33m429[0m 2.117 ms - 61[0m
[0mPOST /api/public/barberias/test-barberia/barberos/698be98b6a05e103eb47021b/reservar [33m429[0m 1.073 ms - 61[0m
[0mPOST /api/public/barberias/test-barberia/barberos/698be98b6a05e103eb47021b/reservar [33m429[0m 2.380 ms - 61[0m
[0mPOST /api/public/barberias/test-barberia/barberos/698be98b6a05e103eb47021b/reservar [33m429[0m 0.743 ms - 61[0m
[0mPOST /api/public/barberias/test-barberia/barberos/698be98b6a05e103eb47021b/reservar [33m429[0m 0.963 ms - 61[0m
[0mPOST /api/public/barberias/test-barberia/barberos/698be98b6a05e103eb47021b/reservar [33m429[0m 1.400 ms - 61[0m
[0mPOST /api/public/barberias/test-barberia/barberos/698be98b6a05e103eb47021b/reservar [33m429[0m 1.711 ms - 61[0m
[0mPOST /api/public/barberias/test-barberia/barberos/698be98b6a05e103eb47021b/reservar [33m429[0m 1.749 ms - 61[0m
[0mPOST /api/public/barberias/test-barberia/barberos/698be98b6a05e103eb47021b/reservar [33m429[0m 1.240 ms - 61[0m
[0mPOST /api/public/barberias/test-barberia/barberos/698be98b6a05e103eb47021b/reservar [33m429[0m 1.050 ms - 61[0m
[0mPOST /api/public/barberias/test-barberia/barberos/698be98b6a05e103eb47021b/reservar [33m429[0m 1.179 ms - 61[0m
[0mPOST /api/public/barberias/test-barberia/barberos/698be98b6a05e103eb47021b/reservar [33m429[0m 2.862 ms - 61[0m
[0mPOST /api/public/barberias/test-barberia/barberos/698be98b6a05e103eb47021b/reservar [33m429[0m 1.164 ms - 61[0m
[0mPOST /api/public/barberias/test-barberia/barberos/698be98b6a05e103eb47021b/reservar [33m429[0m 1.542 ms - 61[0m
[0mPOST /api/public/barberias/test-barberia/barberos/698be98b6a05e103eb47021b/reservar [33m429[0m 0.781 ms - 61[0m
[0mPOST /api/public/barberias/test-barberia/barberos/698be98b6a05e103eb47021b/reservar [32m201[0m 975.431 ms - 640[0m
[0mPOST /api/public/barberias/test-barberia/barberos/698be98b6a05e103eb47021b/reservar [31m500[0m 1050.701 ms - 1164[0m
[0mPOST /api/public/barberias/test-barberia/barberos/698be98b6a05e103eb47021b/reservar [31m500[0m 993.419 ms - 1164[0m
[0mPOST /api/public/barberias/test-barberia/barberos/698be98b6a05e103eb47021b/reservar [31m500[0m 1045.721 ms - 1164[0m
[0mPOST /api/public/barberias/test-barberia/barberos/698be98b6a05e103eb47021b/reservar [31m500[0m 1015.157 ms - 1164[0m
[0mPOST /api/public/barberias/test-barberia/barberos/698be98b6a05e103eb47021b/reservar [31m500[0m 999.090 ms - 1164[0m
[0mPOST /api/public/barberias/test-barberia/barberos/698be98b6a05e103eb47021b/reservar [31m500[0m 995.472 ms - 1164[0m
[0mPOST /api/public/barberias/test-barberia/barberos/698be98b6a05e103eb47021b/reservar [31m500[0m 1016.845 ms - 1164[0m
[0mPOST /api/public/barberias/test-barberia/barberos/698be98b6a05e103eb47021b/reservar [31m500[0m 1082.803 ms - 1164[0m
[0mPOST /api/public/barberias/test-barberia/barberos/698be98b6a05e103eb47021b/reservar [31m500[0m 984.497 ms - 1164[0m
[0mPOST /api/public/barberias/test-barberia/barberos/698be98b6a05e103eb47021b/reservar [31m500[0m 1318.240 ms - 1164[0m
[0mPOST /api/public/barberias/test-barberia/barberos/698be98b6a05e103eb47021b/reservar [31m500[0m 1345.786 ms - 1164[0m
[0mPOST /api/public/barberias/test-barberia/barberos/698be98b6a05e103eb47021b/reservar [31m500[0m 1323.905 ms - 1164[0m
[0mPOST /api/public/barberias/test-barberia/barberos/698be98b6a05e103eb47021b/reservar [31m500[0m 1406.736 ms - 1164[0m
[0mPOST /api/public/barberias/test-barberia/barberos/698be98b6a05e103eb47021b/reservar [31m500[0m 1414.302 ms - 1164[0m
[0mPOST /api/public/barberias/test-barberia/barberos/698be98b6a05e103eb47021b/reservar [31m500[0m 1363.823 ms - 1164[0m
[0mPOST /api/public/barberias/test-barberia/barberos/698be98b6a05e103eb47021b/reservar [31m500[0m 1436.032 ms - 1164[0m
[0mPOST /api/public/barberias/test-barberia/barberos/698be98b6a05e103eb47021b/reservar [31m500[0m 1491.010 ms - 1164[0m
[0mPOST /api/public/barberias/test-barberia/barberos/698be98b6a05e103eb47021b/reservar [31m500[0m 1490.018 ms - 1164[0m
[0mPOST /api/public/barberias/test-barberia/barberos/698be98b6a05e103eb47021b/reservar [31m500[0m 1461.596 ms - 1164[0m
[0mPOST /api/public/barberias/test-barberia/barberos/698be98d6a05e103eb47030a/reservar [33m429[0m 0.745 ms - 61[0m
[0mPOST /api/public/barberias/test-barberia/barberos/698be98e6a05e103eb47032a/reservar [33m429[0m 0.676 ms - 61[0m
[0mPOST /api/public/barberias/test-barberia/barberos/698be98e6a05e103eb47032a/reservar [33m429[0m 1.543 ms - 61[0m
[0mPOST /api/public/barberias/test-barberia/barberos/698be98e6a05e103eb47032a/reservar [33m429[0m 1.316 ms - 61[0m
[0mPOST /api/public/barberias/test-barberia/barberos/698be98e6a05e103eb47032a/reservar [33m429[0m 1.175 ms - 61[0m
[0mPOST /api/public/barberias/test-barberia/barberos/698be98e6a05e103eb47032a/reservar [33m429[0m 1.572 ms - 61[0m
[0mPOST /api/public/barberias/test-barberia/barberos/698be98e6a05e103eb47032a/reservar [33m429[0m 0.853 ms - 61[0m
[0mPOST /api/public/barberias/test-barberia/barberos/698be98e6a05e103eb47032a/reservar [33m429[0m 0.813 ms - 61[0m
[0mPOST /api/public/barberias/test-barberia/barberos/698be98e6a05e103eb47032a/reservar [33m429[0m 2.066 ms - 61[0m
[0mPOST /api/public/barberias/test-barberia/barberos/698be98e6a05e103eb47032a/reservar [33m429[0m 1.814 ms - 61[0m
[0mPOST /api/public/barberias/test-barberia/barberos/698be98e6a05e103eb47032a/reservar [33m429[0m 1.212 ms - 61[0m
[0mPOST /api/public/barberias/test-barberia/barberos/698be98e6a05e103eb47032a/reservar [33m429[0m 0.893 ms - 61[0m
[0mPOST /api/public/barberias/test-barberia/barberos/698be98e6a05e103eb47032a/reservar [33m429[0m 1.174 ms - 61[0m
[0mPOST /api/public/barberias/test-barberia/barberos/698be98e6a05e103eb47032a/reservar [33m429[0m 0.865 ms - 61[0m
[0mPOST /api/public/barberias/test-barberia/barberos/698be98e6a05e103eb47032a/reservar [33m429[0m 2.251 ms - 61[0m
[0mPOST /api/public/barberias/test-barberia/barberos/698be98e6a05e103eb47032a/reservar [33m429[0m 0.823 ms - 61[0m
[0mPOST /api/public/barberias/test-barberia/barberos/698be98e6a05e103eb47032a/reservar [33m429[0m 1.194 ms - 61[0m
[0mPOST /api/public/barberias/test-barberia/barberos/698be98e6a05e103eb47032a/reservar [33m429[0m 0.742 ms - 61[0m
[0mPOST /api/public/barberias/test-barberia/barberos/698be98e6a05e103eb47032a/reservar [33m429[0m 1.326 ms - 61[0m
[0mPOST /api/public/barberias/test-barberia/barberos/698be98e6a05e103eb47032a/reservar [33m429[0m 0.690 ms - 61[0m
[0mPOST /api/public/barberias/test-barberia/barberos/698be98e6a05e103eb47032a/reservar [33m429[0m 0.839 ms - 61[0m
FAIL tests/race-condition-stress.test.js (9.337 s)
  ÔùÅ Console

    console.log
      [dotenv@17.2.3] injecting env (13) from .env -- tip: ƒöÉ encrypt with 
Dotenvx: https://dotenvx.com

      at _log (node_modules/dotenv/lib/main.js:142:11)

    console.log
      ƒôí [POST] 
/api/public/barberias/test-barberia/barberos/698be98a6a05e103eb4701ae/reservar

      at log (src/app.js:93:11)

    console.log
      ƒôí [POST] 
/api/public/barberias/test-barberia/barberos/698be98a6a05e103eb4701ae/reservar

      at log (src/app.js:93:11)

    console.log
      ƒôí [POST] 
/api/public/barberias/test-barberia/barberos/698be98a6a05e103eb4701ae/reservar

      at log (src/app.js:93:11)

    console.log
      ƒôí [POST] 
/api/public/barberias/test-barberia/barberos/698be98a6a05e103eb4701ae/reservar

      at log (src/app.js:93:11)

    console.log
      ƒôí [POST] 
/api/public/barberias/test-barberia/barberos/698be98a6a05e103eb4701ae/reservar

      at log (src/app.js:93:11)

    console.log
      ƒôí [POST] 
/api/public/barberias/test-barberia/barberos/698be98a6a05e103eb4701ae/reservar

      at log (src/app.js:93:11)

    console.log
      ƒôí [POST] 
/api/public/barberias/test-barberia/barberos/698be98a6a05e103eb4701ae/reservar

      at log (src/app.js:93:11)

    console.log
      ƒôí [POST] 
/api/public/barberias/test-barberia/barberos/698be98a6a05e103eb4701ae/reservar

      at log (src/app.js:93:11)

    console.log
      ƒôí [POST] 
/api/public/barberias/test-barberia/barberos/698be98a6a05e103eb4701ae/reservar

      at log (src/app.js:93:11)

    console.log
      ƒôí [POST] 
/api/public/barberias/test-barberia/barberos/698be98a6a05e103eb4701ae/reservar

      at log (src/app.js:93:11)

    console.log
      [Transaction] Started: CreateReservation (attempt 1/3)

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:54:25)

    console.log
      [Transaction] Started: CreateReservation (attempt 1/3)

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:54:25)

    console.log
      [Transaction] Started: CreateReservation (attempt 1/3)

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:54:25)

    console.log
      [Transaction] Started: CreateReservation (attempt 1/3)

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:54:25)

    console.log
      [Transaction] Started: CreateReservation (attempt 1/3)

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:54:25)

    console.log
      [Transaction] Started: CreateReservation (attempt 1/3)

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:54:25)

    console.log
      [Transaction] Started: CreateReservation (attempt 1/3)

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:54:25)

    console.log
      [Transaction] Started: CreateReservation (attempt 1/3)

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:54:25)

    console.log
      [Transaction] Started: CreateReservation (attempt 1/3)

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:54:25)

    console.log
      [Transaction] Started: CreateReservation (attempt 1/3)

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:54:25)

    console.log
      [Transaction] Committed: CreateReservation

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:61:25)

    console.log
      [Transaction] Aborted: CreateReservation

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:69:29)

    console.warn
      [Transaction] Transient error, retrying in 200ms: WriteConflict error: 
this operation conflicted with another operation. Please retry your operation or 
multi-document transaction.

    [0m [90m 74 |[39m                     attempt[33m++[39m[33m;[39m
     [90m 75 |[39m                     [36mconst[39m delay [33m=[39m 
retryDelay [33m*[39m [33mMath[39m[33m.[39mpow([35m2[39m[33m,[39m 
attempt)[33m;[39m [90m// Exponential backoff[39m
    [31m[1m>[22m[39m[90m 76 |[39m                     
console[33m.[39mwarn([32m`[Transaction] Transient error, retrying in 
${delay}ms:`[39m[33m,[39m error[33m.[39mmessage)[33m;[39m
     [90m    |[39m                             [31m[1m^[22m[39m
     [90m 77 |[39m                     [36mawait[39m 
[36mthis[39m[33m.[39msleep(delay)[33m;[39m
     [90m 78 |[39m                     [36mcontinue[39m[33m;[39m
     [90m 79 |[39m                 }[0m

      at Function.warn [as executeInTransaction] 
(src/utils/TransactionManager.js:76:29)
      at CreateReserva.execute 
(src/application/use-cases/reservas/CreateReserva.js:26:34)
      at Object.<anonymous>.exports.crearReservaBySlug 
(src/controllers/public.controller.js:140:25)

    console.log
      [Transaction] Aborted: CreateReservation

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:69:29)

    console.warn
      [Transaction] Transient error, retrying in 200ms: WriteConflict error: 
this operation conflicted with another operation. Please retry your operation or 
multi-document transaction.

    [0m [90m 74 |[39m                     attempt[33m++[39m[33m;[39m
     [90m 75 |[39m                     [36mconst[39m delay [33m=[39m 
retryDelay [33m*[39m [33mMath[39m[33m.[39mpow([35m2[39m[33m,[39m 
attempt)[33m;[39m [90m// Exponential backoff[39m
    [31m[1m>[22m[39m[90m 76 |[39m                     
console[33m.[39mwarn([32m`[Transaction] Transient error, retrying in 
${delay}ms:`[39m[33m,[39m error[33m.[39mmessage)[33m;[39m
     [90m    |[39m                             [31m[1m^[22m[39m
     [90m 77 |[39m                     [36mawait[39m 
[36mthis[39m[33m.[39msleep(delay)[33m;[39m
     [90m 78 |[39m                     [36mcontinue[39m[33m;[39m
     [90m 79 |[39m                 }[0m

      at Function.warn [as executeInTransaction] 
(src/utils/TransactionManager.js:76:29)
      at CreateReserva.execute 
(src/application/use-cases/reservas/CreateReserva.js:26:34)
      at Object.<anonymous>.exports.crearReservaBySlug 
(src/controllers/public.controller.js:140:25)

    console.log
      [Transaction] Aborted: CreateReservation

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:69:29)

    console.warn
      [Transaction] Transient error, retrying in 200ms: WriteConflict error: 
this operation conflicted with another operation. Please retry your operation or 
multi-document transaction.

    [0m [90m 74 |[39m                     attempt[33m++[39m[33m;[39m
     [90m 75 |[39m                     [36mconst[39m delay [33m=[39m 
retryDelay [33m*[39m [33mMath[39m[33m.[39mpow([35m2[39m[33m,[39m 
attempt)[33m;[39m [90m// Exponential backoff[39m
    [31m[1m>[22m[39m[90m 76 |[39m                     
console[33m.[39mwarn([32m`[Transaction] Transient error, retrying in 
${delay}ms:`[39m[33m,[39m error[33m.[39mmessage)[33m;[39m
     [90m    |[39m                             [31m[1m^[22m[39m
     [90m 77 |[39m                     [36mawait[39m 
[36mthis[39m[33m.[39msleep(delay)[33m;[39m
     [90m 78 |[39m                     [36mcontinue[39m[33m;[39m
     [90m 79 |[39m                 }[0m

      at Function.warn [as executeInTransaction] 
(src/utils/TransactionManager.js:76:29)
      at CreateReserva.execute 
(src/application/use-cases/reservas/CreateReserva.js:26:34)
      at Object.<anonymous>.exports.crearReservaBySlug 
(src/controllers/public.controller.js:140:25)

    console.log
      [Transaction] Aborted: CreateReservation

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:69:29)

    console.warn
      [Transaction] Transient error, retrying in 200ms: WriteConflict error: 
this operation conflicted with another operation. Please retry your operation or 
multi-document transaction.

    [0m [90m 74 |[39m                     attempt[33m++[39m[33m;[39m
     [90m 75 |[39m                     [36mconst[39m delay [33m=[39m 
retryDelay [33m*[39m [33mMath[39m[33m.[39mpow([35m2[39m[33m,[39m 
attempt)[33m;[39m [90m// Exponential backoff[39m
    [31m[1m>[22m[39m[90m 76 |[39m                     
console[33m.[39mwarn([32m`[Transaction] Transient error, retrying in 
${delay}ms:`[39m[33m,[39m error[33m.[39mmessage)[33m;[39m
     [90m    |[39m                             [31m[1m^[22m[39m
     [90m 77 |[39m                     [36mawait[39m 
[36mthis[39m[33m.[39msleep(delay)[33m;[39m
     [90m 78 |[39m                     [36mcontinue[39m[33m;[39m
     [90m 79 |[39m                 }[0m

      at Function.warn [as executeInTransaction] 
(src/utils/TransactionManager.js:76:29)
      at CreateReserva.execute 
(src/application/use-cases/reservas/CreateReserva.js:26:34)
      at Object.<anonymous>.exports.crearReservaBySlug 
(src/controllers/public.controller.js:140:25)

    console.log
      [Transaction] Aborted: CreateReservation

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:69:29)

    console.warn
      [Transaction] Transient error, retrying in 200ms: WriteConflict error: 
this operation conflicted with another operation. Please retry your operation or 
multi-document transaction.

    [0m [90m 74 |[39m                     attempt[33m++[39m[33m;[39m
     [90m 75 |[39m                     [36mconst[39m delay [33m=[39m 
retryDelay [33m*[39m [33mMath[39m[33m.[39mpow([35m2[39m[33m,[39m 
attempt)[33m;[39m [90m// Exponential backoff[39m
    [31m[1m>[22m[39m[90m 76 |[39m                     
console[33m.[39mwarn([32m`[Transaction] Transient error, retrying in 
${delay}ms:`[39m[33m,[39m error[33m.[39mmessage)[33m;[39m
     [90m    |[39m                             [31m[1m^[22m[39m
     [90m 77 |[39m                     [36mawait[39m 
[36mthis[39m[33m.[39msleep(delay)[33m;[39m
     [90m 78 |[39m                     [36mcontinue[39m[33m;[39m
     [90m 79 |[39m                 }[0m

      at Function.warn [as executeInTransaction] 
(src/utils/TransactionManager.js:76:29)
      at CreateReserva.execute 
(src/application/use-cases/reservas/CreateReserva.js:26:34)
      at Object.<anonymous>.exports.crearReservaBySlug 
(src/controllers/public.controller.js:140:25)

    console.log
      [Transaction] Aborted: CreateReservation

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:69:29)

    console.warn
      [Transaction] Transient error, retrying in 200ms: WriteConflict error: 
this operation conflicted with another operation. Please retry your operation or 
multi-document transaction.

    [0m [90m 74 |[39m                     attempt[33m++[39m[33m;[39m
     [90m 75 |[39m                     [36mconst[39m delay [33m=[39m 
retryDelay [33m*[39m [33mMath[39m[33m.[39mpow([35m2[39m[33m,[39m 
attempt)[33m;[39m [90m// Exponential backoff[39m
    [31m[1m>[22m[39m[90m 76 |[39m                     
console[33m.[39mwarn([32m`[Transaction] Transient error, retrying in 
${delay}ms:`[39m[33m,[39m error[33m.[39mmessage)[33m;[39m
     [90m    |[39m                             [31m[1m^[22m[39m
     [90m 77 |[39m                     [36mawait[39m 
[36mthis[39m[33m.[39msleep(delay)[33m;[39m
     [90m 78 |[39m                     [36mcontinue[39m[33m;[39m
     [90m 79 |[39m                 }[0m

      at Function.warn [as executeInTransaction] 
(src/utils/TransactionManager.js:76:29)
      at CreateReserva.execute 
(src/application/use-cases/reservas/CreateReserva.js:26:34)
      at Object.<anonymous>.exports.crearReservaBySlug 
(src/controllers/public.controller.js:140:25)

    console.log
      [Transaction] Aborted: CreateReservation

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:69:29)

    console.warn
      [Transaction] Transient error, retrying in 200ms: WriteConflict error: 
this operation conflicted with another operation. Please retry your operation or 
multi-document transaction.

    [0m [90m 74 |[39m                     attempt[33m++[39m[33m;[39m
     [90m 75 |[39m                     [36mconst[39m delay [33m=[39m 
retryDelay [33m*[39m [33mMath[39m[33m.[39mpow([35m2[39m[33m,[39m 
attempt)[33m;[39m [90m// Exponential backoff[39m
    [31m[1m>[22m[39m[90m 76 |[39m                     
console[33m.[39mwarn([32m`[Transaction] Transient error, retrying in 
${delay}ms:`[39m[33m,[39m error[33m.[39mmessage)[33m;[39m
     [90m    |[39m                             [31m[1m^[22m[39m
     [90m 77 |[39m                     [36mawait[39m 
[36mthis[39m[33m.[39msleep(delay)[33m;[39m
     [90m 78 |[39m                     [36mcontinue[39m[33m;[39m
     [90m 79 |[39m                 }[0m

      at Function.warn [as executeInTransaction] 
(src/utils/TransactionManager.js:76:29)
      at CreateReserva.execute 
(src/application/use-cases/reservas/CreateReserva.js:26:34)
      at Object.<anonymous>.exports.crearReservaBySlug 
(src/controllers/public.controller.js:140:25)

    console.log
      [Transaction] Aborted: CreateReservation

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:69:29)

    console.error
      [Transaction] Failed: CreateReservation {
        error: `E11000 duplicate key error collection: test.reservas index: 
unique_reservation_slot dup key: { barberoId: 
ObjectId('698be98a6a05e103eb4701ae'), fecha: new Date(1773532800000), hora: 
"10:00", barberiaId: ObjectId('698be98a6a05e103eb4701ac') }`,
        attempt: 1,
        stack: `MongoServerError: E11000 duplicate key error collection: 
test.reservas index: unique_reservation_slot dup key: { barberoId: 
ObjectId('698be98a6a05e103eb4701ae'), fecha: new Date(1773532800000), hora: 
"10:00", barberiaId: ObjectId('698be98a6a05e103eb4701ac') }\n` +
          '    at InsertOneOperation.handleOk (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\node_modules\\mongodb\\src\\operations\\insert.ts:79:13)\n' +
          '    at tryOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\backen
d\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:294:26)\n' +
          '    at processTicksAndRejections 
(node:internal/process/task_queues:105:5)\n' +
          '    at executeOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\ba
ckend\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:123:12)\n' +
          '    at Collection.insertOne (C:\\Users\\Kristian\\Desktop\\barber-saas
\\backend\\node_modules\\mongodb\\src\\collection.ts:294:12)\n' +
          '    at model.$__save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backe
nd\\node_modules\\mongoose\\lib\\model.js:398:16)\n' +
          '    at model.save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\
\node_modules\\mongoose\\lib\\model.js:609:5)\n' +
          '    at C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\\node_module
s\\mongoose\\lib\\model.js:2722:9\n' +
          '    at async Promise.all (index 0)\n' +
          '    at Function.create (C:\\Users\\Kristian\\Desktop\\barber-saas\\bac
kend\\node_modules\\mongoose\\lib\\model.js:2707:11)\n' +
          '    at MongoReservaRepository.save (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\src\\infrastructure\\database\\mongodb\\repositories\\MongoRese
rvaRepository.js:15:16)\n' +
          '    at TransactionManager.executeInTransaction.operationName (C:\\User
s\\Kristian\\Desktop\\barber-saas\\backend\\src\\application\\use-cases\\reservas
\\CreateReserva.js:72:42)\n' +
          '    at Function.executeInTransaction (C:\\Users\\Kristian\\Desktop\\ba
rber-saas\\backend\\src\\utils\\TransactionManager.js:57:32)\n' +
          '    at CreateReserva.execute (C:\\Users\\Kristian\\Desktop\\barber-saa
s\\backend\\src\\application\\use-cases\\reservas\\CreateReserva.js:26:34)\n' +
          '    at Object.<anonymous>.exports.crearReservaBySlug (C:\\Users\\Krist
ian\\Desktop\\barber-saas\\backend\\src\\controllers\\public.controller.js:140:25
)'
      }

    [0m [90m 80 |[39m
     [90m 81 |[39m                 [90m// Non-transient error or max retries 
reached[39m
    [31m[1m>[22m[39m[90m 82 |[39m                 
console[33m.[39merror([32m`[Transaction] Failed: 
${operationName}`[39m[33m,[39m {
     [90m    |[39m                         [31m[1m^[22m[39m
     [90m 83 |[39m                     error[33m:[39m 
error[33m.[39mmessage[33m,[39m
     [90m 84 |[39m                     attempt[33m:[39m attempt [33m+[39m 
[35m1[39m[33m,[39m
     [90m 85 |[39m                     stack[33m:[39m 
error[33m.[39mstack[0m

      at Function.error [as executeInTransaction] 
(src/utils/TransactionManager.js:82:25)
      at CreateReserva.execute 
(src/application/use-cases/reservas/CreateReserva.js:26:34)
      at Object.<anonymous>.exports.crearReservaBySlug 
(src/controllers/public.controller.js:140:25)

    console.error
      ƒö┤ ERROR: TransactionError: Transaction failed for CreateReservation: 
E11000 duplicate key error collection: test.reservas index: 
unique_reservation_slot dup key: { barberoId: 
ObjectId('698be98a6a05e103eb4701ae'), fecha: new Date(1773532800000), hora: 
"10:00", barberiaId: ObjectId('698be98a6a05e103eb4701ac') }
          at Function.executeInTransaction (C:\Users\Kristian\Desktop\barber-saas
\backend\src\utils\TransactionManager.js:88:42)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at CreateReserva.execute (C:\Users\Kristian\Desktop\barber-saas\backend
\src\application\use-cases\reservas\CreateReserva.js:26:34)
          at Object.<anonymous>.exports.crearReservaBySlug (C:\Users\Kristian\Des
ktop\barber-saas\backend\src\controllers\public.controller.js:140:25) {
        isTransactionError: true,
        originalError: MongoServerError: E11000 duplicate key error collection: 
test.reservas index: unique_reservation_slot dup key: { barberoId: 
ObjectId('698be98a6a05e103eb4701ae'), fecha: new Date(1773532800000), hora: 
"10:00", barberiaId: ObjectId('698be98a6a05e103eb4701ac') }
            at InsertOneOperation.handleOk (C:\Users\Kristian\Desktop\barber-saas
\backend\node_modules\mongodb\src\operations\insert.ts:79:13)
            at tryOperation (C:\Users\Kristian\Desktop\barber-saas\backend\node_m
odules\mongodb\src\operations\execute_operation.ts:294:26)
            at processTicksAndRejections 
(node:internal/process/task_queues:105:5)
            at executeOperation (C:\Users\Kristian\Desktop\barber-saas\backend\no
de_modules\mongodb\src\operations\execute_operation.ts:123:12)
            at Collection.insertOne (C:\Users\Kristian\Desktop\barber-saas\backen
d\node_modules\mongodb\src\collection.ts:294:12)
            at model.$__save (C:\Users\Kristian\Desktop\barber-saas\backend\node_
modules\mongoose\lib\model.js:398:16)
            at model.save (C:\Users\Kristian\Desktop\barber-saas\backend\node_mod
ules\mongoose\lib\model.js:609:5)
            at C:\Users\Kristian\Desktop\barber-saas\backend\node_modules\mongoos
e\lib\model.js:2722:9
            at async Promise.all (index 0)
            at Function.create (C:\Users\Kristian\Desktop\barber-saas\backend\nod
e_modules\mongoose\lib\model.js:2707:11)
            at MongoReservaRepository.save (C:\Users\Kristian\Desktop\barber-saas
\backend\src\infrastructure\database\mongodb\repositories\MongoReservaRepository.
js:15:16)
            at TransactionManager.executeInTransaction.operationName (C:\Users\Kr
istian\Desktop\barber-saas\backend\src\application\use-cases\reservas\CreateReser
va.js:72:42)
            at Function.executeInTransaction (C:\Users\Kristian\Desktop\barber-sa
as\backend\src\utils\TransactionManager.js:57:32)
            at CreateReserva.execute (C:\Users\Kristian\Desktop\barber-saas\backe
nd\src\application\use-cases\reservas\CreateReserva.js:26:34)
            at Object.<anonymous>.exports.crearReservaBySlug (C:\Users\Kristian\D
esktop\barber-saas\backend\src\controllers\public.controller.js:140:25) {
          errorLabelSet: Set(0) {},
          errorResponse: {
            index: 0,
            code: 11000,
            errmsg: `E11000 duplicate key error collection: test.reservas index: 
unique_reservation_slot dup key: { barberoId: 
ObjectId('698be98a6a05e103eb4701ae'), fecha: new Date(1773532800000), hora: 
"10:00", barberiaId: ObjectId('698be98a6a05e103eb4701ac') }`,
            keyPattern: [Object],
            keyValue: [Object]
          },
          index: 0,
          code: 11000,
          keyPattern: { barberoId: 1, fecha: 1, hora: 1, barberiaId: 1 },
          keyValue: {
            barberoId: new ObjectId('698be98a6a05e103eb4701ae'),
            fecha: 2026-03-15T00:00:00.000Z,
            hora: '10:00',
            barberiaId: new ObjectId('698be98a6a05e103eb4701ac')
          }
        },
        context: { operationName: 'CreateReservation', attempt: 1 },
        timestamp: 2026-02-11T02:29:30.563Z,
        originalStack: `MongoServerError: E11000 duplicate key error collection: 
test.reservas index: unique_reservation_slot dup key: { barberoId: 
ObjectId('698be98a6a05e103eb4701ae'), fecha: new Date(1773532800000), hora: 
"10:00", barberiaId: ObjectId('698be98a6a05e103eb4701ac') }\n` +
          '    at InsertOneOperation.handleOk (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\node_modules\\mongodb\\src\\operations\\insert.ts:79:13)\n' +
          '    at tryOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\backen
d\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:294:26)\n' +
          '    at processTicksAndRejections 
(node:internal/process/task_queues:105:5)\n' +
          '    at executeOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\ba
ckend\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:123:12)\n' +
          '    at Collection.insertOne (C:\\Users\\Kristian\\Desktop\\barber-saas
\\backend\\node_modules\\mongodb\\src\\collection.ts:294:12)\n' +
          '    at model.$__save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backe
nd\\node_modules\\mongoose\\lib\\model.js:398:16)\n' +
          '    at model.save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\
\node_modules\\mongoose\\lib\\model.js:609:5)\n' +
          '    at C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\\node_module
s\\mongoose\\lib\\model.js:2722:9\n' +
          '    at async Promise.all (index 0)\n' +
          '    at Function.create (C:\\Users\\Kristian\\Desktop\\barber-saas\\bac
kend\\node_modules\\mongoose\\lib\\model.js:2707:11)\n' +
          '    at MongoReservaRepository.save (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\src\\infrastructure\\database\\mongodb\\repositories\\MongoRese
rvaRepository.js:15:16)\n' +
          '    at TransactionManager.executeInTransaction.operationName (C:\\User
s\\Kristian\\Desktop\\barber-saas\\backend\\src\\application\\use-cases\\reservas
\\CreateReserva.js:72:42)\n' +
          '    at Function.executeInTransaction (C:\\Users\\Kristian\\Desktop\\ba
rber-saas\\backend\\src\\utils\\TransactionManager.js:57:32)\n' +
          '    at CreateReserva.execute (C:\\Users\\Kristian\\Desktop\\barber-saa
s\\backend\\src\\application\\use-cases\\reservas\\CreateReserva.js:26:34)\n' +
          '    at Object.<anonymous>.exports.crearReservaBySlug (C:\\Users\\Krist
ian\\Desktop\\barber-saas\\backend\\src\\controllers\\public.controller.js:140:25
)'
      }

    [0m [90m 4 |[39m
     [90m 5 |[39m [36mconst[39m errorHandler [33m=[39m (err[33m,[39m 
req[33m,[39m res[33m,[39m next) [33m=>[39m {
    [31m[1m>[22m[39m[90m 6 |[39m   console[33m.[39merror([32m"ƒö┤ 
ERROR:"[39m[33m,[39m err)[33m;[39m
     [90m   |[39m           [31m[1m^[22m[39m
     [90m 7 |[39m
     [90m 8 |[39m   [90m// ­ƒöÑ A├æADIR HEADERS CORS SI NO EXISTEN[39m
     [90m 9 |[39m   [36mconst[39m origin [33m=[39m 
req[33m.[39mheaders[33m.[39morigin[33m;[39m[0m

      at error (src/config/middleware/errorHandler.js:6:11)
      at Layer.handleError (node_modules/router/lib/layer.js:116:17)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at Layer.handleError (node_modules/router/lib/layer.js:111:12)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at Immediate.next (node_modules/router/index.js:291:5)
      at Immediate._onImmediate (node_modules/router/index.js:688:15)

    console.log
      [Transaction] Aborted: CreateReservation

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:69:29)

    console.error
      [Transaction] Failed: CreateReservation {
        error: `E11000 duplicate key error collection: test.reservas index: 
unique_reservation_slot dup key: { barberoId: 
ObjectId('698be98a6a05e103eb4701ae'), fecha: new Date(1773532800000), hora: 
"10:00", barberiaId: ObjectId('698be98a6a05e103eb4701ac') }`,
        attempt: 1,
        stack: `MongoServerError: E11000 duplicate key error collection: 
test.reservas index: unique_reservation_slot dup key: { barberoId: 
ObjectId('698be98a6a05e103eb4701ae'), fecha: new Date(1773532800000), hora: 
"10:00", barberiaId: ObjectId('698be98a6a05e103eb4701ac') }\n` +
          '    at InsertOneOperation.handleOk (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\node_modules\\mongodb\\src\\operations\\insert.ts:79:13)\n' +
          '    at tryOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\backen
d\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:294:26)\n' +
          '    at processTicksAndRejections 
(node:internal/process/task_queues:105:5)\n' +
          '    at executeOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\ba
ckend\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:123:12)\n' +
          '    at Collection.insertOne (C:\\Users\\Kristian\\Desktop\\barber-saas
\\backend\\node_modules\\mongodb\\src\\collection.ts:294:12)\n' +
          '    at model.$__save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backe
nd\\node_modules\\mongoose\\lib\\model.js:398:16)\n' +
          '    at model.save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\
\node_modules\\mongoose\\lib\\model.js:609:5)\n' +
          '    at C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\\node_module
s\\mongoose\\lib\\model.js:2722:9\n' +
          '    at async Promise.all (index 0)\n' +
          '    at Function.create (C:\\Users\\Kristian\\Desktop\\barber-saas\\bac
kend\\node_modules\\mongoose\\lib\\model.js:2707:11)\n' +
          '    at MongoReservaRepository.save (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\src\\infrastructure\\database\\mongodb\\repositories\\MongoRese
rvaRepository.js:15:16)\n' +
          '    at TransactionManager.executeInTransaction.operationName (C:\\User
s\\Kristian\\Desktop\\barber-saas\\backend\\src\\application\\use-cases\\reservas
\\CreateReserva.js:72:42)\n' +
          '    at Function.executeInTransaction (C:\\Users\\Kristian\\Desktop\\ba
rber-saas\\backend\\src\\utils\\TransactionManager.js:57:32)\n' +
          '    at CreateReserva.execute (C:\\Users\\Kristian\\Desktop\\barber-saa
s\\backend\\src\\application\\use-cases\\reservas\\CreateReserva.js:26:34)\n' +
          '    at Object.<anonymous>.exports.crearReservaBySlug (C:\\Users\\Krist
ian\\Desktop\\barber-saas\\backend\\src\\controllers\\public.controller.js:140:25
)'
      }

    [0m [90m 80 |[39m
     [90m 81 |[39m                 [90m// Non-transient error or max retries 
reached[39m
    [31m[1m>[22m[39m[90m 82 |[39m                 
console[33m.[39merror([32m`[Transaction] Failed: 
${operationName}`[39m[33m,[39m {
     [90m    |[39m                         [31m[1m^[22m[39m
     [90m 83 |[39m                     error[33m:[39m 
error[33m.[39mmessage[33m,[39m
     [90m 84 |[39m                     attempt[33m:[39m attempt [33m+[39m 
[35m1[39m[33m,[39m
     [90m 85 |[39m                     stack[33m:[39m 
error[33m.[39mstack[0m

      at Function.error [as executeInTransaction] 
(src/utils/TransactionManager.js:82:25)
      at CreateReserva.execute 
(src/application/use-cases/reservas/CreateReserva.js:26:34)
      at Object.<anonymous>.exports.crearReservaBySlug 
(src/controllers/public.controller.js:140:25)

    console.error
      ƒö┤ ERROR: TransactionError: Transaction failed for CreateReservation: 
E11000 duplicate key error collection: test.reservas index: 
unique_reservation_slot dup key: { barberoId: 
ObjectId('698be98a6a05e103eb4701ae'), fecha: new Date(1773532800000), hora: 
"10:00", barberiaId: ObjectId('698be98a6a05e103eb4701ac') }
          at Function.executeInTransaction (C:\Users\Kristian\Desktop\barber-saas
\backend\src\utils\TransactionManager.js:88:42)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at CreateReserva.execute (C:\Users\Kristian\Desktop\barber-saas\backend
\src\application\use-cases\reservas\CreateReserva.js:26:34)
          at Object.<anonymous>.exports.crearReservaBySlug (C:\Users\Kristian\Des
ktop\barber-saas\backend\src\controllers\public.controller.js:140:25) {
        isTransactionError: true,
        originalError: MongoServerError: E11000 duplicate key error collection: 
test.reservas index: unique_reservation_slot dup key: { barberoId: 
ObjectId('698be98a6a05e103eb4701ae'), fecha: new Date(1773532800000), hora: 
"10:00", barberiaId: ObjectId('698be98a6a05e103eb4701ac') }
            at InsertOneOperation.handleOk (C:\Users\Kristian\Desktop\barber-saas
\backend\node_modules\mongodb\src\operations\insert.ts:79:13)
            at tryOperation (C:\Users\Kristian\Desktop\barber-saas\backend\node_m
odules\mongodb\src\operations\execute_operation.ts:294:26)
            at processTicksAndRejections 
(node:internal/process/task_queues:105:5)
            at executeOperation (C:\Users\Kristian\Desktop\barber-saas\backend\no
de_modules\mongodb\src\operations\execute_operation.ts:123:12)
            at Collection.insertOne (C:\Users\Kristian\Desktop\barber-saas\backen
d\node_modules\mongodb\src\collection.ts:294:12)
            at model.$__save (C:\Users\Kristian\Desktop\barber-saas\backend\node_
modules\mongoose\lib\model.js:398:16)
            at model.save (C:\Users\Kristian\Desktop\barber-saas\backend\node_mod
ules\mongoose\lib\model.js:609:5)
            at C:\Users\Kristian\Desktop\barber-saas\backend\node_modules\mongoos
e\lib\model.js:2722:9
            at async Promise.all (index 0)
            at Function.create (C:\Users\Kristian\Desktop\barber-saas\backend\nod
e_modules\mongoose\lib\model.js:2707:11)
            at MongoReservaRepository.save (C:\Users\Kristian\Desktop\barber-saas
\backend\src\infrastructure\database\mongodb\repositories\MongoReservaRepository.
js:15:16)
            at TransactionManager.executeInTransaction.operationName (C:\Users\Kr
istian\Desktop\barber-saas\backend\src\application\use-cases\reservas\CreateReser
va.js:72:42)
            at Function.executeInTransaction (C:\Users\Kristian\Desktop\barber-sa
as\backend\src\utils\TransactionManager.js:57:32)
            at CreateReserva.execute (C:\Users\Kristian\Desktop\barber-saas\backe
nd\src\application\use-cases\reservas\CreateReserva.js:26:34)
            at Object.<anonymous>.exports.crearReservaBySlug (C:\Users\Kristian\D
esktop\barber-saas\backend\src\controllers\public.controller.js:140:25) {
          errorLabelSet: Set(0) {},
          errorResponse: {
            index: 0,
            code: 11000,
            errmsg: `E11000 duplicate key error collection: test.reservas index: 
unique_reservation_slot dup key: { barberoId: 
ObjectId('698be98a6a05e103eb4701ae'), fecha: new Date(1773532800000), hora: 
"10:00", barberiaId: ObjectId('698be98a6a05e103eb4701ac') }`,
            keyPattern: [Object],
            keyValue: [Object]
          },
          index: 0,
          code: 11000,
          keyPattern: { barberoId: 1, fecha: 1, hora: 1, barberiaId: 1 },
          keyValue: {
            barberoId: new ObjectId('698be98a6a05e103eb4701ae'),
            fecha: 2026-03-15T00:00:00.000Z,
            hora: '10:00',
            barberiaId: new ObjectId('698be98a6a05e103eb4701ac')
          }
        },
        context: { operationName: 'CreateReservation', attempt: 1 },
        timestamp: 2026-02-11T02:29:30.576Z,
        originalStack: `MongoServerError: E11000 duplicate key error collection: 
test.reservas index: unique_reservation_slot dup key: { barberoId: 
ObjectId('698be98a6a05e103eb4701ae'), fecha: new Date(1773532800000), hora: 
"10:00", barberiaId: ObjectId('698be98a6a05e103eb4701ac') }\n` +
          '    at InsertOneOperation.handleOk (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\node_modules\\mongodb\\src\\operations\\insert.ts:79:13)\n' +
          '    at tryOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\backen
d\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:294:26)\n' +
          '    at processTicksAndRejections 
(node:internal/process/task_queues:105:5)\n' +
          '    at executeOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\ba
ckend\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:123:12)\n' +
          '    at Collection.insertOne (C:\\Users\\Kristian\\Desktop\\barber-saas
\\backend\\node_modules\\mongodb\\src\\collection.ts:294:12)\n' +
          '    at model.$__save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backe
nd\\node_modules\\mongoose\\lib\\model.js:398:16)\n' +
          '    at model.save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\
\node_modules\\mongoose\\lib\\model.js:609:5)\n' +
          '    at C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\\node_module
s\\mongoose\\lib\\model.js:2722:9\n' +
          '    at async Promise.all (index 0)\n' +
          '    at Function.create (C:\\Users\\Kristian\\Desktop\\barber-saas\\bac
kend\\node_modules\\mongoose\\lib\\model.js:2707:11)\n' +
          '    at MongoReservaRepository.save (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\src\\infrastructure\\database\\mongodb\\repositories\\MongoRese
rvaRepository.js:15:16)\n' +
          '    at TransactionManager.executeInTransaction.operationName (C:\\User
s\\Kristian\\Desktop\\barber-saas\\backend\\src\\application\\use-cases\\reservas
\\CreateReserva.js:72:42)\n' +
          '    at Function.executeInTransaction (C:\\Users\\Kristian\\Desktop\\ba
rber-saas\\backend\\src\\utils\\TransactionManager.js:57:32)\n' +
          '    at CreateReserva.execute (C:\\Users\\Kristian\\Desktop\\barber-saa
s\\backend\\src\\application\\use-cases\\reservas\\CreateReserva.js:26:34)\n' +
          '    at Object.<anonymous>.exports.crearReservaBySlug (C:\\Users\\Krist
ian\\Desktop\\barber-saas\\backend\\src\\controllers\\public.controller.js:140:25
)'
      }

    [0m [90m 4 |[39m
     [90m 5 |[39m [36mconst[39m errorHandler [33m=[39m (err[33m,[39m 
req[33m,[39m res[33m,[39m next) [33m=>[39m {
    [31m[1m>[22m[39m[90m 6 |[39m   console[33m.[39merror([32m"ƒö┤ 
ERROR:"[39m[33m,[39m err)[33m;[39m
     [90m   |[39m           [31m[1m^[22m[39m
     [90m 7 |[39m
     [90m 8 |[39m   [90m// ­ƒöÑ A├æADIR HEADERS CORS SI NO EXISTEN[39m
     [90m 9 |[39m   [36mconst[39m origin [33m=[39m 
req[33m.[39mheaders[33m.[39morigin[33m;[39m[0m

      at error (src/config/middleware/errorHandler.js:6:11)
      at Layer.handleError (node_modules/router/lib/layer.js:116:17)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at Layer.handleError (node_modules/router/lib/layer.js:111:12)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at Immediate.next (node_modules/router/index.js:291:5)
      at Immediate._onImmediate (node_modules/router/index.js:688:15)

    console.log
      [Transaction] Started: CreateReservation (attempt 2/3)

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:54:25)

    console.log
      [Transaction] Started: CreateReservation (attempt 2/3)

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:54:25)

    console.log
      [Transaction] Started: CreateReservation (attempt 2/3)

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:54:25)

    console.log
      [Transaction] Started: CreateReservation (attempt 2/3)

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:54:25)

    console.log
      [Transaction] Started: CreateReservation (attempt 2/3)

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:54:25)

    console.log
      [Transaction] Started: CreateReservation (attempt 2/3)

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:54:25)

    console.log
      [Transaction] Started: CreateReservation (attempt 2/3)

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:54:25)

    console.log
      [Transaction] Aborted: CreateReservation

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:69:29)

    console.error
      [Transaction] Failed: CreateReservation {
        error: `E11000 duplicate key error collection: test.reservas index: 
unique_reservation_slot dup key: { barberoId: 
ObjectId('698be98a6a05e103eb4701ae'), fecha: new Date(1773532800000), hora: 
"10:00", barberiaId: ObjectId('698be98a6a05e103eb4701ac') }`,
        attempt: 2,
        stack: `MongoServerError: E11000 duplicate key error collection: 
test.reservas index: unique_reservation_slot dup key: { barberoId: 
ObjectId('698be98a6a05e103eb4701ae'), fecha: new Date(1773532800000), hora: 
"10:00", barberiaId: ObjectId('698be98a6a05e103eb4701ac') }\n` +
          '    at InsertOneOperation.handleOk (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\node_modules\\mongodb\\src\\operations\\insert.ts:79:13)\n' +
          '    at tryOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\backen
d\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:294:26)\n' +
          '    at processTicksAndRejections 
(node:internal/process/task_queues:105:5)\n' +
          '    at executeOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\ba
ckend\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:123:12)\n' +
          '    at Collection.insertOne (C:\\Users\\Kristian\\Desktop\\barber-saas
\\backend\\node_modules\\mongodb\\src\\collection.ts:294:12)\n' +
          '    at model.$__save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backe
nd\\node_modules\\mongoose\\lib\\model.js:398:16)\n' +
          '    at model.save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\
\node_modules\\mongoose\\lib\\model.js:609:5)\n' +
          '    at C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\\node_module
s\\mongoose\\lib\\model.js:2722:9\n' +
          '    at async Promise.all (index 0)\n' +
          '    at Function.create (C:\\Users\\Kristian\\Desktop\\barber-saas\\bac
kend\\node_modules\\mongoose\\lib\\model.js:2707:11)\n' +
          '    at MongoReservaRepository.save (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\src\\infrastructure\\database\\mongodb\\repositories\\MongoRese
rvaRepository.js:15:16)\n' +
          '    at TransactionManager.executeInTransaction.operationName (C:\\User
s\\Kristian\\Desktop\\barber-saas\\backend\\src\\application\\use-cases\\reservas
\\CreateReserva.js:72:42)\n' +
          '    at Function.executeInTransaction (C:\\Users\\Kristian\\Desktop\\ba
rber-saas\\backend\\src\\utils\\TransactionManager.js:57:32)\n' +
          '    at CreateReserva.execute (C:\\Users\\Kristian\\Desktop\\barber-saa
s\\backend\\src\\application\\use-cases\\reservas\\CreateReserva.js:26:34)\n' +
          '    at Object.<anonymous>.exports.crearReservaBySlug (C:\\Users\\Krist
ian\\Desktop\\barber-saas\\backend\\src\\controllers\\public.controller.js:140:25
)'
      }

    [0m [90m 80 |[39m
     [90m 81 |[39m                 [90m// Non-transient error or max retries 
reached[39m
    [31m[1m>[22m[39m[90m 82 |[39m                 
console[33m.[39merror([32m`[Transaction] Failed: 
${operationName}`[39m[33m,[39m {
     [90m    |[39m                         [31m[1m^[22m[39m
     [90m 83 |[39m                     error[33m:[39m 
error[33m.[39mmessage[33m,[39m
     [90m 84 |[39m                     attempt[33m:[39m attempt [33m+[39m 
[35m1[39m[33m,[39m
     [90m 85 |[39m                     stack[33m:[39m 
error[33m.[39mstack[0m

      at Function.error [as executeInTransaction] 
(src/utils/TransactionManager.js:82:25)
      at CreateReserva.execute 
(src/application/use-cases/reservas/CreateReserva.js:26:34)
      at Object.<anonymous>.exports.crearReservaBySlug 
(src/controllers/public.controller.js:140:25)

    console.log
      [Transaction] Aborted: CreateReservation

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:69:29)

    console.error
      [Transaction] Failed: CreateReservation {
        error: `E11000 duplicate key error collection: test.reservas index: 
unique_reservation_slot dup key: { barberoId: 
ObjectId('698be98a6a05e103eb4701ae'), fecha: new Date(1773532800000), hora: 
"10:00", barberiaId: ObjectId('698be98a6a05e103eb4701ac') }`,
        attempt: 2,
        stack: `MongoServerError: E11000 duplicate key error collection: 
test.reservas index: unique_reservation_slot dup key: { barberoId: 
ObjectId('698be98a6a05e103eb4701ae'), fecha: new Date(1773532800000), hora: 
"10:00", barberiaId: ObjectId('698be98a6a05e103eb4701ac') }\n` +
          '    at InsertOneOperation.handleOk (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\node_modules\\mongodb\\src\\operations\\insert.ts:79:13)\n' +
          '    at tryOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\backen
d\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:294:26)\n' +
          '    at processTicksAndRejections 
(node:internal/process/task_queues:105:5)\n' +
          '    at executeOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\ba
ckend\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:123:12)\n' +
          '    at Collection.insertOne (C:\\Users\\Kristian\\Desktop\\barber-saas
\\backend\\node_modules\\mongodb\\src\\collection.ts:294:12)\n' +
          '    at model.$__save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backe
nd\\node_modules\\mongoose\\lib\\model.js:398:16)\n' +
          '    at model.save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\
\node_modules\\mongoose\\lib\\model.js:609:5)\n' +
          '    at C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\\node_module
s\\mongoose\\lib\\model.js:2722:9\n' +
          '    at async Promise.all (index 0)\n' +
          '    at Function.create (C:\\Users\\Kristian\\Desktop\\barber-saas\\bac
kend\\node_modules\\mongoose\\lib\\model.js:2707:11)\n' +
          '    at MongoReservaRepository.save (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\src\\infrastructure\\database\\mongodb\\repositories\\MongoRese
rvaRepository.js:15:16)\n' +
          '    at TransactionManager.executeInTransaction.operationName (C:\\User
s\\Kristian\\Desktop\\barber-saas\\backend\\src\\application\\use-cases\\reservas
\\CreateReserva.js:72:42)\n' +
          '    at Function.executeInTransaction (C:\\Users\\Kristian\\Desktop\\ba
rber-saas\\backend\\src\\utils\\TransactionManager.js:57:32)\n' +
          '    at CreateReserva.execute (C:\\Users\\Kristian\\Desktop\\barber-saa
s\\backend\\src\\application\\use-cases\\reservas\\CreateReserva.js:26:34)\n' +
          '    at Object.<anonymous>.exports.crearReservaBySlug (C:\\Users\\Krist
ian\\Desktop\\barber-saas\\backend\\src\\controllers\\public.controller.js:140:25
)'
      }

    [0m [90m 80 |[39m
     [90m 81 |[39m                 [90m// Non-transient error or max retries 
reached[39m
    [31m[1m>[22m[39m[90m 82 |[39m                 
console[33m.[39merror([32m`[Transaction] Failed: 
${operationName}`[39m[33m,[39m {
     [90m    |[39m                         [31m[1m^[22m[39m
     [90m 83 |[39m                     error[33m:[39m 
error[33m.[39mmessage[33m,[39m
     [90m 84 |[39m                     attempt[33m:[39m attempt [33m+[39m 
[35m1[39m[33m,[39m
     [90m 85 |[39m                     stack[33m:[39m 
error[33m.[39mstack[0m

      at Function.error [as executeInTransaction] 
(src/utils/TransactionManager.js:82:25)
      at CreateReserva.execute 
(src/application/use-cases/reservas/CreateReserva.js:26:34)
      at Object.<anonymous>.exports.crearReservaBySlug 
(src/controllers/public.controller.js:140:25)

    console.error
      ƒö┤ ERROR: TransactionError: Transaction failed for CreateReservation: 
E11000 duplicate key error collection: test.reservas index: 
unique_reservation_slot dup key: { barberoId: 
ObjectId('698be98a6a05e103eb4701ae'), fecha: new Date(1773532800000), hora: 
"10:00", barberiaId: ObjectId('698be98a6a05e103eb4701ac') }
          at Function.executeInTransaction (C:\Users\Kristian\Desktop\barber-saas
\backend\src\utils\TransactionManager.js:88:42)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at CreateReserva.execute (C:\Users\Kristian\Desktop\barber-saas\backend
\src\application\use-cases\reservas\CreateReserva.js:26:34)
          at Object.<anonymous>.exports.crearReservaBySlug (C:\Users\Kristian\Des
ktop\barber-saas\backend\src\controllers\public.controller.js:140:25) {
        isTransactionError: true,
        originalError: MongoServerError: E11000 duplicate key error collection: 
test.reservas index: unique_reservation_slot dup key: { barberoId: 
ObjectId('698be98a6a05e103eb4701ae'), fecha: new Date(1773532800000), hora: 
"10:00", barberiaId: ObjectId('698be98a6a05e103eb4701ac') }
            at InsertOneOperation.handleOk (C:\Users\Kristian\Desktop\barber-saas
\backend\node_modules\mongodb\src\operations\insert.ts:79:13)
            at tryOperation (C:\Users\Kristian\Desktop\barber-saas\backend\node_m
odules\mongodb\src\operations\execute_operation.ts:294:26)
            at processTicksAndRejections 
(node:internal/process/task_queues:105:5)
            at executeOperation (C:\Users\Kristian\Desktop\barber-saas\backend\no
de_modules\mongodb\src\operations\execute_operation.ts:123:12)
            at Collection.insertOne (C:\Users\Kristian\Desktop\barber-saas\backen
d\node_modules\mongodb\src\collection.ts:294:12)
            at model.$__save (C:\Users\Kristian\Desktop\barber-saas\backend\node_
modules\mongoose\lib\model.js:398:16)
            at model.save (C:\Users\Kristian\Desktop\barber-saas\backend\node_mod
ules\mongoose\lib\model.js:609:5)
            at C:\Users\Kristian\Desktop\barber-saas\backend\node_modules\mongoos
e\lib\model.js:2722:9
            at async Promise.all (index 0)
            at Function.create (C:\Users\Kristian\Desktop\barber-saas\backend\nod
e_modules\mongoose\lib\model.js:2707:11)
            at MongoReservaRepository.save (C:\Users\Kristian\Desktop\barber-saas
\backend\src\infrastructure\database\mongodb\repositories\MongoReservaRepository.
js:15:16)
            at TransactionManager.executeInTransaction.operationName (C:\Users\Kr
istian\Desktop\barber-saas\backend\src\application\use-cases\reservas\CreateReser
va.js:72:42)
            at Function.executeInTransaction (C:\Users\Kristian\Desktop\barber-sa
as\backend\src\utils\TransactionManager.js:57:32)
            at CreateReserva.execute (C:\Users\Kristian\Desktop\barber-saas\backe
nd\src\application\use-cases\reservas\CreateReserva.js:26:34)
            at Object.<anonymous>.exports.crearReservaBySlug (C:\Users\Kristian\D
esktop\barber-saas\backend\src\controllers\public.controller.js:140:25) {
          errorLabelSet: Set(0) {},
          errorResponse: {
            index: 0,
            code: 11000,
            errmsg: `E11000 duplicate key error collection: test.reservas index: 
unique_reservation_slot dup key: { barberoId: 
ObjectId('698be98a6a05e103eb4701ae'), fecha: new Date(1773532800000), hora: 
"10:00", barberiaId: ObjectId('698be98a6a05e103eb4701ac') }`,
            keyPattern: [Object],
            keyValue: [Object]
          },
          index: 0,
          code: 11000,
          keyPattern: { barberoId: 1, fecha: 1, hora: 1, barberiaId: 1 },
          keyValue: {
            barberoId: new ObjectId('698be98a6a05e103eb4701ae'),
            fecha: 2026-03-15T00:00:00.000Z,
            hora: '10:00',
            barberiaId: new ObjectId('698be98a6a05e103eb4701ac')
          }
        },
        context: { operationName: 'CreateReservation', attempt: 2 },
        timestamp: 2026-02-11T02:29:30.780Z,
        originalStack: `MongoServerError: E11000 duplicate key error collection: 
test.reservas index: unique_reservation_slot dup key: { barberoId: 
ObjectId('698be98a6a05e103eb4701ae'), fecha: new Date(1773532800000), hora: 
"10:00", barberiaId: ObjectId('698be98a6a05e103eb4701ac') }\n` +
          '    at InsertOneOperation.handleOk (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\node_modules\\mongodb\\src\\operations\\insert.ts:79:13)\n' +
          '    at tryOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\backen
d\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:294:26)\n' +
          '    at processTicksAndRejections 
(node:internal/process/task_queues:105:5)\n' +
          '    at executeOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\ba
ckend\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:123:12)\n' +
          '    at Collection.insertOne (C:\\Users\\Kristian\\Desktop\\barber-saas
\\backend\\node_modules\\mongodb\\src\\collection.ts:294:12)\n' +
          '    at model.$__save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backe
nd\\node_modules\\mongoose\\lib\\model.js:398:16)\n' +
          '    at model.save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\
\node_modules\\mongoose\\lib\\model.js:609:5)\n' +
          '    at C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\\node_module
s\\mongoose\\lib\\model.js:2722:9\n' +
          '    at async Promise.all (index 0)\n' +
          '    at Function.create (C:\\Users\\Kristian\\Desktop\\barber-saas\\bac
kend\\node_modules\\mongoose\\lib\\model.js:2707:11)\n' +
          '    at MongoReservaRepository.save (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\src\\infrastructure\\database\\mongodb\\repositories\\MongoRese
rvaRepository.js:15:16)\n' +
          '    at TransactionManager.executeInTransaction.operationName (C:\\User
s\\Kristian\\Desktop\\barber-saas\\backend\\src\\application\\use-cases\\reservas
\\CreateReserva.js:72:42)\n' +
          '    at Function.executeInTransaction (C:\\Users\\Kristian\\Desktop\\ba
rber-saas\\backend\\src\\utils\\TransactionManager.js:57:32)\n' +
          '    at CreateReserva.execute (C:\\Users\\Kristian\\Desktop\\barber-saa
s\\backend\\src\\application\\use-cases\\reservas\\CreateReserva.js:26:34)\n' +
          '    at Object.<anonymous>.exports.crearReservaBySlug (C:\\Users\\Krist
ian\\Desktop\\barber-saas\\backend\\src\\controllers\\public.controller.js:140:25
)'
      }

    [0m [90m 4 |[39m
     [90m 5 |[39m [36mconst[39m errorHandler [33m=[39m (err[33m,[39m 
req[33m,[39m res[33m,[39m next) [33m=>[39m {
    [31m[1m>[22m[39m[90m 6 |[39m   console[33m.[39merror([32m"ƒö┤ 
ERROR:"[39m[33m,[39m err)[33m;[39m
     [90m   |[39m           [31m[1m^[22m[39m
     [90m 7 |[39m
     [90m 8 |[39m   [90m// ­ƒöÑ A├æADIR HEADERS CORS SI NO EXISTEN[39m
     [90m 9 |[39m   [36mconst[39m origin [33m=[39m 
req[33m.[39mheaders[33m.[39morigin[33m;[39m[0m

      at error (src/config/middleware/errorHandler.js:6:11)
      at Layer.handleError (node_modules/router/lib/layer.js:116:17)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at Layer.handleError (node_modules/router/lib/layer.js:111:12)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at Immediate.next (node_modules/router/index.js:291:5)
      at Immediate._onImmediate (node_modules/router/index.js:688:15)

    console.error
      ƒö┤ ERROR: TransactionError: Transaction failed for CreateReservation: 
E11000 duplicate key error collection: test.reservas index: 
unique_reservation_slot dup key: { barberoId: 
ObjectId('698be98a6a05e103eb4701ae'), fecha: new Date(1773532800000), hora: 
"10:00", barberiaId: ObjectId('698be98a6a05e103eb4701ac') }
          at Function.executeInTransaction (C:\Users\Kristian\Desktop\barber-saas
\backend\src\utils\TransactionManager.js:88:42)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at CreateReserva.execute (C:\Users\Kristian\Desktop\barber-saas\backend
\src\application\use-cases\reservas\CreateReserva.js:26:34)
          at Object.<anonymous>.exports.crearReservaBySlug (C:\Users\Kristian\Des
ktop\barber-saas\backend\src\controllers\public.controller.js:140:25) {
        isTransactionError: true,
        originalError: MongoServerError: E11000 duplicate key error collection: 
test.reservas index: unique_reservation_slot dup key: { barberoId: 
ObjectId('698be98a6a05e103eb4701ae'), fecha: new Date(1773532800000), hora: 
"10:00", barberiaId: ObjectId('698be98a6a05e103eb4701ac') }
            at InsertOneOperation.handleOk (C:\Users\Kristian\Desktop\barber-saas
\backend\node_modules\mongodb\src\operations\insert.ts:79:13)
            at tryOperation (C:\Users\Kristian\Desktop\barber-saas\backend\node_m
odules\mongodb\src\operations\execute_operation.ts:294:26)
            at processTicksAndRejections 
(node:internal/process/task_queues:105:5)
            at executeOperation (C:\Users\Kristian\Desktop\barber-saas\backend\no
de_modules\mongodb\src\operations\execute_operation.ts:123:12)
            at Collection.insertOne (C:\Users\Kristian\Desktop\barber-saas\backen
d\node_modules\mongodb\src\collection.ts:294:12)
            at model.$__save (C:\Users\Kristian\Desktop\barber-saas\backend\node_
modules\mongoose\lib\model.js:398:16)
            at model.save (C:\Users\Kristian\Desktop\barber-saas\backend\node_mod
ules\mongoose\lib\model.js:609:5)
            at C:\Users\Kristian\Desktop\barber-saas\backend\node_modules\mongoos
e\lib\model.js:2722:9
            at async Promise.all (index 0)
            at Function.create (C:\Users\Kristian\Desktop\barber-saas\backend\nod
e_modules\mongoose\lib\model.js:2707:11)
            at MongoReservaRepository.save (C:\Users\Kristian\Desktop\barber-saas
\backend\src\infrastructure\database\mongodb\repositories\MongoReservaRepository.
js:15:16)
            at TransactionManager.executeInTransaction.operationName (C:\Users\Kr
istian\Desktop\barber-saas\backend\src\application\use-cases\reservas\CreateReser
va.js:72:42)
            at Function.executeInTransaction (C:\Users\Kristian\Desktop\barber-sa
as\backend\src\utils\TransactionManager.js:57:32)
            at CreateReserva.execute (C:\Users\Kristian\Desktop\barber-saas\backe
nd\src\application\use-cases\reservas\CreateReserva.js:26:34)
            at Object.<anonymous>.exports.crearReservaBySlug (C:\Users\Kristian\D
esktop\barber-saas\backend\src\controllers\public.controller.js:140:25) {
          errorLabelSet: Set(0) {},
          errorResponse: {
            index: 0,
            code: 11000,
            errmsg: `E11000 duplicate key error collection: test.reservas index: 
unique_reservation_slot dup key: { barberoId: 
ObjectId('698be98a6a05e103eb4701ae'), fecha: new Date(1773532800000), hora: 
"10:00", barberiaId: ObjectId('698be98a6a05e103eb4701ac') }`,
            keyPattern: [Object],
            keyValue: [Object]
          },
          index: 0,
          code: 11000,
          keyPattern: { barberoId: 1, fecha: 1, hora: 1, barberiaId: 1 },
          keyValue: {
            barberoId: new ObjectId('698be98a6a05e103eb4701ae'),
            fecha: 2026-03-15T00:00:00.000Z,
            hora: '10:00',
            barberiaId: new ObjectId('698be98a6a05e103eb4701ac')
          }
        },
        context: { operationName: 'CreateReservation', attempt: 2 },
        timestamp: 2026-02-11T02:29:30.782Z,
        originalStack: `MongoServerError: E11000 duplicate key error collection: 
test.reservas index: unique_reservation_slot dup key: { barberoId: 
ObjectId('698be98a6a05e103eb4701ae'), fecha: new Date(1773532800000), hora: 
"10:00", barberiaId: ObjectId('698be98a6a05e103eb4701ac') }\n` +
          '    at InsertOneOperation.handleOk (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\node_modules\\mongodb\\src\\operations\\insert.ts:79:13)\n' +
          '    at tryOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\backen
d\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:294:26)\n' +
          '    at processTicksAndRejections 
(node:internal/process/task_queues:105:5)\n' +
          '    at executeOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\ba
ckend\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:123:12)\n' +
          '    at Collection.insertOne (C:\\Users\\Kristian\\Desktop\\barber-saas
\\backend\\node_modules\\mongodb\\src\\collection.ts:294:12)\n' +
          '    at model.$__save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backe
nd\\node_modules\\mongoose\\lib\\model.js:398:16)\n' +
          '    at model.save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\
\node_modules\\mongoose\\lib\\model.js:609:5)\n' +
          '    at C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\\node_module
s\\mongoose\\lib\\model.js:2722:9\n' +
          '    at async Promise.all (index 0)\n' +
          '    at Function.create (C:\\Users\\Kristian\\Desktop\\barber-saas\\bac
kend\\node_modules\\mongoose\\lib\\model.js:2707:11)\n' +
          '    at MongoReservaRepository.save (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\src\\infrastructure\\database\\mongodb\\repositories\\MongoRese
rvaRepository.js:15:16)\n' +
          '    at TransactionManager.executeInTransaction.operationName (C:\\User
s\\Kristian\\Desktop\\barber-saas\\backend\\src\\application\\use-cases\\reservas
\\CreateReserva.js:72:42)\n' +
          '    at Function.executeInTransaction (C:\\Users\\Kristian\\Desktop\\ba
rber-saas\\backend\\src\\utils\\TransactionManager.js:57:32)\n' +
          '    at CreateReserva.execute (C:\\Users\\Kristian\\Desktop\\barber-saa
s\\backend\\src\\application\\use-cases\\reservas\\CreateReserva.js:26:34)\n' +
          '    at Object.<anonymous>.exports.crearReservaBySlug (C:\\Users\\Krist
ian\\Desktop\\barber-saas\\backend\\src\\controllers\\public.controller.js:140:25
)'
      }

    [0m [90m 4 |[39m
     [90m 5 |[39m [36mconst[39m errorHandler [33m=[39m (err[33m,[39m 
req[33m,[39m res[33m,[39m next) [33m=>[39m {
    [31m[1m>[22m[39m[90m 6 |[39m   console[33m.[39merror([32m"ƒö┤ 
ERROR:"[39m[33m,[39m err)[33m;[39m
     [90m   |[39m           [31m[1m^[22m[39m
     [90m 7 |[39m
     [90m 8 |[39m   [90m// ­ƒöÑ A├æADIR HEADERS CORS SI NO EXISTEN[39m
     [90m 9 |[39m   [36mconst[39m origin [33m=[39m 
req[33m.[39mheaders[33m.[39morigin[33m;[39m[0m

      at error (src/config/middleware/errorHandler.js:6:11)
      at Layer.handleError (node_modules/router/lib/layer.js:116:17)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at Layer.handleError (node_modules/router/lib/layer.js:111:12)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at Immediate.next (node_modules/router/index.js:291:5)
      at Immediate._onImmediate (node_modules/router/index.js:688:15)

    console.log
      [Transaction] Aborted: CreateReservation

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:69:29)

    console.error
      [Transaction] Failed: CreateReservation {
        error: `E11000 duplicate key error collection: test.reservas index: 
unique_reservation_slot dup key: { barberoId: 
ObjectId('698be98a6a05e103eb4701ae'), fecha: new Date(1773532800000), hora: 
"10:00", barberiaId: ObjectId('698be98a6a05e103eb4701ac') }`,
        attempt: 2,
        stack: `MongoServerError: E11000 duplicate key error collection: 
test.reservas index: unique_reservation_slot dup key: { barberoId: 
ObjectId('698be98a6a05e103eb4701ae'), fecha: new Date(1773532800000), hora: 
"10:00", barberiaId: ObjectId('698be98a6a05e103eb4701ac') }\n` +
          '    at InsertOneOperation.handleOk (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\node_modules\\mongodb\\src\\operations\\insert.ts:79:13)\n' +
          '    at tryOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\backen
d\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:294:26)\n' +
          '    at processTicksAndRejections 
(node:internal/process/task_queues:105:5)\n' +
          '    at executeOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\ba
ckend\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:123:12)\n' +
          '    at Collection.insertOne (C:\\Users\\Kristian\\Desktop\\barber-saas
\\backend\\node_modules\\mongodb\\src\\collection.ts:294:12)\n' +
          '    at model.$__save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backe
nd\\node_modules\\mongoose\\lib\\model.js:398:16)\n' +
          '    at model.save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\
\node_modules\\mongoose\\lib\\model.js:609:5)\n' +
          '    at C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\\node_module
s\\mongoose\\lib\\model.js:2722:9\n' +
          '    at async Promise.all (index 0)\n' +
          '    at Function.create (C:\\Users\\Kristian\\Desktop\\barber-saas\\bac
kend\\node_modules\\mongoose\\lib\\model.js:2707:11)\n' +
          '    at MongoReservaRepository.save (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\src\\infrastructure\\database\\mongodb\\repositories\\MongoRese
rvaRepository.js:15:16)\n' +
          '    at TransactionManager.executeInTransaction.operationName (C:\\User
s\\Kristian\\Desktop\\barber-saas\\backend\\src\\application\\use-cases\\reservas
\\CreateReserva.js:72:42)\n' +
          '    at Function.executeInTransaction (C:\\Users\\Kristian\\Desktop\\ba
rber-saas\\backend\\src\\utils\\TransactionManager.js:57:32)\n' +
          '    at CreateReserva.execute (C:\\Users\\Kristian\\Desktop\\barber-saa
s\\backend\\src\\application\\use-cases\\reservas\\CreateReserva.js:26:34)\n' +
          '    at Object.<anonymous>.exports.crearReservaBySlug (C:\\Users\\Krist
ian\\Desktop\\barber-saas\\backend\\src\\controllers\\public.controller.js:140:25
)'
      }

    [0m [90m 80 |[39m
     [90m 81 |[39m                 [90m// Non-transient error or max retries 
reached[39m
    [31m[1m>[22m[39m[90m 82 |[39m                 
console[33m.[39merror([32m`[Transaction] Failed: 
${operationName}`[39m[33m,[39m {
     [90m    |[39m                         [31m[1m^[22m[39m
     [90m 83 |[39m                     error[33m:[39m 
error[33m.[39mmessage[33m,[39m
     [90m 84 |[39m                     attempt[33m:[39m attempt [33m+[39m 
[35m1[39m[33m,[39m
     [90m 85 |[39m                     stack[33m:[39m 
error[33m.[39mstack[0m

      at Function.error [as executeInTransaction] 
(src/utils/TransactionManager.js:82:25)
      at CreateReserva.execute 
(src/application/use-cases/reservas/CreateReserva.js:26:34)
      at Object.<anonymous>.exports.crearReservaBySlug 
(src/controllers/public.controller.js:140:25)

    console.error
      ƒö┤ ERROR: TransactionError: Transaction failed for CreateReservation: 
E11000 duplicate key error collection: test.reservas index: 
unique_reservation_slot dup key: { barberoId: 
ObjectId('698be98a6a05e103eb4701ae'), fecha: new Date(1773532800000), hora: 
"10:00", barberiaId: ObjectId('698be98a6a05e103eb4701ac') }
          at Function.executeInTransaction (C:\Users\Kristian\Desktop\barber-saas
\backend\src\utils\TransactionManager.js:88:42)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at CreateReserva.execute (C:\Users\Kristian\Desktop\barber-saas\backend
\src\application\use-cases\reservas\CreateReserva.js:26:34)
          at Object.<anonymous>.exports.crearReservaBySlug (C:\Users\Kristian\Des
ktop\barber-saas\backend\src\controllers\public.controller.js:140:25) {
        isTransactionError: true,
        originalError: MongoServerError: E11000 duplicate key error collection: 
test.reservas index: unique_reservation_slot dup key: { barberoId: 
ObjectId('698be98a6a05e103eb4701ae'), fecha: new Date(1773532800000), hora: 
"10:00", barberiaId: ObjectId('698be98a6a05e103eb4701ac') }
            at InsertOneOperation.handleOk (C:\Users\Kristian\Desktop\barber-saas
\backend\node_modules\mongodb\src\operations\insert.ts:79:13)
            at tryOperation (C:\Users\Kristian\Desktop\barber-saas\backend\node_m
odules\mongodb\src\operations\execute_operation.ts:294:26)
            at processTicksAndRejections 
(node:internal/process/task_queues:105:5)
            at executeOperation (C:\Users\Kristian\Desktop\barber-saas\backend\no
de_modules\mongodb\src\operations\execute_operation.ts:123:12)
            at Collection.insertOne (C:\Users\Kristian\Desktop\barber-saas\backen
d\node_modules\mongodb\src\collection.ts:294:12)
            at model.$__save (C:\Users\Kristian\Desktop\barber-saas\backend\node_
modules\mongoose\lib\model.js:398:16)
            at model.save (C:\Users\Kristian\Desktop\barber-saas\backend\node_mod
ules\mongoose\lib\model.js:609:5)
            at C:\Users\Kristian\Desktop\barber-saas\backend\node_modules\mongoos
e\lib\model.js:2722:9
            at async Promise.all (index 0)
            at Function.create (C:\Users\Kristian\Desktop\barber-saas\backend\nod
e_modules\mongoose\lib\model.js:2707:11)
            at MongoReservaRepository.save (C:\Users\Kristian\Desktop\barber-saas
\backend\src\infrastructure\database\mongodb\repositories\MongoReservaRepository.
js:15:16)
            at TransactionManager.executeInTransaction.operationName (C:\Users\Kr
istian\Desktop\barber-saas\backend\src\application\use-cases\reservas\CreateReser
va.js:72:42)
            at Function.executeInTransaction (C:\Users\Kristian\Desktop\barber-sa
as\backend\src\utils\TransactionManager.js:57:32)
            at CreateReserva.execute (C:\Users\Kristian\Desktop\barber-saas\backe
nd\src\application\use-cases\reservas\CreateReserva.js:26:34)
            at Object.<anonymous>.exports.crearReservaBySlug (C:\Users\Kristian\D
esktop\barber-saas\backend\src\controllers\public.controller.js:140:25) {
          errorLabelSet: Set(0) {},
          errorResponse: {
            index: 0,
            code: 11000,
            errmsg: `E11000 duplicate key error collection: test.reservas index: 
unique_reservation_slot dup key: { barberoId: 
ObjectId('698be98a6a05e103eb4701ae'), fecha: new Date(1773532800000), hora: 
"10:00", barberiaId: ObjectId('698be98a6a05e103eb4701ac') }`,
            keyPattern: [Object],
            keyValue: [Object]
          },
          index: 0,
          code: 11000,
          keyPattern: { barberoId: 1, fecha: 1, hora: 1, barberiaId: 1 },
          keyValue: {
            barberoId: new ObjectId('698be98a6a05e103eb4701ae'),
            fecha: 2026-03-15T00:00:00.000Z,
            hora: '10:00',
            barberiaId: new ObjectId('698be98a6a05e103eb4701ac')
          }
        },
        context: { operationName: 'CreateReservation', attempt: 2 },
        timestamp: 2026-02-11T02:29:30.909Z,
        originalStack: `MongoServerError: E11000 duplicate key error collection: 
test.reservas index: unique_reservation_slot dup key: { barberoId: 
ObjectId('698be98a6a05e103eb4701ae'), fecha: new Date(1773532800000), hora: 
"10:00", barberiaId: ObjectId('698be98a6a05e103eb4701ac') }\n` +
          '    at InsertOneOperation.handleOk (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\node_modules\\mongodb\\src\\operations\\insert.ts:79:13)\n' +
          '    at tryOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\backen
d\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:294:26)\n' +
          '    at processTicksAndRejections 
(node:internal/process/task_queues:105:5)\n' +
          '    at executeOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\ba
ckend\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:123:12)\n' +
          '    at Collection.insertOne (C:\\Users\\Kristian\\Desktop\\barber-saas
\\backend\\node_modules\\mongodb\\src\\collection.ts:294:12)\n' +
          '    at model.$__save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backe
nd\\node_modules\\mongoose\\lib\\model.js:398:16)\n' +
          '    at model.save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\
\node_modules\\mongoose\\lib\\model.js:609:5)\n' +
          '    at C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\\node_module
s\\mongoose\\lib\\model.js:2722:9\n' +
          '    at async Promise.all (index 0)\n' +
          '    at Function.create (C:\\Users\\Kristian\\Desktop\\barber-saas\\bac
kend\\node_modules\\mongoose\\lib\\model.js:2707:11)\n' +
          '    at MongoReservaRepository.save (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\src\\infrastructure\\database\\mongodb\\repositories\\MongoRese
rvaRepository.js:15:16)\n' +
          '    at TransactionManager.executeInTransaction.operationName (C:\\User
s\\Kristian\\Desktop\\barber-saas\\backend\\src\\application\\use-cases\\reservas
\\CreateReserva.js:72:42)\n' +
          '    at Function.executeInTransaction (C:\\Users\\Kristian\\Desktop\\ba
rber-saas\\backend\\src\\utils\\TransactionManager.js:57:32)\n' +
          '    at CreateReserva.execute (C:\\Users\\Kristian\\Desktop\\barber-saa
s\\backend\\src\\application\\use-cases\\reservas\\CreateReserva.js:26:34)\n' +
          '    at Object.<anonymous>.exports.crearReservaBySlug (C:\\Users\\Krist
ian\\Desktop\\barber-saas\\backend\\src\\controllers\\public.controller.js:140:25
)'
      }

    [0m [90m 4 |[39m
     [90m 5 |[39m [36mconst[39m errorHandler [33m=[39m (err[33m,[39m 
req[33m,[39m res[33m,[39m next) [33m=>[39m {
    [31m[1m>[22m[39m[90m 6 |[39m   console[33m.[39merror([32m"ƒö┤ 
ERROR:"[39m[33m,[39m err)[33m;[39m
     [90m   |[39m           [31m[1m^[22m[39m
     [90m 7 |[39m
     [90m 8 |[39m   [90m// ­ƒöÑ A├æADIR HEADERS CORS SI NO EXISTEN[39m
     [90m 9 |[39m   [36mconst[39m origin [33m=[39m 
req[33m.[39mheaders[33m.[39morigin[33m;[39m[0m

      at error (src/config/middleware/errorHandler.js:6:11)
      at Layer.handleError (node_modules/router/lib/layer.js:116:17)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at Layer.handleError (node_modules/router/lib/layer.js:111:12)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at Immediate.next (node_modules/router/index.js:291:5)
      at Immediate._onImmediate (node_modules/router/index.js:688:15)

    console.log
      [Transaction] Aborted: CreateReservation

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:69:29)

    console.error
      [Transaction] Failed: CreateReservation {
        error: `E11000 duplicate key error collection: test.reservas index: 
unique_reservation_slot dup key: { barberoId: 
ObjectId('698be98a6a05e103eb4701ae'), fecha: new Date(1773532800000), hora: 
"10:00", barberiaId: ObjectId('698be98a6a05e103eb4701ac') }`,
        attempt: 2,
        stack: `MongoServerError: E11000 duplicate key error collection: 
test.reservas index: unique_reservation_slot dup key: { barberoId: 
ObjectId('698be98a6a05e103eb4701ae'), fecha: new Date(1773532800000), hora: 
"10:00", barberiaId: ObjectId('698be98a6a05e103eb4701ac') }\n` +
          '    at InsertOneOperation.handleOk (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\node_modules\\mongodb\\src\\operations\\insert.ts:79:13)\n' +
          '    at tryOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\backen
d\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:294:26)\n' +
          '    at processTicksAndRejections 
(node:internal/process/task_queues:105:5)\n' +
          '    at executeOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\ba
ckend\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:123:12)\n' +
          '    at Collection.insertOne (C:\\Users\\Kristian\\Desktop\\barber-saas
\\backend\\node_modules\\mongodb\\src\\collection.ts:294:12)\n' +
          '    at model.$__save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backe
nd\\node_modules\\mongoose\\lib\\model.js:398:16)\n' +
          '    at model.save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\
\node_modules\\mongoose\\lib\\model.js:609:5)\n' +
          '    at C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\\node_module
s\\mongoose\\lib\\model.js:2722:9\n' +
          '    at async Promise.all (index 0)\n' +
          '    at Function.create (C:\\Users\\Kristian\\Desktop\\barber-saas\\bac
kend\\node_modules\\mongoose\\lib\\model.js:2707:11)\n' +
          '    at MongoReservaRepository.save (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\src\\infrastructure\\database\\mongodb\\repositories\\MongoRese
rvaRepository.js:15:16)\n' +
          '    at TransactionManager.executeInTransaction.operationName (C:\\User
s\\Kristian\\Desktop\\barber-saas\\backend\\src\\application\\use-cases\\reservas
\\CreateReserva.js:72:42)\n' +
          '    at Function.executeInTransaction (C:\\Users\\Kristian\\Desktop\\ba
rber-saas\\backend\\src\\utils\\TransactionManager.js:57:32)\n' +
          '    at CreateReserva.execute (C:\\Users\\Kristian\\Desktop\\barber-saa
s\\backend\\src\\application\\use-cases\\reservas\\CreateReserva.js:26:34)\n' +
          '    at Object.<anonymous>.exports.crearReservaBySlug (C:\\Users\\Krist
ian\\Desktop\\barber-saas\\backend\\src\\controllers\\public.controller.js:140:25
)'
      }

    [0m [90m 80 |[39m
     [90m 81 |[39m                 [90m// Non-transient error or max retries 
reached[39m
    [31m[1m>[22m[39m[90m 82 |[39m                 
console[33m.[39merror([32m`[Transaction] Failed: 
${operationName}`[39m[33m,[39m {
     [90m    |[39m                         [31m[1m^[22m[39m
     [90m 83 |[39m                     error[33m:[39m 
error[33m.[39mmessage[33m,[39m
     [90m 84 |[39m                     attempt[33m:[39m attempt [33m+[39m 
[35m1[39m[33m,[39m
     [90m 85 |[39m                     stack[33m:[39m 
error[33m.[39mstack[0m

      at Function.error [as executeInTransaction] 
(src/utils/TransactionManager.js:82:25)
      at CreateReserva.execute 
(src/application/use-cases/reservas/CreateReserva.js:26:34)
      at Object.<anonymous>.exports.crearReservaBySlug 
(src/controllers/public.controller.js:140:25)

    console.log
      [Transaction] Aborted: CreateReservation

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:69:29)

    console.error
      [Transaction] Failed: CreateReservation {
        error: `E11000 duplicate key error collection: test.reservas index: 
unique_reservation_slot dup key: { barberoId: 
ObjectId('698be98a6a05e103eb4701ae'), fecha: new Date(1773532800000), hora: 
"10:00", barberiaId: ObjectId('698be98a6a05e103eb4701ac') }`,
        attempt: 2,
        stack: `MongoServerError: E11000 duplicate key error collection: 
test.reservas index: unique_reservation_slot dup key: { barberoId: 
ObjectId('698be98a6a05e103eb4701ae'), fecha: new Date(1773532800000), hora: 
"10:00", barberiaId: ObjectId('698be98a6a05e103eb4701ac') }\n` +
          '    at InsertOneOperation.handleOk (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\node_modules\\mongodb\\src\\operations\\insert.ts:79:13)\n' +
          '    at tryOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\backen
d\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:294:26)\n' +
          '    at processTicksAndRejections 
(node:internal/process/task_queues:105:5)\n' +
          '    at executeOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\ba
ckend\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:123:12)\n' +
          '    at Collection.insertOne (C:\\Users\\Kristian\\Desktop\\barber-saas
\\backend\\node_modules\\mongodb\\src\\collection.ts:294:12)\n' +
          '    at model.$__save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backe
nd\\node_modules\\mongoose\\lib\\model.js:398:16)\n' +
          '    at model.save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\
\node_modules\\mongoose\\lib\\model.js:609:5)\n' +
          '    at C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\\node_module
s\\mongoose\\lib\\model.js:2722:9\n' +
          '    at async Promise.all (index 0)\n' +
          '    at Function.create (C:\\Users\\Kristian\\Desktop\\barber-saas\\bac
kend\\node_modules\\mongoose\\lib\\model.js:2707:11)\n' +
          '    at MongoReservaRepository.save (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\src\\infrastructure\\database\\mongodb\\repositories\\MongoRese
rvaRepository.js:15:16)\n' +
          '    at TransactionManager.executeInTransaction.operationName (C:\\User
s\\Kristian\\Desktop\\barber-saas\\backend\\src\\application\\use-cases\\reservas
\\CreateReserva.js:72:42)\n' +
          '    at Function.executeInTransaction (C:\\Users\\Kristian\\Desktop\\ba
rber-saas\\backend\\src\\utils\\TransactionManager.js:57:32)\n' +
          '    at CreateReserva.execute (C:\\Users\\Kristian\\Desktop\\barber-saa
s\\backend\\src\\application\\use-cases\\reservas\\CreateReserva.js:26:34)\n' +
          '    at Object.<anonymous>.exports.crearReservaBySlug (C:\\Users\\Krist
ian\\Desktop\\barber-saas\\backend\\src\\controllers\\public.controller.js:140:25
)'
      }

    [0m [90m 80 |[39m
     [90m 81 |[39m                 [90m// Non-transient error or max retries 
reached[39m
    [31m[1m>[22m[39m[90m 82 |[39m                 
console[33m.[39merror([32m`[Transaction] Failed: 
${operationName}`[39m[33m,[39m {
     [90m    |[39m                         [31m[1m^[22m[39m
     [90m 83 |[39m                     error[33m:[39m 
error[33m.[39mmessage[33m,[39m
     [90m 84 |[39m                     attempt[33m:[39m attempt [33m+[39m 
[35m1[39m[33m,[39m
     [90m 85 |[39m                     stack[33m:[39m 
error[33m.[39mstack[0m

      at Function.error [as executeInTransaction] 
(src/utils/TransactionManager.js:82:25)
      at CreateReserva.execute 
(src/application/use-cases/reservas/CreateReserva.js:26:34)
      at Object.<anonymous>.exports.crearReservaBySlug 
(src/controllers/public.controller.js:140:25)

    console.log
      [Transaction] Aborted: CreateReservation

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:69:29)

    console.error
      [Transaction] Failed: CreateReservation {
        error: `E11000 duplicate key error collection: test.reservas index: 
unique_reservation_slot dup key: { barberoId: 
ObjectId('698be98a6a05e103eb4701ae'), fecha: new Date(1773532800000), hora: 
"10:00", barberiaId: ObjectId('698be98a6a05e103eb4701ac') }`,
        attempt: 2,
        stack: `MongoServerError: E11000 duplicate key error collection: 
test.reservas index: unique_reservation_slot dup key: { barberoId: 
ObjectId('698be98a6a05e103eb4701ae'), fecha: new Date(1773532800000), hora: 
"10:00", barberiaId: ObjectId('698be98a6a05e103eb4701ac') }\n` +
          '    at InsertOneOperation.handleOk (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\node_modules\\mongodb\\src\\operations\\insert.ts:79:13)\n' +
          '    at tryOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\backen
d\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:294:26)\n' +
          '    at processTicksAndRejections 
(node:internal/process/task_queues:105:5)\n' +
          '    at executeOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\ba
ckend\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:123:12)\n' +
          '    at Collection.insertOne (C:\\Users\\Kristian\\Desktop\\barber-saas
\\backend\\node_modules\\mongodb\\src\\collection.ts:294:12)\n' +
          '    at model.$__save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backe
nd\\node_modules\\mongoose\\lib\\model.js:398:16)\n' +
          '    at model.save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\
\node_modules\\mongoose\\lib\\model.js:609:5)\n' +
          '    at C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\\node_module
s\\mongoose\\lib\\model.js:2722:9\n' +
          '    at async Promise.all (index 0)\n' +
          '    at Function.create (C:\\Users\\Kristian\\Desktop\\barber-saas\\bac
kend\\node_modules\\mongoose\\lib\\model.js:2707:11)\n' +
          '    at MongoReservaRepository.save (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\src\\infrastructure\\database\\mongodb\\repositories\\MongoRese
rvaRepository.js:15:16)\n' +
          '    at TransactionManager.executeInTransaction.operationName (C:\\User
s\\Kristian\\Desktop\\barber-saas\\backend\\src\\application\\use-cases\\reservas
\\CreateReserva.js:72:42)\n' +
          '    at Function.executeInTransaction (C:\\Users\\Kristian\\Desktop\\ba
rber-saas\\backend\\src\\utils\\TransactionManager.js:57:32)\n' +
          '    at CreateReserva.execute (C:\\Users\\Kristian\\Desktop\\barber-saa
s\\backend\\src\\application\\use-cases\\reservas\\CreateReserva.js:26:34)\n' +
          '    at Object.<anonymous>.exports.crearReservaBySlug (C:\\Users\\Krist
ian\\Desktop\\barber-saas\\backend\\src\\controllers\\public.controller.js:140:25
)'
      }

    [0m [90m 80 |[39m
     [90m 81 |[39m                 [90m// Non-transient error or max retries 
reached[39m
    [31m[1m>[22m[39m[90m 82 |[39m                 
console[33m.[39merror([32m`[Transaction] Failed: 
${operationName}`[39m[33m,[39m {
     [90m    |[39m                         [31m[1m^[22m[39m
     [90m 83 |[39m                     error[33m:[39m 
error[33m.[39mmessage[33m,[39m
     [90m 84 |[39m                     attempt[33m:[39m attempt [33m+[39m 
[35m1[39m[33m,[39m
     [90m 85 |[39m                     stack[33m:[39m 
error[33m.[39mstack[0m

      at Function.error [as executeInTransaction] 
(src/utils/TransactionManager.js:82:25)
      at CreateReserva.execute 
(src/application/use-cases/reservas/CreateReserva.js:26:34)
      at Object.<anonymous>.exports.crearReservaBySlug 
(src/controllers/public.controller.js:140:25)

    console.error
      ƒö┤ ERROR: TransactionError: Transaction failed for CreateReservation: 
E11000 duplicate key error collection: test.reservas index: 
unique_reservation_slot dup key: { barberoId: 
ObjectId('698be98a6a05e103eb4701ae'), fecha: new Date(1773532800000), hora: 
"10:00", barberiaId: ObjectId('698be98a6a05e103eb4701ac') }
          at Function.executeInTransaction (C:\Users\Kristian\Desktop\barber-saas
\backend\src\utils\TransactionManager.js:88:42)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at CreateReserva.execute (C:\Users\Kristian\Desktop\barber-saas\backend
\src\application\use-cases\reservas\CreateReserva.js:26:34)
          at Object.<anonymous>.exports.crearReservaBySlug (C:\Users\Kristian\Des
ktop\barber-saas\backend\src\controllers\public.controller.js:140:25) {
        isTransactionError: true,
        originalError: MongoServerError: E11000 duplicate key error collection: 
test.reservas index: unique_reservation_slot dup key: { barberoId: 
ObjectId('698be98a6a05e103eb4701ae'), fecha: new Date(1773532800000), hora: 
"10:00", barberiaId: ObjectId('698be98a6a05e103eb4701ac') }
            at InsertOneOperation.handleOk (C:\Users\Kristian\Desktop\barber-saas
\backend\node_modules\mongodb\src\operations\insert.ts:79:13)
            at tryOperation (C:\Users\Kristian\Desktop\barber-saas\backend\node_m
odules\mongodb\src\operations\execute_operation.ts:294:26)
            at processTicksAndRejections 
(node:internal/process/task_queues:105:5)
            at executeOperation (C:\Users\Kristian\Desktop\barber-saas\backend\no
de_modules\mongodb\src\operations\execute_operation.ts:123:12)
            at Collection.insertOne (C:\Users\Kristian\Desktop\barber-saas\backen
d\node_modules\mongodb\src\collection.ts:294:12)
            at model.$__save (C:\Users\Kristian\Desktop\barber-saas\backend\node_
modules\mongoose\lib\model.js:398:16)
            at model.save (C:\Users\Kristian\Desktop\barber-saas\backend\node_mod
ules\mongoose\lib\model.js:609:5)
            at C:\Users\Kristian\Desktop\barber-saas\backend\node_modules\mongoos
e\lib\model.js:2722:9
            at async Promise.all (index 0)
            at Function.create (C:\Users\Kristian\Desktop\barber-saas\backend\nod
e_modules\mongoose\lib\model.js:2707:11)
            at MongoReservaRepository.save (C:\Users\Kristian\Desktop\barber-saas
\backend\src\infrastructure\database\mongodb\repositories\MongoReservaRepository.
js:15:16)
            at TransactionManager.executeInTransaction.operationName (C:\Users\Kr
istian\Desktop\barber-saas\backend\src\application\use-cases\reservas\CreateReser
va.js:72:42)
            at Function.executeInTransaction (C:\Users\Kristian\Desktop\barber-sa
as\backend\src\utils\TransactionManager.js:57:32)
            at CreateReserva.execute (C:\Users\Kristian\Desktop\barber-saas\backe
nd\src\application\use-cases\reservas\CreateReserva.js:26:34)
            at Object.<anonymous>.exports.crearReservaBySlug (C:\Users\Kristian\D
esktop\barber-saas\backend\src\controllers\public.controller.js:140:25) {
          errorLabelSet: Set(0) {},
          errorResponse: {
            index: 0,
            code: 11000,
            errmsg: `E11000 duplicate key error collection: test.reservas index: 
unique_reservation_slot dup key: { barberoId: 
ObjectId('698be98a6a05e103eb4701ae'), fecha: new Date(1773532800000), hora: 
"10:00", barberiaId: ObjectId('698be98a6a05e103eb4701ac') }`,
            keyPattern: [Object],
            keyValue: [Object]
          },
          index: 0,
          code: 11000,
          keyPattern: { barberoId: 1, fecha: 1, hora: 1, barberiaId: 1 },
          keyValue: {
            barberoId: new ObjectId('698be98a6a05e103eb4701ae'),
            fecha: 2026-03-15T00:00:00.000Z,
            hora: '10:00',
            barberiaId: new ObjectId('698be98a6a05e103eb4701ac')
          }
        },
        context: { operationName: 'CreateReservation', attempt: 2 },
        timestamp: 2026-02-11T02:29:30.926Z,
        originalStack: `MongoServerError: E11000 duplicate key error collection: 
test.reservas index: unique_reservation_slot dup key: { barberoId: 
ObjectId('698be98a6a05e103eb4701ae'), fecha: new Date(1773532800000), hora: 
"10:00", barberiaId: ObjectId('698be98a6a05e103eb4701ac') }\n` +
          '    at InsertOneOperation.handleOk (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\node_modules\\mongodb\\src\\operations\\insert.ts:79:13)\n' +
          '    at tryOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\backen
d\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:294:26)\n' +
          '    at processTicksAndRejections 
(node:internal/process/task_queues:105:5)\n' +
          '    at executeOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\ba
ckend\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:123:12)\n' +
          '    at Collection.insertOne (C:\\Users\\Kristian\\Desktop\\barber-saas
\\backend\\node_modules\\mongodb\\src\\collection.ts:294:12)\n' +
          '    at model.$__save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backe
nd\\node_modules\\mongoose\\lib\\model.js:398:16)\n' +
          '    at model.save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\
\node_modules\\mongoose\\lib\\model.js:609:5)\n' +
          '    at C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\\node_module
s\\mongoose\\lib\\model.js:2722:9\n' +
          '    at async Promise.all (index 0)\n' +
          '    at Function.create (C:\\Users\\Kristian\\Desktop\\barber-saas\\bac
kend\\node_modules\\mongoose\\lib\\model.js:2707:11)\n' +
          '    at MongoReservaRepository.save (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\src\\infrastructure\\database\\mongodb\\repositories\\MongoRese
rvaRepository.js:15:16)\n' +
          '    at TransactionManager.executeInTransaction.operationName (C:\\User
s\\Kristian\\Desktop\\barber-saas\\backend\\src\\application\\use-cases\\reservas
\\CreateReserva.js:72:42)\n' +
          '    at Function.executeInTransaction (C:\\Users\\Kristian\\Desktop\\ba
rber-saas\\backend\\src\\utils\\TransactionManager.js:57:32)\n' +
          '    at CreateReserva.execute (C:\\Users\\Kristian\\Desktop\\barber-saa
s\\backend\\src\\application\\use-cases\\reservas\\CreateReserva.js:26:34)\n' +
          '    at Object.<anonymous>.exports.crearReservaBySlug (C:\\Users\\Krist
ian\\Desktop\\barber-saas\\backend\\src\\controllers\\public.controller.js:140:25
)'
      }

    [0m [90m 4 |[39m
     [90m 5 |[39m [36mconst[39m errorHandler [33m=[39m (err[33m,[39m 
req[33m,[39m res[33m,[39m next) [33m=>[39m {
    [31m[1m>[22m[39m[90m 6 |[39m   console[33m.[39merror([32m"ƒö┤ 
ERROR:"[39m[33m,[39m err)[33m;[39m
     [90m   |[39m           [31m[1m^[22m[39m
     [90m 7 |[39m
     [90m 8 |[39m   [90m// ­ƒöÑ A├æADIR HEADERS CORS SI NO EXISTEN[39m
     [90m 9 |[39m   [36mconst[39m origin [33m=[39m 
req[33m.[39mheaders[33m.[39morigin[33m;[39m[0m

      at error (src/config/middleware/errorHandler.js:6:11)
      at Layer.handleError (node_modules/router/lib/layer.js:116:17)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at Layer.handleError (node_modules/router/lib/layer.js:111:12)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at Immediate.next (node_modules/router/index.js:291:5)
      at Immediate._onImmediate (node_modules/router/index.js:688:15)

    console.error
      ƒö┤ ERROR: TransactionError: Transaction failed for CreateReservation: 
E11000 duplicate key error collection: test.reservas index: 
unique_reservation_slot dup key: { barberoId: 
ObjectId('698be98a6a05e103eb4701ae'), fecha: new Date(1773532800000), hora: 
"10:00", barberiaId: ObjectId('698be98a6a05e103eb4701ac') }
          at Function.executeInTransaction (C:\Users\Kristian\Desktop\barber-saas
\backend\src\utils\TransactionManager.js:88:42)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at CreateReserva.execute (C:\Users\Kristian\Desktop\barber-saas\backend
\src\application\use-cases\reservas\CreateReserva.js:26:34)
          at Object.<anonymous>.exports.crearReservaBySlug (C:\Users\Kristian\Des
ktop\barber-saas\backend\src\controllers\public.controller.js:140:25) {
        isTransactionError: true,
        originalError: MongoServerError: E11000 duplicate key error collection: 
test.reservas index: unique_reservation_slot dup key: { barberoId: 
ObjectId('698be98a6a05e103eb4701ae'), fecha: new Date(1773532800000), hora: 
"10:00", barberiaId: ObjectId('698be98a6a05e103eb4701ac') }
            at InsertOneOperation.handleOk (C:\Users\Kristian\Desktop\barber-saas
\backend\node_modules\mongodb\src\operations\insert.ts:79:13)
            at tryOperation (C:\Users\Kristian\Desktop\barber-saas\backend\node_m
odules\mongodb\src\operations\execute_operation.ts:294:26)
            at processTicksAndRejections 
(node:internal/process/task_queues:105:5)
            at executeOperation (C:\Users\Kristian\Desktop\barber-saas\backend\no
de_modules\mongodb\src\operations\execute_operation.ts:123:12)
            at Collection.insertOne (C:\Users\Kristian\Desktop\barber-saas\backen
d\node_modules\mongodb\src\collection.ts:294:12)
            at model.$__save (C:\Users\Kristian\Desktop\barber-saas\backend\node_
modules\mongoose\lib\model.js:398:16)
            at model.save (C:\Users\Kristian\Desktop\barber-saas\backend\node_mod
ules\mongoose\lib\model.js:609:5)
            at C:\Users\Kristian\Desktop\barber-saas\backend\node_modules\mongoos
e\lib\model.js:2722:9
            at async Promise.all (index 0)
            at Function.create (C:\Users\Kristian\Desktop\barber-saas\backend\nod
e_modules\mongoose\lib\model.js:2707:11)
            at MongoReservaRepository.save (C:\Users\Kristian\Desktop\barber-saas
\backend\src\infrastructure\database\mongodb\repositories\MongoReservaRepository.
js:15:16)
            at TransactionManager.executeInTransaction.operationName (C:\Users\Kr
istian\Desktop\barber-saas\backend\src\application\use-cases\reservas\CreateReser
va.js:72:42)
            at Function.executeInTransaction (C:\Users\Kristian\Desktop\barber-sa
as\backend\src\utils\TransactionManager.js:57:32)
            at CreateReserva.execute (C:\Users\Kristian\Desktop\barber-saas\backe
nd\src\application\use-cases\reservas\CreateReserva.js:26:34)
            at Object.<anonymous>.exports.crearReservaBySlug (C:\Users\Kristian\D
esktop\barber-saas\backend\src\controllers\public.controller.js:140:25) {
          errorLabelSet: Set(0) {},
          errorResponse: {
            index: 0,
            code: 11000,
            errmsg: `E11000 duplicate key error collection: test.reservas index: 
unique_reservation_slot dup key: { barberoId: 
ObjectId('698be98a6a05e103eb4701ae'), fecha: new Date(1773532800000), hora: 
"10:00", barberiaId: ObjectId('698be98a6a05e103eb4701ac') }`,
            keyPattern: [Object],
            keyValue: [Object]
          },
          index: 0,
          code: 11000,
          keyPattern: { barberoId: 1, fecha: 1, hora: 1, barberiaId: 1 },
          keyValue: {
            barberoId: new ObjectId('698be98a6a05e103eb4701ae'),
            fecha: 2026-03-15T00:00:00.000Z,
            hora: '10:00',
            barberiaId: new ObjectId('698be98a6a05e103eb4701ac')
          }
        },
        context: { operationName: 'CreateReservation', attempt: 2 },
        timestamp: 2026-02-11T02:29:30.929Z,
        originalStack: `MongoServerError: E11000 duplicate key error collection: 
test.reservas index: unique_reservation_slot dup key: { barberoId: 
ObjectId('698be98a6a05e103eb4701ae'), fecha: new Date(1773532800000), hora: 
"10:00", barberiaId: ObjectId('698be98a6a05e103eb4701ac') }\n` +
          '    at InsertOneOperation.handleOk (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\node_modules\\mongodb\\src\\operations\\insert.ts:79:13)\n' +
          '    at tryOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\backen
d\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:294:26)\n' +
          '    at processTicksAndRejections 
(node:internal/process/task_queues:105:5)\n' +
          '    at executeOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\ba
ckend\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:123:12)\n' +
          '    at Collection.insertOne (C:\\Users\\Kristian\\Desktop\\barber-saas
\\backend\\node_modules\\mongodb\\src\\collection.ts:294:12)\n' +
          '    at model.$__save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backe
nd\\node_modules\\mongoose\\lib\\model.js:398:16)\n' +
          '    at model.save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\
\node_modules\\mongoose\\lib\\model.js:609:5)\n' +
          '    at C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\\node_module
s\\mongoose\\lib\\model.js:2722:9\n' +
          '    at async Promise.all (index 0)\n' +
          '    at Function.create (C:\\Users\\Kristian\\Desktop\\barber-saas\\bac
kend\\node_modules\\mongoose\\lib\\model.js:2707:11)\n' +
          '    at MongoReservaRepository.save (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\src\\infrastructure\\database\\mongodb\\repositories\\MongoRese
rvaRepository.js:15:16)\n' +
          '    at TransactionManager.executeInTransaction.operationName (C:\\User
s\\Kristian\\Desktop\\barber-saas\\backend\\src\\application\\use-cases\\reservas
\\CreateReserva.js:72:42)\n' +
          '    at Function.executeInTransaction (C:\\Users\\Kristian\\Desktop\\ba
rber-saas\\backend\\src\\utils\\TransactionManager.js:57:32)\n' +
          '    at CreateReserva.execute (C:\\Users\\Kristian\\Desktop\\barber-saa
s\\backend\\src\\application\\use-cases\\reservas\\CreateReserva.js:26:34)\n' +
          '    at Object.<anonymous>.exports.crearReservaBySlug (C:\\Users\\Krist
ian\\Desktop\\barber-saas\\backend\\src\\controllers\\public.controller.js:140:25
)'
      }

    [0m [90m 4 |[39m
     [90m 5 |[39m [36mconst[39m errorHandler [33m=[39m (err[33m,[39m 
req[33m,[39m res[33m,[39m next) [33m=>[39m {
    [31m[1m>[22m[39m[90m 6 |[39m   console[33m.[39merror([32m"ƒö┤ 
ERROR:"[39m[33m,[39m err)[33m;[39m
     [90m   |[39m           [31m[1m^[22m[39m
     [90m 7 |[39m
     [90m 8 |[39m   [90m// ­ƒöÑ A├æADIR HEADERS CORS SI NO EXISTEN[39m
     [90m 9 |[39m   [36mconst[39m origin [33m=[39m 
req[33m.[39mheaders[33m.[39morigin[33m;[39m[0m

      at error (src/config/middleware/errorHandler.js:6:11)
      at Layer.handleError (node_modules/router/lib/layer.js:116:17)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at Layer.handleError (node_modules/router/lib/layer.js:111:12)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at Immediate.next (node_modules/router/index.js:291:5)
      at Immediate._onImmediate (node_modules/router/index.js:688:15)

    console.error
      ƒö┤ ERROR: TransactionError: Transaction failed for CreateReservation: 
E11000 duplicate key error collection: test.reservas index: 
unique_reservation_slot dup key: { barberoId: 
ObjectId('698be98a6a05e103eb4701ae'), fecha: new Date(1773532800000), hora: 
"10:00", barberiaId: ObjectId('698be98a6a05e103eb4701ac') }
          at Function.executeInTransaction (C:\Users\Kristian\Desktop\barber-saas
\backend\src\utils\TransactionManager.js:88:42)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at CreateReserva.execute (C:\Users\Kristian\Desktop\barber-saas\backend
\src\application\use-cases\reservas\CreateReserva.js:26:34)
          at Object.<anonymous>.exports.crearReservaBySlug (C:\Users\Kristian\Des
ktop\barber-saas\backend\src\controllers\public.controller.js:140:25) {
        isTransactionError: true,
        originalError: MongoServerError: E11000 duplicate key error collection: 
test.reservas index: unique_reservation_slot dup key: { barberoId: 
ObjectId('698be98a6a05e103eb4701ae'), fecha: new Date(1773532800000), hora: 
"10:00", barberiaId: ObjectId('698be98a6a05e103eb4701ac') }
            at InsertOneOperation.handleOk (C:\Users\Kristian\Desktop\barber-saas
\backend\node_modules\mongodb\src\operations\insert.ts:79:13)
            at tryOperation (C:\Users\Kristian\Desktop\barber-saas\backend\node_m
odules\mongodb\src\operations\execute_operation.ts:294:26)
            at processTicksAndRejections 
(node:internal/process/task_queues:105:5)
            at executeOperation (C:\Users\Kristian\Desktop\barber-saas\backend\no
de_modules\mongodb\src\operations\execute_operation.ts:123:12)
            at Collection.insertOne (C:\Users\Kristian\Desktop\barber-saas\backen
d\node_modules\mongodb\src\collection.ts:294:12)
            at model.$__save (C:\Users\Kristian\Desktop\barber-saas\backend\node_
modules\mongoose\lib\model.js:398:16)
            at model.save (C:\Users\Kristian\Desktop\barber-saas\backend\node_mod
ules\mongoose\lib\model.js:609:5)
            at C:\Users\Kristian\Desktop\barber-saas\backend\node_modules\mongoos
e\lib\model.js:2722:9
            at async Promise.all (index 0)
            at Function.create (C:\Users\Kristian\Desktop\barber-saas\backend\nod
e_modules\mongoose\lib\model.js:2707:11)
            at MongoReservaRepository.save (C:\Users\Kristian\Desktop\barber-saas
\backend\src\infrastructure\database\mongodb\repositories\MongoReservaRepository.
js:15:16)
            at TransactionManager.executeInTransaction.operationName (C:\Users\Kr
istian\Desktop\barber-saas\backend\src\application\use-cases\reservas\CreateReser
va.js:72:42)
            at Function.executeInTransaction (C:\Users\Kristian\Desktop\barber-sa
as\backend\src\utils\TransactionManager.js:57:32)
            at CreateReserva.execute (C:\Users\Kristian\Desktop\barber-saas\backe
nd\src\application\use-cases\reservas\CreateReserva.js:26:34)
            at Object.<anonymous>.exports.crearReservaBySlug (C:\Users\Kristian\D
esktop\barber-saas\backend\src\controllers\public.controller.js:140:25) {
          errorLabelSet: Set(0) {},
          errorResponse: {
            index: 0,
            code: 11000,
            errmsg: `E11000 duplicate key error collection: test.reservas index: 
unique_reservation_slot dup key: { barberoId: 
ObjectId('698be98a6a05e103eb4701ae'), fecha: new Date(1773532800000), hora: 
"10:00", barberiaId: ObjectId('698be98a6a05e103eb4701ac') }`,
            keyPattern: [Object],
            keyValue: [Object]
          },
          index: 0,
          code: 11000,
          keyPattern: { barberoId: 1, fecha: 1, hora: 1, barberiaId: 1 },
          keyValue: {
            barberoId: new ObjectId('698be98a6a05e103eb4701ae'),
            fecha: 2026-03-15T00:00:00.000Z,
            hora: '10:00',
            barberiaId: new ObjectId('698be98a6a05e103eb4701ac')
          }
        },
        context: { operationName: 'CreateReservation', attempt: 2 },
        timestamp: 2026-02-11T02:29:30.931Z,
        originalStack: `MongoServerError: E11000 duplicate key error collection: 
test.reservas index: unique_reservation_slot dup key: { barberoId: 
ObjectId('698be98a6a05e103eb4701ae'), fecha: new Date(1773532800000), hora: 
"10:00", barberiaId: ObjectId('698be98a6a05e103eb4701ac') }\n` +
          '    at InsertOneOperation.handleOk (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\node_modules\\mongodb\\src\\operations\\insert.ts:79:13)\n' +
          '    at tryOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\backen
d\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:294:26)\n' +
          '    at processTicksAndRejections 
(node:internal/process/task_queues:105:5)\n' +
          '    at executeOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\ba
ckend\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:123:12)\n' +
          '    at Collection.insertOne (C:\\Users\\Kristian\\Desktop\\barber-saas
\\backend\\node_modules\\mongodb\\src\\collection.ts:294:12)\n' +
          '    at model.$__save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backe
nd\\node_modules\\mongoose\\lib\\model.js:398:16)\n' +
          '    at model.save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\
\node_modules\\mongoose\\lib\\model.js:609:5)\n' +
          '    at C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\\node_module
s\\mongoose\\lib\\model.js:2722:9\n' +
          '    at async Promise.all (index 0)\n' +
          '    at Function.create (C:\\Users\\Kristian\\Desktop\\barber-saas\\bac
kend\\node_modules\\mongoose\\lib\\model.js:2707:11)\n' +
          '    at MongoReservaRepository.save (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\src\\infrastructure\\database\\mongodb\\repositories\\MongoRese
rvaRepository.js:15:16)\n' +
          '    at TransactionManager.executeInTransaction.operationName (C:\\User
s\\Kristian\\Desktop\\barber-saas\\backend\\src\\application\\use-cases\\reservas
\\CreateReserva.js:72:42)\n' +
          '    at Function.executeInTransaction (C:\\Users\\Kristian\\Desktop\\ba
rber-saas\\backend\\src\\utils\\TransactionManager.js:57:32)\n' +
          '    at CreateReserva.execute (C:\\Users\\Kristian\\Desktop\\barber-saa
s\\backend\\src\\application\\use-cases\\reservas\\CreateReserva.js:26:34)\n' +
          '    at Object.<anonymous>.exports.crearReservaBySlug (C:\\Users\\Krist
ian\\Desktop\\barber-saas\\backend\\src\\controllers\\public.controller.js:140:25
)'
      }

    [0m [90m 4 |[39m
     [90m 5 |[39m [36mconst[39m errorHandler [33m=[39m (err[33m,[39m 
req[33m,[39m res[33m,[39m next) [33m=>[39m {
    [31m[1m>[22m[39m[90m 6 |[39m   console[33m.[39merror([32m"ƒö┤ 
ERROR:"[39m[33m,[39m err)[33m;[39m
     [90m   |[39m           [31m[1m^[22m[39m
     [90m 7 |[39m
     [90m 8 |[39m   [90m// ­ƒöÑ A├æADIR HEADERS CORS SI NO EXISTEN[39m
     [90m 9 |[39m   [36mconst[39m origin [33m=[39m 
req[33m.[39mheaders[33m.[39morigin[33m;[39m[0m

      at error (src/config/middleware/errorHandler.js:6:11)
      at Layer.handleError (node_modules/router/lib/layer.js:116:17)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at Layer.handleError (node_modules/router/lib/layer.js:111:12)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at Immediate.next (node_modules/router/index.js:291:5)
      at Immediate._onImmediate (node_modules/router/index.js:688:15)

    console.log
      [Transaction] Aborted: CreateReservation

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:69:29)

    console.error
      [Transaction] Failed: CreateReservation {
        error: `E11000 duplicate key error collection: test.reservas index: 
unique_reservation_slot dup key: { barberoId: 
ObjectId('698be98a6a05e103eb4701ae'), fecha: new Date(1773532800000), hora: 
"10:00", barberiaId: ObjectId('698be98a6a05e103eb4701ac') }`,
        attempt: 2,
        stack: `MongoServerError: E11000 duplicate key error collection: 
test.reservas index: unique_reservation_slot dup key: { barberoId: 
ObjectId('698be98a6a05e103eb4701ae'), fecha: new Date(1773532800000), hora: 
"10:00", barberiaId: ObjectId('698be98a6a05e103eb4701ac') }\n` +
          '    at InsertOneOperation.handleOk (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\node_modules\\mongodb\\src\\operations\\insert.ts:79:13)\n' +
          '    at tryOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\backen
d\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:294:26)\n' +
          '    at processTicksAndRejections 
(node:internal/process/task_queues:105:5)\n' +
          '    at executeOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\ba
ckend\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:123:12)\n' +
          '    at Collection.insertOne (C:\\Users\\Kristian\\Desktop\\barber-saas
\\backend\\node_modules\\mongodb\\src\\collection.ts:294:12)\n' +
          '    at model.$__save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backe
nd\\node_modules\\mongoose\\lib\\model.js:398:16)\n' +
          '    at model.save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\
\node_modules\\mongoose\\lib\\model.js:609:5)\n' +
          '    at C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\\node_module
s\\mongoose\\lib\\model.js:2722:9\n' +
          '    at async Promise.all (index 0)\n' +
          '    at Function.create (C:\\Users\\Kristian\\Desktop\\barber-saas\\bac
kend\\node_modules\\mongoose\\lib\\model.js:2707:11)\n' +
          '    at MongoReservaRepository.save (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\src\\infrastructure\\database\\mongodb\\repositories\\MongoRese
rvaRepository.js:15:16)\n' +
          '    at TransactionManager.executeInTransaction.operationName (C:\\User
s\\Kristian\\Desktop\\barber-saas\\backend\\src\\application\\use-cases\\reservas
\\CreateReserva.js:72:42)\n' +
          '    at Function.executeInTransaction (C:\\Users\\Kristian\\Desktop\\ba
rber-saas\\backend\\src\\utils\\TransactionManager.js:57:32)\n' +
          '    at CreateReserva.execute (C:\\Users\\Kristian\\Desktop\\barber-saa
s\\backend\\src\\application\\use-cases\\reservas\\CreateReserva.js:26:34)\n' +
          '    at Object.<anonymous>.exports.crearReservaBySlug (C:\\Users\\Krist
ian\\Desktop\\barber-saas\\backend\\src\\controllers\\public.controller.js:140:25
)'
      }

    [0m [90m 80 |[39m
     [90m 81 |[39m                 [90m// Non-transient error or max retries 
reached[39m
    [31m[1m>[22m[39m[90m 82 |[39m                 
console[33m.[39merror([32m`[Transaction] Failed: 
${operationName}`[39m[33m,[39m {
     [90m    |[39m                         [31m[1m^[22m[39m
     [90m 83 |[39m                     error[33m:[39m 
error[33m.[39mmessage[33m,[39m
     [90m 84 |[39m                     attempt[33m:[39m attempt [33m+[39m 
[35m1[39m[33m,[39m
     [90m 85 |[39m                     stack[33m:[39m 
error[33m.[39mstack[0m

      at Function.error [as executeInTransaction] 
(src/utils/TransactionManager.js:82:25)
      at CreateReserva.execute 
(src/application/use-cases/reservas/CreateReserva.js:26:34)
      at Object.<anonymous>.exports.crearReservaBySlug 
(src/controllers/public.controller.js:140:25)

    console.error
      ƒö┤ ERROR: TransactionError: Transaction failed for CreateReservation: 
E11000 duplicate key error collection: test.reservas index: 
unique_reservation_slot dup key: { barberoId: 
ObjectId('698be98a6a05e103eb4701ae'), fecha: new Date(1773532800000), hora: 
"10:00", barberiaId: ObjectId('698be98a6a05e103eb4701ac') }
          at Function.executeInTransaction (C:\Users\Kristian\Desktop\barber-saas
\backend\src\utils\TransactionManager.js:88:42)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at CreateReserva.execute (C:\Users\Kristian\Desktop\barber-saas\backend
\src\application\use-cases\reservas\CreateReserva.js:26:34)
          at Object.<anonymous>.exports.crearReservaBySlug (C:\Users\Kristian\Des
ktop\barber-saas\backend\src\controllers\public.controller.js:140:25) {
        isTransactionError: true,
        originalError: MongoServerError: E11000 duplicate key error collection: 
test.reservas index: unique_reservation_slot dup key: { barberoId: 
ObjectId('698be98a6a05e103eb4701ae'), fecha: new Date(1773532800000), hora: 
"10:00", barberiaId: ObjectId('698be98a6a05e103eb4701ac') }
            at InsertOneOperation.handleOk (C:\Users\Kristian\Desktop\barber-saas
\backend\node_modules\mongodb\src\operations\insert.ts:79:13)
            at tryOperation (C:\Users\Kristian\Desktop\barber-saas\backend\node_m
odules\mongodb\src\operations\execute_operation.ts:294:26)
            at processTicksAndRejections 
(node:internal/process/task_queues:105:5)
            at executeOperation (C:\Users\Kristian\Desktop\barber-saas\backend\no
de_modules\mongodb\src\operations\execute_operation.ts:123:12)
            at Collection.insertOne (C:\Users\Kristian\Desktop\barber-saas\backen
d\node_modules\mongodb\src\collection.ts:294:12)
            at model.$__save (C:\Users\Kristian\Desktop\barber-saas\backend\node_
modules\mongoose\lib\model.js:398:16)
            at model.save (C:\Users\Kristian\Desktop\barber-saas\backend\node_mod
ules\mongoose\lib\model.js:609:5)
            at C:\Users\Kristian\Desktop\barber-saas\backend\node_modules\mongoos
e\lib\model.js:2722:9
            at async Promise.all (index 0)
            at Function.create (C:\Users\Kristian\Desktop\barber-saas\backend\nod
e_modules\mongoose\lib\model.js:2707:11)
            at MongoReservaRepository.save (C:\Users\Kristian\Desktop\barber-saas
\backend\src\infrastructure\database\mongodb\repositories\MongoReservaRepository.
js:15:16)
            at TransactionManager.executeInTransaction.operationName (C:\Users\Kr
istian\Desktop\barber-saas\backend\src\application\use-cases\reservas\CreateReser
va.js:72:42)
            at Function.executeInTransaction (C:\Users\Kristian\Desktop\barber-sa
as\backend\src\utils\TransactionManager.js:57:32)
            at CreateReserva.execute (C:\Users\Kristian\Desktop\barber-saas\backe
nd\src\application\use-cases\reservas\CreateReserva.js:26:34)
            at Object.<anonymous>.exports.crearReservaBySlug (C:\Users\Kristian\D
esktop\barber-saas\backend\src\controllers\public.controller.js:140:25) {
          errorLabelSet: Set(0) {},
          errorResponse: {
            index: 0,
            code: 11000,
            errmsg: `E11000 duplicate key error collection: test.reservas index: 
unique_reservation_slot dup key: { barberoId: 
ObjectId('698be98a6a05e103eb4701ae'), fecha: new Date(1773532800000), hora: 
"10:00", barberiaId: ObjectId('698be98a6a05e103eb4701ac') }`,
            keyPattern: [Object],
            keyValue: [Object]
          },
          index: 0,
          code: 11000,
          keyPattern: { barberoId: 1, fecha: 1, hora: 1, barberiaId: 1 },
          keyValue: {
            barberoId: new ObjectId('698be98a6a05e103eb4701ae'),
            fecha: 2026-03-15T00:00:00.000Z,
            hora: '10:00',
            barberiaId: new ObjectId('698be98a6a05e103eb4701ac')
          }
        },
        context: { operationName: 'CreateReservation', attempt: 2 },
        timestamp: 2026-02-11T02:29:30.948Z,
        originalStack: `MongoServerError: E11000 duplicate key error collection: 
test.reservas index: unique_reservation_slot dup key: { barberoId: 
ObjectId('698be98a6a05e103eb4701ae'), fecha: new Date(1773532800000), hora: 
"10:00", barberiaId: ObjectId('698be98a6a05e103eb4701ac') }\n` +
          '    at InsertOneOperation.handleOk (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\node_modules\\mongodb\\src\\operations\\insert.ts:79:13)\n' +
          '    at tryOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\backen
d\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:294:26)\n' +
          '    at processTicksAndRejections 
(node:internal/process/task_queues:105:5)\n' +
          '    at executeOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\ba
ckend\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:123:12)\n' +
          '    at Collection.insertOne (C:\\Users\\Kristian\\Desktop\\barber-saas
\\backend\\node_modules\\mongodb\\src\\collection.ts:294:12)\n' +
          '    at model.$__save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backe
nd\\node_modules\\mongoose\\lib\\model.js:398:16)\n' +
          '    at model.save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\
\node_modules\\mongoose\\lib\\model.js:609:5)\n' +
          '    at C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\\node_module
s\\mongoose\\lib\\model.js:2722:9\n' +
          '    at async Promise.all (index 0)\n' +
          '    at Function.create (C:\\Users\\Kristian\\Desktop\\barber-saas\\bac
kend\\node_modules\\mongoose\\lib\\model.js:2707:11)\n' +
          '    at MongoReservaRepository.save (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\src\\infrastructure\\database\\mongodb\\repositories\\MongoRese
rvaRepository.js:15:16)\n' +
          '    at TransactionManager.executeInTransaction.operationName (C:\\User
s\\Kristian\\Desktop\\barber-saas\\backend\\src\\application\\use-cases\\reservas
\\CreateReserva.js:72:42)\n' +
          '    at Function.executeInTransaction (C:\\Users\\Kristian\\Desktop\\ba
rber-saas\\backend\\src\\utils\\TransactionManager.js:57:32)\n' +
          '    at CreateReserva.execute (C:\\Users\\Kristian\\Desktop\\barber-saa
s\\backend\\src\\application\\use-cases\\reservas\\CreateReserva.js:26:34)\n' +
          '    at Object.<anonymous>.exports.crearReservaBySlug (C:\\Users\\Krist
ian\\Desktop\\barber-saas\\backend\\src\\controllers\\public.controller.js:140:25
)'
      }

    [0m [90m 4 |[39m
     [90m 5 |[39m [36mconst[39m errorHandler [33m=[39m (err[33m,[39m 
req[33m,[39m res[33m,[39m next) [33m=>[39m {
    [31m[1m>[22m[39m[90m 6 |[39m   console[33m.[39merror([32m"ƒö┤ 
ERROR:"[39m[33m,[39m err)[33m;[39m
     [90m   |[39m           [31m[1m^[22m[39m
     [90m 7 |[39m
     [90m 8 |[39m   [90m// ­ƒöÑ A├æADIR HEADERS CORS SI NO EXISTEN[39m
     [90m 9 |[39m   [36mconst[39m origin [33m=[39m 
req[33m.[39mheaders[33m.[39morigin[33m;[39m[0m

      at error (src/config/middleware/errorHandler.js:6:11)
      at Layer.handleError (node_modules/router/lib/layer.js:116:17)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at Layer.handleError (node_modules/router/lib/layer.js:111:12)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at Immediate.next (node_modules/router/index.js:291:5)
      at Immediate._onImmediate (node_modules/router/index.js:688:15)

    console.log
      Ô£à Exitosos: 1

      at Object.log (tests/race-condition-stress.test.js:86:21)

    console.log
      ÔØî Fallidos: 9

      at Object.log (tests/race-condition-stress.test.js:87:21)

    console.log
      ƒôí [POST] 
/api/public/barberias/test-barberia/barberos/698be98b6a05e103eb47021b/reservar

      at log (src/app.js:93:11)

    console.log
      ƒôí [POST] 
/api/public/barberias/test-barberia/barberos/698be98b6a05e103eb47021b/reservar

      at log (src/app.js:93:11)

    console.log
      ƒôí [POST] 
/api/public/barberias/test-barberia/barberos/698be98b6a05e103eb47021b/reservar

      at log (src/app.js:93:11)

    console.log
      ƒôí [POST] 
/api/public/barberias/test-barberia/barberos/698be98b6a05e103eb47021b/reservar

      at log (src/app.js:93:11)

    console.log
      ƒôí [POST] 
/api/public/barberias/test-barberia/barberos/698be98b6a05e103eb47021b/reservar

      at log (src/app.js:93:11)

    console.log
      ƒôí [POST] 
/api/public/barberias/test-barberia/barberos/698be98b6a05e103eb47021b/reservar

      at log (src/app.js:93:11)

    console.log
      ƒôí [POST] 
/api/public/barberias/test-barberia/barberos/698be98b6a05e103eb47021b/reservar

      at log (src/app.js:93:11)

    console.log
      ƒôí [POST] 
/api/public/barberias/test-barberia/barberos/698be98b6a05e103eb47021b/reservar

      at log (src/app.js:93:11)

    console.log
      ƒôí [POST] 
/api/public/barberias/test-barberia/barberos/698be98b6a05e103eb47021b/reservar

      at log (src/app.js:93:11)

    console.log
      ƒôí [POST] 
/api/public/barberias/test-barberia/barberos/698be98b6a05e103eb47021b/reservar

      at log (src/app.js:93:11)

    console.log
      ƒôí [POST] 
/api/public/barberias/test-barberia/barberos/698be98b6a05e103eb47021b/reservar

      at log (src/app.js:93:11)

    console.log
      ƒôí [POST] 
/api/public/barberias/test-barberia/barberos/698be98b6a05e103eb47021b/reservar

      at log (src/app.js:93:11)

    console.log
      ƒôí [POST] 
/api/public/barberias/test-barberia/barberos/698be98b6a05e103eb47021b/reservar

      at log (src/app.js:93:11)

    console.log
      ƒôí [POST] 
/api/public/barberias/test-barberia/barberos/698be98b6a05e103eb47021b/reservar

      at log (src/app.js:93:11)

    console.log
      ƒôí [POST] 
/api/public/barberias/test-barberia/barberos/698be98b6a05e103eb47021b/reservar

      at log (src/app.js:93:11)

    console.log
      ƒôí [POST] 
/api/public/barberias/test-barberia/barberos/698be98b6a05e103eb47021b/reservar

      at log (src/app.js:93:11)

    console.log
      ƒôí [POST] 
/api/public/barberias/test-barberia/barberos/698be98b6a05e103eb47021b/reservar

      at log (src/app.js:93:11)

    console.log
      ƒôí [POST] 
/api/public/barberias/test-barberia/barberos/698be98b6a05e103eb47021b/reservar

      at log (src/app.js:93:11)

    console.log
      ƒôí [POST] 
/api/public/barberias/test-barberia/barberos/698be98b6a05e103eb47021b/reservar

      at log (src/app.js:93:11)

    console.log
      ƒôí [POST] 
/api/public/barberias/test-barberia/barberos/698be98b6a05e103eb47021b/reservar

      at log (src/app.js:93:11)

    console.log
      ƒôí [POST] 
/api/public/barberias/test-barberia/barberos/698be98b6a05e103eb47021b/reservar

      at log (src/app.js:93:11)

    console.warn
      ÔÜá´©Å  [Security] Rate limit exceeded {
        ip: '::ffff:127.0.0.1',
        method: 'POST',
        path: '/test-barberia/barberos/698be98b6a05e103eb47021b/reservar',
        max: 30
      }

    [0m [90m 38 |[39m [90m     */[39m
     [90m 39 |[39m     [36mstatic[39m warn(context[33m,[39m 
message[33m,[39m metadata [33m=[39m {}) {
    [31m[1m>[22m[39m[90m 40 |[39m         
console[33m.[39mwarn([32m`ÔÜá´©Å  [${context}] ${message}`[39m[33m,[39m 
metadata)[33m;[39m
     [90m    |[39m                 [31m[1m^[22m[39m
     [90m 41 |[39m     }
     [90m 42 |[39m
     [90m 43 |[39m     [90m/**[39m[0m

      at Function.warn (src/shared/Logger.js:40:17)
      at Object.warn [as handler] (src/middleware/rateLimit.middleware.js:18:20)
      at node_modules/express-rate-limit/dist/index.cjs:939:16
      at node_modules/express-rate-limit/dist/index.cjs:825:5

    console.log
      ƒôí [POST] 
/api/public/barberias/test-barberia/barberos/698be98b6a05e103eb47021b/reservar

      at log (src/app.js:93:11)

    console.warn
      ÔÜá´©Å  [Security] Rate limit exceeded {
        ip: '::ffff:127.0.0.1',
        method: 'POST',
        path: '/test-barberia/barberos/698be98b6a05e103eb47021b/reservar',
        max: 30
      }

    [0m [90m 38 |[39m [90m     */[39m
     [90m 39 |[39m     [36mstatic[39m warn(context[33m,[39m 
message[33m,[39m metadata [33m=[39m {}) {
    [31m[1m>[22m[39m[90m 40 |[39m         
console[33m.[39mwarn([32m`ÔÜá´©Å  [${context}] ${message}`[39m[33m,[39m 
metadata)[33m;[39m
     [90m    |[39m                 [31m[1m^[22m[39m
     [90m 41 |[39m     }
     [90m 42 |[39m
     [90m 43 |[39m     [90m/**[39m[0m

      at Function.warn (src/shared/Logger.js:40:17)
      at Object.warn [as handler] (src/middleware/rateLimit.middleware.js:18:20)
      at node_modules/express-rate-limit/dist/index.cjs:939:16
      at node_modules/express-rate-limit/dist/index.cjs:825:5

    console.log
      ƒôí [POST] 
/api/public/barberias/test-barberia/barberos/698be98b6a05e103eb47021b/reservar

      at log (src/app.js:93:11)

    console.warn
      ÔÜá´©Å  [Security] Rate limit exceeded {
        ip: '::ffff:127.0.0.1',
        method: 'POST',
        path: '/test-barberia/barberos/698be98b6a05e103eb47021b/reservar',
        max: 30
      }

    [0m [90m 38 |[39m [90m     */[39m
     [90m 39 |[39m     [36mstatic[39m warn(context[33m,[39m 
message[33m,[39m metadata [33m=[39m {}) {
    [31m[1m>[22m[39m[90m 40 |[39m         
console[33m.[39mwarn([32m`ÔÜá´©Å  [${context}] ${message}`[39m[33m,[39m 
metadata)[33m;[39m
     [90m    |[39m                 [31m[1m^[22m[39m
     [90m 41 |[39m     }
     [90m 42 |[39m
     [90m 43 |[39m     [90m/**[39m[0m

      at Function.warn (src/shared/Logger.js:40:17)
      at Object.warn [as handler] (src/middleware/rateLimit.middleware.js:18:20)
      at node_modules/express-rate-limit/dist/index.cjs:939:16
      at node_modules/express-rate-limit/dist/index.cjs:825:5

    console.log
      ƒôí [POST] 
/api/public/barberias/test-barberia/barberos/698be98b6a05e103eb47021b/reservar

      at log (src/app.js:93:11)

    console.warn
      ÔÜá´©Å  [Security] Rate limit exceeded {
        ip: '::ffff:127.0.0.1',
        method: 'POST',
        path: '/test-barberia/barberos/698be98b6a05e103eb47021b/reservar',
        max: 30
      }

    [0m [90m 38 |[39m [90m     */[39m
     [90m 39 |[39m     [36mstatic[39m warn(context[33m,[39m 
message[33m,[39m metadata [33m=[39m {}) {
    [31m[1m>[22m[39m[90m 40 |[39m         
console[33m.[39mwarn([32m`ÔÜá´©Å  [${context}] ${message}`[39m[33m,[39m 
metadata)[33m;[39m
     [90m    |[39m                 [31m[1m^[22m[39m
     [90m 41 |[39m     }
     [90m 42 |[39m
     [90m 43 |[39m     [90m/**[39m[0m

      at Function.warn (src/shared/Logger.js:40:17)
      at Object.warn [as handler] (src/middleware/rateLimit.middleware.js:18:20)
      at node_modules/express-rate-limit/dist/index.cjs:939:16
      at node_modules/express-rate-limit/dist/index.cjs:825:5

    console.log
      ƒôí [POST] 
/api/public/barberias/test-barberia/barberos/698be98b6a05e103eb47021b/reservar

      at log (src/app.js:93:11)

    console.warn
      ÔÜá´©Å  [Security] Rate limit exceeded {
        ip: '::ffff:127.0.0.1',
        method: 'POST',
        path: '/test-barberia/barberos/698be98b6a05e103eb47021b/reservar',
        max: 30
      }

    [0m [90m 38 |[39m [90m     */[39m
     [90m 39 |[39m     [36mstatic[39m warn(context[33m,[39m 
message[33m,[39m metadata [33m=[39m {}) {
    [31m[1m>[22m[39m[90m 40 |[39m         
console[33m.[39mwarn([32m`ÔÜá´©Å  [${context}] ${message}`[39m[33m,[39m 
metadata)[33m;[39m
     [90m    |[39m                 [31m[1m^[22m[39m
     [90m 41 |[39m     }
     [90m 42 |[39m
     [90m 43 |[39m     [90m/**[39m[0m

      at Function.warn (src/shared/Logger.js:40:17)
      at Object.warn [as handler] (src/middleware/rateLimit.middleware.js:18:20)
      at node_modules/express-rate-limit/dist/index.cjs:939:16
      at node_modules/express-rate-limit/dist/index.cjs:825:5

    console.log
      ƒôí [POST] 
/api/public/barberias/test-barberia/barberos/698be98b6a05e103eb47021b/reservar

      at log (src/app.js:93:11)

    console.warn
      ÔÜá´©Å  [Security] Rate limit exceeded {
        ip: '::ffff:127.0.0.1',
        method: 'POST',
        path: '/test-barberia/barberos/698be98b6a05e103eb47021b/reservar',
        max: 30
      }

    [0m [90m 38 |[39m [90m     */[39m
     [90m 39 |[39m     [36mstatic[39m warn(context[33m,[39m 
message[33m,[39m metadata [33m=[39m {}) {
    [31m[1m>[22m[39m[90m 40 |[39m         
console[33m.[39mwarn([32m`ÔÜá´©Å  [${context}] ${message}`[39m[33m,[39m 
metadata)[33m;[39m
     [90m    |[39m                 [31m[1m^[22m[39m
     [90m 41 |[39m     }
     [90m 42 |[39m
     [90m 43 |[39m     [90m/**[39m[0m

      at Function.warn (src/shared/Logger.js:40:17)
      at Object.warn [as handler] (src/middleware/rateLimit.middleware.js:18:20)
      at node_modules/express-rate-limit/dist/index.cjs:939:16
      at node_modules/express-rate-limit/dist/index.cjs:825:5

    console.log
      ƒôí [POST] 
/api/public/barberias/test-barberia/barberos/698be98b6a05e103eb47021b/reservar

      at log (src/app.js:93:11)

    console.warn
      ÔÜá´©Å  [Security] Rate limit exceeded {
        ip: '::ffff:127.0.0.1',
        method: 'POST',
        path: '/test-barberia/barberos/698be98b6a05e103eb47021b/reservar',
        max: 30
      }

    [0m [90m 38 |[39m [90m     */[39m
     [90m 39 |[39m     [36mstatic[39m warn(context[33m,[39m 
message[33m,[39m metadata [33m=[39m {}) {
    [31m[1m>[22m[39m[90m 40 |[39m         
console[33m.[39mwarn([32m`ÔÜá´©Å  [${context}] ${message}`[39m[33m,[39m 
metadata)[33m;[39m
     [90m    |[39m                 [31m[1m^[22m[39m
     [90m 41 |[39m     }
     [90m 42 |[39m
     [90m 43 |[39m     [90m/**[39m[0m

      at Function.warn (src/shared/Logger.js:40:17)
      at Object.warn [as handler] (src/middleware/rateLimit.middleware.js:18:20)
      at node_modules/express-rate-limit/dist/index.cjs:939:16
      at node_modules/express-rate-limit/dist/index.cjs:825:5

    console.log
      ƒôí [POST] 
/api/public/barberias/test-barberia/barberos/698be98b6a05e103eb47021b/reservar

      at log (src/app.js:93:11)

    console.warn
      ÔÜá´©Å  [Security] Rate limit exceeded {
        ip: '::ffff:127.0.0.1',
        method: 'POST',
        path: '/test-barberia/barberos/698be98b6a05e103eb47021b/reservar',
        max: 30
      }

    [0m [90m 38 |[39m [90m     */[39m
     [90m 39 |[39m     [36mstatic[39m warn(context[33m,[39m 
message[33m,[39m metadata [33m=[39m {}) {
    [31m[1m>[22m[39m[90m 40 |[39m         
console[33m.[39mwarn([32m`ÔÜá´©Å  [${context}] ${message}`[39m[33m,[39m 
metadata)[33m;[39m
     [90m    |[39m                 [31m[1m^[22m[39m
     [90m 41 |[39m     }
     [90m 42 |[39m
     [90m 43 |[39m     [90m/**[39m[0m

      at Function.warn (src/shared/Logger.js:40:17)
      at Object.warn [as handler] (src/middleware/rateLimit.middleware.js:18:20)
      at node_modules/express-rate-limit/dist/index.cjs:939:16
      at node_modules/express-rate-limit/dist/index.cjs:825:5

    console.log
      ƒôí [POST] 
/api/public/barberias/test-barberia/barberos/698be98b6a05e103eb47021b/reservar

      at log (src/app.js:93:11)

    console.warn
      ÔÜá´©Å  [Security] Rate limit exceeded {
        ip: '::ffff:127.0.0.1',
        method: 'POST',
        path: '/test-barberia/barberos/698be98b6a05e103eb47021b/reservar',
        max: 30
      }

    [0m [90m 38 |[39m [90m     */[39m
     [90m 39 |[39m     [36mstatic[39m warn(context[33m,[39m 
message[33m,[39m metadata [33m=[39m {}) {
    [31m[1m>[22m[39m[90m 40 |[39m         
console[33m.[39mwarn([32m`ÔÜá´©Å  [${context}] ${message}`[39m[33m,[39m 
metadata)[33m;[39m
     [90m    |[39m                 [31m[1m^[22m[39m
     [90m 41 |[39m     }
     [90m 42 |[39m
     [90m 43 |[39m     [90m/**[39m[0m

      at Function.warn (src/shared/Logger.js:40:17)
      at Object.warn [as handler] (src/middleware/rateLimit.middleware.js:18:20)
      at node_modules/express-rate-limit/dist/index.cjs:939:16
      at node_modules/express-rate-limit/dist/index.cjs:825:5

    console.log
      ƒôí [POST] 
/api/public/barberias/test-barberia/barberos/698be98b6a05e103eb47021b/reservar

      at log (src/app.js:93:11)

    console.warn
      ÔÜá´©Å  [Security] Rate limit exceeded {
        ip: '::ffff:127.0.0.1',
        method: 'POST',
        path: '/test-barberia/barberos/698be98b6a05e103eb47021b/reservar',
        max: 30
      }

    [0m [90m 38 |[39m [90m     */[39m
     [90m 39 |[39m     [36mstatic[39m warn(context[33m,[39m 
message[33m,[39m metadata [33m=[39m {}) {
    [31m[1m>[22m[39m[90m 40 |[39m         
console[33m.[39mwarn([32m`ÔÜá´©Å  [${context}] ${message}`[39m[33m,[39m 
metadata)[33m;[39m
     [90m    |[39m                 [31m[1m^[22m[39m
     [90m 41 |[39m     }
     [90m 42 |[39m
     [90m 43 |[39m     [90m/**[39m[0m

      at Function.warn (src/shared/Logger.js:40:17)
      at Object.warn [as handler] (src/middleware/rateLimit.middleware.js:18:20)
      at node_modules/express-rate-limit/dist/index.cjs:939:16
      at node_modules/express-rate-limit/dist/index.cjs:825:5

    console.log
      ƒôí [POST] 
/api/public/barberias/test-barberia/barberos/698be98b6a05e103eb47021b/reservar

      at log (src/app.js:93:11)

    console.warn
      ÔÜá´©Å  [Security] Rate limit exceeded {
        ip: '::ffff:127.0.0.1',
        method: 'POST',
        path: '/test-barberia/barberos/698be98b6a05e103eb47021b/reservar',
        max: 30
      }

    [0m [90m 38 |[39m [90m     */[39m
     [90m 39 |[39m     [36mstatic[39m warn(context[33m,[39m 
message[33m,[39m metadata [33m=[39m {}) {
    [31m[1m>[22m[39m[90m 40 |[39m         
console[33m.[39mwarn([32m`ÔÜá´©Å  [${context}] ${message}`[39m[33m,[39m 
metadata)[33m;[39m
     [90m    |[39m                 [31m[1m^[22m[39m
     [90m 41 |[39m     }
     [90m 42 |[39m
     [90m 43 |[39m     [90m/**[39m[0m

      at Function.warn (src/shared/Logger.js:40:17)
      at Object.warn [as handler] (src/middleware/rateLimit.middleware.js:18:20)
      at node_modules/express-rate-limit/dist/index.cjs:939:16
      at node_modules/express-rate-limit/dist/index.cjs:825:5

    console.log
      ƒôí [POST] 
/api/public/barberias/test-barberia/barberos/698be98b6a05e103eb47021b/reservar

      at log (src/app.js:93:11)

    console.warn
      ÔÜá´©Å  [Security] Rate limit exceeded {
        ip: '::ffff:127.0.0.1',
        method: 'POST',
        path: '/test-barberia/barberos/698be98b6a05e103eb47021b/reservar',
        max: 30
      }

    [0m [90m 38 |[39m [90m     */[39m
     [90m 39 |[39m     [36mstatic[39m warn(context[33m,[39m 
message[33m,[39m metadata [33m=[39m {}) {
    [31m[1m>[22m[39m[90m 40 |[39m         
console[33m.[39mwarn([32m`ÔÜá´©Å  [${context}] ${message}`[39m[33m,[39m 
metadata)[33m;[39m
     [90m    |[39m                 [31m[1m^[22m[39m
     [90m 41 |[39m     }
     [90m 42 |[39m
     [90m 43 |[39m     [90m/**[39m[0m

      at Function.warn (src/shared/Logger.js:40:17)
      at Object.warn [as handler] (src/middleware/rateLimit.middleware.js:18:20)
      at node_modules/express-rate-limit/dist/index.cjs:939:16
      at node_modules/express-rate-limit/dist/index.cjs:825:5

    console.log
      ƒôí [POST] 
/api/public/barberias/test-barberia/barberos/698be98b6a05e103eb47021b/reservar

      at log (src/app.js:93:11)

    console.warn
      ÔÜá´©Å  [Security] Rate limit exceeded {
        ip: '::ffff:127.0.0.1',
        method: 'POST',
        path: '/test-barberia/barberos/698be98b6a05e103eb47021b/reservar',
        max: 30
      }

    [0m [90m 38 |[39m [90m     */[39m
     [90m 39 |[39m     [36mstatic[39m warn(context[33m,[39m 
message[33m,[39m metadata [33m=[39m {}) {
    [31m[1m>[22m[39m[90m 40 |[39m         
console[33m.[39mwarn([32m`ÔÜá´©Å  [${context}] ${message}`[39m[33m,[39m 
metadata)[33m;[39m
     [90m    |[39m                 [31m[1m^[22m[39m
     [90m 41 |[39m     }
     [90m 42 |[39m
     [90m 43 |[39m     [90m/**[39m[0m

      at Function.warn (src/shared/Logger.js:40:17)
      at Object.warn [as handler] (src/middleware/rateLimit.middleware.js:18:20)
      at node_modules/express-rate-limit/dist/index.cjs:939:16
      at node_modules/express-rate-limit/dist/index.cjs:825:5

    console.log
      ƒôí [POST] 
/api/public/barberias/test-barberia/barberos/698be98b6a05e103eb47021b/reservar

      at log (src/app.js:93:11)

    console.warn
      ÔÜá´©Å  [Security] Rate limit exceeded {
        ip: '::ffff:127.0.0.1',
        method: 'POST',
        path: '/test-barberia/barberos/698be98b6a05e103eb47021b/reservar',
        max: 30
      }

    [0m [90m 38 |[39m [90m     */[39m
     [90m 39 |[39m     [36mstatic[39m warn(context[33m,[39m 
message[33m,[39m metadata [33m=[39m {}) {
    [31m[1m>[22m[39m[90m 40 |[39m         
console[33m.[39mwarn([32m`ÔÜá´©Å  [${context}] ${message}`[39m[33m,[39m 
metadata)[33m;[39m
     [90m    |[39m                 [31m[1m^[22m[39m
     [90m 41 |[39m     }
     [90m 42 |[39m
     [90m 43 |[39m     [90m/**[39m[0m

      at Function.warn (src/shared/Logger.js:40:17)
      at Object.warn [as handler] (src/middleware/rateLimit.middleware.js:18:20)
      at node_modules/express-rate-limit/dist/index.cjs:939:16
      at node_modules/express-rate-limit/dist/index.cjs:825:5

    console.log
      ƒôí [POST] 
/api/public/barberias/test-barberia/barberos/698be98b6a05e103eb47021b/reservar

      at log (src/app.js:93:11)

    console.warn
      ÔÜá´©Å  [Security] Rate limit exceeded {
        ip: '::ffff:127.0.0.1',
        method: 'POST',
        path: '/test-barberia/barberos/698be98b6a05e103eb47021b/reservar',
        max: 30
      }

    [0m [90m 38 |[39m [90m     */[39m
     [90m 39 |[39m     [36mstatic[39m warn(context[33m,[39m 
message[33m,[39m metadata [33m=[39m {}) {
    [31m[1m>[22m[39m[90m 40 |[39m         
console[33m.[39mwarn([32m`ÔÜá´©Å  [${context}] ${message}`[39m[33m,[39m 
metadata)[33m;[39m
     [90m    |[39m                 [31m[1m^[22m[39m
     [90m 41 |[39m     }
     [90m 42 |[39m
     [90m 43 |[39m     [90m/**[39m[0m

      at Function.warn (src/shared/Logger.js:40:17)
      at Object.warn [as handler] (src/middleware/rateLimit.middleware.js:18:20)
      at node_modules/express-rate-limit/dist/index.cjs:939:16
      at node_modules/express-rate-limit/dist/index.cjs:825:5

    console.log
      ƒôí [POST] 
/api/public/barberias/test-barberia/barberos/698be98b6a05e103eb47021b/reservar

      at log (src/app.js:93:11)

    console.warn
      ÔÜá´©Å  [Security] Rate limit exceeded {
        ip: '::ffff:127.0.0.1',
        method: 'POST',
        path: '/test-barberia/barberos/698be98b6a05e103eb47021b/reservar',
        max: 30
      }

    [0m [90m 38 |[39m [90m     */[39m
     [90m 39 |[39m     [36mstatic[39m warn(context[33m,[39m 
message[33m,[39m metadata [33m=[39m {}) {
    [31m[1m>[22m[39m[90m 40 |[39m         
console[33m.[39mwarn([32m`ÔÜá´©Å  [${context}] ${message}`[39m[33m,[39m 
metadata)[33m;[39m
     [90m    |[39m                 [31m[1m^[22m[39m
     [90m 41 |[39m     }
     [90m 42 |[39m
     [90m 43 |[39m     [90m/**[39m[0m

      at Function.warn (src/shared/Logger.js:40:17)
      at Object.warn [as handler] (src/middleware/rateLimit.middleware.js:18:20)
      at node_modules/express-rate-limit/dist/index.cjs:939:16
      at node_modules/express-rate-limit/dist/index.cjs:825:5

    console.log
      ƒôí [POST] 
/api/public/barberias/test-barberia/barberos/698be98b6a05e103eb47021b/reservar

      at log (src/app.js:93:11)

    console.warn
      ÔÜá´©Å  [Security] Rate limit exceeded {
        ip: '::ffff:127.0.0.1',
        method: 'POST',
        path: '/test-barberia/barberos/698be98b6a05e103eb47021b/reservar',
        max: 30
      }

    [0m [90m 38 |[39m [90m     */[39m
     [90m 39 |[39m     [36mstatic[39m warn(context[33m,[39m 
message[33m,[39m metadata [33m=[39m {}) {
    [31m[1m>[22m[39m[90m 40 |[39m         
console[33m.[39mwarn([32m`ÔÜá´©Å  [${context}] ${message}`[39m[33m,[39m 
metadata)[33m;[39m
     [90m    |[39m                 [31m[1m^[22m[39m
     [90m 41 |[39m     }
     [90m 42 |[39m
     [90m 43 |[39m     [90m/**[39m[0m

      at Function.warn (src/shared/Logger.js:40:17)
      at Object.warn [as handler] (src/middleware/rateLimit.middleware.js:18:20)
      at node_modules/express-rate-limit/dist/index.cjs:939:16
      at node_modules/express-rate-limit/dist/index.cjs:825:5

    console.log
      ƒôí [POST] 
/api/public/barberias/test-barberia/barberos/698be98b6a05e103eb47021b/reservar

      at log (src/app.js:93:11)

    console.warn
      ÔÜá´©Å  [Security] Rate limit exceeded {
        ip: '::ffff:127.0.0.1',
        method: 'POST',
        path: '/test-barberia/barberos/698be98b6a05e103eb47021b/reservar',
        max: 30
      }

    [0m [90m 38 |[39m [90m     */[39m
     [90m 39 |[39m     [36mstatic[39m warn(context[33m,[39m 
message[33m,[39m metadata [33m=[39m {}) {
    [31m[1m>[22m[39m[90m 40 |[39m         
console[33m.[39mwarn([32m`ÔÜá´©Å  [${context}] ${message}`[39m[33m,[39m 
metadata)[33m;[39m
     [90m    |[39m                 [31m[1m^[22m[39m
     [90m 41 |[39m     }
     [90m 42 |[39m
     [90m 43 |[39m     [90m/**[39m[0m

      at Function.warn (src/shared/Logger.js:40:17)
      at Object.warn [as handler] (src/middleware/rateLimit.middleware.js:18:20)
      at node_modules/express-rate-limit/dist/index.cjs:939:16
      at node_modules/express-rate-limit/dist/index.cjs:825:5

    console.log
      ƒôí [POST] 
/api/public/barberias/test-barberia/barberos/698be98b6a05e103eb47021b/reservar

      at log (src/app.js:93:11)

    console.warn
      ÔÜá´©Å  [Security] Rate limit exceeded {
        ip: '::ffff:127.0.0.1',
        method: 'POST',
        path: '/test-barberia/barberos/698be98b6a05e103eb47021b/reservar',
        max: 30
      }

    [0m [90m 38 |[39m [90m     */[39m
     [90m 39 |[39m     [36mstatic[39m warn(context[33m,[39m 
message[33m,[39m metadata [33m=[39m {}) {
    [31m[1m>[22m[39m[90m 40 |[39m         
console[33m.[39mwarn([32m`ÔÜá´©Å  [${context}] ${message}`[39m[33m,[39m 
metadata)[33m;[39m
     [90m    |[39m                 [31m[1m^[22m[39m
     [90m 41 |[39m     }
     [90m 42 |[39m
     [90m 43 |[39m     [90m/**[39m[0m

      at Function.warn (src/shared/Logger.js:40:17)
      at Object.warn [as handler] (src/middleware/rateLimit.middleware.js:18:20)
      at node_modules/express-rate-limit/dist/index.cjs:939:16
      at node_modules/express-rate-limit/dist/index.cjs:825:5

    console.log
      ƒôí [POST] 
/api/public/barberias/test-barberia/barberos/698be98b6a05e103eb47021b/reservar

      at log (src/app.js:93:11)

    console.warn
      ÔÜá´©Å  [Security] Rate limit exceeded {
        ip: '::ffff:127.0.0.1',
        method: 'POST',
        path: '/test-barberia/barberos/698be98b6a05e103eb47021b/reservar',
        max: 30
      }

    [0m [90m 38 |[39m [90m     */[39m
     [90m 39 |[39m     [36mstatic[39m warn(context[33m,[39m 
message[33m,[39m metadata [33m=[39m {}) {
    [31m[1m>[22m[39m[90m 40 |[39m         
console[33m.[39mwarn([32m`ÔÜá´©Å  [${context}] ${message}`[39m[33m,[39m 
metadata)[33m;[39m
     [90m    |[39m                 [31m[1m^[22m[39m
     [90m 41 |[39m     }
     [90m 42 |[39m
     [90m 43 |[39m     [90m/**[39m[0m

      at Function.warn (src/shared/Logger.js:40:17)
      at Object.warn [as handler] (src/middleware/rateLimit.middleware.js:18:20)
      at node_modules/express-rate-limit/dist/index.cjs:939:16
      at node_modules/express-rate-limit/dist/index.cjs:825:5

    console.log
      ƒôí [POST] 
/api/public/barberias/test-barberia/barberos/698be98b6a05e103eb47021b/reservar

      at log (src/app.js:93:11)

    console.warn
      ÔÜá´©Å  [Security] Rate limit exceeded {
        ip: '::ffff:127.0.0.1',
        method: 'POST',
        path: '/test-barberia/barberos/698be98b6a05e103eb47021b/reservar',
        max: 30
      }

    [0m [90m 38 |[39m [90m     */[39m
     [90m 39 |[39m     [36mstatic[39m warn(context[33m,[39m 
message[33m,[39m metadata [33m=[39m {}) {
    [31m[1m>[22m[39m[90m 40 |[39m         
console[33m.[39mwarn([32m`ÔÜá´©Å  [${context}] ${message}`[39m[33m,[39m 
metadata)[33m;[39m
     [90m    |[39m                 [31m[1m^[22m[39m
     [90m 41 |[39m     }
     [90m 42 |[39m
     [90m 43 |[39m     [90m/**[39m[0m

      at Function.warn (src/shared/Logger.js:40:17)
      at Object.warn [as handler] (src/middleware/rateLimit.middleware.js:18:20)
      at node_modules/express-rate-limit/dist/index.cjs:939:16
      at node_modules/express-rate-limit/dist/index.cjs:825:5

    console.log
      ƒôí [POST] 
/api/public/barberias/test-barberia/barberos/698be98b6a05e103eb47021b/reservar

      at log (src/app.js:93:11)

    console.warn
      ÔÜá´©Å  [Security] Rate limit exceeded {
        ip: '::ffff:127.0.0.1',
        method: 'POST',
        path: '/test-barberia/barberos/698be98b6a05e103eb47021b/reservar',
        max: 30
      }

    [0m [90m 38 |[39m [90m     */[39m
     [90m 39 |[39m     [36mstatic[39m warn(context[33m,[39m 
message[33m,[39m metadata [33m=[39m {}) {
    [31m[1m>[22m[39m[90m 40 |[39m         
console[33m.[39mwarn([32m`ÔÜá´©Å  [${context}] ${message}`[39m[33m,[39m 
metadata)[33m;[39m
     [90m    |[39m                 [31m[1m^[22m[39m
     [90m 41 |[39m     }
     [90m 42 |[39m
     [90m 43 |[39m     [90m/**[39m[0m

      at Function.warn (src/shared/Logger.js:40:17)
      at Object.warn [as handler] (src/middleware/rateLimit.middleware.js:18:20)
      at node_modules/express-rate-limit/dist/index.cjs:939:16
      at node_modules/express-rate-limit/dist/index.cjs:825:5

    console.log
      ƒôí [POST] 
/api/public/barberias/test-barberia/barberos/698be98b6a05e103eb47021b/reservar

      at log (src/app.js:93:11)

    console.warn
      ÔÜá´©Å  [Security] Rate limit exceeded {
        ip: '::ffff:127.0.0.1',
        method: 'POST',
        path: '/test-barberia/barberos/698be98b6a05e103eb47021b/reservar',
        max: 30
      }

    [0m [90m 38 |[39m [90m     */[39m
     [90m 39 |[39m     [36mstatic[39m warn(context[33m,[39m 
message[33m,[39m metadata [33m=[39m {}) {
    [31m[1m>[22m[39m[90m 40 |[39m         
console[33m.[39mwarn([32m`ÔÜá´©Å  [${context}] ${message}`[39m[33m,[39m 
metadata)[33m;[39m
     [90m    |[39m                 [31m[1m^[22m[39m
     [90m 41 |[39m     }
     [90m 42 |[39m
     [90m 43 |[39m     [90m/**[39m[0m

      at Function.warn (src/shared/Logger.js:40:17)
      at Object.warn [as handler] (src/middleware/rateLimit.middleware.js:18:20)
      at node_modules/express-rate-limit/dist/index.cjs:939:16
      at node_modules/express-rate-limit/dist/index.cjs:825:5

    console.log
      ƒôí [POST] 
/api/public/barberias/test-barberia/barberos/698be98b6a05e103eb47021b/reservar

      at log (src/app.js:93:11)

    console.warn
      ÔÜá´©Å  [Security] Rate limit exceeded {
        ip: '::ffff:127.0.0.1',
        method: 'POST',
        path: '/test-barberia/barberos/698be98b6a05e103eb47021b/reservar',
        max: 30
      }

    [0m [90m 38 |[39m [90m     */[39m
     [90m 39 |[39m     [36mstatic[39m warn(context[33m,[39m 
message[33m,[39m metadata [33m=[39m {}) {
    [31m[1m>[22m[39m[90m 40 |[39m         
console[33m.[39mwarn([32m`ÔÜá´©Å  [${context}] ${message}`[39m[33m,[39m 
metadata)[33m;[39m
     [90m    |[39m                 [31m[1m^[22m[39m
     [90m 41 |[39m     }
     [90m 42 |[39m
     [90m 43 |[39m     [90m/**[39m[0m

      at Function.warn (src/shared/Logger.js:40:17)
      at Object.warn [as handler] (src/middleware/rateLimit.middleware.js:18:20)
      at node_modules/express-rate-limit/dist/index.cjs:939:16
      at node_modules/express-rate-limit/dist/index.cjs:825:5

    console.log
      ƒôí [POST] 
/api/public/barberias/test-barberia/barberos/698be98b6a05e103eb47021b/reservar

      at log (src/app.js:93:11)

    console.warn
      ÔÜá´©Å  [Security] Rate limit exceeded {
        ip: '::ffff:127.0.0.1',
        method: 'POST',
        path: '/test-barberia/barberos/698be98b6a05e103eb47021b/reservar',
        max: 30
      }

    [0m [90m 38 |[39m [90m     */[39m
     [90m 39 |[39m     [36mstatic[39m warn(context[33m,[39m 
message[33m,[39m metadata [33m=[39m {}) {
    [31m[1m>[22m[39m[90m 40 |[39m         
console[33m.[39mwarn([32m`ÔÜá´©Å  [${context}] ${message}`[39m[33m,[39m 
metadata)[33m;[39m
     [90m    |[39m                 [31m[1m^[22m[39m
     [90m 41 |[39m     }
     [90m 42 |[39m
     [90m 43 |[39m     [90m/**[39m[0m

      at Function.warn (src/shared/Logger.js:40:17)
      at Object.warn [as handler] (src/middleware/rateLimit.middleware.js:18:20)
      at node_modules/express-rate-limit/dist/index.cjs:939:16
      at node_modules/express-rate-limit/dist/index.cjs:825:5

    console.log
      ƒôí [POST] 
/api/public/barberias/test-barberia/barberos/698be98b6a05e103eb47021b/reservar

      at log (src/app.js:93:11)

    console.warn
      ÔÜá´©Å  [Security] Rate limit exceeded {
        ip: '::ffff:127.0.0.1',
        method: 'POST',
        path: '/test-barberia/barberos/698be98b6a05e103eb47021b/reservar',
        max: 30
      }

    [0m [90m 38 |[39m [90m     */[39m
     [90m 39 |[39m     [36mstatic[39m warn(context[33m,[39m 
message[33m,[39m metadata [33m=[39m {}) {
    [31m[1m>[22m[39m[90m 40 |[39m         
console[33m.[39mwarn([32m`ÔÜá´©Å  [${context}] ${message}`[39m[33m,[39m 
metadata)[33m;[39m
     [90m    |[39m                 [31m[1m^[22m[39m
     [90m 41 |[39m     }
     [90m 42 |[39m
     [90m 43 |[39m     [90m/**[39m[0m

      at Function.warn (src/shared/Logger.js:40:17)
      at Object.warn [as handler] (src/middleware/rateLimit.middleware.js:18:20)
      at node_modules/express-rate-limit/dist/index.cjs:939:16
      at node_modules/express-rate-limit/dist/index.cjs:825:5

    console.log
      ƒôí [POST] 
/api/public/barberias/test-barberia/barberos/698be98b6a05e103eb47021b/reservar

      at log (src/app.js:93:11)

    console.warn
      ÔÜá´©Å  [Security] Rate limit exceeded {
        ip: '::ffff:127.0.0.1',
        method: 'POST',
        path: '/test-barberia/barberos/698be98b6a05e103eb47021b/reservar',
        max: 30
      }

    [0m [90m 38 |[39m [90m     */[39m
     [90m 39 |[39m     [36mstatic[39m warn(context[33m,[39m 
message[33m,[39m metadata [33m=[39m {}) {
    [31m[1m>[22m[39m[90m 40 |[39m         
console[33m.[39mwarn([32m`ÔÜá´©Å  [${context}] ${message}`[39m[33m,[39m 
metadata)[33m;[39m
     [90m    |[39m                 [31m[1m^[22m[39m
     [90m 41 |[39m     }
     [90m 42 |[39m
     [90m 43 |[39m     [90m/**[39m[0m

      at Function.warn (src/shared/Logger.js:40:17)
      at Object.warn [as handler] (src/middleware/rateLimit.middleware.js:18:20)
      at node_modules/express-rate-limit/dist/index.cjs:939:16
      at node_modules/express-rate-limit/dist/index.cjs:825:5

    console.log
      ƒôí [POST] 
/api/public/barberias/test-barberia/barberos/698be98b6a05e103eb47021b/reservar

      at log (src/app.js:93:11)

    console.warn
      ÔÜá´©Å  [Security] Rate limit exceeded {
        ip: '::ffff:127.0.0.1',
        method: 'POST',
        path: '/test-barberia/barberos/698be98b6a05e103eb47021b/reservar',
        max: 30
      }

    [0m [90m 38 |[39m [90m     */[39m
     [90m 39 |[39m     [36mstatic[39m warn(context[33m,[39m 
message[33m,[39m metadata [33m=[39m {}) {
    [31m[1m>[22m[39m[90m 40 |[39m         
console[33m.[39mwarn([32m`ÔÜá´©Å  [${context}] ${message}`[39m[33m,[39m 
metadata)[33m;[39m
     [90m    |[39m                 [31m[1m^[22m[39m
     [90m 41 |[39m     }
     [90m 42 |[39m
     [90m 43 |[39m     [90m/**[39m[0m

      at Function.warn (src/shared/Logger.js:40:17)
      at Object.warn [as handler] (src/middleware/rateLimit.middleware.js:18:20)
      at node_modules/express-rate-limit/dist/index.cjs:939:16
      at node_modules/express-rate-limit/dist/index.cjs:825:5

    console.log
      ƒôí [POST] 
/api/public/barberias/test-barberia/barberos/698be98b6a05e103eb47021b/reservar

      at log (src/app.js:93:11)

    console.warn
      ÔÜá´©Å  [Security] Rate limit exceeded {
        ip: '::ffff:127.0.0.1',
        method: 'POST',
        path: '/test-barberia/barberos/698be98b6a05e103eb47021b/reservar',
        max: 30
      }

    [0m [90m 38 |[39m [90m     */[39m
     [90m 39 |[39m     [36mstatic[39m warn(context[33m,[39m 
message[33m,[39m metadata [33m=[39m {}) {
    [31m[1m>[22m[39m[90m 40 |[39m         
console[33m.[39mwarn([32m`ÔÜá´©Å  [${context}] ${message}`[39m[33m,[39m 
metadata)[33m;[39m
     [90m    |[39m                 [31m[1m^[22m[39m
     [90m 41 |[39m     }
     [90m 42 |[39m
     [90m 43 |[39m     [90m/**[39m[0m

      at Function.warn (src/shared/Logger.js:40:17)
      at Object.warn [as handler] (src/middleware/rateLimit.middleware.js:18:20)
      at node_modules/express-rate-limit/dist/index.cjs:939:16
      at node_modules/express-rate-limit/dist/index.cjs:825:5

    console.log
      ƒôí [POST] 
/api/public/barberias/test-barberia/barberos/698be98b6a05e103eb47021b/reservar

      at log (src/app.js:93:11)

    console.warn
      ÔÜá´©Å  [Security] Rate limit exceeded {
        ip: '::ffff:127.0.0.1',
        method: 'POST',
        path: '/test-barberia/barberos/698be98b6a05e103eb47021b/reservar',
        max: 30
      }

    [0m [90m 38 |[39m [90m     */[39m
     [90m 39 |[39m     [36mstatic[39m warn(context[33m,[39m 
message[33m,[39m metadata [33m=[39m {}) {
    [31m[1m>[22m[39m[90m 40 |[39m         
console[33m.[39mwarn([32m`ÔÜá´©Å  [${context}] ${message}`[39m[33m,[39m 
metadata)[33m;[39m
     [90m    |[39m                 [31m[1m^[22m[39m
     [90m 41 |[39m     }
     [90m 42 |[39m
     [90m 43 |[39m     [90m/**[39m[0m

      at Function.warn (src/shared/Logger.js:40:17)
      at Object.warn [as handler] (src/middleware/rateLimit.middleware.js:18:20)
      at node_modules/express-rate-limit/dist/index.cjs:939:16
      at node_modules/express-rate-limit/dist/index.cjs:825:5

    console.log
      [Transaction] Started: CreateReservation (attempt 1/3)

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:54:25)

    console.log
      [Transaction] Started: CreateReservation (attempt 1/3)

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:54:25)

    console.log
      [Transaction] Started: CreateReservation (attempt 1/3)

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:54:25)

    console.log
      [Transaction] Started: CreateReservation (attempt 1/3)

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:54:25)

    console.log
      [Transaction] Started: CreateReservation (attempt 1/3)

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:54:25)

    console.log
      [Transaction] Started: CreateReservation (attempt 1/3)

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:54:25)

    console.log
      [Transaction] Started: CreateReservation (attempt 1/3)

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:54:25)

    console.log
      [Transaction] Started: CreateReservation (attempt 1/3)

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:54:25)

    console.log
      [Transaction] Started: CreateReservation (attempt 1/3)

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:54:25)

    console.log
      [Transaction] Started: CreateReservation (attempt 1/3)

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:54:25)

    console.log
      [Transaction] Started: CreateReservation (attempt 1/3)

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:54:25)

    console.log
      [Transaction] Started: CreateReservation (attempt 1/3)

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:54:25)

    console.log
      [Transaction] Started: CreateReservation (attempt 1/3)

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:54:25)

    console.log
      [Transaction] Started: CreateReservation (attempt 1/3)

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:54:25)

    console.log
      [Transaction] Started: CreateReservation (attempt 1/3)

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:54:25)

    console.log
      [Transaction] Started: CreateReservation (attempt 1/3)

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:54:25)

    console.log
      [Transaction] Started: CreateReservation (attempt 1/3)

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:54:25)

    console.log
      [Transaction] Started: CreateReservation (attempt 1/3)

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:54:25)

    console.log
      [Transaction] Started: CreateReservation (attempt 1/3)

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:54:25)

    console.log
      [Transaction] Started: CreateReservation (attempt 1/3)

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:54:25)

    console.log
      [Transaction] Committed: CreateReservation

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:61:25)

    console.log
      [Transaction] Aborted: CreateReservation

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:69:29)

    console.warn
      [Transaction] Transient error, retrying in 200ms: WriteConflict error: 
this operation conflicted with another operation. Please retry your operation or 
multi-document transaction.

    [0m [90m 74 |[39m                     attempt[33m++[39m[33m;[39m
     [90m 75 |[39m                     [36mconst[39m delay [33m=[39m 
retryDelay [33m*[39m [33mMath[39m[33m.[39mpow([35m2[39m[33m,[39m 
attempt)[33m;[39m [90m// Exponential backoff[39m
    [31m[1m>[22m[39m[90m 76 |[39m                     
console[33m.[39mwarn([32m`[Transaction] Transient error, retrying in 
${delay}ms:`[39m[33m,[39m error[33m.[39mmessage)[33m;[39m
     [90m    |[39m                             [31m[1m^[22m[39m
     [90m 77 |[39m                     [36mawait[39m 
[36mthis[39m[33m.[39msleep(delay)[33m;[39m
     [90m 78 |[39m                     [36mcontinue[39m[33m;[39m
     [90m 79 |[39m                 }[0m

      at Function.warn [as executeInTransaction] 
(src/utils/TransactionManager.js:76:29)
      at CreateReserva.execute 
(src/application/use-cases/reservas/CreateReserva.js:26:34)
      at Object.<anonymous>.exports.crearReservaBySlug 
(src/controllers/public.controller.js:140:25)

    console.log
      [Transaction] Aborted: CreateReservation

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:69:29)

    console.warn
      [Transaction] Transient error, retrying in 200ms: WriteConflict error: 
this operation conflicted with another operation. Please retry your operation or 
multi-document transaction.

    [0m [90m 74 |[39m                     attempt[33m++[39m[33m;[39m
     [90m 75 |[39m                     [36mconst[39m delay [33m=[39m 
retryDelay [33m*[39m [33mMath[39m[33m.[39mpow([35m2[39m[33m,[39m 
attempt)[33m;[39m [90m// Exponential backoff[39m
    [31m[1m>[22m[39m[90m 76 |[39m                     
console[33m.[39mwarn([32m`[Transaction] Transient error, retrying in 
${delay}ms:`[39m[33m,[39m error[33m.[39mmessage)[33m;[39m
     [90m    |[39m                             [31m[1m^[22m[39m
     [90m 77 |[39m                     [36mawait[39m 
[36mthis[39m[33m.[39msleep(delay)[33m;[39m
     [90m 78 |[39m                     [36mcontinue[39m[33m;[39m
     [90m 79 |[39m                 }[0m

      at Function.warn [as executeInTransaction] 
(src/utils/TransactionManager.js:76:29)
      at CreateReserva.execute 
(src/application/use-cases/reservas/CreateReserva.js:26:34)
      at Object.<anonymous>.exports.crearReservaBySlug 
(src/controllers/public.controller.js:140:25)

    console.log
      [Transaction] Aborted: CreateReservation

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:69:29)

    console.warn
      [Transaction] Transient error, retrying in 200ms: WriteConflict error: 
this operation conflicted with another operation. Please retry your operation or 
multi-document transaction.

    [0m [90m 74 |[39m                     attempt[33m++[39m[33m;[39m
     [90m 75 |[39m                     [36mconst[39m delay [33m=[39m 
retryDelay [33m*[39m [33mMath[39m[33m.[39mpow([35m2[39m[33m,[39m 
attempt)[33m;[39m [90m// Exponential backoff[39m
    [31m[1m>[22m[39m[90m 76 |[39m                     
console[33m.[39mwarn([32m`[Transaction] Transient error, retrying in 
${delay}ms:`[39m[33m,[39m error[33m.[39mmessage)[33m;[39m
     [90m    |[39m                             [31m[1m^[22m[39m
     [90m 77 |[39m                     [36mawait[39m 
[36mthis[39m[33m.[39msleep(delay)[33m;[39m
     [90m 78 |[39m                     [36mcontinue[39m[33m;[39m
     [90m 79 |[39m                 }[0m

      at Function.warn [as executeInTransaction] 
(src/utils/TransactionManager.js:76:29)
      at CreateReserva.execute 
(src/application/use-cases/reservas/CreateReserva.js:26:34)
      at Object.<anonymous>.exports.crearReservaBySlug 
(src/controllers/public.controller.js:140:25)

    console.log
      [Transaction] Aborted: CreateReservation

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:69:29)

    console.warn
      [Transaction] Transient error, retrying in 200ms: WriteConflict error: 
this operation conflicted with another operation. Please retry your operation or 
multi-document transaction.

    [0m [90m 74 |[39m                     attempt[33m++[39m[33m;[39m
     [90m 75 |[39m                     [36mconst[39m delay [33m=[39m 
retryDelay [33m*[39m [33mMath[39m[33m.[39mpow([35m2[39m[33m,[39m 
attempt)[33m;[39m [90m// Exponential backoff[39m
    [31m[1m>[22m[39m[90m 76 |[39m                     
console[33m.[39mwarn([32m`[Transaction] Transient error, retrying in 
${delay}ms:`[39m[33m,[39m error[33m.[39mmessage)[33m;[39m
     [90m    |[39m                             [31m[1m^[22m[39m
     [90m 77 |[39m                     [36mawait[39m 
[36mthis[39m[33m.[39msleep(delay)[33m;[39m
     [90m 78 |[39m                     [36mcontinue[39m[33m;[39m
     [90m 79 |[39m                 }[0m

      at Function.warn [as executeInTransaction] 
(src/utils/TransactionManager.js:76:29)
      at CreateReserva.execute 
(src/application/use-cases/reservas/CreateReserva.js:26:34)
      at Object.<anonymous>.exports.crearReservaBySlug 
(src/controllers/public.controller.js:140:25)

    console.log
      [Transaction] Aborted: CreateReservation

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:69:29)

    console.error
      [Transaction] Failed: CreateReservation {
        error: `E11000 duplicate key error collection: test.reservas index: 
unique_reservation_slot dup key: { barberoId: 
ObjectId('698be98b6a05e103eb47021b'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698be98b6a05e103eb470219') }`,
        attempt: 1,
        stack: `MongoServerError: E11000 duplicate key error collection: 
test.reservas index: unique_reservation_slot dup key: { barberoId: 
ObjectId('698be98b6a05e103eb47021b'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698be98b6a05e103eb470219') }\n` +
          '    at InsertOneOperation.handleOk (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\node_modules\\mongodb\\src\\operations\\insert.ts:79:13)\n' +
          '    at tryOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\backen
d\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:294:26)\n' +
          '    at processTicksAndRejections 
(node:internal/process/task_queues:105:5)\n' +
          '    at executeOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\ba
ckend\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:123:12)\n' +
          '    at Collection.insertOne (C:\\Users\\Kristian\\Desktop\\barber-saas
\\backend\\node_modules\\mongodb\\src\\collection.ts:294:12)\n' +
          '    at model.$__save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backe
nd\\node_modules\\mongoose\\lib\\model.js:398:16)\n' +
          '    at model.save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\
\node_modules\\mongoose\\lib\\model.js:609:5)\n' +
          '    at C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\\node_module
s\\mongoose\\lib\\model.js:2722:9\n' +
          '    at async Promise.all (index 0)\n' +
          '    at Function.create (C:\\Users\\Kristian\\Desktop\\barber-saas\\bac
kend\\node_modules\\mongoose\\lib\\model.js:2707:11)\n' +
          '    at MongoReservaRepository.save (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\src\\infrastructure\\database\\mongodb\\repositories\\MongoRese
rvaRepository.js:15:16)\n' +
          '    at TransactionManager.executeInTransaction.operationName (C:\\User
s\\Kristian\\Desktop\\barber-saas\\backend\\src\\application\\use-cases\\reservas
\\CreateReserva.js:72:42)\n' +
          '    at Function.executeInTransaction (C:\\Users\\Kristian\\Desktop\\ba
rber-saas\\backend\\src\\utils\\TransactionManager.js:57:32)\n' +
          '    at CreateReserva.execute (C:\\Users\\Kristian\\Desktop\\barber-saa
s\\backend\\src\\application\\use-cases\\reservas\\CreateReserva.js:26:34)\n' +
          '    at Object.<anonymous>.exports.crearReservaBySlug (C:\\Users\\Krist
ian\\Desktop\\barber-saas\\backend\\src\\controllers\\public.controller.js:140:25
)'
      }

    [0m [90m 80 |[39m
     [90m 81 |[39m                 [90m// Non-transient error or max retries 
reached[39m
    [31m[1m>[22m[39m[90m 82 |[39m                 
console[33m.[39merror([32m`[Transaction] Failed: 
${operationName}`[39m[33m,[39m {
     [90m    |[39m                         [31m[1m^[22m[39m
     [90m 83 |[39m                     error[33m:[39m 
error[33m.[39mmessage[33m,[39m
     [90m 84 |[39m                     attempt[33m:[39m attempt [33m+[39m 
[35m1[39m[33m,[39m
     [90m 85 |[39m                     stack[33m:[39m 
error[33m.[39mstack[0m

      at Function.error [as executeInTransaction] 
(src/utils/TransactionManager.js:82:25)
      at CreateReserva.execute 
(src/application/use-cases/reservas/CreateReserva.js:26:34)
      at Object.<anonymous>.exports.crearReservaBySlug 
(src/controllers/public.controller.js:140:25)

    console.log
      [Transaction] Aborted: CreateReservation

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:69:29)

    console.error
      [Transaction] Failed: CreateReservation {
        error: `E11000 duplicate key error collection: test.reservas index: 
unique_reservation_slot dup key: { barberoId: 
ObjectId('698be98b6a05e103eb47021b'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698be98b6a05e103eb470219') }`,
        attempt: 1,
        stack: `MongoServerError: E11000 duplicate key error collection: 
test.reservas index: unique_reservation_slot dup key: { barberoId: 
ObjectId('698be98b6a05e103eb47021b'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698be98b6a05e103eb470219') }\n` +
          '    at InsertOneOperation.handleOk (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\node_modules\\mongodb\\src\\operations\\insert.ts:79:13)\n' +
          '    at tryOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\backen
d\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:294:26)\n' +
          '    at processTicksAndRejections 
(node:internal/process/task_queues:105:5)\n' +
          '    at executeOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\ba
ckend\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:123:12)\n' +
          '    at Collection.insertOne (C:\\Users\\Kristian\\Desktop\\barber-saas
\\backend\\node_modules\\mongodb\\src\\collection.ts:294:12)\n' +
          '    at model.$__save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backe
nd\\node_modules\\mongoose\\lib\\model.js:398:16)\n' +
          '    at model.save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\
\node_modules\\mongoose\\lib\\model.js:609:5)\n' +
          '    at C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\\node_module
s\\mongoose\\lib\\model.js:2722:9\n' +
          '    at async Promise.all (index 0)\n' +
          '    at Function.create (C:\\Users\\Kristian\\Desktop\\barber-saas\\bac
kend\\node_modules\\mongoose\\lib\\model.js:2707:11)\n' +
          '    at MongoReservaRepository.save (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\src\\infrastructure\\database\\mongodb\\repositories\\MongoRese
rvaRepository.js:15:16)\n' +
          '    at TransactionManager.executeInTransaction.operationName (C:\\User
s\\Kristian\\Desktop\\barber-saas\\backend\\src\\application\\use-cases\\reservas
\\CreateReserva.js:72:42)\n' +
          '    at Function.executeInTransaction (C:\\Users\\Kristian\\Desktop\\ba
rber-saas\\backend\\src\\utils\\TransactionManager.js:57:32)\n' +
          '    at CreateReserva.execute (C:\\Users\\Kristian\\Desktop\\barber-saa
s\\backend\\src\\application\\use-cases\\reservas\\CreateReserva.js:26:34)\n' +
          '    at Object.<anonymous>.exports.crearReservaBySlug (C:\\Users\\Krist
ian\\Desktop\\barber-saas\\backend\\src\\controllers\\public.controller.js:140:25
)'
      }

    [0m [90m 80 |[39m
     [90m 81 |[39m                 [90m// Non-transient error or max retries 
reached[39m
    [31m[1m>[22m[39m[90m 82 |[39m                 
console[33m.[39merror([32m`[Transaction] Failed: 
${operationName}`[39m[33m,[39m {
     [90m    |[39m                         [31m[1m^[22m[39m
     [90m 83 |[39m                     error[33m:[39m 
error[33m.[39mmessage[33m,[39m
     [90m 84 |[39m                     attempt[33m:[39m attempt [33m+[39m 
[35m1[39m[33m,[39m
     [90m 85 |[39m                     stack[33m:[39m 
error[33m.[39mstack[0m

      at Function.error [as executeInTransaction] 
(src/utils/TransactionManager.js:82:25)
      at CreateReserva.execute 
(src/application/use-cases/reservas/CreateReserva.js:26:34)
      at Object.<anonymous>.exports.crearReservaBySlug 
(src/controllers/public.controller.js:140:25)

    console.log
      [Transaction] Aborted: CreateReservation

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:69:29)

    console.warn
      [Transaction] Transient error, retrying in 200ms: WriteConflict error: 
this operation conflicted with another operation. Please retry your operation or 
multi-document transaction.

    [0m [90m 74 |[39m                     attempt[33m++[39m[33m;[39m
     [90m 75 |[39m                     [36mconst[39m delay [33m=[39m 
retryDelay [33m*[39m [33mMath[39m[33m.[39mpow([35m2[39m[33m,[39m 
attempt)[33m;[39m [90m// Exponential backoff[39m
    [31m[1m>[22m[39m[90m 76 |[39m                     
console[33m.[39mwarn([32m`[Transaction] Transient error, retrying in 
${delay}ms:`[39m[33m,[39m error[33m.[39mmessage)[33m;[39m
     [90m    |[39m                             [31m[1m^[22m[39m
     [90m 77 |[39m                     [36mawait[39m 
[36mthis[39m[33m.[39msleep(delay)[33m;[39m
     [90m 78 |[39m                     [36mcontinue[39m[33m;[39m
     [90m 79 |[39m                 }[0m

      at Function.warn [as executeInTransaction] 
(src/utils/TransactionManager.js:76:29)
      at CreateReserva.execute 
(src/application/use-cases/reservas/CreateReserva.js:26:34)
      at Object.<anonymous>.exports.crearReservaBySlug 
(src/controllers/public.controller.js:140:25)

    console.log
      [Transaction] Aborted: CreateReservation

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:69:29)

    console.warn
      [Transaction] Transient error, retrying in 200ms: WriteConflict error: 
this operation conflicted with another operation. Please retry your operation or 
multi-document transaction.

    [0m [90m 74 |[39m                     attempt[33m++[39m[33m;[39m
     [90m 75 |[39m                     [36mconst[39m delay [33m=[39m 
retryDelay [33m*[39m [33mMath[39m[33m.[39mpow([35m2[39m[33m,[39m 
attempt)[33m;[39m [90m// Exponential backoff[39m
    [31m[1m>[22m[39m[90m 76 |[39m                     
console[33m.[39mwarn([32m`[Transaction] Transient error, retrying in 
${delay}ms:`[39m[33m,[39m error[33m.[39mmessage)[33m;[39m
     [90m    |[39m                             [31m[1m^[22m[39m
     [90m 77 |[39m                     [36mawait[39m 
[36mthis[39m[33m.[39msleep(delay)[33m;[39m
     [90m 78 |[39m                     [36mcontinue[39m[33m;[39m
     [90m 79 |[39m                 }[0m

      at Function.warn [as executeInTransaction] 
(src/utils/TransactionManager.js:76:29)
      at CreateReserva.execute 
(src/application/use-cases/reservas/CreateReserva.js:26:34)
      at Object.<anonymous>.exports.crearReservaBySlug 
(src/controllers/public.controller.js:140:25)

    console.log
      [Transaction] Aborted: CreateReservation

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:69:29)

    console.warn
      [Transaction] Transient error, retrying in 200ms: WriteConflict error: 
this operation conflicted with another operation. Please retry your operation or 
multi-document transaction.

    [0m [90m 74 |[39m                     attempt[33m++[39m[33m;[39m
     [90m 75 |[39m                     [36mconst[39m delay [33m=[39m 
retryDelay [33m*[39m [33mMath[39m[33m.[39mpow([35m2[39m[33m,[39m 
attempt)[33m;[39m [90m// Exponential backoff[39m
    [31m[1m>[22m[39m[90m 76 |[39m                     
console[33m.[39mwarn([32m`[Transaction] Transient error, retrying in 
${delay}ms:`[39m[33m,[39m error[33m.[39mmessage)[33m;[39m
     [90m    |[39m                             [31m[1m^[22m[39m
     [90m 77 |[39m                     [36mawait[39m 
[36mthis[39m[33m.[39msleep(delay)[33m;[39m
     [90m 78 |[39m                     [36mcontinue[39m[33m;[39m
     [90m 79 |[39m                 }[0m

      at Function.warn [as executeInTransaction] 
(src/utils/TransactionManager.js:76:29)
      at CreateReserva.execute 
(src/application/use-cases/reservas/CreateReserva.js:26:34)
      at Object.<anonymous>.exports.crearReservaBySlug 
(src/controllers/public.controller.js:140:25)

    console.log
      [Transaction] Aborted: CreateReservation

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:69:29)

    console.warn
      [Transaction] Transient error, retrying in 200ms: WriteConflict error: 
this operation conflicted with another operation. Please retry your operation or 
multi-document transaction.

    [0m [90m 74 |[39m                     attempt[33m++[39m[33m;[39m
     [90m 75 |[39m                     [36mconst[39m delay [33m=[39m 
retryDelay [33m*[39m [33mMath[39m[33m.[39mpow([35m2[39m[33m,[39m 
attempt)[33m;[39m [90m// Exponential backoff[39m
    [31m[1m>[22m[39m[90m 76 |[39m                     
console[33m.[39mwarn([32m`[Transaction] Transient error, retrying in 
${delay}ms:`[39m[33m,[39m error[33m.[39mmessage)[33m;[39m
     [90m    |[39m                             [31m[1m^[22m[39m
     [90m 77 |[39m                     [36mawait[39m 
[36mthis[39m[33m.[39msleep(delay)[33m;[39m
     [90m 78 |[39m                     [36mcontinue[39m[33m;[39m
     [90m 79 |[39m                 }[0m

      at Function.warn [as executeInTransaction] 
(src/utils/TransactionManager.js:76:29)
      at CreateReserva.execute 
(src/application/use-cases/reservas/CreateReserva.js:26:34)
      at Object.<anonymous>.exports.crearReservaBySlug 
(src/controllers/public.controller.js:140:25)

    console.log
      [Transaction] Aborted: CreateReservation

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:69:29)

    console.warn
      [Transaction] Transient error, retrying in 200ms: WriteConflict error: 
this operation conflicted with another operation. Please retry your operation or 
multi-document transaction.

    [0m [90m 74 |[39m                     attempt[33m++[39m[33m;[39m
     [90m 75 |[39m                     [36mconst[39m delay [33m=[39m 
retryDelay [33m*[39m [33mMath[39m[33m.[39mpow([35m2[39m[33m,[39m 
attempt)[33m;[39m [90m// Exponential backoff[39m
    [31m[1m>[22m[39m[90m 76 |[39m                     
console[33m.[39mwarn([32m`[Transaction] Transient error, retrying in 
${delay}ms:`[39m[33m,[39m error[33m.[39mmessage)[33m;[39m
     [90m    |[39m                             [31m[1m^[22m[39m
     [90m 77 |[39m                     [36mawait[39m 
[36mthis[39m[33m.[39msleep(delay)[33m;[39m
     [90m 78 |[39m                     [36mcontinue[39m[33m;[39m
     [90m 79 |[39m                 }[0m

      at Function.warn [as executeInTransaction] 
(src/utils/TransactionManager.js:76:29)
      at CreateReserva.execute 
(src/application/use-cases/reservas/CreateReserva.js:26:34)
      at Object.<anonymous>.exports.crearReservaBySlug 
(src/controllers/public.controller.js:140:25)

    console.log
      [Transaction] Aborted: CreateReservation

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:69:29)

    console.warn
      [Transaction] Transient error, retrying in 200ms: WriteConflict error: 
this operation conflicted with another operation. Please retry your operation or 
multi-document transaction.

    [0m [90m 74 |[39m                     attempt[33m++[39m[33m;[39m
     [90m 75 |[39m                     [36mconst[39m delay [33m=[39m 
retryDelay [33m*[39m [33mMath[39m[33m.[39mpow([35m2[39m[33m,[39m 
attempt)[33m;[39m [90m// Exponential backoff[39m
    [31m[1m>[22m[39m[90m 76 |[39m                     
console[33m.[39mwarn([32m`[Transaction] Transient error, retrying in 
${delay}ms:`[39m[33m,[39m error[33m.[39mmessage)[33m;[39m
     [90m    |[39m                             [31m[1m^[22m[39m
     [90m 77 |[39m                     [36mawait[39m 
[36mthis[39m[33m.[39msleep(delay)[33m;[39m
     [90m 78 |[39m                     [36mcontinue[39m[33m;[39m
     [90m 79 |[39m                 }[0m

      at Function.warn [as executeInTransaction] 
(src/utils/TransactionManager.js:76:29)
      at CreateReserva.execute 
(src/application/use-cases/reservas/CreateReserva.js:26:34)
      at Object.<anonymous>.exports.crearReservaBySlug 
(src/controllers/public.controller.js:140:25)

    console.error
      ƒö┤ ERROR: TransactionError: Transaction failed for CreateReservation: 
E11000 duplicate key error collection: test.reservas index: 
unique_reservation_slot dup key: { barberoId: 
ObjectId('698be98b6a05e103eb47021b'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698be98b6a05e103eb470219') }
          at Function.executeInTransaction (C:\Users\Kristian\Desktop\barber-saas
\backend\src\utils\TransactionManager.js:88:42)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at CreateReserva.execute (C:\Users\Kristian\Desktop\barber-saas\backend
\src\application\use-cases\reservas\CreateReserva.js:26:34)
          at Object.<anonymous>.exports.crearReservaBySlug (C:\Users\Kristian\Des
ktop\barber-saas\backend\src\controllers\public.controller.js:140:25) {
        isTransactionError: true,
        originalError: MongoServerError: E11000 duplicate key error collection: 
test.reservas index: unique_reservation_slot dup key: { barberoId: 
ObjectId('698be98b6a05e103eb47021b'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698be98b6a05e103eb470219') }
            at InsertOneOperation.handleOk (C:\Users\Kristian\Desktop\barber-saas
\backend\node_modules\mongodb\src\operations\insert.ts:79:13)
            at tryOperation (C:\Users\Kristian\Desktop\barber-saas\backend\node_m
odules\mongodb\src\operations\execute_operation.ts:294:26)
            at processTicksAndRejections 
(node:internal/process/task_queues:105:5)
            at executeOperation (C:\Users\Kristian\Desktop\barber-saas\backend\no
de_modules\mongodb\src\operations\execute_operation.ts:123:12)
            at Collection.insertOne (C:\Users\Kristian\Desktop\barber-saas\backen
d\node_modules\mongodb\src\collection.ts:294:12)
            at model.$__save (C:\Users\Kristian\Desktop\barber-saas\backend\node_
modules\mongoose\lib\model.js:398:16)
            at model.save (C:\Users\Kristian\Desktop\barber-saas\backend\node_mod
ules\mongoose\lib\model.js:609:5)
            at C:\Users\Kristian\Desktop\barber-saas\backend\node_modules\mongoos
e\lib\model.js:2722:9
            at async Promise.all (index 0)
            at Function.create (C:\Users\Kristian\Desktop\barber-saas\backend\nod
e_modules\mongoose\lib\model.js:2707:11)
            at MongoReservaRepository.save (C:\Users\Kristian\Desktop\barber-saas
\backend\src\infrastructure\database\mongodb\repositories\MongoReservaRepository.
js:15:16)
            at TransactionManager.executeInTransaction.operationName (C:\Users\Kr
istian\Desktop\barber-saas\backend\src\application\use-cases\reservas\CreateReser
va.js:72:42)
            at Function.executeInTransaction (C:\Users\Kristian\Desktop\barber-sa
as\backend\src\utils\TransactionManager.js:57:32)
            at CreateReserva.execute (C:\Users\Kristian\Desktop\barber-saas\backe
nd\src\application\use-cases\reservas\CreateReserva.js:26:34)
            at Object.<anonymous>.exports.crearReservaBySlug (C:\Users\Kristian\D
esktop\barber-saas\backend\src\controllers\public.controller.js:140:25) {
          errorLabelSet: Set(0) {},
          errorResponse: {
            index: 0,
            code: 11000,
            errmsg: `E11000 duplicate key error collection: test.reservas index: 
unique_reservation_slot dup key: { barberoId: 
ObjectId('698be98b6a05e103eb47021b'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698be98b6a05e103eb470219') }`,
            keyPattern: [Object],
            keyValue: [Object]
          },
          index: 0,
          code: 11000,
          keyPattern: { barberoId: 1, fecha: 1, hora: 1, barberiaId: 1 },
          keyValue: {
            barberoId: new ObjectId('698be98b6a05e103eb47021b'),
            fecha: 2026-03-16T00:00:00.000Z,
            hora: '14:00',
            barberiaId: new ObjectId('698be98b6a05e103eb470219')
          }
        },
        context: { operationName: 'CreateReservation', attempt: 1 },
        timestamp: 2026-02-11T02:29:32.661Z,
        originalStack: `MongoServerError: E11000 duplicate key error collection: 
test.reservas index: unique_reservation_slot dup key: { barberoId: 
ObjectId('698be98b6a05e103eb47021b'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698be98b6a05e103eb470219') }\n` +
          '    at InsertOneOperation.handleOk (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\node_modules\\mongodb\\src\\operations\\insert.ts:79:13)\n' +
          '    at tryOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\backen
d\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:294:26)\n' +
          '    at processTicksAndRejections 
(node:internal/process/task_queues:105:5)\n' +
          '    at executeOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\ba
ckend\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:123:12)\n' +
          '    at Collection.insertOne (C:\\Users\\Kristian\\Desktop\\barber-saas
\\backend\\node_modules\\mongodb\\src\\collection.ts:294:12)\n' +
          '    at model.$__save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backe
nd\\node_modules\\mongoose\\lib\\model.js:398:16)\n' +
          '    at model.save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\
\node_modules\\mongoose\\lib\\model.js:609:5)\n' +
          '    at C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\\node_module
s\\mongoose\\lib\\model.js:2722:9\n' +
          '    at async Promise.all (index 0)\n' +
          '    at Function.create (C:\\Users\\Kristian\\Desktop\\barber-saas\\bac
kend\\node_modules\\mongoose\\lib\\model.js:2707:11)\n' +
          '    at MongoReservaRepository.save (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\src\\infrastructure\\database\\mongodb\\repositories\\MongoRese
rvaRepository.js:15:16)\n' +
          '    at TransactionManager.executeInTransaction.operationName (C:\\User
s\\Kristian\\Desktop\\barber-saas\\backend\\src\\application\\use-cases\\reservas
\\CreateReserva.js:72:42)\n' +
          '    at Function.executeInTransaction (C:\\Users\\Kristian\\Desktop\\ba
rber-saas\\backend\\src\\utils\\TransactionManager.js:57:32)\n' +
          '    at CreateReserva.execute (C:\\Users\\Kristian\\Desktop\\barber-saa
s\\backend\\src\\application\\use-cases\\reservas\\CreateReserva.js:26:34)\n' +
          '    at Object.<anonymous>.exports.crearReservaBySlug (C:\\Users\\Krist
ian\\Desktop\\barber-saas\\backend\\src\\controllers\\public.controller.js:140:25
)'
      }

    [0m [90m 4 |[39m
     [90m 5 |[39m [36mconst[39m errorHandler [33m=[39m (err[33m,[39m 
req[33m,[39m res[33m,[39m next) [33m=>[39m {
    [31m[1m>[22m[39m[90m 6 |[39m   console[33m.[39merror([32m"ƒö┤ 
ERROR:"[39m[33m,[39m err)[33m;[39m
     [90m   |[39m           [31m[1m^[22m[39m
     [90m 7 |[39m
     [90m 8 |[39m   [90m// ­ƒöÑ A├æADIR HEADERS CORS SI NO EXISTEN[39m
     [90m 9 |[39m   [36mconst[39m origin [33m=[39m 
req[33m.[39mheaders[33m.[39morigin[33m;[39m[0m

      at error (src/config/middleware/errorHandler.js:6:11)
      at Layer.handleError (node_modules/router/lib/layer.js:116:17)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at Layer.handleError (node_modules/router/lib/layer.js:111:12)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at Immediate.next (node_modules/router/index.js:291:5)
      at Immediate._onImmediate (node_modules/router/index.js:688:15)

    console.error
      ƒö┤ ERROR: TransactionError: Transaction failed for CreateReservation: 
E11000 duplicate key error collection: test.reservas index: 
unique_reservation_slot dup key: { barberoId: 
ObjectId('698be98b6a05e103eb47021b'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698be98b6a05e103eb470219') }
          at Function.executeInTransaction (C:\Users\Kristian\Desktop\barber-saas
\backend\src\utils\TransactionManager.js:88:42)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at CreateReserva.execute (C:\Users\Kristian\Desktop\barber-saas\backend
\src\application\use-cases\reservas\CreateReserva.js:26:34)
          at Object.<anonymous>.exports.crearReservaBySlug (C:\Users\Kristian\Des
ktop\barber-saas\backend\src\controllers\public.controller.js:140:25) {
        isTransactionError: true,
        originalError: MongoServerError: E11000 duplicate key error collection: 
test.reservas index: unique_reservation_slot dup key: { barberoId: 
ObjectId('698be98b6a05e103eb47021b'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698be98b6a05e103eb470219') }
            at InsertOneOperation.handleOk (C:\Users\Kristian\Desktop\barber-saas
\backend\node_modules\mongodb\src\operations\insert.ts:79:13)
            at tryOperation (C:\Users\Kristian\Desktop\barber-saas\backend\node_m
odules\mongodb\src\operations\execute_operation.ts:294:26)
            at processTicksAndRejections 
(node:internal/process/task_queues:105:5)
            at executeOperation (C:\Users\Kristian\Desktop\barber-saas\backend\no
de_modules\mongodb\src\operations\execute_operation.ts:123:12)
            at Collection.insertOne (C:\Users\Kristian\Desktop\barber-saas\backen
d\node_modules\mongodb\src\collection.ts:294:12)
            at model.$__save (C:\Users\Kristian\Desktop\barber-saas\backend\node_
modules\mongoose\lib\model.js:398:16)
            at model.save (C:\Users\Kristian\Desktop\barber-saas\backend\node_mod
ules\mongoose\lib\model.js:609:5)
            at C:\Users\Kristian\Desktop\barber-saas\backend\node_modules\mongoos
e\lib\model.js:2722:9
            at async Promise.all (index 0)
            at Function.create (C:\Users\Kristian\Desktop\barber-saas\backend\nod
e_modules\mongoose\lib\model.js:2707:11)
            at MongoReservaRepository.save (C:\Users\Kristian\Desktop\barber-saas
\backend\src\infrastructure\database\mongodb\repositories\MongoReservaRepository.
js:15:16)
            at TransactionManager.executeInTransaction.operationName (C:\Users\Kr
istian\Desktop\barber-saas\backend\src\application\use-cases\reservas\CreateReser
va.js:72:42)
            at Function.executeInTransaction (C:\Users\Kristian\Desktop\barber-sa
as\backend\src\utils\TransactionManager.js:57:32)
            at CreateReserva.execute (C:\Users\Kristian\Desktop\barber-saas\backe
nd\src\application\use-cases\reservas\CreateReserva.js:26:34)
            at Object.<anonymous>.exports.crearReservaBySlug (C:\Users\Kristian\D
esktop\barber-saas\backend\src\controllers\public.controller.js:140:25) {
          errorLabelSet: Set(0) {},
          errorResponse: {
            index: 0,
            code: 11000,
            errmsg: `E11000 duplicate key error collection: test.reservas index: 
unique_reservation_slot dup key: { barberoId: 
ObjectId('698be98b6a05e103eb47021b'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698be98b6a05e103eb470219') }`,
            keyPattern: [Object],
            keyValue: [Object]
          },
          index: 0,
          code: 11000,
          keyPattern: { barberoId: 1, fecha: 1, hora: 1, barberiaId: 1 },
          keyValue: {
            barberoId: new ObjectId('698be98b6a05e103eb47021b'),
            fecha: 2026-03-16T00:00:00.000Z,
            hora: '14:00',
            barberiaId: new ObjectId('698be98b6a05e103eb470219')
          }
        },
        context: { operationName: 'CreateReservation', attempt: 1 },
        timestamp: 2026-02-11T02:29:32.663Z,
        originalStack: `MongoServerError: E11000 duplicate key error collection: 
test.reservas index: unique_reservation_slot dup key: { barberoId: 
ObjectId('698be98b6a05e103eb47021b'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698be98b6a05e103eb470219') }\n` +
          '    at InsertOneOperation.handleOk (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\node_modules\\mongodb\\src\\operations\\insert.ts:79:13)\n' +
          '    at tryOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\backen
d\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:294:26)\n' +
          '    at processTicksAndRejections 
(node:internal/process/task_queues:105:5)\n' +
          '    at executeOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\ba
ckend\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:123:12)\n' +
          '    at Collection.insertOne (C:\\Users\\Kristian\\Desktop\\barber-saas
\\backend\\node_modules\\mongodb\\src\\collection.ts:294:12)\n' +
          '    at model.$__save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backe
nd\\node_modules\\mongoose\\lib\\model.js:398:16)\n' +
          '    at model.save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\
\node_modules\\mongoose\\lib\\model.js:609:5)\n' +
          '    at C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\\node_module
s\\mongoose\\lib\\model.js:2722:9\n' +
          '    at async Promise.all (index 0)\n' +
          '    at Function.create (C:\\Users\\Kristian\\Desktop\\barber-saas\\bac
kend\\node_modules\\mongoose\\lib\\model.js:2707:11)\n' +
          '    at MongoReservaRepository.save (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\src\\infrastructure\\database\\mongodb\\repositories\\MongoRese
rvaRepository.js:15:16)\n' +
          '    at TransactionManager.executeInTransaction.operationName (C:\\User
s\\Kristian\\Desktop\\barber-saas\\backend\\src\\application\\use-cases\\reservas
\\CreateReserva.js:72:42)\n' +
          '    at Function.executeInTransaction (C:\\Users\\Kristian\\Desktop\\ba
rber-saas\\backend\\src\\utils\\TransactionManager.js:57:32)\n' +
          '    at CreateReserva.execute (C:\\Users\\Kristian\\Desktop\\barber-saa
s\\backend\\src\\application\\use-cases\\reservas\\CreateReserva.js:26:34)\n' +
          '    at Object.<anonymous>.exports.crearReservaBySlug (C:\\Users\\Krist
ian\\Desktop\\barber-saas\\backend\\src\\controllers\\public.controller.js:140:25
)'
      }

    [0m [90m 4 |[39m
     [90m 5 |[39m [36mconst[39m errorHandler [33m=[39m (err[33m,[39m 
req[33m,[39m res[33m,[39m next) [33m=>[39m {
    [31m[1m>[22m[39m[90m 6 |[39m   console[33m.[39merror([32m"ƒö┤ 
ERROR:"[39m[33m,[39m err)[33m;[39m
     [90m   |[39m           [31m[1m^[22m[39m
     [90m 7 |[39m
     [90m 8 |[39m   [90m// ­ƒöÑ A├æADIR HEADERS CORS SI NO EXISTEN[39m
     [90m 9 |[39m   [36mconst[39m origin [33m=[39m 
req[33m.[39mheaders[33m.[39morigin[33m;[39m[0m

      at error (src/config/middleware/errorHandler.js:6:11)
      at Layer.handleError (node_modules/router/lib/layer.js:116:17)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at Layer.handleError (node_modules/router/lib/layer.js:111:12)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at Immediate.next (node_modules/router/index.js:291:5)
      at Immediate._onImmediate (node_modules/router/index.js:688:15)

    console.log
      [Transaction] Aborted: CreateReservation

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:69:29)

    console.error
      [Transaction] Failed: CreateReservation {
        error: `E11000 duplicate key error collection: test.reservas index: 
unique_reservation_slot dup key: { barberoId: 
ObjectId('698be98b6a05e103eb47021b'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698be98b6a05e103eb470219') }`,
        attempt: 1,
        stack: `MongoServerError: E11000 duplicate key error collection: 
test.reservas index: unique_reservation_slot dup key: { barberoId: 
ObjectId('698be98b6a05e103eb47021b'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698be98b6a05e103eb470219') }\n` +
          '    at InsertOneOperation.handleOk (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\node_modules\\mongodb\\src\\operations\\insert.ts:79:13)\n' +
          '    at tryOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\backen
d\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:294:26)\n' +
          '    at processTicksAndRejections 
(node:internal/process/task_queues:105:5)\n' +
          '    at executeOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\ba
ckend\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:123:12)\n' +
          '    at Collection.insertOne (C:\\Users\\Kristian\\Desktop\\barber-saas
\\backend\\node_modules\\mongodb\\src\\collection.ts:294:12)\n' +
          '    at model.$__save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backe
nd\\node_modules\\mongoose\\lib\\model.js:398:16)\n' +
          '    at model.save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\
\node_modules\\mongoose\\lib\\model.js:609:5)\n' +
          '    at C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\\node_module
s\\mongoose\\lib\\model.js:2722:9\n' +
          '    at async Promise.all (index 0)\n' +
          '    at Function.create (C:\\Users\\Kristian\\Desktop\\barber-saas\\bac
kend\\node_modules\\mongoose\\lib\\model.js:2707:11)\n' +
          '    at MongoReservaRepository.save (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\src\\infrastructure\\database\\mongodb\\repositories\\MongoRese
rvaRepository.js:15:16)\n' +
          '    at TransactionManager.executeInTransaction.operationName (C:\\User
s\\Kristian\\Desktop\\barber-saas\\backend\\src\\application\\use-cases\\reservas
\\CreateReserva.js:72:42)\n' +
          '    at Function.executeInTransaction (C:\\Users\\Kristian\\Desktop\\ba
rber-saas\\backend\\src\\utils\\TransactionManager.js:57:32)\n' +
          '    at CreateReserva.execute (C:\\Users\\Kristian\\Desktop\\barber-saa
s\\backend\\src\\application\\use-cases\\reservas\\CreateReserva.js:26:34)\n' +
          '    at Object.<anonymous>.exports.crearReservaBySlug (C:\\Users\\Krist
ian\\Desktop\\barber-saas\\backend\\src\\controllers\\public.controller.js:140:25
)'
      }

    [0m [90m 80 |[39m
     [90m 81 |[39m                 [90m// Non-transient error or max retries 
reached[39m
    [31m[1m>[22m[39m[90m 82 |[39m                 
console[33m.[39merror([32m`[Transaction] Failed: 
${operationName}`[39m[33m,[39m {
     [90m    |[39m                         [31m[1m^[22m[39m
     [90m 83 |[39m                     error[33m:[39m 
error[33m.[39mmessage[33m,[39m
     [90m 84 |[39m                     attempt[33m:[39m attempt [33m+[39m 
[35m1[39m[33m,[39m
     [90m 85 |[39m                     stack[33m:[39m 
error[33m.[39mstack[0m

      at Function.error [as executeInTransaction] 
(src/utils/TransactionManager.js:82:25)
      at CreateReserva.execute 
(src/application/use-cases/reservas/CreateReserva.js:26:34)
      at Object.<anonymous>.exports.crearReservaBySlug 
(src/controllers/public.controller.js:140:25)

    console.log
      [Transaction] Aborted: CreateReservation

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:69:29)

    console.error
      [Transaction] Failed: CreateReservation {
        error: `E11000 duplicate key error collection: test.reservas index: 
unique_reservation_slot dup key: { barberoId: 
ObjectId('698be98b6a05e103eb47021b'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698be98b6a05e103eb470219') }`,
        attempt: 1,
        stack: `MongoServerError: E11000 duplicate key error collection: 
test.reservas index: unique_reservation_slot dup key: { barberoId: 
ObjectId('698be98b6a05e103eb47021b'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698be98b6a05e103eb470219') }\n` +
          '    at InsertOneOperation.handleOk (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\node_modules\\mongodb\\src\\operations\\insert.ts:79:13)\n' +
          '    at tryOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\backen
d\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:294:26)\n' +
          '    at processTicksAndRejections 
(node:internal/process/task_queues:105:5)\n' +
          '    at executeOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\ba
ckend\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:123:12)\n' +
          '    at Collection.insertOne (C:\\Users\\Kristian\\Desktop\\barber-saas
\\backend\\node_modules\\mongodb\\src\\collection.ts:294:12)\n' +
          '    at model.$__save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backe
nd\\node_modules\\mongoose\\lib\\model.js:398:16)\n' +
          '    at model.save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\
\node_modules\\mongoose\\lib\\model.js:609:5)\n' +
          '    at C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\\node_module
s\\mongoose\\lib\\model.js:2722:9\n' +
          '    at async Promise.all (index 0)\n' +
          '    at Function.create (C:\\Users\\Kristian\\Desktop\\barber-saas\\bac
kend\\node_modules\\mongoose\\lib\\model.js:2707:11)\n' +
          '    at MongoReservaRepository.save (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\src\\infrastructure\\database\\mongodb\\repositories\\MongoRese
rvaRepository.js:15:16)\n' +
          '    at TransactionManager.executeInTransaction.operationName (C:\\User
s\\Kristian\\Desktop\\barber-saas\\backend\\src\\application\\use-cases\\reservas
\\CreateReserva.js:72:42)\n' +
          '    at Function.executeInTransaction (C:\\Users\\Kristian\\Desktop\\ba
rber-saas\\backend\\src\\utils\\TransactionManager.js:57:32)\n' +
          '    at CreateReserva.execute (C:\\Users\\Kristian\\Desktop\\barber-saa
s\\backend\\src\\application\\use-cases\\reservas\\CreateReserva.js:26:34)\n' +
          '    at Object.<anonymous>.exports.crearReservaBySlug (C:\\Users\\Krist
ian\\Desktop\\barber-saas\\backend\\src\\controllers\\public.controller.js:140:25
)'
      }

    [0m [90m 80 |[39m
     [90m 81 |[39m                 [90m// Non-transient error or max retries 
reached[39m
    [31m[1m>[22m[39m[90m 82 |[39m                 
console[33m.[39merror([32m`[Transaction] Failed: 
${operationName}`[39m[33m,[39m {
     [90m    |[39m                         [31m[1m^[22m[39m
     [90m 83 |[39m                     error[33m:[39m 
error[33m.[39mmessage[33m,[39m
     [90m 84 |[39m                     attempt[33m:[39m attempt [33m+[39m 
[35m1[39m[33m,[39m
     [90m 85 |[39m                     stack[33m:[39m 
error[33m.[39mstack[0m

      at Function.error [as executeInTransaction] 
(src/utils/TransactionManager.js:82:25)
      at CreateReserva.execute 
(src/application/use-cases/reservas/CreateReserva.js:26:34)
      at Object.<anonymous>.exports.crearReservaBySlug 
(src/controllers/public.controller.js:140:25)

    console.log
      [Transaction] Aborted: CreateReservation

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:69:29)

    console.error
      [Transaction] Failed: CreateReservation {
        error: `E11000 duplicate key error collection: test.reservas index: 
unique_reservation_slot dup key: { barberoId: 
ObjectId('698be98b6a05e103eb47021b'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698be98b6a05e103eb470219') }`,
        attempt: 1,
        stack: `MongoServerError: E11000 duplicate key error collection: 
test.reservas index: unique_reservation_slot dup key: { barberoId: 
ObjectId('698be98b6a05e103eb47021b'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698be98b6a05e103eb470219') }\n` +
          '    at InsertOneOperation.handleOk (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\node_modules\\mongodb\\src\\operations\\insert.ts:79:13)\n' +
          '    at tryOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\backen
d\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:294:26)\n' +
          '    at processTicksAndRejections 
(node:internal/process/task_queues:105:5)\n' +
          '    at executeOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\ba
ckend\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:123:12)\n' +
          '    at Collection.insertOne (C:\\Users\\Kristian\\Desktop\\barber-saas
\\backend\\node_modules\\mongodb\\src\\collection.ts:294:12)\n' +
          '    at model.$__save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backe
nd\\node_modules\\mongoose\\lib\\model.js:398:16)\n' +
          '    at model.save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\
\node_modules\\mongoose\\lib\\model.js:609:5)\n' +
          '    at C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\\node_module
s\\mongoose\\lib\\model.js:2722:9\n' +
          '    at async Promise.all (index 0)\n' +
          '    at Function.create (C:\\Users\\Kristian\\Desktop\\barber-saas\\bac
kend\\node_modules\\mongoose\\lib\\model.js:2707:11)\n' +
          '    at MongoReservaRepository.save (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\src\\infrastructure\\database\\mongodb\\repositories\\MongoRese
rvaRepository.js:15:16)\n' +
          '    at TransactionManager.executeInTransaction.operationName (C:\\User
s\\Kristian\\Desktop\\barber-saas\\backend\\src\\application\\use-cases\\reservas
\\CreateReserva.js:72:42)\n' +
          '    at Function.executeInTransaction (C:\\Users\\Kristian\\Desktop\\ba
rber-saas\\backend\\src\\utils\\TransactionManager.js:57:32)\n' +
          '    at CreateReserva.execute (C:\\Users\\Kristian\\Desktop\\barber-saa
s\\backend\\src\\application\\use-cases\\reservas\\CreateReserva.js:26:34)\n' +
          '    at Object.<anonymous>.exports.crearReservaBySlug (C:\\Users\\Krist
ian\\Desktop\\barber-saas\\backend\\src\\controllers\\public.controller.js:140:25
)'
      }

    [0m [90m 80 |[39m
     [90m 81 |[39m                 [90m// Non-transient error or max retries 
reached[39m
    [31m[1m>[22m[39m[90m 82 |[39m                 
console[33m.[39merror([32m`[Transaction] Failed: 
${operationName}`[39m[33m,[39m {
     [90m    |[39m                         [31m[1m^[22m[39m
     [90m 83 |[39m                     error[33m:[39m 
error[33m.[39mmessage[33m,[39m
     [90m 84 |[39m                     attempt[33m:[39m attempt [33m+[39m 
[35m1[39m[33m,[39m
     [90m 85 |[39m                     stack[33m:[39m 
error[33m.[39mstack[0m

      at Function.error [as executeInTransaction] 
(src/utils/TransactionManager.js:82:25)
      at CreateReserva.execute 
(src/application/use-cases/reservas/CreateReserva.js:26:34)
      at Object.<anonymous>.exports.crearReservaBySlug 
(src/controllers/public.controller.js:140:25)

    console.log
      [Transaction] Aborted: CreateReservation

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:69:29)

    console.error
      [Transaction] Failed: CreateReservation {
        error: `E11000 duplicate key error collection: test.reservas index: 
unique_reservation_slot dup key: { barberoId: 
ObjectId('698be98b6a05e103eb47021b'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698be98b6a05e103eb470219') }`,
        attempt: 1,
        stack: `MongoServerError: E11000 duplicate key error collection: 
test.reservas index: unique_reservation_slot dup key: { barberoId: 
ObjectId('698be98b6a05e103eb47021b'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698be98b6a05e103eb470219') }\n` +
          '    at InsertOneOperation.handleOk (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\node_modules\\mongodb\\src\\operations\\insert.ts:79:13)\n' +
          '    at tryOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\backen
d\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:294:26)\n' +
          '    at processTicksAndRejections 
(node:internal/process/task_queues:105:5)\n' +
          '    at executeOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\ba
ckend\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:123:12)\n' +
          '    at Collection.insertOne (C:\\Users\\Kristian\\Desktop\\barber-saas
\\backend\\node_modules\\mongodb\\src\\collection.ts:294:12)\n' +
          '    at model.$__save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backe
nd\\node_modules\\mongoose\\lib\\model.js:398:16)\n' +
          '    at model.save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\
\node_modules\\mongoose\\lib\\model.js:609:5)\n' +
          '    at C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\\node_module
s\\mongoose\\lib\\model.js:2722:9\n' +
          '    at async Promise.all (index 0)\n' +
          '    at Function.create (C:\\Users\\Kristian\\Desktop\\barber-saas\\bac
kend\\node_modules\\mongoose\\lib\\model.js:2707:11)\n' +
          '    at MongoReservaRepository.save (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\src\\infrastructure\\database\\mongodb\\repositories\\MongoRese
rvaRepository.js:15:16)\n' +
          '    at TransactionManager.executeInTransaction.operationName (C:\\User
s\\Kristian\\Desktop\\barber-saas\\backend\\src\\application\\use-cases\\reservas
\\CreateReserva.js:72:42)\n' +
          '    at Function.executeInTransaction (C:\\Users\\Kristian\\Desktop\\ba
rber-saas\\backend\\src\\utils\\TransactionManager.js:57:32)\n' +
          '    at CreateReserva.execute (C:\\Users\\Kristian\\Desktop\\barber-saa
s\\backend\\src\\application\\use-cases\\reservas\\CreateReserva.js:26:34)\n' +
          '    at Object.<anonymous>.exports.crearReservaBySlug (C:\\Users\\Krist
ian\\Desktop\\barber-saas\\backend\\src\\controllers\\public.controller.js:140:25
)'
      }

    [0m [90m 80 |[39m
     [90m 81 |[39m                 [90m// Non-transient error or max retries 
reached[39m
    [31m[1m>[22m[39m[90m 82 |[39m                 
console[33m.[39merror([32m`[Transaction] Failed: 
${operationName}`[39m[33m,[39m {
     [90m    |[39m                         [31m[1m^[22m[39m
     [90m 83 |[39m                     error[33m:[39m 
error[33m.[39mmessage[33m,[39m
     [90m 84 |[39m                     attempt[33m:[39m attempt [33m+[39m 
[35m1[39m[33m,[39m
     [90m 85 |[39m                     stack[33m:[39m 
error[33m.[39mstack[0m

      at Function.error [as executeInTransaction] 
(src/utils/TransactionManager.js:82:25)
      at CreateReserva.execute 
(src/application/use-cases/reservas/CreateReserva.js:26:34)
      at Object.<anonymous>.exports.crearReservaBySlug 
(src/controllers/public.controller.js:140:25)

    console.log
      [Transaction] Aborted: CreateReservation

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:69:29)

    console.error
      [Transaction] Failed: CreateReservation {
        error: `E11000 duplicate key error collection: test.reservas index: 
unique_reservation_slot dup key: { barberoId: 
ObjectId('698be98b6a05e103eb47021b'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698be98b6a05e103eb470219') }`,
        attempt: 1,
        stack: `MongoServerError: E11000 duplicate key error collection: 
test.reservas index: unique_reservation_slot dup key: { barberoId: 
ObjectId('698be98b6a05e103eb47021b'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698be98b6a05e103eb470219') }\n` +
          '    at InsertOneOperation.handleOk (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\node_modules\\mongodb\\src\\operations\\insert.ts:79:13)\n' +
          '    at tryOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\backen
d\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:294:26)\n' +
          '    at processTicksAndRejections 
(node:internal/process/task_queues:105:5)\n' +
          '    at executeOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\ba
ckend\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:123:12)\n' +
          '    at Collection.insertOne (C:\\Users\\Kristian\\Desktop\\barber-saas
\\backend\\node_modules\\mongodb\\src\\collection.ts:294:12)\n' +
          '    at model.$__save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backe
nd\\node_modules\\mongoose\\lib\\model.js:398:16)\n' +
          '    at model.save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\
\node_modules\\mongoose\\lib\\model.js:609:5)\n' +
          '    at C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\\node_module
s\\mongoose\\lib\\model.js:2722:9\n' +
          '    at async Promise.all (index 0)\n' +
          '    at Function.create (C:\\Users\\Kristian\\Desktop\\barber-saas\\bac
kend\\node_modules\\mongoose\\lib\\model.js:2707:11)\n' +
          '    at MongoReservaRepository.save (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\src\\infrastructure\\database\\mongodb\\repositories\\MongoRese
rvaRepository.js:15:16)\n' +
          '    at TransactionManager.executeInTransaction.operationName (C:\\User
s\\Kristian\\Desktop\\barber-saas\\backend\\src\\application\\use-cases\\reservas
\\CreateReserva.js:72:42)\n' +
          '    at Function.executeInTransaction (C:\\Users\\Kristian\\Desktop\\ba
rber-saas\\backend\\src\\utils\\TransactionManager.js:57:32)\n' +
          '    at CreateReserva.execute (C:\\Users\\Kristian\\Desktop\\barber-saa
s\\backend\\src\\application\\use-cases\\reservas\\CreateReserva.js:26:34)\n' +
          '    at Object.<anonymous>.exports.crearReservaBySlug (C:\\Users\\Krist
ian\\Desktop\\barber-saas\\backend\\src\\controllers\\public.controller.js:140:25
)'
      }

    [0m [90m 80 |[39m
     [90m 81 |[39m                 [90m// Non-transient error or max retries 
reached[39m
    [31m[1m>[22m[39m[90m 82 |[39m                 
console[33m.[39merror([32m`[Transaction] Failed: 
${operationName}`[39m[33m,[39m {
     [90m    |[39m                         [31m[1m^[22m[39m
     [90m 83 |[39m                     error[33m:[39m 
error[33m.[39mmessage[33m,[39m
     [90m 84 |[39m                     attempt[33m:[39m attempt [33m+[39m 
[35m1[39m[33m,[39m
     [90m 85 |[39m                     stack[33m:[39m 
error[33m.[39mstack[0m

      at Function.error [as executeInTransaction] 
(src/utils/TransactionManager.js:82:25)
      at CreateReserva.execute 
(src/application/use-cases/reservas/CreateReserva.js:26:34)
      at Object.<anonymous>.exports.crearReservaBySlug 
(src/controllers/public.controller.js:140:25)

    console.log
      [Transaction] Aborted: CreateReservation

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:69:29)

    console.error
      [Transaction] Failed: CreateReservation {
        error: `E11000 duplicate key error collection: test.reservas index: 
unique_reservation_slot dup key: { barberoId: 
ObjectId('698be98b6a05e103eb47021b'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698be98b6a05e103eb470219') }`,
        attempt: 1,
        stack: `MongoServerError: E11000 duplicate key error collection: 
test.reservas index: unique_reservation_slot dup key: { barberoId: 
ObjectId('698be98b6a05e103eb47021b'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698be98b6a05e103eb470219') }\n` +
          '    at InsertOneOperation.handleOk (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\node_modules\\mongodb\\src\\operations\\insert.ts:79:13)\n' +
          '    at tryOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\backen
d\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:294:26)\n' +
          '    at processTicksAndRejections 
(node:internal/process/task_queues:105:5)\n' +
          '    at executeOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\ba
ckend\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:123:12)\n' +
          '    at Collection.insertOne (C:\\Users\\Kristian\\Desktop\\barber-saas
\\backend\\node_modules\\mongodb\\src\\collection.ts:294:12)\n' +
          '    at model.$__save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backe
nd\\node_modules\\mongoose\\lib\\model.js:398:16)\n' +
          '    at model.save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\
\node_modules\\mongoose\\lib\\model.js:609:5)\n' +
          '    at C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\\node_module
s\\mongoose\\lib\\model.js:2722:9\n' +
          '    at async Promise.all (index 0)\n' +
          '    at Function.create (C:\\Users\\Kristian\\Desktop\\barber-saas\\bac
kend\\node_modules\\mongoose\\lib\\model.js:2707:11)\n' +
          '    at MongoReservaRepository.save (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\src\\infrastructure\\database\\mongodb\\repositories\\MongoRese
rvaRepository.js:15:16)\n' +
          '    at TransactionManager.executeInTransaction.operationName (C:\\User
s\\Kristian\\Desktop\\barber-saas\\backend\\src\\application\\use-cases\\reservas
\\CreateReserva.js:72:42)\n' +
          '    at Function.executeInTransaction (C:\\Users\\Kristian\\Desktop\\ba
rber-saas\\backend\\src\\utils\\TransactionManager.js:57:32)\n' +
          '    at CreateReserva.execute (C:\\Users\\Kristian\\Desktop\\barber-saa
s\\backend\\src\\application\\use-cases\\reservas\\CreateReserva.js:26:34)\n' +
          '    at Object.<anonymous>.exports.crearReservaBySlug (C:\\Users\\Krist
ian\\Desktop\\barber-saas\\backend\\src\\controllers\\public.controller.js:140:25
)'
      }

    [0m [90m 80 |[39m
     [90m 81 |[39m                 [90m// Non-transient error or max retries 
reached[39m
    [31m[1m>[22m[39m[90m 82 |[39m                 
console[33m.[39merror([32m`[Transaction] Failed: 
${operationName}`[39m[33m,[39m {
     [90m    |[39m                         [31m[1m^[22m[39m
     [90m 83 |[39m                     error[33m:[39m 
error[33m.[39mmessage[33m,[39m
     [90m 84 |[39m                     attempt[33m:[39m attempt [33m+[39m 
[35m1[39m[33m,[39m
     [90m 85 |[39m                     stack[33m:[39m 
error[33m.[39mstack[0m

      at Function.error [as executeInTransaction] 
(src/utils/TransactionManager.js:82:25)
      at CreateReserva.execute 
(src/application/use-cases/reservas/CreateReserva.js:26:34)
      at Object.<anonymous>.exports.crearReservaBySlug 
(src/controllers/public.controller.js:140:25)

    console.log
      [Transaction] Aborted: CreateReservation

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:69:29)

    console.error
      [Transaction] Failed: CreateReservation {
        error: `E11000 duplicate key error collection: test.reservas index: 
unique_reservation_slot dup key: { barberoId: 
ObjectId('698be98b6a05e103eb47021b'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698be98b6a05e103eb470219') }`,
        attempt: 1,
        stack: `MongoServerError: E11000 duplicate key error collection: 
test.reservas index: unique_reservation_slot dup key: { barberoId: 
ObjectId('698be98b6a05e103eb47021b'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698be98b6a05e103eb470219') }\n` +
          '    at InsertOneOperation.handleOk (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\node_modules\\mongodb\\src\\operations\\insert.ts:79:13)\n' +
          '    at tryOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\backen
d\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:294:26)\n' +
          '    at processTicksAndRejections 
(node:internal/process/task_queues:105:5)\n' +
          '    at executeOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\ba
ckend\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:123:12)\n' +
          '    at Collection.insertOne (C:\\Users\\Kristian\\Desktop\\barber-saas
\\backend\\node_modules\\mongodb\\src\\collection.ts:294:12)\n' +
          '    at model.$__save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backe
nd\\node_modules\\mongoose\\lib\\model.js:398:16)\n' +
          '    at model.save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\
\node_modules\\mongoose\\lib\\model.js:609:5)\n' +
          '    at C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\\node_module
s\\mongoose\\lib\\model.js:2722:9\n' +
          '    at async Promise.all (index 0)\n' +
          '    at Function.create (C:\\Users\\Kristian\\Desktop\\barber-saas\\bac
kend\\node_modules\\mongoose\\lib\\model.js:2707:11)\n' +
          '    at MongoReservaRepository.save (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\src\\infrastructure\\database\\mongodb\\repositories\\MongoRese
rvaRepository.js:15:16)\n' +
          '    at TransactionManager.executeInTransaction.operationName (C:\\User
s\\Kristian\\Desktop\\barber-saas\\backend\\src\\application\\use-cases\\reservas
\\CreateReserva.js:72:42)\n' +
          '    at Function.executeInTransaction (C:\\Users\\Kristian\\Desktop\\ba
rber-saas\\backend\\src\\utils\\TransactionManager.js:57:32)\n' +
          '    at CreateReserva.execute (C:\\Users\\Kristian\\Desktop\\barber-saa
s\\backend\\src\\application\\use-cases\\reservas\\CreateReserva.js:26:34)\n' +
          '    at Object.<anonymous>.exports.crearReservaBySlug (C:\\Users\\Krist
ian\\Desktop\\barber-saas\\backend\\src\\controllers\\public.controller.js:140:25
)'
      }

    [0m [90m 80 |[39m
     [90m 81 |[39m                 [90m// Non-transient error or max retries 
reached[39m
    [31m[1m>[22m[39m[90m 82 |[39m                 
console[33m.[39merror([32m`[Transaction] Failed: 
${operationName}`[39m[33m,[39m {
     [90m    |[39m                         [31m[1m^[22m[39m
     [90m 83 |[39m                     error[33m:[39m 
error[33m.[39mmessage[33m,[39m
     [90m 84 |[39m                     attempt[33m:[39m attempt [33m+[39m 
[35m1[39m[33m,[39m
     [90m 85 |[39m                     stack[33m:[39m 
error[33m.[39mstack[0m

      at Function.error [as executeInTransaction] 
(src/utils/TransactionManager.js:82:25)
      at CreateReserva.execute 
(src/application/use-cases/reservas/CreateReserva.js:26:34)
      at Object.<anonymous>.exports.crearReservaBySlug 
(src/controllers/public.controller.js:140:25)

    console.error
      ƒö┤ ERROR: TransactionError: Transaction failed for CreateReservation: 
E11000 duplicate key error collection: test.reservas index: 
unique_reservation_slot dup key: { barberoId: 
ObjectId('698be98b6a05e103eb47021b'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698be98b6a05e103eb470219') }
          at Function.executeInTransaction (C:\Users\Kristian\Desktop\barber-saas
\backend\src\utils\TransactionManager.js:88:42)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at CreateReserva.execute (C:\Users\Kristian\Desktop\barber-saas\backend
\src\application\use-cases\reservas\CreateReserva.js:26:34)
          at Object.<anonymous>.exports.crearReservaBySlug (C:\Users\Kristian\Des
ktop\barber-saas\backend\src\controllers\public.controller.js:140:25) {
        isTransactionError: true,
        originalError: MongoServerError: E11000 duplicate key error collection: 
test.reservas index: unique_reservation_slot dup key: { barberoId: 
ObjectId('698be98b6a05e103eb47021b'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698be98b6a05e103eb470219') }
            at InsertOneOperation.handleOk (C:\Users\Kristian\Desktop\barber-saas
\backend\node_modules\mongodb\src\operations\insert.ts:79:13)
            at tryOperation (C:\Users\Kristian\Desktop\barber-saas\backend\node_m
odules\mongodb\src\operations\execute_operation.ts:294:26)
            at processTicksAndRejections 
(node:internal/process/task_queues:105:5)
            at executeOperation (C:\Users\Kristian\Desktop\barber-saas\backend\no
de_modules\mongodb\src\operations\execute_operation.ts:123:12)
            at Collection.insertOne (C:\Users\Kristian\Desktop\barber-saas\backen
d\node_modules\mongodb\src\collection.ts:294:12)
            at model.$__save (C:\Users\Kristian\Desktop\barber-saas\backend\node_
modules\mongoose\lib\model.js:398:16)
            at model.save (C:\Users\Kristian\Desktop\barber-saas\backend\node_mod
ules\mongoose\lib\model.js:609:5)
            at C:\Users\Kristian\Desktop\barber-saas\backend\node_modules\mongoos
e\lib\model.js:2722:9
            at async Promise.all (index 0)
            at Function.create (C:\Users\Kristian\Desktop\barber-saas\backend\nod
e_modules\mongoose\lib\model.js:2707:11)
            at MongoReservaRepository.save (C:\Users\Kristian\Desktop\barber-saas
\backend\src\infrastructure\database\mongodb\repositories\MongoReservaRepository.
js:15:16)
            at TransactionManager.executeInTransaction.operationName (C:\Users\Kr
istian\Desktop\barber-saas\backend\src\application\use-cases\reservas\CreateReser
va.js:72:42)
            at Function.executeInTransaction (C:\Users\Kristian\Desktop\barber-sa
as\backend\src\utils\TransactionManager.js:57:32)
            at CreateReserva.execute (C:\Users\Kristian\Desktop\barber-saas\backe
nd\src\application\use-cases\reservas\CreateReserva.js:26:34)
            at Object.<anonymous>.exports.crearReservaBySlug (C:\Users\Kristian\D
esktop\barber-saas\backend\src\controllers\public.controller.js:140:25) {
          errorLabelSet: Set(0) {},
          errorResponse: {
            index: 0,
            code: 11000,
            errmsg: `E11000 duplicate key error collection: test.reservas index: 
unique_reservation_slot dup key: { barberoId: 
ObjectId('698be98b6a05e103eb47021b'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698be98b6a05e103eb470219') }`,
            keyPattern: [Object],
            keyValue: [Object]
          },
          index: 0,
          code: 11000,
          keyPattern: { barberoId: 1, fecha: 1, hora: 1, barberiaId: 1 },
          keyValue: {
            barberoId: new ObjectId('698be98b6a05e103eb47021b'),
            fecha: 2026-03-16T00:00:00.000Z,
            hora: '14:00',
            barberiaId: new ObjectId('698be98b6a05e103eb470219')
          }
        },
        context: { operationName: 'CreateReservation', attempt: 1 },
        timestamp: 2026-02-11T02:29:32.699Z,
        originalStack: `MongoServerError: E11000 duplicate key error collection: 
test.reservas index: unique_reservation_slot dup key: { barberoId: 
ObjectId('698be98b6a05e103eb47021b'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698be98b6a05e103eb470219') }\n` +
          '    at InsertOneOperation.handleOk (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\node_modules\\mongodb\\src\\operations\\insert.ts:79:13)\n' +
          '    at tryOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\backen
d\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:294:26)\n' +
          '    at processTicksAndRejections 
(node:internal/process/task_queues:105:5)\n' +
          '    at executeOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\ba
ckend\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:123:12)\n' +
          '    at Collection.insertOne (C:\\Users\\Kristian\\Desktop\\barber-saas
\\backend\\node_modules\\mongodb\\src\\collection.ts:294:12)\n' +
          '    at model.$__save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backe
nd\\node_modules\\mongoose\\lib\\model.js:398:16)\n' +
          '    at model.save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\
\node_modules\\mongoose\\lib\\model.js:609:5)\n' +
          '    at C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\\node_module
s\\mongoose\\lib\\model.js:2722:9\n' +
          '    at async Promise.all (index 0)\n' +
          '    at Function.create (C:\\Users\\Kristian\\Desktop\\barber-saas\\bac
kend\\node_modules\\mongoose\\lib\\model.js:2707:11)\n' +
          '    at MongoReservaRepository.save (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\src\\infrastructure\\database\\mongodb\\repositories\\MongoRese
rvaRepository.js:15:16)\n' +
          '    at TransactionManager.executeInTransaction.operationName (C:\\User
s\\Kristian\\Desktop\\barber-saas\\backend\\src\\application\\use-cases\\reservas
\\CreateReserva.js:72:42)\n' +
          '    at Function.executeInTransaction (C:\\Users\\Kristian\\Desktop\\ba
rber-saas\\backend\\src\\utils\\TransactionManager.js:57:32)\n' +
          '    at CreateReserva.execute (C:\\Users\\Kristian\\Desktop\\barber-saa
s\\backend\\src\\application\\use-cases\\reservas\\CreateReserva.js:26:34)\n' +
          '    at Object.<anonymous>.exports.crearReservaBySlug (C:\\Users\\Krist
ian\\Desktop\\barber-saas\\backend\\src\\controllers\\public.controller.js:140:25
)'
      }

    [0m [90m 4 |[39m
     [90m 5 |[39m [36mconst[39m errorHandler [33m=[39m (err[33m,[39m 
req[33m,[39m res[33m,[39m next) [33m=>[39m {
    [31m[1m>[22m[39m[90m 6 |[39m   console[33m.[39merror([32m"ƒö┤ 
ERROR:"[39m[33m,[39m err)[33m;[39m
     [90m   |[39m           [31m[1m^[22m[39m
     [90m 7 |[39m
     [90m 8 |[39m   [90m// ­ƒöÑ A├æADIR HEADERS CORS SI NO EXISTEN[39m
     [90m 9 |[39m   [36mconst[39m origin [33m=[39m 
req[33m.[39mheaders[33m.[39morigin[33m;[39m[0m

      at error (src/config/middleware/errorHandler.js:6:11)
      at Layer.handleError (node_modules/router/lib/layer.js:116:17)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at Layer.handleError (node_modules/router/lib/layer.js:111:12)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at Immediate.next (node_modules/router/index.js:291:5)
      at Immediate._onImmediate (node_modules/router/index.js:688:15)

    console.error
      ƒö┤ ERROR: TransactionError: Transaction failed for CreateReservation: 
E11000 duplicate key error collection: test.reservas index: 
unique_reservation_slot dup key: { barberoId: 
ObjectId('698be98b6a05e103eb47021b'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698be98b6a05e103eb470219') }
          at Function.executeInTransaction (C:\Users\Kristian\Desktop\barber-saas
\backend\src\utils\TransactionManager.js:88:42)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at CreateReserva.execute (C:\Users\Kristian\Desktop\barber-saas\backend
\src\application\use-cases\reservas\CreateReserva.js:26:34)
          at Object.<anonymous>.exports.crearReservaBySlug (C:\Users\Kristian\Des
ktop\barber-saas\backend\src\controllers\public.controller.js:140:25) {
        isTransactionError: true,
        originalError: MongoServerError: E11000 duplicate key error collection: 
test.reservas index: unique_reservation_slot dup key: { barberoId: 
ObjectId('698be98b6a05e103eb47021b'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698be98b6a05e103eb470219') }
            at InsertOneOperation.handleOk (C:\Users\Kristian\Desktop\barber-saas
\backend\node_modules\mongodb\src\operations\insert.ts:79:13)
            at tryOperation (C:\Users\Kristian\Desktop\barber-saas\backend\node_m
odules\mongodb\src\operations\execute_operation.ts:294:26)
            at processTicksAndRejections 
(node:internal/process/task_queues:105:5)
            at executeOperation (C:\Users\Kristian\Desktop\barber-saas\backend\no
de_modules\mongodb\src\operations\execute_operation.ts:123:12)
            at Collection.insertOne (C:\Users\Kristian\Desktop\barber-saas\backen
d\node_modules\mongodb\src\collection.ts:294:12)
            at model.$__save (C:\Users\Kristian\Desktop\barber-saas\backend\node_
modules\mongoose\lib\model.js:398:16)
            at model.save (C:\Users\Kristian\Desktop\barber-saas\backend\node_mod
ules\mongoose\lib\model.js:609:5)
            at C:\Users\Kristian\Desktop\barber-saas\backend\node_modules\mongoos
e\lib\model.js:2722:9
            at async Promise.all (index 0)
            at Function.create (C:\Users\Kristian\Desktop\barber-saas\backend\nod
e_modules\mongoose\lib\model.js:2707:11)
            at MongoReservaRepository.save (C:\Users\Kristian\Desktop\barber-saas
\backend\src\infrastructure\database\mongodb\repositories\MongoReservaRepository.
js:15:16)
            at TransactionManager.executeInTransaction.operationName (C:\Users\Kr
istian\Desktop\barber-saas\backend\src\application\use-cases\reservas\CreateReser
va.js:72:42)
            at Function.executeInTransaction (C:\Users\Kristian\Desktop\barber-sa
as\backend\src\utils\TransactionManager.js:57:32)
            at CreateReserva.execute (C:\Users\Kristian\Desktop\barber-saas\backe
nd\src\application\use-cases\reservas\CreateReserva.js:26:34)
            at Object.<anonymous>.exports.crearReservaBySlug (C:\Users\Kristian\D
esktop\barber-saas\backend\src\controllers\public.controller.js:140:25) {
          errorLabelSet: Set(0) {},
          errorResponse: {
            index: 0,
            code: 11000,
            errmsg: `E11000 duplicate key error collection: test.reservas index: 
unique_reservation_slot dup key: { barberoId: 
ObjectId('698be98b6a05e103eb47021b'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698be98b6a05e103eb470219') }`,
            keyPattern: [Object],
            keyValue: [Object]
          },
          index: 0,
          code: 11000,
          keyPattern: { barberoId: 1, fecha: 1, hora: 1, barberiaId: 1 },
          keyValue: {
            barberoId: new ObjectId('698be98b6a05e103eb47021b'),
            fecha: 2026-03-16T00:00:00.000Z,
            hora: '14:00',
            barberiaId: new ObjectId('698be98b6a05e103eb470219')
          }
        },
        context: { operationName: 'CreateReservation', attempt: 1 },
        timestamp: 2026-02-11T02:29:32.702Z,
        originalStack: `MongoServerError: E11000 duplicate key error collection: 
test.reservas index: unique_reservation_slot dup key: { barberoId: 
ObjectId('698be98b6a05e103eb47021b'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698be98b6a05e103eb470219') }\n` +
          '    at InsertOneOperation.handleOk (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\node_modules\\mongodb\\src\\operations\\insert.ts:79:13)\n' +
          '    at tryOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\backen
d\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:294:26)\n' +
          '    at processTicksAndRejections 
(node:internal/process/task_queues:105:5)\n' +
          '    at executeOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\ba
ckend\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:123:12)\n' +
          '    at Collection.insertOne (C:\\Users\\Kristian\\Desktop\\barber-saas
\\backend\\node_modules\\mongodb\\src\\collection.ts:294:12)\n' +
          '    at model.$__save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backe
nd\\node_modules\\mongoose\\lib\\model.js:398:16)\n' +
          '    at model.save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\
\node_modules\\mongoose\\lib\\model.js:609:5)\n' +
          '    at C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\\node_module
s\\mongoose\\lib\\model.js:2722:9\n' +
          '    at async Promise.all (index 0)\n' +
          '    at Function.create (C:\\Users\\Kristian\\Desktop\\barber-saas\\bac
kend\\node_modules\\mongoose\\lib\\model.js:2707:11)\n' +
          '    at MongoReservaRepository.save (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\src\\infrastructure\\database\\mongodb\\repositories\\MongoRese
rvaRepository.js:15:16)\n' +
          '    at TransactionManager.executeInTransaction.operationName (C:\\User
s\\Kristian\\Desktop\\barber-saas\\backend\\src\\application\\use-cases\\reservas
\\CreateReserva.js:72:42)\n' +
          '    at Function.executeInTransaction (C:\\Users\\Kristian\\Desktop\\ba
rber-saas\\backend\\src\\utils\\TransactionManager.js:57:32)\n' +
          '    at CreateReserva.execute (C:\\Users\\Kristian\\Desktop\\barber-saa
s\\backend\\src\\application\\use-cases\\reservas\\CreateReserva.js:26:34)\n' +
          '    at Object.<anonymous>.exports.crearReservaBySlug (C:\\Users\\Krist
ian\\Desktop\\barber-saas\\backend\\src\\controllers\\public.controller.js:140:25
)'
      }

    [0m [90m 4 |[39m
     [90m 5 |[39m [36mconst[39m errorHandler [33m=[39m (err[33m,[39m 
req[33m,[39m res[33m,[39m next) [33m=>[39m {
    [31m[1m>[22m[39m[90m 6 |[39m   console[33m.[39merror([32m"ƒö┤ 
ERROR:"[39m[33m,[39m err)[33m;[39m
     [90m   |[39m           [31m[1m^[22m[39m
     [90m 7 |[39m
     [90m 8 |[39m   [90m// ­ƒöÑ A├æADIR HEADERS CORS SI NO EXISTEN[39m
     [90m 9 |[39m   [36mconst[39m origin [33m=[39m 
req[33m.[39mheaders[33m.[39morigin[33m;[39m[0m

      at error (src/config/middleware/errorHandler.js:6:11)
      at Layer.handleError (node_modules/router/lib/layer.js:116:17)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at Layer.handleError (node_modules/router/lib/layer.js:111:12)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at Immediate.next (node_modules/router/index.js:291:5)
      at Immediate._onImmediate (node_modules/router/index.js:688:15)

    console.error
      ƒö┤ ERROR: TransactionError: Transaction failed for CreateReservation: 
E11000 duplicate key error collection: test.reservas index: 
unique_reservation_slot dup key: { barberoId: 
ObjectId('698be98b6a05e103eb47021b'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698be98b6a05e103eb470219') }
          at Function.executeInTransaction (C:\Users\Kristian\Desktop\barber-saas
\backend\src\utils\TransactionManager.js:88:42)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at CreateReserva.execute (C:\Users\Kristian\Desktop\barber-saas\backend
\src\application\use-cases\reservas\CreateReserva.js:26:34)
          at Object.<anonymous>.exports.crearReservaBySlug (C:\Users\Kristian\Des
ktop\barber-saas\backend\src\controllers\public.controller.js:140:25) {
        isTransactionError: true,
        originalError: MongoServerError: E11000 duplicate key error collection: 
test.reservas index: unique_reservation_slot dup key: { barberoId: 
ObjectId('698be98b6a05e103eb47021b'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698be98b6a05e103eb470219') }
            at InsertOneOperation.handleOk (C:\Users\Kristian\Desktop\barber-saas
\backend\node_modules\mongodb\src\operations\insert.ts:79:13)
            at tryOperation (C:\Users\Kristian\Desktop\barber-saas\backend\node_m
odules\mongodb\src\operations\execute_operation.ts:294:26)
            at processTicksAndRejections 
(node:internal/process/task_queues:105:5)
            at executeOperation (C:\Users\Kristian\Desktop\barber-saas\backend\no
de_modules\mongodb\src\operations\execute_operation.ts:123:12)
            at Collection.insertOne (C:\Users\Kristian\Desktop\barber-saas\backen
d\node_modules\mongodb\src\collection.ts:294:12)
            at model.$__save (C:\Users\Kristian\Desktop\barber-saas\backend\node_
modules\mongoose\lib\model.js:398:16)
            at model.save (C:\Users\Kristian\Desktop\barber-saas\backend\node_mod
ules\mongoose\lib\model.js:609:5)
            at C:\Users\Kristian\Desktop\barber-saas\backend\node_modules\mongoos
e\lib\model.js:2722:9
            at async Promise.all (index 0)
            at Function.create (C:\Users\Kristian\Desktop\barber-saas\backend\nod
e_modules\mongoose\lib\model.js:2707:11)
            at MongoReservaRepository.save (C:\Users\Kristian\Desktop\barber-saas
\backend\src\infrastructure\database\mongodb\repositories\MongoReservaRepository.
js:15:16)
            at TransactionManager.executeInTransaction.operationName (C:\Users\Kr
istian\Desktop\barber-saas\backend\src\application\use-cases\reservas\CreateReser
va.js:72:42)
            at Function.executeInTransaction (C:\Users\Kristian\Desktop\barber-sa
as\backend\src\utils\TransactionManager.js:57:32)
            at CreateReserva.execute (C:\Users\Kristian\Desktop\barber-saas\backe
nd\src\application\use-cases\reservas\CreateReserva.js:26:34)
            at Object.<anonymous>.exports.crearReservaBySlug (C:\Users\Kristian\D
esktop\barber-saas\backend\src\controllers\public.controller.js:140:25) {
          errorLabelSet: Set(0) {},
          errorResponse: {
            index: 0,
            code: 11000,
            errmsg: `E11000 duplicate key error collection: test.reservas index: 
unique_reservation_slot dup key: { barberoId: 
ObjectId('698be98b6a05e103eb47021b'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698be98b6a05e103eb470219') }`,
            keyPattern: [Object],
            keyValue: [Object]
          },
          index: 0,
          code: 11000,
          keyPattern: { barberoId: 1, fecha: 1, hora: 1, barberiaId: 1 },
          keyValue: {
            barberoId: new ObjectId('698be98b6a05e103eb47021b'),
            fecha: 2026-03-16T00:00:00.000Z,
            hora: '14:00',
            barberiaId: new ObjectId('698be98b6a05e103eb470219')
          }
        },
        context: { operationName: 'CreateReservation', attempt: 1 },
        timestamp: 2026-02-11T02:29:32.706Z,
        originalStack: `MongoServerError: E11000 duplicate key error collection: 
test.reservas index: unique_reservation_slot dup key: { barberoId: 
ObjectId('698be98b6a05e103eb47021b'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698be98b6a05e103eb470219') }\n` +
          '    at InsertOneOperation.handleOk (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\node_modules\\mongodb\\src\\operations\\insert.ts:79:13)\n' +
          '    at tryOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\backen
d\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:294:26)\n' +
          '    at processTicksAndRejections 
(node:internal/process/task_queues:105:5)\n' +
          '    at executeOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\ba
ckend\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:123:12)\n' +
          '    at Collection.insertOne (C:\\Users\\Kristian\\Desktop\\barber-saas
\\backend\\node_modules\\mongodb\\src\\collection.ts:294:12)\n' +
          '    at model.$__save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backe
nd\\node_modules\\mongoose\\lib\\model.js:398:16)\n' +
          '    at model.save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\
\node_modules\\mongoose\\lib\\model.js:609:5)\n' +
          '    at C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\\node_module
s\\mongoose\\lib\\model.js:2722:9\n' +
          '    at async Promise.all (index 0)\n' +
          '    at Function.create (C:\\Users\\Kristian\\Desktop\\barber-saas\\bac
kend\\node_modules\\mongoose\\lib\\model.js:2707:11)\n' +
          '    at MongoReservaRepository.save (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\src\\infrastructure\\database\\mongodb\\repositories\\MongoRese
rvaRepository.js:15:16)\n' +
          '    at TransactionManager.executeInTransaction.operationName (C:\\User
s\\Kristian\\Desktop\\barber-saas\\backend\\src\\application\\use-cases\\reservas
\\CreateReserva.js:72:42)\n' +
          '    at Function.executeInTransaction (C:\\Users\\Kristian\\Desktop\\ba
rber-saas\\backend\\src\\utils\\TransactionManager.js:57:32)\n' +
          '    at CreateReserva.execute (C:\\Users\\Kristian\\Desktop\\barber-saa
s\\backend\\src\\application\\use-cases\\reservas\\CreateReserva.js:26:34)\n' +
          '    at Object.<anonymous>.exports.crearReservaBySlug (C:\\Users\\Krist
ian\\Desktop\\barber-saas\\backend\\src\\controllers\\public.controller.js:140:25
)'
      }

    [0m [90m 4 |[39m
     [90m 5 |[39m [36mconst[39m errorHandler [33m=[39m (err[33m,[39m 
req[33m,[39m res[33m,[39m next) [33m=>[39m {
    [31m[1m>[22m[39m[90m 6 |[39m   console[33m.[39merror([32m"ƒö┤ 
ERROR:"[39m[33m,[39m err)[33m;[39m
     [90m   |[39m           [31m[1m^[22m[39m
     [90m 7 |[39m
     [90m 8 |[39m   [90m// ­ƒöÑ A├æADIR HEADERS CORS SI NO EXISTEN[39m
     [90m 9 |[39m   [36mconst[39m origin [33m=[39m 
req[33m.[39mheaders[33m.[39morigin[33m;[39m[0m

      at error (src/config/middleware/errorHandler.js:6:11)
      at Layer.handleError (node_modules/router/lib/layer.js:116:17)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at Layer.handleError (node_modules/router/lib/layer.js:111:12)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at Immediate.next (node_modules/router/index.js:291:5)
      at Immediate._onImmediate (node_modules/router/index.js:688:15)

    console.error
      ƒö┤ ERROR: TransactionError: Transaction failed for CreateReservation: 
E11000 duplicate key error collection: test.reservas index: 
unique_reservation_slot dup key: { barberoId: 
ObjectId('698be98b6a05e103eb47021b'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698be98b6a05e103eb470219') }
          at Function.executeInTransaction (C:\Users\Kristian\Desktop\barber-saas
\backend\src\utils\TransactionManager.js:88:42)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at CreateReserva.execute (C:\Users\Kristian\Desktop\barber-saas\backend
\src\application\use-cases\reservas\CreateReserva.js:26:34)
          at Object.<anonymous>.exports.crearReservaBySlug (C:\Users\Kristian\Des
ktop\barber-saas\backend\src\controllers\public.controller.js:140:25) {
        isTransactionError: true,
        originalError: MongoServerError: E11000 duplicate key error collection: 
test.reservas index: unique_reservation_slot dup key: { barberoId: 
ObjectId('698be98b6a05e103eb47021b'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698be98b6a05e103eb470219') }
            at InsertOneOperation.handleOk (C:\Users\Kristian\Desktop\barber-saas
\backend\node_modules\mongodb\src\operations\insert.ts:79:13)
            at tryOperation (C:\Users\Kristian\Desktop\barber-saas\backend\node_m
odules\mongodb\src\operations\execute_operation.ts:294:26)
            at processTicksAndRejections 
(node:internal/process/task_queues:105:5)
            at executeOperation (C:\Users\Kristian\Desktop\barber-saas\backend\no
de_modules\mongodb\src\operations\execute_operation.ts:123:12)
            at Collection.insertOne (C:\Users\Kristian\Desktop\barber-saas\backen
d\node_modules\mongodb\src\collection.ts:294:12)
            at model.$__save (C:\Users\Kristian\Desktop\barber-saas\backend\node_
modules\mongoose\lib\model.js:398:16)
            at model.save (C:\Users\Kristian\Desktop\barber-saas\backend\node_mod
ules\mongoose\lib\model.js:609:5)
            at C:\Users\Kristian\Desktop\barber-saas\backend\node_modules\mongoos
e\lib\model.js:2722:9
            at async Promise.all (index 0)
            at Function.create (C:\Users\Kristian\Desktop\barber-saas\backend\nod
e_modules\mongoose\lib\model.js:2707:11)
            at MongoReservaRepository.save (C:\Users\Kristian\Desktop\barber-saas
\backend\src\infrastructure\database\mongodb\repositories\MongoReservaRepository.
js:15:16)
            at TransactionManager.executeInTransaction.operationName (C:\Users\Kr
istian\Desktop\barber-saas\backend\src\application\use-cases\reservas\CreateReser
va.js:72:42)
            at Function.executeInTransaction (C:\Users\Kristian\Desktop\barber-sa
as\backend\src\utils\TransactionManager.js:57:32)
            at CreateReserva.execute (C:\Users\Kristian\Desktop\barber-saas\backe
nd\src\application\use-cases\reservas\CreateReserva.js:26:34)
            at Object.<anonymous>.exports.crearReservaBySlug (C:\Users\Kristian\D
esktop\barber-saas\backend\src\controllers\public.controller.js:140:25) {
          errorLabelSet: Set(0) {},
          errorResponse: {
            index: 0,
            code: 11000,
            errmsg: `E11000 duplicate key error collection: test.reservas index: 
unique_reservation_slot dup key: { barberoId: 
ObjectId('698be98b6a05e103eb47021b'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698be98b6a05e103eb470219') }`,
            keyPattern: [Object],
            keyValue: [Object]
          },
          index: 0,
          code: 11000,
          keyPattern: { barberoId: 1, fecha: 1, hora: 1, barberiaId: 1 },
          keyValue: {
            barberoId: new ObjectId('698be98b6a05e103eb47021b'),
            fecha: 2026-03-16T00:00:00.000Z,
            hora: '14:00',
            barberiaId: new ObjectId('698be98b6a05e103eb470219')
          }
        },
        context: { operationName: 'CreateReservation', attempt: 1 },
        timestamp: 2026-02-11T02:29:32.712Z,
        originalStack: `MongoServerError: E11000 duplicate key error collection: 
test.reservas index: unique_reservation_slot dup key: { barberoId: 
ObjectId('698be98b6a05e103eb47021b'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698be98b6a05e103eb470219') }\n` +
          '    at InsertOneOperation.handleOk (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\node_modules\\mongodb\\src\\operations\\insert.ts:79:13)\n' +
          '    at tryOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\backen
d\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:294:26)\n' +
          '    at processTicksAndRejections 
(node:internal/process/task_queues:105:5)\n' +
          '    at executeOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\ba
ckend\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:123:12)\n' +
          '    at Collection.insertOne (C:\\Users\\Kristian\\Desktop\\barber-saas
\\backend\\node_modules\\mongodb\\src\\collection.ts:294:12)\n' +
          '    at model.$__save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backe
nd\\node_modules\\mongoose\\lib\\model.js:398:16)\n' +
          '    at model.save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\
\node_modules\\mongoose\\lib\\model.js:609:5)\n' +
          '    at C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\\node_module
s\\mongoose\\lib\\model.js:2722:9\n' +
          '    at async Promise.all (index 0)\n' +
          '    at Function.create (C:\\Users\\Kristian\\Desktop\\barber-saas\\bac
kend\\node_modules\\mongoose\\lib\\model.js:2707:11)\n' +
          '    at MongoReservaRepository.save (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\src\\infrastructure\\database\\mongodb\\repositories\\MongoRese
rvaRepository.js:15:16)\n' +
          '    at TransactionManager.executeInTransaction.operationName (C:\\User
s\\Kristian\\Desktop\\barber-saas\\backend\\src\\application\\use-cases\\reservas
\\CreateReserva.js:72:42)\n' +
          '    at Function.executeInTransaction (C:\\Users\\Kristian\\Desktop\\ba
rber-saas\\backend\\src\\utils\\TransactionManager.js:57:32)\n' +
          '    at CreateReserva.execute (C:\\Users\\Kristian\\Desktop\\barber-saa
s\\backend\\src\\application\\use-cases\\reservas\\CreateReserva.js:26:34)\n' +
          '    at Object.<anonymous>.exports.crearReservaBySlug (C:\\Users\\Krist
ian\\Desktop\\barber-saas\\backend\\src\\controllers\\public.controller.js:140:25
)'
      }

    [0m [90m 4 |[39m
     [90m 5 |[39m [36mconst[39m errorHandler [33m=[39m (err[33m,[39m 
req[33m,[39m res[33m,[39m next) [33m=>[39m {
    [31m[1m>[22m[39m[90m 6 |[39m   console[33m.[39merror([32m"ƒö┤ 
ERROR:"[39m[33m,[39m err)[33m;[39m
     [90m   |[39m           [31m[1m^[22m[39m
     [90m 7 |[39m
     [90m 8 |[39m   [90m// ­ƒöÑ A├æADIR HEADERS CORS SI NO EXISTEN[39m
     [90m 9 |[39m   [36mconst[39m origin [33m=[39m 
req[33m.[39mheaders[33m.[39morigin[33m;[39m[0m

      at error (src/config/middleware/errorHandler.js:6:11)
      at Layer.handleError (node_modules/router/lib/layer.js:116:17)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at Layer.handleError (node_modules/router/lib/layer.js:111:12)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at Immediate.next (node_modules/router/index.js:291:5)
      at Immediate._onImmediate (node_modules/router/index.js:688:15)

    console.error
      ƒö┤ ERROR: TransactionError: Transaction failed for CreateReservation: 
E11000 duplicate key error collection: test.reservas index: 
unique_reservation_slot dup key: { barberoId: 
ObjectId('698be98b6a05e103eb47021b'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698be98b6a05e103eb470219') }
          at Function.executeInTransaction (C:\Users\Kristian\Desktop\barber-saas
\backend\src\utils\TransactionManager.js:88:42)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at CreateReserva.execute (C:\Users\Kristian\Desktop\barber-saas\backend
\src\application\use-cases\reservas\CreateReserva.js:26:34)
          at Object.<anonymous>.exports.crearReservaBySlug (C:\Users\Kristian\Des
ktop\barber-saas\backend\src\controllers\public.controller.js:140:25) {
        isTransactionError: true,
        originalError: MongoServerError: E11000 duplicate key error collection: 
test.reservas index: unique_reservation_slot dup key: { barberoId: 
ObjectId('698be98b6a05e103eb47021b'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698be98b6a05e103eb470219') }
            at InsertOneOperation.handleOk (C:\Users\Kristian\Desktop\barber-saas
\backend\node_modules\mongodb\src\operations\insert.ts:79:13)
            at tryOperation (C:\Users\Kristian\Desktop\barber-saas\backend\node_m
odules\mongodb\src\operations\execute_operation.ts:294:26)
            at processTicksAndRejections 
(node:internal/process/task_queues:105:5)
            at executeOperation (C:\Users\Kristian\Desktop\barber-saas\backend\no
de_modules\mongodb\src\operations\execute_operation.ts:123:12)
            at Collection.insertOne (C:\Users\Kristian\Desktop\barber-saas\backen
d\node_modules\mongodb\src\collection.ts:294:12)
            at model.$__save (C:\Users\Kristian\Desktop\barber-saas\backend\node_
modules\mongoose\lib\model.js:398:16)
            at model.save (C:\Users\Kristian\Desktop\barber-saas\backend\node_mod
ules\mongoose\lib\model.js:609:5)
            at C:\Users\Kristian\Desktop\barber-saas\backend\node_modules\mongoos
e\lib\model.js:2722:9
            at async Promise.all (index 0)
            at Function.create (C:\Users\Kristian\Desktop\barber-saas\backend\nod
e_modules\mongoose\lib\model.js:2707:11)
            at MongoReservaRepository.save (C:\Users\Kristian\Desktop\barber-saas
\backend\src\infrastructure\database\mongodb\repositories\MongoReservaRepository.
js:15:16)
            at TransactionManager.executeInTransaction.operationName (C:\Users\Kr
istian\Desktop\barber-saas\backend\src\application\use-cases\reservas\CreateReser
va.js:72:42)
            at Function.executeInTransaction (C:\Users\Kristian\Desktop\barber-sa
as\backend\src\utils\TransactionManager.js:57:32)
            at CreateReserva.execute (C:\Users\Kristian\Desktop\barber-saas\backe
nd\src\application\use-cases\reservas\CreateReserva.js:26:34)
            at Object.<anonymous>.exports.crearReservaBySlug (C:\Users\Kristian\D
esktop\barber-saas\backend\src\controllers\public.controller.js:140:25) {
          errorLabelSet: Set(0) {},
          errorResponse: {
            index: 0,
            code: 11000,
            errmsg: `E11000 duplicate key error collection: test.reservas index: 
unique_reservation_slot dup key: { barberoId: 
ObjectId('698be98b6a05e103eb47021b'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698be98b6a05e103eb470219') }`,
            keyPattern: [Object],
            keyValue: [Object]
          },
          index: 0,
          code: 11000,
          keyPattern: { barberoId: 1, fecha: 1, hora: 1, barberiaId: 1 },
          keyValue: {
            barberoId: new ObjectId('698be98b6a05e103eb47021b'),
            fecha: 2026-03-16T00:00:00.000Z,
            hora: '14:00',
            barberiaId: new ObjectId('698be98b6a05e103eb470219')
          }
        },
        context: { operationName: 'CreateReservation', attempt: 1 },
        timestamp: 2026-02-11T02:29:32.714Z,
        originalStack: `MongoServerError: E11000 duplicate key error collection: 
test.reservas index: unique_reservation_slot dup key: { barberoId: 
ObjectId('698be98b6a05e103eb47021b'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698be98b6a05e103eb470219') }\n` +
          '    at InsertOneOperation.handleOk (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\node_modules\\mongodb\\src\\operations\\insert.ts:79:13)\n' +
          '    at tryOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\backen
d\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:294:26)\n' +
          '    at processTicksAndRejections 
(node:internal/process/task_queues:105:5)\n' +
          '    at executeOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\ba
ckend\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:123:12)\n' +
          '    at Collection.insertOne (C:\\Users\\Kristian\\Desktop\\barber-saas
\\backend\\node_modules\\mongodb\\src\\collection.ts:294:12)\n' +
          '    at model.$__save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backe
nd\\node_modules\\mongoose\\lib\\model.js:398:16)\n' +
          '    at model.save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\
\node_modules\\mongoose\\lib\\model.js:609:5)\n' +
          '    at C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\\node_module
s\\mongoose\\lib\\model.js:2722:9\n' +
          '    at async Promise.all (index 0)\n' +
          '    at Function.create (C:\\Users\\Kristian\\Desktop\\barber-saas\\bac
kend\\node_modules\\mongoose\\lib\\model.js:2707:11)\n' +
          '    at MongoReservaRepository.save (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\src\\infrastructure\\database\\mongodb\\repositories\\MongoRese
rvaRepository.js:15:16)\n' +
          '    at TransactionManager.executeInTransaction.operationName (C:\\User
s\\Kristian\\Desktop\\barber-saas\\backend\\src\\application\\use-cases\\reservas
\\CreateReserva.js:72:42)\n' +
          '    at Function.executeInTransaction (C:\\Users\\Kristian\\Desktop\\ba
rber-saas\\backend\\src\\utils\\TransactionManager.js:57:32)\n' +
          '    at CreateReserva.execute (C:\\Users\\Kristian\\Desktop\\barber-saa
s\\backend\\src\\application\\use-cases\\reservas\\CreateReserva.js:26:34)\n' +
          '    at Object.<anonymous>.exports.crearReservaBySlug (C:\\Users\\Krist
ian\\Desktop\\barber-saas\\backend\\src\\controllers\\public.controller.js:140:25
)'
      }

    [0m [90m 4 |[39m
     [90m 5 |[39m [36mconst[39m errorHandler [33m=[39m (err[33m,[39m 
req[33m,[39m res[33m,[39m next) [33m=>[39m {
    [31m[1m>[22m[39m[90m 6 |[39m   console[33m.[39merror([32m"ƒö┤ 
ERROR:"[39m[33m,[39m err)[33m;[39m
     [90m   |[39m           [31m[1m^[22m[39m
     [90m 7 |[39m
     [90m 8 |[39m   [90m// ­ƒöÑ A├æADIR HEADERS CORS SI NO EXISTEN[39m
     [90m 9 |[39m   [36mconst[39m origin [33m=[39m 
req[33m.[39mheaders[33m.[39morigin[33m;[39m[0m

      at error (src/config/middleware/errorHandler.js:6:11)
      at Layer.handleError (node_modules/router/lib/layer.js:116:17)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at Layer.handleError (node_modules/router/lib/layer.js:111:12)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at Immediate.next (node_modules/router/index.js:291:5)
      at Immediate._onImmediate (node_modules/router/index.js:688:15)

    console.error
      ƒö┤ ERROR: TransactionError: Transaction failed for CreateReservation: 
E11000 duplicate key error collection: test.reservas index: 
unique_reservation_slot dup key: { barberoId: 
ObjectId('698be98b6a05e103eb47021b'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698be98b6a05e103eb470219') }
          at Function.executeInTransaction (C:\Users\Kristian\Desktop\barber-saas
\backend\src\utils\TransactionManager.js:88:42)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at CreateReserva.execute (C:\Users\Kristian\Desktop\barber-saas\backend
\src\application\use-cases\reservas\CreateReserva.js:26:34)
          at Object.<anonymous>.exports.crearReservaBySlug (C:\Users\Kristian\Des
ktop\barber-saas\backend\src\controllers\public.controller.js:140:25) {
        isTransactionError: true,
        originalError: MongoServerError: E11000 duplicate key error collection: 
test.reservas index: unique_reservation_slot dup key: { barberoId: 
ObjectId('698be98b6a05e103eb47021b'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698be98b6a05e103eb470219') }
            at InsertOneOperation.handleOk (C:\Users\Kristian\Desktop\barber-saas
\backend\node_modules\mongodb\src\operations\insert.ts:79:13)
            at tryOperation (C:\Users\Kristian\Desktop\barber-saas\backend\node_m
odules\mongodb\src\operations\execute_operation.ts:294:26)
            at processTicksAndRejections 
(node:internal/process/task_queues:105:5)
            at executeOperation (C:\Users\Kristian\Desktop\barber-saas\backend\no
de_modules\mongodb\src\operations\execute_operation.ts:123:12)
            at Collection.insertOne (C:\Users\Kristian\Desktop\barber-saas\backen
d\node_modules\mongodb\src\collection.ts:294:12)
            at model.$__save (C:\Users\Kristian\Desktop\barber-saas\backend\node_
modules\mongoose\lib\model.js:398:16)
            at model.save (C:\Users\Kristian\Desktop\barber-saas\backend\node_mod
ules\mongoose\lib\model.js:609:5)
            at C:\Users\Kristian\Desktop\barber-saas\backend\node_modules\mongoos
e\lib\model.js:2722:9
            at async Promise.all (index 0)
            at Function.create (C:\Users\Kristian\Desktop\barber-saas\backend\nod
e_modules\mongoose\lib\model.js:2707:11)
            at MongoReservaRepository.save (C:\Users\Kristian\Desktop\barber-saas
\backend\src\infrastructure\database\mongodb\repositories\MongoReservaRepository.
js:15:16)
            at TransactionManager.executeInTransaction.operationName (C:\Users\Kr
istian\Desktop\barber-saas\backend\src\application\use-cases\reservas\CreateReser
va.js:72:42)
            at Function.executeInTransaction (C:\Users\Kristian\Desktop\barber-sa
as\backend\src\utils\TransactionManager.js:57:32)
            at CreateReserva.execute (C:\Users\Kristian\Desktop\barber-saas\backe
nd\src\application\use-cases\reservas\CreateReserva.js:26:34)
            at Object.<anonymous>.exports.crearReservaBySlug (C:\Users\Kristian\D
esktop\barber-saas\backend\src\controllers\public.controller.js:140:25) {
          errorLabelSet: Set(0) {},
          errorResponse: {
            index: 0,
            code: 11000,
            errmsg: `E11000 duplicate key error collection: test.reservas index: 
unique_reservation_slot dup key: { barberoId: 
ObjectId('698be98b6a05e103eb47021b'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698be98b6a05e103eb470219') }`,
            keyPattern: [Object],
            keyValue: [Object]
          },
          index: 0,
          code: 11000,
          keyPattern: { barberoId: 1, fecha: 1, hora: 1, barberiaId: 1 },
          keyValue: {
            barberoId: new ObjectId('698be98b6a05e103eb47021b'),
            fecha: 2026-03-16T00:00:00.000Z,
            hora: '14:00',
            barberiaId: new ObjectId('698be98b6a05e103eb470219')
          }
        },
        context: { operationName: 'CreateReservation', attempt: 1 },
        timestamp: 2026-02-11T02:29:32.721Z,
        originalStack: `MongoServerError: E11000 duplicate key error collection: 
test.reservas index: unique_reservation_slot dup key: { barberoId: 
ObjectId('698be98b6a05e103eb47021b'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698be98b6a05e103eb470219') }\n` +
          '    at InsertOneOperation.handleOk (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\node_modules\\mongodb\\src\\operations\\insert.ts:79:13)\n' +
          '    at tryOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\backen
d\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:294:26)\n' +
          '    at processTicksAndRejections 
(node:internal/process/task_queues:105:5)\n' +
          '    at executeOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\ba
ckend\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:123:12)\n' +
          '    at Collection.insertOne (C:\\Users\\Kristian\\Desktop\\barber-saas
\\backend\\node_modules\\mongodb\\src\\collection.ts:294:12)\n' +
          '    at model.$__save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backe
nd\\node_modules\\mongoose\\lib\\model.js:398:16)\n' +
          '    at model.save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\
\node_modules\\mongoose\\lib\\model.js:609:5)\n' +
          '    at C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\\node_module
s\\mongoose\\lib\\model.js:2722:9\n' +
          '    at async Promise.all (index 0)\n' +
          '    at Function.create (C:\\Users\\Kristian\\Desktop\\barber-saas\\bac
kend\\node_modules\\mongoose\\lib\\model.js:2707:11)\n' +
          '    at MongoReservaRepository.save (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\src\\infrastructure\\database\\mongodb\\repositories\\MongoRese
rvaRepository.js:15:16)\n' +
          '    at TransactionManager.executeInTransaction.operationName (C:\\User
s\\Kristian\\Desktop\\barber-saas\\backend\\src\\application\\use-cases\\reservas
\\CreateReserva.js:72:42)\n' +
          '    at Function.executeInTransaction (C:\\Users\\Kristian\\Desktop\\ba
rber-saas\\backend\\src\\utils\\TransactionManager.js:57:32)\n' +
          '    at CreateReserva.execute (C:\\Users\\Kristian\\Desktop\\barber-saa
s\\backend\\src\\application\\use-cases\\reservas\\CreateReserva.js:26:34)\n' +
          '    at Object.<anonymous>.exports.crearReservaBySlug (C:\\Users\\Krist
ian\\Desktop\\barber-saas\\backend\\src\\controllers\\public.controller.js:140:25
)'
      }

    [0m [90m 4 |[39m
     [90m 5 |[39m [36mconst[39m errorHandler [33m=[39m (err[33m,[39m 
req[33m,[39m res[33m,[39m next) [33m=>[39m {
    [31m[1m>[22m[39m[90m 6 |[39m   console[33m.[39merror([32m"ƒö┤ 
ERROR:"[39m[33m,[39m err)[33m;[39m
     [90m   |[39m           [31m[1m^[22m[39m
     [90m 7 |[39m
     [90m 8 |[39m   [90m// ­ƒöÑ A├æADIR HEADERS CORS SI NO EXISTEN[39m
     [90m 9 |[39m   [36mconst[39m origin [33m=[39m 
req[33m.[39mheaders[33m.[39morigin[33m;[39m[0m

      at error (src/config/middleware/errorHandler.js:6:11)
      at Layer.handleError (node_modules/router/lib/layer.js:116:17)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at Layer.handleError (node_modules/router/lib/layer.js:111:12)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at Immediate.next (node_modules/router/index.js:291:5)
      at Immediate._onImmediate (node_modules/router/index.js:688:15)

    console.error
      ƒö┤ ERROR: TransactionError: Transaction failed for CreateReservation: 
E11000 duplicate key error collection: test.reservas index: 
unique_reservation_slot dup key: { barberoId: 
ObjectId('698be98b6a05e103eb47021b'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698be98b6a05e103eb470219') }
          at Function.executeInTransaction (C:\Users\Kristian\Desktop\barber-saas
\backend\src\utils\TransactionManager.js:88:42)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at CreateReserva.execute (C:\Users\Kristian\Desktop\barber-saas\backend
\src\application\use-cases\reservas\CreateReserva.js:26:34)
          at Object.<anonymous>.exports.crearReservaBySlug (C:\Users\Kristian\Des
ktop\barber-saas\backend\src\controllers\public.controller.js:140:25) {
        isTransactionError: true,
        originalError: MongoServerError: E11000 duplicate key error collection: 
test.reservas index: unique_reservation_slot dup key: { barberoId: 
ObjectId('698be98b6a05e103eb47021b'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698be98b6a05e103eb470219') }
            at InsertOneOperation.handleOk (C:\Users\Kristian\Desktop\barber-saas
\backend\node_modules\mongodb\src\operations\insert.ts:79:13)
            at tryOperation (C:\Users\Kristian\Desktop\barber-saas\backend\node_m
odules\mongodb\src\operations\execute_operation.ts:294:26)
            at processTicksAndRejections 
(node:internal/process/task_queues:105:5)
            at executeOperation (C:\Users\Kristian\Desktop\barber-saas\backend\no
de_modules\mongodb\src\operations\execute_operation.ts:123:12)
            at Collection.insertOne (C:\Users\Kristian\Desktop\barber-saas\backen
d\node_modules\mongodb\src\collection.ts:294:12)
            at model.$__save (C:\Users\Kristian\Desktop\barber-saas\backend\node_
modules\mongoose\lib\model.js:398:16)
            at model.save (C:\Users\Kristian\Desktop\barber-saas\backend\node_mod
ules\mongoose\lib\model.js:609:5)
            at C:\Users\Kristian\Desktop\barber-saas\backend\node_modules\mongoos
e\lib\model.js:2722:9
            at async Promise.all (index 0)
            at Function.create (C:\Users\Kristian\Desktop\barber-saas\backend\nod
e_modules\mongoose\lib\model.js:2707:11)
            at MongoReservaRepository.save (C:\Users\Kristian\Desktop\barber-saas
\backend\src\infrastructure\database\mongodb\repositories\MongoReservaRepository.
js:15:16)
            at TransactionManager.executeInTransaction.operationName (C:\Users\Kr
istian\Desktop\barber-saas\backend\src\application\use-cases\reservas\CreateReser
va.js:72:42)
            at Function.executeInTransaction (C:\Users\Kristian\Desktop\barber-sa
as\backend\src\utils\TransactionManager.js:57:32)
            at CreateReserva.execute (C:\Users\Kristian\Desktop\barber-saas\backe
nd\src\application\use-cases\reservas\CreateReserva.js:26:34)
            at Object.<anonymous>.exports.crearReservaBySlug (C:\Users\Kristian\D
esktop\barber-saas\backend\src\controllers\public.controller.js:140:25) {
          errorLabelSet: Set(0) {},
          errorResponse: {
            index: 0,
            code: 11000,
            errmsg: `E11000 duplicate key error collection: test.reservas index: 
unique_reservation_slot dup key: { barberoId: 
ObjectId('698be98b6a05e103eb47021b'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698be98b6a05e103eb470219') }`,
            keyPattern: [Object],
            keyValue: [Object]
          },
          index: 0,
          code: 11000,
          keyPattern: { barberoId: 1, fecha: 1, hora: 1, barberiaId: 1 },
          keyValue: {
            barberoId: new ObjectId('698be98b6a05e103eb47021b'),
            fecha: 2026-03-16T00:00:00.000Z,
            hora: '14:00',
            barberiaId: new ObjectId('698be98b6a05e103eb470219')
          }
        },
        context: { operationName: 'CreateReservation', attempt: 1 },
        timestamp: 2026-02-11T02:29:32.725Z,
        originalStack: `MongoServerError: E11000 duplicate key error collection: 
test.reservas index: unique_reservation_slot dup key: { barberoId: 
ObjectId('698be98b6a05e103eb47021b'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698be98b6a05e103eb470219') }\n` +
          '    at InsertOneOperation.handleOk (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\node_modules\\mongodb\\src\\operations\\insert.ts:79:13)\n' +
          '    at tryOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\backen
d\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:294:26)\n' +
          '    at processTicksAndRejections 
(node:internal/process/task_queues:105:5)\n' +
          '    at executeOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\ba
ckend\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:123:12)\n' +
          '    at Collection.insertOne (C:\\Users\\Kristian\\Desktop\\barber-saas
\\backend\\node_modules\\mongodb\\src\\collection.ts:294:12)\n' +
          '    at model.$__save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backe
nd\\node_modules\\mongoose\\lib\\model.js:398:16)\n' +
          '    at model.save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\
\node_modules\\mongoose\\lib\\model.js:609:5)\n' +
          '    at C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\\node_module
s\\mongoose\\lib\\model.js:2722:9\n' +
          '    at async Promise.all (index 0)\n' +
          '    at Function.create (C:\\Users\\Kristian\\Desktop\\barber-saas\\bac
kend\\node_modules\\mongoose\\lib\\model.js:2707:11)\n' +
          '    at MongoReservaRepository.save (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\src\\infrastructure\\database\\mongodb\\repositories\\MongoRese
rvaRepository.js:15:16)\n' +
          '    at TransactionManager.executeInTransaction.operationName (C:\\User
s\\Kristian\\Desktop\\barber-saas\\backend\\src\\application\\use-cases\\reservas
\\CreateReserva.js:72:42)\n' +
          '    at Function.executeInTransaction (C:\\Users\\Kristian\\Desktop\\ba
rber-saas\\backend\\src\\utils\\TransactionManager.js:57:32)\n' +
          '    at CreateReserva.execute (C:\\Users\\Kristian\\Desktop\\barber-saa
s\\backend\\src\\application\\use-cases\\reservas\\CreateReserva.js:26:34)\n' +
          '    at Object.<anonymous>.exports.crearReservaBySlug (C:\\Users\\Krist
ian\\Desktop\\barber-saas\\backend\\src\\controllers\\public.controller.js:140:25
)'
      }

    [0m [90m 4 |[39m
     [90m 5 |[39m [36mconst[39m errorHandler [33m=[39m (err[33m,[39m 
req[33m,[39m res[33m,[39m next) [33m=>[39m {
    [31m[1m>[22m[39m[90m 6 |[39m   console[33m.[39merror([32m"ƒö┤ 
ERROR:"[39m[33m,[39m err)[33m;[39m
     [90m   |[39m           [31m[1m^[22m[39m
     [90m 7 |[39m
     [90m 8 |[39m   [90m// ­ƒöÑ A├æADIR HEADERS CORS SI NO EXISTEN[39m
     [90m 9 |[39m   [36mconst[39m origin [33m=[39m 
req[33m.[39mheaders[33m.[39morigin[33m;[39m[0m

      at error (src/config/middleware/errorHandler.js:6:11)
      at Layer.handleError (node_modules/router/lib/layer.js:116:17)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at Layer.handleError (node_modules/router/lib/layer.js:111:12)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at Immediate.next (node_modules/router/index.js:291:5)
      at Immediate._onImmediate (node_modules/router/index.js:688:15)

    console.log
      [Transaction] Started: CreateReservation (attempt 2/3)

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:54:25)

    console.log
      [Transaction] Started: CreateReservation (attempt 2/3)

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:54:25)

    console.log
      [Transaction] Started: CreateReservation (attempt 2/3)

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:54:25)

    console.log
      [Transaction] Started: CreateReservation (attempt 2/3)

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:54:25)

    console.log
      [Transaction] Started: CreateReservation (attempt 2/3)

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:54:25)

    console.log
      [Transaction] Started: CreateReservation (attempt 2/3)

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:54:25)

    console.log
      [Transaction] Started: CreateReservation (attempt 2/3)

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:54:25)

    console.log
      [Transaction] Started: CreateReservation (attempt 2/3)

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:54:25)

    console.log
      [Transaction] Started: CreateReservation (attempt 2/3)

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:54:25)

    console.log
      [Transaction] Started: CreateReservation (attempt 2/3)

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:54:25)

    console.log
      [Transaction] Aborted: CreateReservation

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:69:29)

    console.error
      [Transaction] Failed: CreateReservation {
        error: `E11000 duplicate key error collection: test.reservas index: 
unique_reservation_slot dup key: { barberoId: 
ObjectId('698be98b6a05e103eb47021b'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698be98b6a05e103eb470219') }`,
        attempt: 2,
        stack: `MongoServerError: E11000 duplicate key error collection: 
test.reservas index: unique_reservation_slot dup key: { barberoId: 
ObjectId('698be98b6a05e103eb47021b'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698be98b6a05e103eb470219') }\n` +
          '    at InsertOneOperation.handleOk (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\node_modules\\mongodb\\src\\operations\\insert.ts:79:13)\n' +
          '    at tryOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\backen
d\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:294:26)\n' +
          '    at processTicksAndRejections 
(node:internal/process/task_queues:105:5)\n' +
          '    at executeOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\ba
ckend\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:123:12)\n' +
          '    at Collection.insertOne (C:\\Users\\Kristian\\Desktop\\barber-saas
\\backend\\node_modules\\mongodb\\src\\collection.ts:294:12)\n' +
          '    at model.$__save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backe
nd\\node_modules\\mongoose\\lib\\model.js:398:16)\n' +
          '    at model.save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\
\node_modules\\mongoose\\lib\\model.js:609:5)\n' +
          '    at C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\\node_module
s\\mongoose\\lib\\model.js:2722:9\n' +
          '    at async Promise.all (index 0)\n' +
          '    at Function.create (C:\\Users\\Kristian\\Desktop\\barber-saas\\bac
kend\\node_modules\\mongoose\\lib\\model.js:2707:11)\n' +
          '    at MongoReservaRepository.save (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\src\\infrastructure\\database\\mongodb\\repositories\\MongoRese
rvaRepository.js:15:16)\n' +
          '    at TransactionManager.executeInTransaction.operationName (C:\\User
s\\Kristian\\Desktop\\barber-saas\\backend\\src\\application\\use-cases\\reservas
\\CreateReserva.js:72:42)\n' +
          '    at Function.executeInTransaction (C:\\Users\\Kristian\\Desktop\\ba
rber-saas\\backend\\src\\utils\\TransactionManager.js:57:32)\n' +
          '    at CreateReserva.execute (C:\\Users\\Kristian\\Desktop\\barber-saa
s\\backend\\src\\application\\use-cases\\reservas\\CreateReserva.js:26:34)\n' +
          '    at Object.<anonymous>.exports.crearReservaBySlug (C:\\Users\\Krist
ian\\Desktop\\barber-saas\\backend\\src\\controllers\\public.controller.js:140:25
)'
      }

    [0m [90m 80 |[39m
     [90m 81 |[39m                 [90m// Non-transient error or max retries 
reached[39m
    [31m[1m>[22m[39m[90m 82 |[39m                 
console[33m.[39merror([32m`[Transaction] Failed: 
${operationName}`[39m[33m,[39m {
     [90m    |[39m                         [31m[1m^[22m[39m
     [90m 83 |[39m                     error[33m:[39m 
error[33m.[39mmessage[33m,[39m
     [90m 84 |[39m                     attempt[33m:[39m attempt [33m+[39m 
[35m1[39m[33m,[39m
     [90m 85 |[39m                     stack[33m:[39m 
error[33m.[39mstack[0m

      at Function.error [as executeInTransaction] 
(src/utils/TransactionManager.js:82:25)
      at CreateReserva.execute 
(src/application/use-cases/reservas/CreateReserva.js:26:34)
      at Object.<anonymous>.exports.crearReservaBySlug 
(src/controllers/public.controller.js:140:25)

    console.error
      ƒö┤ ERROR: TransactionError: Transaction failed for CreateReservation: 
E11000 duplicate key error collection: test.reservas index: 
unique_reservation_slot dup key: { barberoId: 
ObjectId('698be98b6a05e103eb47021b'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698be98b6a05e103eb470219') }
          at Function.executeInTransaction (C:\Users\Kristian\Desktop\barber-saas
\backend\src\utils\TransactionManager.js:88:42)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at CreateReserva.execute (C:\Users\Kristian\Desktop\barber-saas\backend
\src\application\use-cases\reservas\CreateReserva.js:26:34)
          at Object.<anonymous>.exports.crearReservaBySlug (C:\Users\Kristian\Des
ktop\barber-saas\backend\src\controllers\public.controller.js:140:25) {
        isTransactionError: true,
        originalError: MongoServerError: E11000 duplicate key error collection: 
test.reservas index: unique_reservation_slot dup key: { barberoId: 
ObjectId('698be98b6a05e103eb47021b'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698be98b6a05e103eb470219') }
            at InsertOneOperation.handleOk (C:\Users\Kristian\Desktop\barber-saas
\backend\node_modules\mongodb\src\operations\insert.ts:79:13)
            at tryOperation (C:\Users\Kristian\Desktop\barber-saas\backend\node_m
odules\mongodb\src\operations\execute_operation.ts:294:26)
            at processTicksAndRejections 
(node:internal/process/task_queues:105:5)
            at executeOperation (C:\Users\Kristian\Desktop\barber-saas\backend\no
de_modules\mongodb\src\operations\execute_operation.ts:123:12)
            at Collection.insertOne (C:\Users\Kristian\Desktop\barber-saas\backen
d\node_modules\mongodb\src\collection.ts:294:12)
            at model.$__save (C:\Users\Kristian\Desktop\barber-saas\backend\node_
modules\mongoose\lib\model.js:398:16)
            at model.save (C:\Users\Kristian\Desktop\barber-saas\backend\node_mod
ules\mongoose\lib\model.js:609:5)
            at C:\Users\Kristian\Desktop\barber-saas\backend\node_modules\mongoos
e\lib\model.js:2722:9
            at async Promise.all (index 0)
            at Function.create (C:\Users\Kristian\Desktop\barber-saas\backend\nod
e_modules\mongoose\lib\model.js:2707:11)
            at MongoReservaRepository.save (C:\Users\Kristian\Desktop\barber-saas
\backend\src\infrastructure\database\mongodb\repositories\MongoReservaRepository.
js:15:16)
            at TransactionManager.executeInTransaction.operationName (C:\Users\Kr
istian\Desktop\barber-saas\backend\src\application\use-cases\reservas\CreateReser
va.js:72:42)
            at Function.executeInTransaction (C:\Users\Kristian\Desktop\barber-sa
as\backend\src\utils\TransactionManager.js:57:32)
            at CreateReserva.execute (C:\Users\Kristian\Desktop\barber-saas\backe
nd\src\application\use-cases\reservas\CreateReserva.js:26:34)
            at Object.<anonymous>.exports.crearReservaBySlug (C:\Users\Kristian\D
esktop\barber-saas\backend\src\controllers\public.controller.js:140:25) {
          errorLabelSet: Set(0) {},
          errorResponse: {
            index: 0,
            code: 11000,
            errmsg: `E11000 duplicate key error collection: test.reservas index: 
unique_reservation_slot dup key: { barberoId: 
ObjectId('698be98b6a05e103eb47021b'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698be98b6a05e103eb470219') }`,
            keyPattern: [Object],
            keyValue: [Object]
          },
          index: 0,
          code: 11000,
          keyPattern: { barberoId: 1, fecha: 1, hora: 1, barberiaId: 1 },
          keyValue: {
            barberoId: new ObjectId('698be98b6a05e103eb47021b'),
            fecha: 2026-03-16T00:00:00.000Z,
            hora: '14:00',
            barberiaId: new ObjectId('698be98b6a05e103eb470219')
          }
        },
        context: { operationName: 'CreateReservation', attempt: 2 },
        timestamp: 2026-02-11T02:29:32.959Z,
        originalStack: `MongoServerError: E11000 duplicate key error collection: 
test.reservas index: unique_reservation_slot dup key: { barberoId: 
ObjectId('698be98b6a05e103eb47021b'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698be98b6a05e103eb470219') }\n` +
          '    at InsertOneOperation.handleOk (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\node_modules\\mongodb\\src\\operations\\insert.ts:79:13)\n' +
          '    at tryOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\backen
d\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:294:26)\n' +
          '    at processTicksAndRejections 
(node:internal/process/task_queues:105:5)\n' +
          '    at executeOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\ba
ckend\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:123:12)\n' +
          '    at Collection.insertOne (C:\\Users\\Kristian\\Desktop\\barber-saas
\\backend\\node_modules\\mongodb\\src\\collection.ts:294:12)\n' +
          '    at model.$__save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backe
nd\\node_modules\\mongoose\\lib\\model.js:398:16)\n' +
          '    at model.save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\
\node_modules\\mongoose\\lib\\model.js:609:5)\n' +
          '    at C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\\node_module
s\\mongoose\\lib\\model.js:2722:9\n' +
          '    at async Promise.all (index 0)\n' +
          '    at Function.create (C:\\Users\\Kristian\\Desktop\\barber-saas\\bac
kend\\node_modules\\mongoose\\lib\\model.js:2707:11)\n' +
          '    at MongoReservaRepository.save (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\src\\infrastructure\\database\\mongodb\\repositories\\MongoRese
rvaRepository.js:15:16)\n' +
          '    at TransactionManager.executeInTransaction.operationName (C:\\User
s\\Kristian\\Desktop\\barber-saas\\backend\\src\\application\\use-cases\\reservas
\\CreateReserva.js:72:42)\n' +
          '    at Function.executeInTransaction (C:\\Users\\Kristian\\Desktop\\ba
rber-saas\\backend\\src\\utils\\TransactionManager.js:57:32)\n' +
          '    at CreateReserva.execute (C:\\Users\\Kristian\\Desktop\\barber-saa
s\\backend\\src\\application\\use-cases\\reservas\\CreateReserva.js:26:34)\n' +
          '    at Object.<anonymous>.exports.crearReservaBySlug (C:\\Users\\Krist
ian\\Desktop\\barber-saas\\backend\\src\\controllers\\public.controller.js:140:25
)'
      }

    [0m [90m 4 |[39m
     [90m 5 |[39m [36mconst[39m errorHandler [33m=[39m (err[33m,[39m 
req[33m,[39m res[33m,[39m next) [33m=>[39m {
    [31m[1m>[22m[39m[90m 6 |[39m   console[33m.[39merror([32m"ƒö┤ 
ERROR:"[39m[33m,[39m err)[33m;[39m
     [90m   |[39m           [31m[1m^[22m[39m
     [90m 7 |[39m
     [90m 8 |[39m   [90m// ­ƒöÑ A├æADIR HEADERS CORS SI NO EXISTEN[39m
     [90m 9 |[39m   [36mconst[39m origin [33m=[39m 
req[33m.[39mheaders[33m.[39morigin[33m;[39m[0m

      at error (src/config/middleware/errorHandler.js:6:11)
      at Layer.handleError (node_modules/router/lib/layer.js:116:17)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at Layer.handleError (node_modules/router/lib/layer.js:111:12)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at Immediate.next (node_modules/router/index.js:291:5)
      at Immediate._onImmediate (node_modules/router/index.js:688:15)

    console.log
      [Transaction] Aborted: CreateReservation

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:69:29)

    console.error
      [Transaction] Failed: CreateReservation {
        error: `E11000 duplicate key error collection: test.reservas index: 
unique_reservation_slot dup key: { barberoId: 
ObjectId('698be98b6a05e103eb47021b'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698be98b6a05e103eb470219') }`,
        attempt: 2,
        stack: `MongoServerError: E11000 duplicate key error collection: 
test.reservas index: unique_reservation_slot dup key: { barberoId: 
ObjectId('698be98b6a05e103eb47021b'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698be98b6a05e103eb470219') }\n` +
          '    at InsertOneOperation.handleOk (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\node_modules\\mongodb\\src\\operations\\insert.ts:79:13)\n' +
          '    at tryOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\backen
d\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:294:26)\n' +
          '    at processTicksAndRejections 
(node:internal/process/task_queues:105:5)\n' +
          '    at executeOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\ba
ckend\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:123:12)\n' +
          '    at Collection.insertOne (C:\\Users\\Kristian\\Desktop\\barber-saas
\\backend\\node_modules\\mongodb\\src\\collection.ts:294:12)\n' +
          '    at model.$__save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backe
nd\\node_modules\\mongoose\\lib\\model.js:398:16)\n' +
          '    at model.save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\
\node_modules\\mongoose\\lib\\model.js:609:5)\n' +
          '    at C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\\node_module
s\\mongoose\\lib\\model.js:2722:9\n' +
          '    at async Promise.all (index 0)\n' +
          '    at Function.create (C:\\Users\\Kristian\\Desktop\\barber-saas\\bac
kend\\node_modules\\mongoose\\lib\\model.js:2707:11)\n' +
          '    at MongoReservaRepository.save (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\src\\infrastructure\\database\\mongodb\\repositories\\MongoRese
rvaRepository.js:15:16)\n' +
          '    at TransactionManager.executeInTransaction.operationName (C:\\User
s\\Kristian\\Desktop\\barber-saas\\backend\\src\\application\\use-cases\\reservas
\\CreateReserva.js:72:42)\n' +
          '    at Function.executeInTransaction (C:\\Users\\Kristian\\Desktop\\ba
rber-saas\\backend\\src\\utils\\TransactionManager.js:57:32)\n' +
          '    at CreateReserva.execute (C:\\Users\\Kristian\\Desktop\\barber-saa
s\\backend\\src\\application\\use-cases\\reservas\\CreateReserva.js:26:34)\n' +
          '    at Object.<anonymous>.exports.crearReservaBySlug (C:\\Users\\Krist
ian\\Desktop\\barber-saas\\backend\\src\\controllers\\public.controller.js:140:25
)'
      }

    [0m [90m 80 |[39m
     [90m 81 |[39m                 [90m// Non-transient error or max retries 
reached[39m
    [31m[1m>[22m[39m[90m 82 |[39m                 
console[33m.[39merror([32m`[Transaction] Failed: 
${operationName}`[39m[33m,[39m {
     [90m    |[39m                         [31m[1m^[22m[39m
     [90m 83 |[39m                     error[33m:[39m 
error[33m.[39mmessage[33m,[39m
     [90m 84 |[39m                     attempt[33m:[39m attempt [33m+[39m 
[35m1[39m[33m,[39m
     [90m 85 |[39m                     stack[33m:[39m 
error[33m.[39mstack[0m

      at Function.error [as executeInTransaction] 
(src/utils/TransactionManager.js:82:25)
      at CreateReserva.execute 
(src/application/use-cases/reservas/CreateReserva.js:26:34)
      at Object.<anonymous>.exports.crearReservaBySlug 
(src/controllers/public.controller.js:140:25)

    console.log
      [Transaction] Aborted: CreateReservation

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:69:29)

    console.error
      [Transaction] Failed: CreateReservation {
        error: `E11000 duplicate key error collection: test.reservas index: 
unique_reservation_slot dup key: { barberoId: 
ObjectId('698be98b6a05e103eb47021b'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698be98b6a05e103eb470219') }`,
        attempt: 2,
        stack: `MongoServerError: E11000 duplicate key error collection: 
test.reservas index: unique_reservation_slot dup key: { barberoId: 
ObjectId('698be98b6a05e103eb47021b'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698be98b6a05e103eb470219') }\n` +
          '    at InsertOneOperation.handleOk (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\node_modules\\mongodb\\src\\operations\\insert.ts:79:13)\n' +
          '    at tryOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\backen
d\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:294:26)\n' +
          '    at processTicksAndRejections 
(node:internal/process/task_queues:105:5)\n' +
          '    at executeOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\ba
ckend\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:123:12)\n' +
          '    at Collection.insertOne (C:\\Users\\Kristian\\Desktop\\barber-saas
\\backend\\node_modules\\mongodb\\src\\collection.ts:294:12)\n' +
          '    at model.$__save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backe
nd\\node_modules\\mongoose\\lib\\model.js:398:16)\n' +
          '    at model.save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\
\node_modules\\mongoose\\lib\\model.js:609:5)\n' +
          '    at C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\\node_module
s\\mongoose\\lib\\model.js:2722:9\n' +
          '    at async Promise.all (index 0)\n' +
          '    at Function.create (C:\\Users\\Kristian\\Desktop\\barber-saas\\bac
kend\\node_modules\\mongoose\\lib\\model.js:2707:11)\n' +
          '    at MongoReservaRepository.save (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\src\\infrastructure\\database\\mongodb\\repositories\\MongoRese
rvaRepository.js:15:16)\n' +
          '    at TransactionManager.executeInTransaction.operationName (C:\\User
s\\Kristian\\Desktop\\barber-saas\\backend\\src\\application\\use-cases\\reservas
\\CreateReserva.js:72:42)\n' +
          '    at Function.executeInTransaction (C:\\Users\\Kristian\\Desktop\\ba
rber-saas\\backend\\src\\utils\\TransactionManager.js:57:32)\n' +
          '    at CreateReserva.execute (C:\\Users\\Kristian\\Desktop\\barber-saa
s\\backend\\src\\application\\use-cases\\reservas\\CreateReserva.js:26:34)\n' +
          '    at Object.<anonymous>.exports.crearReservaBySlug (C:\\Users\\Krist
ian\\Desktop\\barber-saas\\backend\\src\\controllers\\public.controller.js:140:25
)'
      }

    [0m [90m 80 |[39m
     [90m 81 |[39m                 [90m// Non-transient error or max retries 
reached[39m
    [31m[1m>[22m[39m[90m 82 |[39m                 
console[33m.[39merror([32m`[Transaction] Failed: 
${operationName}`[39m[33m,[39m {
     [90m    |[39m                         [31m[1m^[22m[39m
     [90m 83 |[39m                     error[33m:[39m 
error[33m.[39mmessage[33m,[39m
     [90m 84 |[39m                     attempt[33m:[39m attempt [33m+[39m 
[35m1[39m[33m,[39m
     [90m 85 |[39m                     stack[33m:[39m 
error[33m.[39mstack[0m

      at Function.error [as executeInTransaction] 
(src/utils/TransactionManager.js:82:25)
      at CreateReserva.execute 
(src/application/use-cases/reservas/CreateReserva.js:26:34)
      at Object.<anonymous>.exports.crearReservaBySlug 
(src/controllers/public.controller.js:140:25)

    console.log
      [Transaction] Aborted: CreateReservation

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:69:29)

    console.error
      [Transaction] Failed: CreateReservation {
        error: `E11000 duplicate key error collection: test.reservas index: 
unique_reservation_slot dup key: { barberoId: 
ObjectId('698be98b6a05e103eb47021b'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698be98b6a05e103eb470219') }`,
        attempt: 2,
        stack: `MongoServerError: E11000 duplicate key error collection: 
test.reservas index: unique_reservation_slot dup key: { barberoId: 
ObjectId('698be98b6a05e103eb47021b'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698be98b6a05e103eb470219') }\n` +
          '    at InsertOneOperation.handleOk (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\node_modules\\mongodb\\src\\operations\\insert.ts:79:13)\n' +
          '    at tryOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\backen
d\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:294:26)\n' +
          '    at processTicksAndRejections 
(node:internal/process/task_queues:105:5)\n' +
          '    at executeOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\ba
ckend\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:123:12)\n' +
          '    at Collection.insertOne (C:\\Users\\Kristian\\Desktop\\barber-saas
\\backend\\node_modules\\mongodb\\src\\collection.ts:294:12)\n' +
          '    at model.$__save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backe
nd\\node_modules\\mongoose\\lib\\model.js:398:16)\n' +
          '    at model.save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\
\node_modules\\mongoose\\lib\\model.js:609:5)\n' +
          '    at C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\\node_module
s\\mongoose\\lib\\model.js:2722:9\n' +
          '    at async Promise.all (index 0)\n' +
          '    at Function.create (C:\\Users\\Kristian\\Desktop\\barber-saas\\bac
kend\\node_modules\\mongoose\\lib\\model.js:2707:11)\n' +
          '    at MongoReservaRepository.save (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\src\\infrastructure\\database\\mongodb\\repositories\\MongoRese
rvaRepository.js:15:16)\n' +
          '    at TransactionManager.executeInTransaction.operationName (C:\\User
s\\Kristian\\Desktop\\barber-saas\\backend\\src\\application\\use-cases\\reservas
\\CreateReserva.js:72:42)\n' +
          '    at Function.executeInTransaction (C:\\Users\\Kristian\\Desktop\\ba
rber-saas\\backend\\src\\utils\\TransactionManager.js:57:32)\n' +
          '    at CreateReserva.execute (C:\\Users\\Kristian\\Desktop\\barber-saa
s\\backend\\src\\application\\use-cases\\reservas\\CreateReserva.js:26:34)\n' +
          '    at Object.<anonymous>.exports.crearReservaBySlug (C:\\Users\\Krist
ian\\Desktop\\barber-saas\\backend\\src\\controllers\\public.controller.js:140:25
)'
      }

    [0m [90m 80 |[39m
     [90m 81 |[39m                 [90m// Non-transient error or max retries 
reached[39m
    [31m[1m>[22m[39m[90m 82 |[39m                 
console[33m.[39merror([32m`[Transaction] Failed: 
${operationName}`[39m[33m,[39m {
     [90m    |[39m                         [31m[1m^[22m[39m
     [90m 83 |[39m                     error[33m:[39m 
error[33m.[39mmessage[33m,[39m
     [90m 84 |[39m                     attempt[33m:[39m attempt [33m+[39m 
[35m1[39m[33m,[39m
     [90m 85 |[39m                     stack[33m:[39m 
error[33m.[39mstack[0m

      at Function.error [as executeInTransaction] 
(src/utils/TransactionManager.js:82:25)
      at CreateReserva.execute 
(src/application/use-cases/reservas/CreateReserva.js:26:34)
      at Object.<anonymous>.exports.crearReservaBySlug 
(src/controllers/public.controller.js:140:25)

    console.log
      [Transaction] Aborted: CreateReservation

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:69:29)

    console.error
      [Transaction] Failed: CreateReservation {
        error: `E11000 duplicate key error collection: test.reservas index: 
unique_reservation_slot dup key: { barberoId: 
ObjectId('698be98b6a05e103eb47021b'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698be98b6a05e103eb470219') }`,
        attempt: 2,
        stack: `MongoServerError: E11000 duplicate key error collection: 
test.reservas index: unique_reservation_slot dup key: { barberoId: 
ObjectId('698be98b6a05e103eb47021b'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698be98b6a05e103eb470219') }\n` +
          '    at InsertOneOperation.handleOk (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\node_modules\\mongodb\\src\\operations\\insert.ts:79:13)\n' +
          '    at tryOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\backen
d\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:294:26)\n' +
          '    at processTicksAndRejections 
(node:internal/process/task_queues:105:5)\n' +
          '    at executeOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\ba
ckend\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:123:12)\n' +
          '    at Collection.insertOne (C:\\Users\\Kristian\\Desktop\\barber-saas
\\backend\\node_modules\\mongodb\\src\\collection.ts:294:12)\n' +
          '    at model.$__save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backe
nd\\node_modules\\mongoose\\lib\\model.js:398:16)\n' +
          '    at model.save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\
\node_modules\\mongoose\\lib\\model.js:609:5)\n' +
          '    at C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\\node_module
s\\mongoose\\lib\\model.js:2722:9\n' +
          '    at async Promise.all (index 0)\n' +
          '    at Function.create (C:\\Users\\Kristian\\Desktop\\barber-saas\\bac
kend\\node_modules\\mongoose\\lib\\model.js:2707:11)\n' +
          '    at MongoReservaRepository.save (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\src\\infrastructure\\database\\mongodb\\repositories\\MongoRese
rvaRepository.js:15:16)\n' +
          '    at TransactionManager.executeInTransaction.operationName (C:\\User
s\\Kristian\\Desktop\\barber-saas\\backend\\src\\application\\use-cases\\reservas
\\CreateReserva.js:72:42)\n' +
          '    at Function.executeInTransaction (C:\\Users\\Kristian\\Desktop\\ba
rber-saas\\backend\\src\\utils\\TransactionManager.js:57:32)\n' +
          '    at CreateReserva.execute (C:\\Users\\Kristian\\Desktop\\barber-saa
s\\backend\\src\\application\\use-cases\\reservas\\CreateReserva.js:26:34)\n' +
          '    at Object.<anonymous>.exports.crearReservaBySlug (C:\\Users\\Krist
ian\\Desktop\\barber-saas\\backend\\src\\controllers\\public.controller.js:140:25
)'
      }

    [0m [90m 80 |[39m
     [90m 81 |[39m                 [90m// Non-transient error or max retries 
reached[39m
    [31m[1m>[22m[39m[90m 82 |[39m                 
console[33m.[39merror([32m`[Transaction] Failed: 
${operationName}`[39m[33m,[39m {
     [90m    |[39m                         [31m[1m^[22m[39m
     [90m 83 |[39m                     error[33m:[39m 
error[33m.[39mmessage[33m,[39m
     [90m 84 |[39m                     attempt[33m:[39m attempt [33m+[39m 
[35m1[39m[33m,[39m
     [90m 85 |[39m                     stack[33m:[39m 
error[33m.[39mstack[0m

      at Function.error [as executeInTransaction] 
(src/utils/TransactionManager.js:82:25)
      at CreateReserva.execute 
(src/application/use-cases/reservas/CreateReserva.js:26:34)
      at Object.<anonymous>.exports.crearReservaBySlug 
(src/controllers/public.controller.js:140:25)

    console.error
      ƒö┤ ERROR: TransactionError: Transaction failed for CreateReservation: 
E11000 duplicate key error collection: test.reservas index: 
unique_reservation_slot dup key: { barberoId: 
ObjectId('698be98b6a05e103eb47021b'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698be98b6a05e103eb470219') }
          at Function.executeInTransaction (C:\Users\Kristian\Desktop\barber-saas
\backend\src\utils\TransactionManager.js:88:42)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at CreateReserva.execute (C:\Users\Kristian\Desktop\barber-saas\backend
\src\application\use-cases\reservas\CreateReserva.js:26:34)
          at Object.<anonymous>.exports.crearReservaBySlug (C:\Users\Kristian\Des
ktop\barber-saas\backend\src\controllers\public.controller.js:140:25) {
        isTransactionError: true,
        originalError: MongoServerError: E11000 duplicate key error collection: 
test.reservas index: unique_reservation_slot dup key: { barberoId: 
ObjectId('698be98b6a05e103eb47021b'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698be98b6a05e103eb470219') }
            at InsertOneOperation.handleOk (C:\Users\Kristian\Desktop\barber-saas
\backend\node_modules\mongodb\src\operations\insert.ts:79:13)
            at tryOperation (C:\Users\Kristian\Desktop\barber-saas\backend\node_m
odules\mongodb\src\operations\execute_operation.ts:294:26)
            at processTicksAndRejections 
(node:internal/process/task_queues:105:5)
            at executeOperation (C:\Users\Kristian\Desktop\barber-saas\backend\no
de_modules\mongodb\src\operations\execute_operation.ts:123:12)
            at Collection.insertOne (C:\Users\Kristian\Desktop\barber-saas\backen
d\node_modules\mongodb\src\collection.ts:294:12)
            at model.$__save (C:\Users\Kristian\Desktop\barber-saas\backend\node_
modules\mongoose\lib\model.js:398:16)
            at model.save (C:\Users\Kristian\Desktop\barber-saas\backend\node_mod
ules\mongoose\lib\model.js:609:5)
            at C:\Users\Kristian\Desktop\barber-saas\backend\node_modules\mongoos
e\lib\model.js:2722:9
            at async Promise.all (index 0)
            at Function.create (C:\Users\Kristian\Desktop\barber-saas\backend\nod
e_modules\mongoose\lib\model.js:2707:11)
            at MongoReservaRepository.save (C:\Users\Kristian\Desktop\barber-saas
\backend\src\infrastructure\database\mongodb\repositories\MongoReservaRepository.
js:15:16)
            at TransactionManager.executeInTransaction.operationName (C:\Users\Kr
istian\Desktop\barber-saas\backend\src\application\use-cases\reservas\CreateReser
va.js:72:42)
            at Function.executeInTransaction (C:\Users\Kristian\Desktop\barber-sa
as\backend\src\utils\TransactionManager.js:57:32)
            at CreateReserva.execute (C:\Users\Kristian\Desktop\barber-saas\backe
nd\src\application\use-cases\reservas\CreateReserva.js:26:34)
            at Object.<anonymous>.exports.crearReservaBySlug (C:\Users\Kristian\D
esktop\barber-saas\backend\src\controllers\public.controller.js:140:25) {
          errorLabelSet: Set(0) {},
          errorResponse: {
            index: 0,
            code: 11000,
            errmsg: `E11000 duplicate key error collection: test.reservas index: 
unique_reservation_slot dup key: { barberoId: 
ObjectId('698be98b6a05e103eb47021b'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698be98b6a05e103eb470219') }`,
            keyPattern: [Object],
            keyValue: [Object]
          },
          index: 0,
          code: 11000,
          keyPattern: { barberoId: 1, fecha: 1, hora: 1, barberiaId: 1 },
          keyValue: {
            barberoId: new ObjectId('698be98b6a05e103eb47021b'),
            fecha: 2026-03-16T00:00:00.000Z,
            hora: '14:00',
            barberiaId: new ObjectId('698be98b6a05e103eb470219')
          }
        },
        context: { operationName: 'CreateReservation', attempt: 2 },
        timestamp: 2026-02-11T02:29:33.054Z,
        originalStack: `MongoServerError: E11000 duplicate key error collection: 
test.reservas index: unique_reservation_slot dup key: { barberoId: 
ObjectId('698be98b6a05e103eb47021b'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698be98b6a05e103eb470219') }\n` +
          '    at InsertOneOperation.handleOk (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\node_modules\\mongodb\\src\\operations\\insert.ts:79:13)\n' +
          '    at tryOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\backen
d\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:294:26)\n' +
          '    at processTicksAndRejections 
(node:internal/process/task_queues:105:5)\n' +
          '    at executeOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\ba
ckend\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:123:12)\n' +
          '    at Collection.insertOne (C:\\Users\\Kristian\\Desktop\\barber-saas
\\backend\\node_modules\\mongodb\\src\\collection.ts:294:12)\n' +
          '    at model.$__save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backe
nd\\node_modules\\mongoose\\lib\\model.js:398:16)\n' +
          '    at model.save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\
\node_modules\\mongoose\\lib\\model.js:609:5)\n' +
          '    at C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\\node_module
s\\mongoose\\lib\\model.js:2722:9\n' +
          '    at async Promise.all (index 0)\n' +
          '    at Function.create (C:\\Users\\Kristian\\Desktop\\barber-saas\\bac
kend\\node_modules\\mongoose\\lib\\model.js:2707:11)\n' +
          '    at MongoReservaRepository.save (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\src\\infrastructure\\database\\mongodb\\repositories\\MongoRese
rvaRepository.js:15:16)\n' +
          '    at TransactionManager.executeInTransaction.operationName (C:\\User
s\\Kristian\\Desktop\\barber-saas\\backend\\src\\application\\use-cases\\reservas
\\CreateReserva.js:72:42)\n' +
          '    at Function.executeInTransaction (C:\\Users\\Kristian\\Desktop\\ba
rber-saas\\backend\\src\\utils\\TransactionManager.js:57:32)\n' +
          '    at CreateReserva.execute (C:\\Users\\Kristian\\Desktop\\barber-saa
s\\backend\\src\\application\\use-cases\\reservas\\CreateReserva.js:26:34)\n' +
          '    at Object.<anonymous>.exports.crearReservaBySlug (C:\\Users\\Krist
ian\\Desktop\\barber-saas\\backend\\src\\controllers\\public.controller.js:140:25
)'
      }

    [0m [90m 4 |[39m
     [90m 5 |[39m [36mconst[39m errorHandler [33m=[39m (err[33m,[39m 
req[33m,[39m res[33m,[39m next) [33m=>[39m {
    [31m[1m>[22m[39m[90m 6 |[39m   console[33m.[39merror([32m"ƒö┤ 
ERROR:"[39m[33m,[39m err)[33m;[39m
     [90m   |[39m           [31m[1m^[22m[39m
     [90m 7 |[39m
     [90m 8 |[39m   [90m// ­ƒöÑ A├æADIR HEADERS CORS SI NO EXISTEN[39m
     [90m 9 |[39m   [36mconst[39m origin [33m=[39m 
req[33m.[39mheaders[33m.[39morigin[33m;[39m[0m

      at error (src/config/middleware/errorHandler.js:6:11)
      at Layer.handleError (node_modules/router/lib/layer.js:116:17)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at Layer.handleError (node_modules/router/lib/layer.js:111:12)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at Immediate.next (node_modules/router/index.js:291:5)
      at Immediate._onImmediate (node_modules/router/index.js:688:15)

    console.error
      ƒö┤ ERROR: TransactionError: Transaction failed for CreateReservation: 
E11000 duplicate key error collection: test.reservas index: 
unique_reservation_slot dup key: { barberoId: 
ObjectId('698be98b6a05e103eb47021b'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698be98b6a05e103eb470219') }
          at Function.executeInTransaction (C:\Users\Kristian\Desktop\barber-saas
\backend\src\utils\TransactionManager.js:88:42)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at CreateReserva.execute (C:\Users\Kristian\Desktop\barber-saas\backend
\src\application\use-cases\reservas\CreateReserva.js:26:34)
          at Object.<anonymous>.exports.crearReservaBySlug (C:\Users\Kristian\Des
ktop\barber-saas\backend\src\controllers\public.controller.js:140:25) {
        isTransactionError: true,
        originalError: MongoServerError: E11000 duplicate key error collection: 
test.reservas index: unique_reservation_slot dup key: { barberoId: 
ObjectId('698be98b6a05e103eb47021b'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698be98b6a05e103eb470219') }
            at InsertOneOperation.handleOk (C:\Users\Kristian\Desktop\barber-saas
\backend\node_modules\mongodb\src\operations\insert.ts:79:13)
            at tryOperation (C:\Users\Kristian\Desktop\barber-saas\backend\node_m
odules\mongodb\src\operations\execute_operation.ts:294:26)
            at processTicksAndRejections 
(node:internal/process/task_queues:105:5)
            at executeOperation (C:\Users\Kristian\Desktop\barber-saas\backend\no
de_modules\mongodb\src\operations\execute_operation.ts:123:12)
            at Collection.insertOne (C:\Users\Kristian\Desktop\barber-saas\backen
d\node_modules\mongodb\src\collection.ts:294:12)
            at model.$__save (C:\Users\Kristian\Desktop\barber-saas\backend\node_
modules\mongoose\lib\model.js:398:16)
            at model.save (C:\Users\Kristian\Desktop\barber-saas\backend\node_mod
ules\mongoose\lib\model.js:609:5)
            at C:\Users\Kristian\Desktop\barber-saas\backend\node_modules\mongoos
e\lib\model.js:2722:9
            at async Promise.all (index 0)
            at Function.create (C:\Users\Kristian\Desktop\barber-saas\backend\nod
e_modules\mongoose\lib\model.js:2707:11)
            at MongoReservaRepository.save (C:\Users\Kristian\Desktop\barber-saas
\backend\src\infrastructure\database\mongodb\repositories\MongoReservaRepository.
js:15:16)
            at TransactionManager.executeInTransaction.operationName (C:\Users\Kr
istian\Desktop\barber-saas\backend\src\application\use-cases\reservas\CreateReser
va.js:72:42)
            at Function.executeInTransaction (C:\Users\Kristian\Desktop\barber-sa
as\backend\src\utils\TransactionManager.js:57:32)
            at CreateReserva.execute (C:\Users\Kristian\Desktop\barber-saas\backe
nd\src\application\use-cases\reservas\CreateReserva.js:26:34)
            at Object.<anonymous>.exports.crearReservaBySlug (C:\Users\Kristian\D
esktop\barber-saas\backend\src\controllers\public.controller.js:140:25) {
          errorLabelSet: Set(0) {},
          errorResponse: {
            index: 0,
            code: 11000,
            errmsg: `E11000 duplicate key error collection: test.reservas index: 
unique_reservation_slot dup key: { barberoId: 
ObjectId('698be98b6a05e103eb47021b'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698be98b6a05e103eb470219') }`,
            keyPattern: [Object],
            keyValue: [Object]
          },
          index: 0,
          code: 11000,
          keyPattern: { barberoId: 1, fecha: 1, hora: 1, barberiaId: 1 },
          keyValue: {
            barberoId: new ObjectId('698be98b6a05e103eb47021b'),
            fecha: 2026-03-16T00:00:00.000Z,
            hora: '14:00',
            barberiaId: new ObjectId('698be98b6a05e103eb470219')
          }
        },
        context: { operationName: 'CreateReservation', attempt: 2 },
        timestamp: 2026-02-11T02:29:33.057Z,
        originalStack: `MongoServerError: E11000 duplicate key error collection: 
test.reservas index: unique_reservation_slot dup key: { barberoId: 
ObjectId('698be98b6a05e103eb47021b'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698be98b6a05e103eb470219') }\n` +
          '    at InsertOneOperation.handleOk (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\node_modules\\mongodb\\src\\operations\\insert.ts:79:13)\n' +
          '    at tryOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\backen
d\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:294:26)\n' +
          '    at processTicksAndRejections 
(node:internal/process/task_queues:105:5)\n' +
          '    at executeOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\ba
ckend\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:123:12)\n' +
          '    at Collection.insertOne (C:\\Users\\Kristian\\Desktop\\barber-saas
\\backend\\node_modules\\mongodb\\src\\collection.ts:294:12)\n' +
          '    at model.$__save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backe
nd\\node_modules\\mongoose\\lib\\model.js:398:16)\n' +
          '    at model.save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\
\node_modules\\mongoose\\lib\\model.js:609:5)\n' +
          '    at C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\\node_module
s\\mongoose\\lib\\model.js:2722:9\n' +
          '    at async Promise.all (index 0)\n' +
          '    at Function.create (C:\\Users\\Kristian\\Desktop\\barber-saas\\bac
kend\\node_modules\\mongoose\\lib\\model.js:2707:11)\n' +
          '    at MongoReservaRepository.save (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\src\\infrastructure\\database\\mongodb\\repositories\\MongoRese
rvaRepository.js:15:16)\n' +
          '    at TransactionManager.executeInTransaction.operationName (C:\\User
s\\Kristian\\Desktop\\barber-saas\\backend\\src\\application\\use-cases\\reservas
\\CreateReserva.js:72:42)\n' +
          '    at Function.executeInTransaction (C:\\Users\\Kristian\\Desktop\\ba
rber-saas\\backend\\src\\utils\\TransactionManager.js:57:32)\n' +
          '    at CreateReserva.execute (C:\\Users\\Kristian\\Desktop\\barber-saa
s\\backend\\src\\application\\use-cases\\reservas\\CreateReserva.js:26:34)\n' +
          '    at Object.<anonymous>.exports.crearReservaBySlug (C:\\Users\\Krist
ian\\Desktop\\barber-saas\\backend\\src\\controllers\\public.controller.js:140:25
)'
      }

    [0m [90m 4 |[39m
     [90m 5 |[39m [36mconst[39m errorHandler [33m=[39m (err[33m,[39m 
req[33m,[39m res[33m,[39m next) [33m=>[39m {
    [31m[1m>[22m[39m[90m 6 |[39m   console[33m.[39merror([32m"ƒö┤ 
ERROR:"[39m[33m,[39m err)[33m;[39m
     [90m   |[39m           [31m[1m^[22m[39m
     [90m 7 |[39m
     [90m 8 |[39m   [90m// ­ƒöÑ A├æADIR HEADERS CORS SI NO EXISTEN[39m
     [90m 9 |[39m   [36mconst[39m origin [33m=[39m 
req[33m.[39mheaders[33m.[39morigin[33m;[39m[0m

      at error (src/config/middleware/errorHandler.js:6:11)
      at Layer.handleError (node_modules/router/lib/layer.js:116:17)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at Layer.handleError (node_modules/router/lib/layer.js:111:12)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at Immediate.next (node_modules/router/index.js:291:5)
      at Immediate._onImmediate (node_modules/router/index.js:688:15)

    console.error
      ƒö┤ ERROR: TransactionError: Transaction failed for CreateReservation: 
E11000 duplicate key error collection: test.reservas index: 
unique_reservation_slot dup key: { barberoId: 
ObjectId('698be98b6a05e103eb47021b'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698be98b6a05e103eb470219') }
          at Function.executeInTransaction (C:\Users\Kristian\Desktop\barber-saas
\backend\src\utils\TransactionManager.js:88:42)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at CreateReserva.execute (C:\Users\Kristian\Desktop\barber-saas\backend
\src\application\use-cases\reservas\CreateReserva.js:26:34)
          at Object.<anonymous>.exports.crearReservaBySlug (C:\Users\Kristian\Des
ktop\barber-saas\backend\src\controllers\public.controller.js:140:25) {
        isTransactionError: true,
        originalError: MongoServerError: E11000 duplicate key error collection: 
test.reservas index: unique_reservation_slot dup key: { barberoId: 
ObjectId('698be98b6a05e103eb47021b'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698be98b6a05e103eb470219') }
            at InsertOneOperation.handleOk (C:\Users\Kristian\Desktop\barber-saas
\backend\node_modules\mongodb\src\operations\insert.ts:79:13)
            at tryOperation (C:\Users\Kristian\Desktop\barber-saas\backend\node_m
odules\mongodb\src\operations\execute_operation.ts:294:26)
            at processTicksAndRejections 
(node:internal/process/task_queues:105:5)
            at executeOperation (C:\Users\Kristian\Desktop\barber-saas\backend\no
de_modules\mongodb\src\operations\execute_operation.ts:123:12)
            at Collection.insertOne (C:\Users\Kristian\Desktop\barber-saas\backen
d\node_modules\mongodb\src\collection.ts:294:12)
            at model.$__save (C:\Users\Kristian\Desktop\barber-saas\backend\node_
modules\mongoose\lib\model.js:398:16)
            at model.save (C:\Users\Kristian\Desktop\barber-saas\backend\node_mod
ules\mongoose\lib\model.js:609:5)
            at C:\Users\Kristian\Desktop\barber-saas\backend\node_modules\mongoos
e\lib\model.js:2722:9
            at async Promise.all (index 0)
            at Function.create (C:\Users\Kristian\Desktop\barber-saas\backend\nod
e_modules\mongoose\lib\model.js:2707:11)
            at MongoReservaRepository.save (C:\Users\Kristian\Desktop\barber-saas
\backend\src\infrastructure\database\mongodb\repositories\MongoReservaRepository.
js:15:16)
            at TransactionManager.executeInTransaction.operationName (C:\Users\Kr
istian\Desktop\barber-saas\backend\src\application\use-cases\reservas\CreateReser
va.js:72:42)
            at Function.executeInTransaction (C:\Users\Kristian\Desktop\barber-sa
as\backend\src\utils\TransactionManager.js:57:32)
            at CreateReserva.execute (C:\Users\Kristian\Desktop\barber-saas\backe
nd\src\application\use-cases\reservas\CreateReserva.js:26:34)
            at Object.<anonymous>.exports.crearReservaBySlug (C:\Users\Kristian\D
esktop\barber-saas\backend\src\controllers\public.controller.js:140:25) {
          errorLabelSet: Set(0) {},
          errorResponse: {
            index: 0,
            code: 11000,
            errmsg: `E11000 duplicate key error collection: test.reservas index: 
unique_reservation_slot dup key: { barberoId: 
ObjectId('698be98b6a05e103eb47021b'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698be98b6a05e103eb470219') }`,
            keyPattern: [Object],
            keyValue: [Object]
          },
          index: 0,
          code: 11000,
          keyPattern: { barberoId: 1, fecha: 1, hora: 1, barberiaId: 1 },
          keyValue: {
            barberoId: new ObjectId('698be98b6a05e103eb47021b'),
            fecha: 2026-03-16T00:00:00.000Z,
            hora: '14:00',
            barberiaId: new ObjectId('698be98b6a05e103eb470219')
          }
        },
        context: { operationName: 'CreateReservation', attempt: 2 },
        timestamp: 2026-02-11T02:29:33.065Z,
        originalStack: `MongoServerError: E11000 duplicate key error collection: 
test.reservas index: unique_reservation_slot dup key: { barberoId: 
ObjectId('698be98b6a05e103eb47021b'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698be98b6a05e103eb470219') }\n` +
          '    at InsertOneOperation.handleOk (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\node_modules\\mongodb\\src\\operations\\insert.ts:79:13)\n' +
          '    at tryOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\backen
d\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:294:26)\n' +
          '    at processTicksAndRejections 
(node:internal/process/task_queues:105:5)\n' +
          '    at executeOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\ba
ckend\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:123:12)\n' +
          '    at Collection.insertOne (C:\\Users\\Kristian\\Desktop\\barber-saas
\\backend\\node_modules\\mongodb\\src\\collection.ts:294:12)\n' +
          '    at model.$__save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backe
nd\\node_modules\\mongoose\\lib\\model.js:398:16)\n' +
          '    at model.save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\
\node_modules\\mongoose\\lib\\model.js:609:5)\n' +
          '    at C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\\node_module
s\\mongoose\\lib\\model.js:2722:9\n' +
          '    at async Promise.all (index 0)\n' +
          '    at Function.create (C:\\Users\\Kristian\\Desktop\\barber-saas\\bac
kend\\node_modules\\mongoose\\lib\\model.js:2707:11)\n' +
          '    at MongoReservaRepository.save (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\src\\infrastructure\\database\\mongodb\\repositories\\MongoRese
rvaRepository.js:15:16)\n' +
          '    at TransactionManager.executeInTransaction.operationName (C:\\User
s\\Kristian\\Desktop\\barber-saas\\backend\\src\\application\\use-cases\\reservas
\\CreateReserva.js:72:42)\n' +
          '    at Function.executeInTransaction (C:\\Users\\Kristian\\Desktop\\ba
rber-saas\\backend\\src\\utils\\TransactionManager.js:57:32)\n' +
          '    at CreateReserva.execute (C:\\Users\\Kristian\\Desktop\\barber-saa
s\\backend\\src\\application\\use-cases\\reservas\\CreateReserva.js:26:34)\n' +
          '    at Object.<anonymous>.exports.crearReservaBySlug (C:\\Users\\Krist
ian\\Desktop\\barber-saas\\backend\\src\\controllers\\public.controller.js:140:25
)'
      }

    [0m [90m 4 |[39m
     [90m 5 |[39m [36mconst[39m errorHandler [33m=[39m (err[33m,[39m 
req[33m,[39m res[33m,[39m next) [33m=>[39m {
    [31m[1m>[22m[39m[90m 6 |[39m   console[33m.[39merror([32m"ƒö┤ 
ERROR:"[39m[33m,[39m err)[33m;[39m
     [90m   |[39m           [31m[1m^[22m[39m
     [90m 7 |[39m
     [90m 8 |[39m   [90m// ­ƒöÑ A├æADIR HEADERS CORS SI NO EXISTEN[39m
     [90m 9 |[39m   [36mconst[39m origin [33m=[39m 
req[33m.[39mheaders[33m.[39morigin[33m;[39m[0m

      at error (src/config/middleware/errorHandler.js:6:11)
      at Layer.handleError (node_modules/router/lib/layer.js:116:17)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at Layer.handleError (node_modules/router/lib/layer.js:111:12)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at Immediate.next (node_modules/router/index.js:291:5)
      at Immediate._onImmediate (node_modules/router/index.js:688:15)

    console.error
      ƒö┤ ERROR: TransactionError: Transaction failed for CreateReservation: 
E11000 duplicate key error collection: test.reservas index: 
unique_reservation_slot dup key: { barberoId: 
ObjectId('698be98b6a05e103eb47021b'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698be98b6a05e103eb470219') }
          at Function.executeInTransaction (C:\Users\Kristian\Desktop\barber-saas
\backend\src\utils\TransactionManager.js:88:42)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at CreateReserva.execute (C:\Users\Kristian\Desktop\barber-saas\backend
\src\application\use-cases\reservas\CreateReserva.js:26:34)
          at Object.<anonymous>.exports.crearReservaBySlug (C:\Users\Kristian\Des
ktop\barber-saas\backend\src\controllers\public.controller.js:140:25) {
        isTransactionError: true,
        originalError: MongoServerError: E11000 duplicate key error collection: 
test.reservas index: unique_reservation_slot dup key: { barberoId: 
ObjectId('698be98b6a05e103eb47021b'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698be98b6a05e103eb470219') }
            at InsertOneOperation.handleOk (C:\Users\Kristian\Desktop\barber-saas
\backend\node_modules\mongodb\src\operations\insert.ts:79:13)
            at tryOperation (C:\Users\Kristian\Desktop\barber-saas\backend\node_m
odules\mongodb\src\operations\execute_operation.ts:294:26)
            at processTicksAndRejections 
(node:internal/process/task_queues:105:5)
            at executeOperation (C:\Users\Kristian\Desktop\barber-saas\backend\no
de_modules\mongodb\src\operations\execute_operation.ts:123:12)
            at Collection.insertOne (C:\Users\Kristian\Desktop\barber-saas\backen
d\node_modules\mongodb\src\collection.ts:294:12)
            at model.$__save (C:\Users\Kristian\Desktop\barber-saas\backend\node_
modules\mongoose\lib\model.js:398:16)
            at model.save (C:\Users\Kristian\Desktop\barber-saas\backend\node_mod
ules\mongoose\lib\model.js:609:5)
            at C:\Users\Kristian\Desktop\barber-saas\backend\node_modules\mongoos
e\lib\model.js:2722:9
            at async Promise.all (index 0)
            at Function.create (C:\Users\Kristian\Desktop\barber-saas\backend\nod
e_modules\mongoose\lib\model.js:2707:11)
            at MongoReservaRepository.save (C:\Users\Kristian\Desktop\barber-saas
\backend\src\infrastructure\database\mongodb\repositories\MongoReservaRepository.
js:15:16)
            at TransactionManager.executeInTransaction.operationName (C:\Users\Kr
istian\Desktop\barber-saas\backend\src\application\use-cases\reservas\CreateReser
va.js:72:42)
            at Function.executeInTransaction (C:\Users\Kristian\Desktop\barber-sa
as\backend\src\utils\TransactionManager.js:57:32)
            at CreateReserva.execute (C:\Users\Kristian\Desktop\barber-saas\backe
nd\src\application\use-cases\reservas\CreateReserva.js:26:34)
            at Object.<anonymous>.exports.crearReservaBySlug (C:\Users\Kristian\D
esktop\barber-saas\backend\src\controllers\public.controller.js:140:25) {
          errorLabelSet: Set(0) {},
          errorResponse: {
            index: 0,
            code: 11000,
            errmsg: `E11000 duplicate key error collection: test.reservas index: 
unique_reservation_slot dup key: { barberoId: 
ObjectId('698be98b6a05e103eb47021b'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698be98b6a05e103eb470219') }`,
            keyPattern: [Object],
            keyValue: [Object]
          },
          index: 0,
          code: 11000,
          keyPattern: { barberoId: 1, fecha: 1, hora: 1, barberiaId: 1 },
          keyValue: {
            barberoId: new ObjectId('698be98b6a05e103eb47021b'),
            fecha: 2026-03-16T00:00:00.000Z,
            hora: '14:00',
            barberiaId: new ObjectId('698be98b6a05e103eb470219')
          }
        },
        context: { operationName: 'CreateReservation', attempt: 2 },
        timestamp: 2026-02-11T02:29:33.068Z,
        originalStack: `MongoServerError: E11000 duplicate key error collection: 
test.reservas index: unique_reservation_slot dup key: { barberoId: 
ObjectId('698be98b6a05e103eb47021b'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698be98b6a05e103eb470219') }\n` +
          '    at InsertOneOperation.handleOk (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\node_modules\\mongodb\\src\\operations\\insert.ts:79:13)\n' +
          '    at tryOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\backen
d\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:294:26)\n' +
          '    at processTicksAndRejections 
(node:internal/process/task_queues:105:5)\n' +
          '    at executeOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\ba
ckend\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:123:12)\n' +
          '    at Collection.insertOne (C:\\Users\\Kristian\\Desktop\\barber-saas
\\backend\\node_modules\\mongodb\\src\\collection.ts:294:12)\n' +
          '    at model.$__save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backe
nd\\node_modules\\mongoose\\lib\\model.js:398:16)\n' +
          '    at model.save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\
\node_modules\\mongoose\\lib\\model.js:609:5)\n' +
          '    at C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\\node_module
s\\mongoose\\lib\\model.js:2722:9\n' +
          '    at async Promise.all (index 0)\n' +
          '    at Function.create (C:\\Users\\Kristian\\Desktop\\barber-saas\\bac
kend\\node_modules\\mongoose\\lib\\model.js:2707:11)\n' +
          '    at MongoReservaRepository.save (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\src\\infrastructure\\database\\mongodb\\repositories\\MongoRese
rvaRepository.js:15:16)\n' +
          '    at TransactionManager.executeInTransaction.operationName (C:\\User
s\\Kristian\\Desktop\\barber-saas\\backend\\src\\application\\use-cases\\reservas
\\CreateReserva.js:72:42)\n' +
          '    at Function.executeInTransaction (C:\\Users\\Kristian\\Desktop\\ba
rber-saas\\backend\\src\\utils\\TransactionManager.js:57:32)\n' +
          '    at CreateReserva.execute (C:\\Users\\Kristian\\Desktop\\barber-saa
s\\backend\\src\\application\\use-cases\\reservas\\CreateReserva.js:26:34)\n' +
          '    at Object.<anonymous>.exports.crearReservaBySlug (C:\\Users\\Krist
ian\\Desktop\\barber-saas\\backend\\src\\controllers\\public.controller.js:140:25
)'
      }

    [0m [90m 4 |[39m
     [90m 5 |[39m [36mconst[39m errorHandler [33m=[39m (err[33m,[39m 
req[33m,[39m res[33m,[39m next) [33m=>[39m {
    [31m[1m>[22m[39m[90m 6 |[39m   console[33m.[39merror([32m"ƒö┤ 
ERROR:"[39m[33m,[39m err)[33m;[39m
     [90m   |[39m           [31m[1m^[22m[39m
     [90m 7 |[39m
     [90m 8 |[39m   [90m// ­ƒöÑ A├æADIR HEADERS CORS SI NO EXISTEN[39m
     [90m 9 |[39m   [36mconst[39m origin [33m=[39m 
req[33m.[39mheaders[33m.[39morigin[33m;[39m[0m

      at error (src/config/middleware/errorHandler.js:6:11)
      at Layer.handleError (node_modules/router/lib/layer.js:116:17)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at Layer.handleError (node_modules/router/lib/layer.js:111:12)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at Immediate.next (node_modules/router/index.js:291:5)
      at Immediate._onImmediate (node_modules/router/index.js:688:15)

    console.log
      [Transaction] Aborted: CreateReservation

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:69:29)

    console.error
      [Transaction] Failed: CreateReservation {
        error: `E11000 duplicate key error collection: test.reservas index: 
unique_reservation_slot dup key: { barberoId: 
ObjectId('698be98b6a05e103eb47021b'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698be98b6a05e103eb470219') }`,
        attempt: 2,
        stack: `MongoServerError: E11000 duplicate key error collection: 
test.reservas index: unique_reservation_slot dup key: { barberoId: 
ObjectId('698be98b6a05e103eb47021b'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698be98b6a05e103eb470219') }\n` +
          '    at InsertOneOperation.handleOk (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\node_modules\\mongodb\\src\\operations\\insert.ts:79:13)\n' +
          '    at tryOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\backen
d\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:294:26)\n' +
          '    at processTicksAndRejections 
(node:internal/process/task_queues:105:5)\n' +
          '    at executeOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\ba
ckend\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:123:12)\n' +
          '    at Collection.insertOne (C:\\Users\\Kristian\\Desktop\\barber-saas
\\backend\\node_modules\\mongodb\\src\\collection.ts:294:12)\n' +
          '    at model.$__save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backe
nd\\node_modules\\mongoose\\lib\\model.js:398:16)\n' +
          '    at model.save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\
\node_modules\\mongoose\\lib\\model.js:609:5)\n' +
          '    at C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\\node_module
s\\mongoose\\lib\\model.js:2722:9\n' +
          '    at async Promise.all (index 0)\n' +
          '    at Function.create (C:\\Users\\Kristian\\Desktop\\barber-saas\\bac
kend\\node_modules\\mongoose\\lib\\model.js:2707:11)\n' +
          '    at MongoReservaRepository.save (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\src\\infrastructure\\database\\mongodb\\repositories\\MongoRese
rvaRepository.js:15:16)\n' +
          '    at TransactionManager.executeInTransaction.operationName (C:\\User
s\\Kristian\\Desktop\\barber-saas\\backend\\src\\application\\use-cases\\reservas
\\CreateReserva.js:72:42)\n' +
          '    at Function.executeInTransaction (C:\\Users\\Kristian\\Desktop\\ba
rber-saas\\backend\\src\\utils\\TransactionManager.js:57:32)\n' +
          '    at CreateReserva.execute (C:\\Users\\Kristian\\Desktop\\barber-saa
s\\backend\\src\\application\\use-cases\\reservas\\CreateReserva.js:26:34)\n' +
          '    at Object.<anonymous>.exports.crearReservaBySlug (C:\\Users\\Krist
ian\\Desktop\\barber-saas\\backend\\src\\controllers\\public.controller.js:140:25
)'
      }

    [0m [90m 80 |[39m
     [90m 81 |[39m                 [90m// Non-transient error or max retries 
reached[39m
    [31m[1m>[22m[39m[90m 82 |[39m                 
console[33m.[39merror([32m`[Transaction] Failed: 
${operationName}`[39m[33m,[39m {
     [90m    |[39m                         [31m[1m^[22m[39m
     [90m 83 |[39m                     error[33m:[39m 
error[33m.[39mmessage[33m,[39m
     [90m 84 |[39m                     attempt[33m:[39m attempt [33m+[39m 
[35m1[39m[33m,[39m
     [90m 85 |[39m                     stack[33m:[39m 
error[33m.[39mstack[0m

      at Function.error [as executeInTransaction] 
(src/utils/TransactionManager.js:82:25)
      at CreateReserva.execute 
(src/application/use-cases/reservas/CreateReserva.js:26:34)
      at Object.<anonymous>.exports.crearReservaBySlug 
(src/controllers/public.controller.js:140:25)

    console.log
      [Transaction] Aborted: CreateReservation

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:69:29)

    console.error
      [Transaction] Failed: CreateReservation {
        error: `E11000 duplicate key error collection: test.reservas index: 
unique_reservation_slot dup key: { barberoId: 
ObjectId('698be98b6a05e103eb47021b'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698be98b6a05e103eb470219') }`,
        attempt: 2,
        stack: `MongoServerError: E11000 duplicate key error collection: 
test.reservas index: unique_reservation_slot dup key: { barberoId: 
ObjectId('698be98b6a05e103eb47021b'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698be98b6a05e103eb470219') }\n` +
          '    at InsertOneOperation.handleOk (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\node_modules\\mongodb\\src\\operations\\insert.ts:79:13)\n' +
          '    at tryOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\backen
d\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:294:26)\n' +
          '    at processTicksAndRejections 
(node:internal/process/task_queues:105:5)\n' +
          '    at executeOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\ba
ckend\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:123:12)\n' +
          '    at Collection.insertOne (C:\\Users\\Kristian\\Desktop\\barber-saas
\\backend\\node_modules\\mongodb\\src\\collection.ts:294:12)\n' +
          '    at model.$__save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backe
nd\\node_modules\\mongoose\\lib\\model.js:398:16)\n' +
          '    at model.save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\
\node_modules\\mongoose\\lib\\model.js:609:5)\n' +
          '    at C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\\node_module
s\\mongoose\\lib\\model.js:2722:9\n' +
          '    at async Promise.all (index 0)\n' +
          '    at Function.create (C:\\Users\\Kristian\\Desktop\\barber-saas\\bac
kend\\node_modules\\mongoose\\lib\\model.js:2707:11)\n' +
          '    at MongoReservaRepository.save (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\src\\infrastructure\\database\\mongodb\\repositories\\MongoRese
rvaRepository.js:15:16)\n' +
          '    at TransactionManager.executeInTransaction.operationName (C:\\User
s\\Kristian\\Desktop\\barber-saas\\backend\\src\\application\\use-cases\\reservas
\\CreateReserva.js:72:42)\n' +
          '    at Function.executeInTransaction (C:\\Users\\Kristian\\Desktop\\ba
rber-saas\\backend\\src\\utils\\TransactionManager.js:57:32)\n' +
          '    at CreateReserva.execute (C:\\Users\\Kristian\\Desktop\\barber-saa
s\\backend\\src\\application\\use-cases\\reservas\\CreateReserva.js:26:34)\n' +
          '    at Object.<anonymous>.exports.crearReservaBySlug (C:\\Users\\Krist
ian\\Desktop\\barber-saas\\backend\\src\\controllers\\public.controller.js:140:25
)'
      }

    [0m [90m 80 |[39m
     [90m 81 |[39m                 [90m// Non-transient error or max retries 
reached[39m
    [31m[1m>[22m[39m[90m 82 |[39m                 
console[33m.[39merror([32m`[Transaction] Failed: 
${operationName}`[39m[33m,[39m {
     [90m    |[39m                         [31m[1m^[22m[39m
     [90m 83 |[39m                     error[33m:[39m 
error[33m.[39mmessage[33m,[39m
     [90m 84 |[39m                     attempt[33m:[39m attempt [33m+[39m 
[35m1[39m[33m,[39m
     [90m 85 |[39m                     stack[33m:[39m 
error[33m.[39mstack[0m

      at Function.error [as executeInTransaction] 
(src/utils/TransactionManager.js:82:25)
      at CreateReserva.execute 
(src/application/use-cases/reservas/CreateReserva.js:26:34)
      at Object.<anonymous>.exports.crearReservaBySlug 
(src/controllers/public.controller.js:140:25)

    console.error
      ƒö┤ ERROR: TransactionError: Transaction failed for CreateReservation: 
E11000 duplicate key error collection: test.reservas index: 
unique_reservation_slot dup key: { barberoId: 
ObjectId('698be98b6a05e103eb47021b'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698be98b6a05e103eb470219') }
          at Function.executeInTransaction (C:\Users\Kristian\Desktop\barber-saas
\backend\src\utils\TransactionManager.js:88:42)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at CreateReserva.execute (C:\Users\Kristian\Desktop\barber-saas\backend
\src\application\use-cases\reservas\CreateReserva.js:26:34)
          at Object.<anonymous>.exports.crearReservaBySlug (C:\Users\Kristian\Des
ktop\barber-saas\backend\src\controllers\public.controller.js:140:25) {
        isTransactionError: true,
        originalError: MongoServerError: E11000 duplicate key error collection: 
test.reservas index: unique_reservation_slot dup key: { barberoId: 
ObjectId('698be98b6a05e103eb47021b'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698be98b6a05e103eb470219') }
            at InsertOneOperation.handleOk (C:\Users\Kristian\Desktop\barber-saas
\backend\node_modules\mongodb\src\operations\insert.ts:79:13)
            at tryOperation (C:\Users\Kristian\Desktop\barber-saas\backend\node_m
odules\mongodb\src\operations\execute_operation.ts:294:26)
            at processTicksAndRejections 
(node:internal/process/task_queues:105:5)
            at executeOperation (C:\Users\Kristian\Desktop\barber-saas\backend\no
de_modules\mongodb\src\operations\execute_operation.ts:123:12)
            at Collection.insertOne (C:\Users\Kristian\Desktop\barber-saas\backen
d\node_modules\mongodb\src\collection.ts:294:12)
            at model.$__save (C:\Users\Kristian\Desktop\barber-saas\backend\node_
modules\mongoose\lib\model.js:398:16)
            at model.save (C:\Users\Kristian\Desktop\barber-saas\backend\node_mod
ules\mongoose\lib\model.js:609:5)
            at C:\Users\Kristian\Desktop\barber-saas\backend\node_modules\mongoos
e\lib\model.js:2722:9
            at async Promise.all (index 0)
            at Function.create (C:\Users\Kristian\Desktop\barber-saas\backend\nod
e_modules\mongoose\lib\model.js:2707:11)
            at MongoReservaRepository.save (C:\Users\Kristian\Desktop\barber-saas
\backend\src\infrastructure\database\mongodb\repositories\MongoReservaRepository.
js:15:16)
            at TransactionManager.executeInTransaction.operationName (C:\Users\Kr
istian\Desktop\barber-saas\backend\src\application\use-cases\reservas\CreateReser
va.js:72:42)
            at Function.executeInTransaction (C:\Users\Kristian\Desktop\barber-sa
as\backend\src\utils\TransactionManager.js:57:32)
            at CreateReserva.execute (C:\Users\Kristian\Desktop\barber-saas\backe
nd\src\application\use-cases\reservas\CreateReserva.js:26:34)
            at Object.<anonymous>.exports.crearReservaBySlug (C:\Users\Kristian\D
esktop\barber-saas\backend\src\controllers\public.controller.js:140:25) {
          errorLabelSet: Set(0) {},
          errorResponse: {
            index: 0,
            code: 11000,
            errmsg: `E11000 duplicate key error collection: test.reservas index: 
unique_reservation_slot dup key: { barberoId: 
ObjectId('698be98b6a05e103eb47021b'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698be98b6a05e103eb470219') }`,
            keyPattern: [Object],
            keyValue: [Object]
          },
          index: 0,
          code: 11000,
          keyPattern: { barberoId: 1, fecha: 1, hora: 1, barberiaId: 1 },
          keyValue: {
            barberoId: new ObjectId('698be98b6a05e103eb47021b'),
            fecha: 2026-03-16T00:00:00.000Z,
            hora: '14:00',
            barberiaId: new ObjectId('698be98b6a05e103eb470219')
          }
        },
        context: { operationName: 'CreateReservation', attempt: 2 },
        timestamp: 2026-02-11T02:29:33.096Z,
        originalStack: `MongoServerError: E11000 duplicate key error collection: 
test.reservas index: unique_reservation_slot dup key: { barberoId: 
ObjectId('698be98b6a05e103eb47021b'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698be98b6a05e103eb470219') }\n` +
          '    at InsertOneOperation.handleOk (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\node_modules\\mongodb\\src\\operations\\insert.ts:79:13)\n' +
          '    at tryOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\backen
d\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:294:26)\n' +
          '    at processTicksAndRejections 
(node:internal/process/task_queues:105:5)\n' +
          '    at executeOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\ba
ckend\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:123:12)\n' +
          '    at Collection.insertOne (C:\\Users\\Kristian\\Desktop\\barber-saas
\\backend\\node_modules\\mongodb\\src\\collection.ts:294:12)\n' +
          '    at model.$__save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backe
nd\\node_modules\\mongoose\\lib\\model.js:398:16)\n' +
          '    at model.save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\
\node_modules\\mongoose\\lib\\model.js:609:5)\n' +
          '    at C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\\node_module
s\\mongoose\\lib\\model.js:2722:9\n' +
          '    at async Promise.all (index 0)\n' +
          '    at Function.create (C:\\Users\\Kristian\\Desktop\\barber-saas\\bac
kend\\node_modules\\mongoose\\lib\\model.js:2707:11)\n' +
          '    at MongoReservaRepository.save (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\src\\infrastructure\\database\\mongodb\\repositories\\MongoRese
rvaRepository.js:15:16)\n' +
          '    at TransactionManager.executeInTransaction.operationName (C:\\User
s\\Kristian\\Desktop\\barber-saas\\backend\\src\\application\\use-cases\\reservas
\\CreateReserva.js:72:42)\n' +
          '    at Function.executeInTransaction (C:\\Users\\Kristian\\Desktop\\ba
rber-saas\\backend\\src\\utils\\TransactionManager.js:57:32)\n' +
          '    at CreateReserva.execute (C:\\Users\\Kristian\\Desktop\\barber-saa
s\\backend\\src\\application\\use-cases\\reservas\\CreateReserva.js:26:34)\n' +
          '    at Object.<anonymous>.exports.crearReservaBySlug (C:\\Users\\Krist
ian\\Desktop\\barber-saas\\backend\\src\\controllers\\public.controller.js:140:25
)'
      }

    [0m [90m 4 |[39m
     [90m 5 |[39m [36mconst[39m errorHandler [33m=[39m (err[33m,[39m 
req[33m,[39m res[33m,[39m next) [33m=>[39m {
    [31m[1m>[22m[39m[90m 6 |[39m   console[33m.[39merror([32m"ƒö┤ 
ERROR:"[39m[33m,[39m err)[33m;[39m
     [90m   |[39m           [31m[1m^[22m[39m
     [90m 7 |[39m
     [90m 8 |[39m   [90m// ­ƒöÑ A├æADIR HEADERS CORS SI NO EXISTEN[39m
     [90m 9 |[39m   [36mconst[39m origin [33m=[39m 
req[33m.[39mheaders[33m.[39morigin[33m;[39m[0m

      at error (src/config/middleware/errorHandler.js:6:11)
      at Layer.handleError (node_modules/router/lib/layer.js:116:17)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at Layer.handleError (node_modules/router/lib/layer.js:111:12)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at Immediate.next (node_modules/router/index.js:291:5)
      at Immediate._onImmediate (node_modules/router/index.js:688:15)

    console.error
      ƒö┤ ERROR: TransactionError: Transaction failed for CreateReservation: 
E11000 duplicate key error collection: test.reservas index: 
unique_reservation_slot dup key: { barberoId: 
ObjectId('698be98b6a05e103eb47021b'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698be98b6a05e103eb470219') }
          at Function.executeInTransaction (C:\Users\Kristian\Desktop\barber-saas
\backend\src\utils\TransactionManager.js:88:42)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at CreateReserva.execute (C:\Users\Kristian\Desktop\barber-saas\backend
\src\application\use-cases\reservas\CreateReserva.js:26:34)
          at Object.<anonymous>.exports.crearReservaBySlug (C:\Users\Kristian\Des
ktop\barber-saas\backend\src\controllers\public.controller.js:140:25) {
        isTransactionError: true,
        originalError: MongoServerError: E11000 duplicate key error collection: 
test.reservas index: unique_reservation_slot dup key: { barberoId: 
ObjectId('698be98b6a05e103eb47021b'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698be98b6a05e103eb470219') }
            at InsertOneOperation.handleOk (C:\Users\Kristian\Desktop\barber-saas
\backend\node_modules\mongodb\src\operations\insert.ts:79:13)
            at tryOperation (C:\Users\Kristian\Desktop\barber-saas\backend\node_m
odules\mongodb\src\operations\execute_operation.ts:294:26)
            at processTicksAndRejections 
(node:internal/process/task_queues:105:5)
            at executeOperation (C:\Users\Kristian\Desktop\barber-saas\backend\no
de_modules\mongodb\src\operations\execute_operation.ts:123:12)
            at Collection.insertOne (C:\Users\Kristian\Desktop\barber-saas\backen
d\node_modules\mongodb\src\collection.ts:294:12)
            at model.$__save (C:\Users\Kristian\Desktop\barber-saas\backend\node_
modules\mongoose\lib\model.js:398:16)
            at model.save (C:\Users\Kristian\Desktop\barber-saas\backend\node_mod
ules\mongoose\lib\model.js:609:5)
            at C:\Users\Kristian\Desktop\barber-saas\backend\node_modules\mongoos
e\lib\model.js:2722:9
            at async Promise.all (index 0)
            at Function.create (C:\Users\Kristian\Desktop\barber-saas\backend\nod
e_modules\mongoose\lib\model.js:2707:11)
            at MongoReservaRepository.save (C:\Users\Kristian\Desktop\barber-saas
\backend\src\infrastructure\database\mongodb\repositories\MongoReservaRepository.
js:15:16)
            at TransactionManager.executeInTransaction.operationName (C:\Users\Kr
istian\Desktop\barber-saas\backend\src\application\use-cases\reservas\CreateReser
va.js:72:42)
            at Function.executeInTransaction (C:\Users\Kristian\Desktop\barber-sa
as\backend\src\utils\TransactionManager.js:57:32)
            at CreateReserva.execute (C:\Users\Kristian\Desktop\barber-saas\backe
nd\src\application\use-cases\reservas\CreateReserva.js:26:34)
            at Object.<anonymous>.exports.crearReservaBySlug (C:\Users\Kristian\D
esktop\barber-saas\backend\src\controllers\public.controller.js:140:25) {
          errorLabelSet: Set(0) {},
          errorResponse: {
            index: 0,
            code: 11000,
            errmsg: `E11000 duplicate key error collection: test.reservas index: 
unique_reservation_slot dup key: { barberoId: 
ObjectId('698be98b6a05e103eb47021b'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698be98b6a05e103eb470219') }`,
            keyPattern: [Object],
            keyValue: [Object]
          },
          index: 0,
          code: 11000,
          keyPattern: { barberoId: 1, fecha: 1, hora: 1, barberiaId: 1 },
          keyValue: {
            barberoId: new ObjectId('698be98b6a05e103eb47021b'),
            fecha: 2026-03-16T00:00:00.000Z,
            hora: '14:00',
            barberiaId: new ObjectId('698be98b6a05e103eb470219')
          }
        },
        context: { operationName: 'CreateReservation', attempt: 2 },
        timestamp: 2026-02-11T02:29:33.100Z,
        originalStack: `MongoServerError: E11000 duplicate key error collection: 
test.reservas index: unique_reservation_slot dup key: { barberoId: 
ObjectId('698be98b6a05e103eb47021b'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698be98b6a05e103eb470219') }\n` +
          '    at InsertOneOperation.handleOk (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\node_modules\\mongodb\\src\\operations\\insert.ts:79:13)\n' +
          '    at tryOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\backen
d\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:294:26)\n' +
          '    at processTicksAndRejections 
(node:internal/process/task_queues:105:5)\n' +
          '    at executeOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\ba
ckend\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:123:12)\n' +
          '    at Collection.insertOne (C:\\Users\\Kristian\\Desktop\\barber-saas
\\backend\\node_modules\\mongodb\\src\\collection.ts:294:12)\n' +
          '    at model.$__save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backe
nd\\node_modules\\mongoose\\lib\\model.js:398:16)\n' +
          '    at model.save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\
\node_modules\\mongoose\\lib\\model.js:609:5)\n' +
          '    at C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\\node_module
s\\mongoose\\lib\\model.js:2722:9\n' +
          '    at async Promise.all (index 0)\n' +
          '    at Function.create (C:\\Users\\Kristian\\Desktop\\barber-saas\\bac
kend\\node_modules\\mongoose\\lib\\model.js:2707:11)\n' +
          '    at MongoReservaRepository.save (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\src\\infrastructure\\database\\mongodb\\repositories\\MongoRese
rvaRepository.js:15:16)\n' +
          '    at TransactionManager.executeInTransaction.operationName (C:\\User
s\\Kristian\\Desktop\\barber-saas\\backend\\src\\application\\use-cases\\reservas
\\CreateReserva.js:72:42)\n' +
          '    at Function.executeInTransaction (C:\\Users\\Kristian\\Desktop\\ba
rber-saas\\backend\\src\\utils\\TransactionManager.js:57:32)\n' +
          '    at CreateReserva.execute (C:\\Users\\Kristian\\Desktop\\barber-saa
s\\backend\\src\\application\\use-cases\\reservas\\CreateReserva.js:26:34)\n' +
          '    at Object.<anonymous>.exports.crearReservaBySlug (C:\\Users\\Krist
ian\\Desktop\\barber-saas\\backend\\src\\controllers\\public.controller.js:140:25
)'
      }

    [0m [90m 4 |[39m
     [90m 5 |[39m [36mconst[39m errorHandler [33m=[39m (err[33m,[39m 
req[33m,[39m res[33m,[39m next) [33m=>[39m {
    [31m[1m>[22m[39m[90m 6 |[39m   console[33m.[39merror([32m"ƒö┤ 
ERROR:"[39m[33m,[39m err)[33m;[39m
     [90m   |[39m           [31m[1m^[22m[39m
     [90m 7 |[39m
     [90m 8 |[39m   [90m// ­ƒöÑ A├æADIR HEADERS CORS SI NO EXISTEN[39m
     [90m 9 |[39m   [36mconst[39m origin [33m=[39m 
req[33m.[39mheaders[33m.[39morigin[33m;[39m[0m

      at error (src/config/middleware/errorHandler.js:6:11)
      at Layer.handleError (node_modules/router/lib/layer.js:116:17)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at Layer.handleError (node_modules/router/lib/layer.js:111:12)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at Immediate.next (node_modules/router/index.js:291:5)
      at Immediate._onImmediate (node_modules/router/index.js:688:15)

    console.log
      [Transaction] Aborted: CreateReservation

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:69:29)

    console.error
      [Transaction] Failed: CreateReservation {
        error: `E11000 duplicate key error collection: test.reservas index: 
unique_reservation_slot dup key: { barberoId: 
ObjectId('698be98b6a05e103eb47021b'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698be98b6a05e103eb470219') }`,
        attempt: 2,
        stack: `MongoServerError: E11000 duplicate key error collection: 
test.reservas index: unique_reservation_slot dup key: { barberoId: 
ObjectId('698be98b6a05e103eb47021b'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698be98b6a05e103eb470219') }\n` +
          '    at InsertOneOperation.handleOk (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\node_modules\\mongodb\\src\\operations\\insert.ts:79:13)\n' +
          '    at tryOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\backen
d\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:294:26)\n' +
          '    at processTicksAndRejections 
(node:internal/process/task_queues:105:5)\n' +
          '    at executeOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\ba
ckend\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:123:12)\n' +
          '    at Collection.insertOne (C:\\Users\\Kristian\\Desktop\\barber-saas
\\backend\\node_modules\\mongodb\\src\\collection.ts:294:12)\n' +
          '    at model.$__save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backe
nd\\node_modules\\mongoose\\lib\\model.js:398:16)\n' +
          '    at model.save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\
\node_modules\\mongoose\\lib\\model.js:609:5)\n' +
          '    at C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\\node_module
s\\mongoose\\lib\\model.js:2722:9\n' +
          '    at async Promise.all (index 0)\n' +
          '    at Function.create (C:\\Users\\Kristian\\Desktop\\barber-saas\\bac
kend\\node_modules\\mongoose\\lib\\model.js:2707:11)\n' +
          '    at MongoReservaRepository.save (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\src\\infrastructure\\database\\mongodb\\repositories\\MongoRese
rvaRepository.js:15:16)\n' +
          '    at TransactionManager.executeInTransaction.operationName (C:\\User
s\\Kristian\\Desktop\\barber-saas\\backend\\src\\application\\use-cases\\reservas
\\CreateReserva.js:72:42)\n' +
          '    at Function.executeInTransaction (C:\\Users\\Kristian\\Desktop\\ba
rber-saas\\backend\\src\\utils\\TransactionManager.js:57:32)\n' +
          '    at CreateReserva.execute (C:\\Users\\Kristian\\Desktop\\barber-saa
s\\backend\\src\\application\\use-cases\\reservas\\CreateReserva.js:26:34)\n' +
          '    at Object.<anonymous>.exports.crearReservaBySlug (C:\\Users\\Krist
ian\\Desktop\\barber-saas\\backend\\src\\controllers\\public.controller.js:140:25
)'
      }

    [0m [90m 80 |[39m
     [90m 81 |[39m                 [90m// Non-transient error or max retries 
reached[39m
    [31m[1m>[22m[39m[90m 82 |[39m                 
console[33m.[39merror([32m`[Transaction] Failed: 
${operationName}`[39m[33m,[39m {
     [90m    |[39m                         [31m[1m^[22m[39m
     [90m 83 |[39m                     error[33m:[39m 
error[33m.[39mmessage[33m,[39m
     [90m 84 |[39m                     attempt[33m:[39m attempt [33m+[39m 
[35m1[39m[33m,[39m
     [90m 85 |[39m                     stack[33m:[39m 
error[33m.[39mstack[0m

      at Function.error [as executeInTransaction] 
(src/utils/TransactionManager.js:82:25)
      at CreateReserva.execute 
(src/application/use-cases/reservas/CreateReserva.js:26:34)
      at Object.<anonymous>.exports.crearReservaBySlug 
(src/controllers/public.controller.js:140:25)

    console.log
      [Transaction] Aborted: CreateReservation

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:69:29)

    console.error
      [Transaction] Failed: CreateReservation {
        error: `E11000 duplicate key error collection: test.reservas index: 
unique_reservation_slot dup key: { barberoId: 
ObjectId('698be98b6a05e103eb47021b'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698be98b6a05e103eb470219') }`,
        attempt: 2,
        stack: `MongoServerError: E11000 duplicate key error collection: 
test.reservas index: unique_reservation_slot dup key: { barberoId: 
ObjectId('698be98b6a05e103eb47021b'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698be98b6a05e103eb470219') }\n` +
          '    at InsertOneOperation.handleOk (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\node_modules\\mongodb\\src\\operations\\insert.ts:79:13)\n' +
          '    at tryOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\backen
d\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:294:26)\n' +
          '    at processTicksAndRejections 
(node:internal/process/task_queues:105:5)\n' +
          '    at executeOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\ba
ckend\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:123:12)\n' +
          '    at Collection.insertOne (C:\\Users\\Kristian\\Desktop\\barber-saas
\\backend\\node_modules\\mongodb\\src\\collection.ts:294:12)\n' +
          '    at model.$__save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backe
nd\\node_modules\\mongoose\\lib\\model.js:398:16)\n' +
          '    at model.save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\
\node_modules\\mongoose\\lib\\model.js:609:5)\n' +
          '    at C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\\node_module
s\\mongoose\\lib\\model.js:2722:9\n' +
          '    at async Promise.all (index 0)\n' +
          '    at Function.create (C:\\Users\\Kristian\\Desktop\\barber-saas\\bac
kend\\node_modules\\mongoose\\lib\\model.js:2707:11)\n' +
          '    at MongoReservaRepository.save (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\src\\infrastructure\\database\\mongodb\\repositories\\MongoRese
rvaRepository.js:15:16)\n' +
          '    at TransactionManager.executeInTransaction.operationName (C:\\User
s\\Kristian\\Desktop\\barber-saas\\backend\\src\\application\\use-cases\\reservas
\\CreateReserva.js:72:42)\n' +
          '    at Function.executeInTransaction (C:\\Users\\Kristian\\Desktop\\ba
rber-saas\\backend\\src\\utils\\TransactionManager.js:57:32)\n' +
          '    at CreateReserva.execute (C:\\Users\\Kristian\\Desktop\\barber-saa
s\\backend\\src\\application\\use-cases\\reservas\\CreateReserva.js:26:34)\n' +
          '    at Object.<anonymous>.exports.crearReservaBySlug (C:\\Users\\Krist
ian\\Desktop\\barber-saas\\backend\\src\\controllers\\public.controller.js:140:25
)'
      }

    [0m [90m 80 |[39m
     [90m 81 |[39m                 [90m// Non-transient error or max retries 
reached[39m
    [31m[1m>[22m[39m[90m 82 |[39m                 
console[33m.[39merror([32m`[Transaction] Failed: 
${operationName}`[39m[33m,[39m {
     [90m    |[39m                         [31m[1m^[22m[39m
     [90m 83 |[39m                     error[33m:[39m 
error[33m.[39mmessage[33m,[39m
     [90m 84 |[39m                     attempt[33m:[39m attempt [33m+[39m 
[35m1[39m[33m,[39m
     [90m 85 |[39m                     stack[33m:[39m 
error[33m.[39mstack[0m

      at Function.error [as executeInTransaction] 
(src/utils/TransactionManager.js:82:25)
      at CreateReserva.execute 
(src/application/use-cases/reservas/CreateReserva.js:26:34)
      at Object.<anonymous>.exports.crearReservaBySlug 
(src/controllers/public.controller.js:140:25)

    console.error
      ƒö┤ ERROR: TransactionError: Transaction failed for CreateReservation: 
E11000 duplicate key error collection: test.reservas index: 
unique_reservation_slot dup key: { barberoId: 
ObjectId('698be98b6a05e103eb47021b'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698be98b6a05e103eb470219') }
          at Function.executeInTransaction (C:\Users\Kristian\Desktop\barber-saas
\backend\src\utils\TransactionManager.js:88:42)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at CreateReserva.execute (C:\Users\Kristian\Desktop\barber-saas\backend
\src\application\use-cases\reservas\CreateReserva.js:26:34)
          at Object.<anonymous>.exports.crearReservaBySlug (C:\Users\Kristian\Des
ktop\barber-saas\backend\src\controllers\public.controller.js:140:25) {
        isTransactionError: true,
        originalError: MongoServerError: E11000 duplicate key error collection: 
test.reservas index: unique_reservation_slot dup key: { barberoId: 
ObjectId('698be98b6a05e103eb47021b'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698be98b6a05e103eb470219') }
            at InsertOneOperation.handleOk (C:\Users\Kristian\Desktop\barber-saas
\backend\node_modules\mongodb\src\operations\insert.ts:79:13)
            at tryOperation (C:\Users\Kristian\Desktop\barber-saas\backend\node_m
odules\mongodb\src\operations\execute_operation.ts:294:26)
            at processTicksAndRejections 
(node:internal/process/task_queues:105:5)
            at executeOperation (C:\Users\Kristian\Desktop\barber-saas\backend\no
de_modules\mongodb\src\operations\execute_operation.ts:123:12)
            at Collection.insertOne (C:\Users\Kristian\Desktop\barber-saas\backen
d\node_modules\mongodb\src\collection.ts:294:12)
            at model.$__save (C:\Users\Kristian\Desktop\barber-saas\backend\node_
modules\mongoose\lib\model.js:398:16)
            at model.save (C:\Users\Kristian\Desktop\barber-saas\backend\node_mod
ules\mongoose\lib\model.js:609:5)
            at C:\Users\Kristian\Desktop\barber-saas\backend\node_modules\mongoos
e\lib\model.js:2722:9
            at async Promise.all (index 0)
            at Function.create (C:\Users\Kristian\Desktop\barber-saas\backend\nod
e_modules\mongoose\lib\model.js:2707:11)
            at MongoReservaRepository.save (C:\Users\Kristian\Desktop\barber-saas
\backend\src\infrastructure\database\mongodb\repositories\MongoReservaRepository.
js:15:16)
            at TransactionManager.executeInTransaction.operationName (C:\Users\Kr
istian\Desktop\barber-saas\backend\src\application\use-cases\reservas\CreateReser
va.js:72:42)
            at Function.executeInTransaction (C:\Users\Kristian\Desktop\barber-sa
as\backend\src\utils\TransactionManager.js:57:32)
            at CreateReserva.execute (C:\Users\Kristian\Desktop\barber-saas\backe
nd\src\application\use-cases\reservas\CreateReserva.js:26:34)
            at Object.<anonymous>.exports.crearReservaBySlug (C:\Users\Kristian\D
esktop\barber-saas\backend\src\controllers\public.controller.js:140:25) {
          errorLabelSet: Set(0) {},
          errorResponse: {
            index: 0,
            code: 11000,
            errmsg: `E11000 duplicate key error collection: test.reservas index: 
unique_reservation_slot dup key: { barberoId: 
ObjectId('698be98b6a05e103eb47021b'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698be98b6a05e103eb470219') }`,
            keyPattern: [Object],
            keyValue: [Object]
          },
          index: 0,
          code: 11000,
          keyPattern: { barberoId: 1, fecha: 1, hora: 1, barberiaId: 1 },
          keyValue: {
            barberoId: new ObjectId('698be98b6a05e103eb47021b'),
            fecha: 2026-03-16T00:00:00.000Z,
            hora: '14:00',
            barberiaId: new ObjectId('698be98b6a05e103eb470219')
          }
        },
        context: { operationName: 'CreateReservation', attempt: 2 },
        timestamp: 2026-02-11T02:29:33.145Z,
        originalStack: `MongoServerError: E11000 duplicate key error collection: 
test.reservas index: unique_reservation_slot dup key: { barberoId: 
ObjectId('698be98b6a05e103eb47021b'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698be98b6a05e103eb470219') }\n` +
          '    at InsertOneOperation.handleOk (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\node_modules\\mongodb\\src\\operations\\insert.ts:79:13)\n' +
          '    at tryOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\backen
d\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:294:26)\n' +
          '    at processTicksAndRejections 
(node:internal/process/task_queues:105:5)\n' +
          '    at executeOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\ba
ckend\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:123:12)\n' +
          '    at Collection.insertOne (C:\\Users\\Kristian\\Desktop\\barber-saas
\\backend\\node_modules\\mongodb\\src\\collection.ts:294:12)\n' +
          '    at model.$__save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backe
nd\\node_modules\\mongoose\\lib\\model.js:398:16)\n' +
          '    at model.save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\
\node_modules\\mongoose\\lib\\model.js:609:5)\n' +
          '    at C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\\node_module
s\\mongoose\\lib\\model.js:2722:9\n' +
          '    at async Promise.all (index 0)\n' +
          '    at Function.create (C:\\Users\\Kristian\\Desktop\\barber-saas\\bac
kend\\node_modules\\mongoose\\lib\\model.js:2707:11)\n' +
          '    at MongoReservaRepository.save (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\src\\infrastructure\\database\\mongodb\\repositories\\MongoRese
rvaRepository.js:15:16)\n' +
          '    at TransactionManager.executeInTransaction.operationName (C:\\User
s\\Kristian\\Desktop\\barber-saas\\backend\\src\\application\\use-cases\\reservas
\\CreateReserva.js:72:42)\n' +
          '    at Function.executeInTransaction (C:\\Users\\Kristian\\Desktop\\ba
rber-saas\\backend\\src\\utils\\TransactionManager.js:57:32)\n' +
          '    at CreateReserva.execute (C:\\Users\\Kristian\\Desktop\\barber-saa
s\\backend\\src\\application\\use-cases\\reservas\\CreateReserva.js:26:34)\n' +
          '    at Object.<anonymous>.exports.crearReservaBySlug (C:\\Users\\Krist
ian\\Desktop\\barber-saas\\backend\\src\\controllers\\public.controller.js:140:25
)'
      }

    [0m [90m 4 |[39m
     [90m 5 |[39m [36mconst[39m errorHandler [33m=[39m (err[33m,[39m 
req[33m,[39m res[33m,[39m next) [33m=>[39m {
    [31m[1m>[22m[39m[90m 6 |[39m   console[33m.[39merror([32m"ƒö┤ 
ERROR:"[39m[33m,[39m err)[33m;[39m
     [90m   |[39m           [31m[1m^[22m[39m
     [90m 7 |[39m
     [90m 8 |[39m   [90m// ­ƒöÑ A├æADIR HEADERS CORS SI NO EXISTEN[39m
     [90m 9 |[39m   [36mconst[39m origin [33m=[39m 
req[33m.[39mheaders[33m.[39morigin[33m;[39m[0m

      at error (src/config/middleware/errorHandler.js:6:11)
      at Layer.handleError (node_modules/router/lib/layer.js:116:17)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at Layer.handleError (node_modules/router/lib/layer.js:111:12)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at Immediate.next (node_modules/router/index.js:291:5)
      at Immediate._onImmediate (node_modules/router/index.js:688:15)

    console.error
      ƒö┤ ERROR: TransactionError: Transaction failed for CreateReservation: 
E11000 duplicate key error collection: test.reservas index: 
unique_reservation_slot dup key: { barberoId: 
ObjectId('698be98b6a05e103eb47021b'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698be98b6a05e103eb470219') }
          at Function.executeInTransaction (C:\Users\Kristian\Desktop\barber-saas
\backend\src\utils\TransactionManager.js:88:42)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at CreateReserva.execute (C:\Users\Kristian\Desktop\barber-saas\backend
\src\application\use-cases\reservas\CreateReserva.js:26:34)
          at Object.<anonymous>.exports.crearReservaBySlug (C:\Users\Kristian\Des
ktop\barber-saas\backend\src\controllers\public.controller.js:140:25) {
        isTransactionError: true,
        originalError: MongoServerError: E11000 duplicate key error collection: 
test.reservas index: unique_reservation_slot dup key: { barberoId: 
ObjectId('698be98b6a05e103eb47021b'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698be98b6a05e103eb470219') }
            at InsertOneOperation.handleOk (C:\Users\Kristian\Desktop\barber-saas
\backend\node_modules\mongodb\src\operations\insert.ts:79:13)
            at tryOperation (C:\Users\Kristian\Desktop\barber-saas\backend\node_m
odules\mongodb\src\operations\execute_operation.ts:294:26)
            at processTicksAndRejections 
(node:internal/process/task_queues:105:5)
            at executeOperation (C:\Users\Kristian\Desktop\barber-saas\backend\no
de_modules\mongodb\src\operations\execute_operation.ts:123:12)
            at Collection.insertOne (C:\Users\Kristian\Desktop\barber-saas\backen
d\node_modules\mongodb\src\collection.ts:294:12)
            at model.$__save (C:\Users\Kristian\Desktop\barber-saas\backend\node_
modules\mongoose\lib\model.js:398:16)
            at model.save (C:\Users\Kristian\Desktop\barber-saas\backend\node_mod
ules\mongoose\lib\model.js:609:5)
            at C:\Users\Kristian\Desktop\barber-saas\backend\node_modules\mongoos
e\lib\model.js:2722:9
            at async Promise.all (index 0)
            at Function.create (C:\Users\Kristian\Desktop\barber-saas\backend\nod
e_modules\mongoose\lib\model.js:2707:11)
            at MongoReservaRepository.save (C:\Users\Kristian\Desktop\barber-saas
\backend\src\infrastructure\database\mongodb\repositories\MongoReservaRepository.
js:15:16)
            at TransactionManager.executeInTransaction.operationName (C:\Users\Kr
istian\Desktop\barber-saas\backend\src\application\use-cases\reservas\CreateReser
va.js:72:42)
            at Function.executeInTransaction (C:\Users\Kristian\Desktop\barber-sa
as\backend\src\utils\TransactionManager.js:57:32)
            at CreateReserva.execute (C:\Users\Kristian\Desktop\barber-saas\backe
nd\src\application\use-cases\reservas\CreateReserva.js:26:34)
            at Object.<anonymous>.exports.crearReservaBySlug (C:\Users\Kristian\D
esktop\barber-saas\backend\src\controllers\public.controller.js:140:25) {
          errorLabelSet: Set(0) {},
          errorResponse: {
            index: 0,
            code: 11000,
            errmsg: `E11000 duplicate key error collection: test.reservas index: 
unique_reservation_slot dup key: { barberoId: 
ObjectId('698be98b6a05e103eb47021b'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698be98b6a05e103eb470219') }`,
            keyPattern: [Object],
            keyValue: [Object]
          },
          index: 0,
          code: 11000,
          keyPattern: { barberoId: 1, fecha: 1, hora: 1, barberiaId: 1 },
          keyValue: {
            barberoId: new ObjectId('698be98b6a05e103eb47021b'),
            fecha: 2026-03-16T00:00:00.000Z,
            hora: '14:00',
            barberiaId: new ObjectId('698be98b6a05e103eb470219')
          }
        },
        context: { operationName: 'CreateReservation', attempt: 2 },
        timestamp: 2026-02-11T02:29:33.150Z,
        originalStack: `MongoServerError: E11000 duplicate key error collection: 
test.reservas index: unique_reservation_slot dup key: { barberoId: 
ObjectId('698be98b6a05e103eb47021b'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698be98b6a05e103eb470219') }\n` +
          '    at InsertOneOperation.handleOk (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\node_modules\\mongodb\\src\\operations\\insert.ts:79:13)\n' +
          '    at tryOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\backen
d\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:294:26)\n' +
          '    at processTicksAndRejections 
(node:internal/process/task_queues:105:5)\n' +
          '    at executeOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\ba
ckend\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:123:12)\n' +
          '    at Collection.insertOne (C:\\Users\\Kristian\\Desktop\\barber-saas
\\backend\\node_modules\\mongodb\\src\\collection.ts:294:12)\n' +
          '    at model.$__save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backe
nd\\node_modules\\mongoose\\lib\\model.js:398:16)\n' +
          '    at model.save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\
\node_modules\\mongoose\\lib\\model.js:609:5)\n' +
          '    at C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\\node_module
s\\mongoose\\lib\\model.js:2722:9\n' +
          '    at async Promise.all (index 0)\n' +
          '    at Function.create (C:\\Users\\Kristian\\Desktop\\barber-saas\\bac
kend\\node_modules\\mongoose\\lib\\model.js:2707:11)\n' +
          '    at MongoReservaRepository.save (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\src\\infrastructure\\database\\mongodb\\repositories\\MongoRese
rvaRepository.js:15:16)\n' +
          '    at TransactionManager.executeInTransaction.operationName (C:\\User
s\\Kristian\\Desktop\\barber-saas\\backend\\src\\application\\use-cases\\reservas
\\CreateReserva.js:72:42)\n' +
          '    at Function.executeInTransaction (C:\\Users\\Kristian\\Desktop\\ba
rber-saas\\backend\\src\\utils\\TransactionManager.js:57:32)\n' +
          '    at CreateReserva.execute (C:\\Users\\Kristian\\Desktop\\barber-saa
s\\backend\\src\\application\\use-cases\\reservas\\CreateReserva.js:26:34)\n' +
          '    at Object.<anonymous>.exports.crearReservaBySlug (C:\\Users\\Krist
ian\\Desktop\\barber-saas\\backend\\src\\controllers\\public.controller.js:140:25
)'
      }

    [0m [90m 4 |[39m
     [90m 5 |[39m [36mconst[39m errorHandler [33m=[39m (err[33m,[39m 
req[33m,[39m res[33m,[39m next) [33m=>[39m {
    [31m[1m>[22m[39m[90m 6 |[39m   console[33m.[39merror([32m"ƒö┤ 
ERROR:"[39m[33m,[39m err)[33m;[39m
     [90m   |[39m           [31m[1m^[22m[39m
     [90m 7 |[39m
     [90m 8 |[39m   [90m// ­ƒöÑ A├æADIR HEADERS CORS SI NO EXISTEN[39m
     [90m 9 |[39m   [36mconst[39m origin [33m=[39m 
req[33m.[39mheaders[33m.[39morigin[33m;[39m[0m

      at error (src/config/middleware/errorHandler.js:6:11)
      at Layer.handleError (node_modules/router/lib/layer.js:116:17)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at Layer.handleError (node_modules/router/lib/layer.js:111:12)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at Immediate.next (node_modules/router/index.js:291:5)
      at Immediate._onImmediate (node_modules/router/index.js:688:15)

    console.log
      [Transaction] Aborted: CreateReservation

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:69:29)

    console.error
      [Transaction] Failed: CreateReservation {
        error: `E11000 duplicate key error collection: test.reservas index: 
unique_reservation_slot dup key: { barberoId: 
ObjectId('698be98b6a05e103eb47021b'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698be98b6a05e103eb470219') }`,
        attempt: 2,
        stack: `MongoServerError: E11000 duplicate key error collection: 
test.reservas index: unique_reservation_slot dup key: { barberoId: 
ObjectId('698be98b6a05e103eb47021b'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698be98b6a05e103eb470219') }\n` +
          '    at InsertOneOperation.handleOk (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\node_modules\\mongodb\\src\\operations\\insert.ts:79:13)\n' +
          '    at tryOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\backen
d\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:294:26)\n' +
          '    at processTicksAndRejections 
(node:internal/process/task_queues:105:5)\n' +
          '    at executeOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\ba
ckend\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:123:12)\n' +
          '    at Collection.insertOne (C:\\Users\\Kristian\\Desktop\\barber-saas
\\backend\\node_modules\\mongodb\\src\\collection.ts:294:12)\n' +
          '    at model.$__save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backe
nd\\node_modules\\mongoose\\lib\\model.js:398:16)\n' +
          '    at model.save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\
\node_modules\\mongoose\\lib\\model.js:609:5)\n' +
          '    at C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\\node_module
s\\mongoose\\lib\\model.js:2722:9\n' +
          '    at async Promise.all (index 0)\n' +
          '    at Function.create (C:\\Users\\Kristian\\Desktop\\barber-saas\\bac
kend\\node_modules\\mongoose\\lib\\model.js:2707:11)\n' +
          '    at MongoReservaRepository.save (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\src\\infrastructure\\database\\mongodb\\repositories\\MongoRese
rvaRepository.js:15:16)\n' +
          '    at TransactionManager.executeInTransaction.operationName (C:\\User
s\\Kristian\\Desktop\\barber-saas\\backend\\src\\application\\use-cases\\reservas
\\CreateReserva.js:72:42)\n' +
          '    at Function.executeInTransaction (C:\\Users\\Kristian\\Desktop\\ba
rber-saas\\backend\\src\\utils\\TransactionManager.js:57:32)\n' +
          '    at CreateReserva.execute (C:\\Users\\Kristian\\Desktop\\barber-saa
s\\backend\\src\\application\\use-cases\\reservas\\CreateReserva.js:26:34)\n' +
          '    at Object.<anonymous>.exports.crearReservaBySlug (C:\\Users\\Krist
ian\\Desktop\\barber-saas\\backend\\src\\controllers\\public.controller.js:140:25
)'
      }

    [0m [90m 80 |[39m
     [90m 81 |[39m                 [90m// Non-transient error or max retries 
reached[39m
    [31m[1m>[22m[39m[90m 82 |[39m                 
console[33m.[39merror([32m`[Transaction] Failed: 
${operationName}`[39m[33m,[39m {
     [90m    |[39m                         [31m[1m^[22m[39m
     [90m 83 |[39m                     error[33m:[39m 
error[33m.[39mmessage[33m,[39m
     [90m 84 |[39m                     attempt[33m:[39m attempt [33m+[39m 
[35m1[39m[33m,[39m
     [90m 85 |[39m                     stack[33m:[39m 
error[33m.[39mstack[0m

      at Function.error [as executeInTransaction] 
(src/utils/TransactionManager.js:82:25)
      at CreateReserva.execute 
(src/application/use-cases/reservas/CreateReserva.js:26:34)
      at Object.<anonymous>.exports.crearReservaBySlug 
(src/controllers/public.controller.js:140:25)

    console.error
      ƒö┤ ERROR: TransactionError: Transaction failed for CreateReservation: 
E11000 duplicate key error collection: test.reservas index: 
unique_reservation_slot dup key: { barberoId: 
ObjectId('698be98b6a05e103eb47021b'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698be98b6a05e103eb470219') }
          at Function.executeInTransaction (C:\Users\Kristian\Desktop\barber-saas
\backend\src\utils\TransactionManager.js:88:42)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at CreateReserva.execute (C:\Users\Kristian\Desktop\barber-saas\backend
\src\application\use-cases\reservas\CreateReserva.js:26:34)
          at Object.<anonymous>.exports.crearReservaBySlug (C:\Users\Kristian\Des
ktop\barber-saas\backend\src\controllers\public.controller.js:140:25) {
        isTransactionError: true,
        originalError: MongoServerError: E11000 duplicate key error collection: 
test.reservas index: unique_reservation_slot dup key: { barberoId: 
ObjectId('698be98b6a05e103eb47021b'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698be98b6a05e103eb470219') }
            at InsertOneOperation.handleOk (C:\Users\Kristian\Desktop\barber-saas
\backend\node_modules\mongodb\src\operations\insert.ts:79:13)
            at tryOperation (C:\Users\Kristian\Desktop\barber-saas\backend\node_m
odules\mongodb\src\operations\execute_operation.ts:294:26)
            at processTicksAndRejections 
(node:internal/process/task_queues:105:5)
            at executeOperation (C:\Users\Kristian\Desktop\barber-saas\backend\no
de_modules\mongodb\src\operations\execute_operation.ts:123:12)
            at Collection.insertOne (C:\Users\Kristian\Desktop\barber-saas\backen
d\node_modules\mongodb\src\collection.ts:294:12)
            at model.$__save (C:\Users\Kristian\Desktop\barber-saas\backend\node_
modules\mongoose\lib\model.js:398:16)
            at model.save (C:\Users\Kristian\Desktop\barber-saas\backend\node_mod
ules\mongoose\lib\model.js:609:5)
            at C:\Users\Kristian\Desktop\barber-saas\backend\node_modules\mongoos
e\lib\model.js:2722:9
            at async Promise.all (index 0)
            at Function.create (C:\Users\Kristian\Desktop\barber-saas\backend\nod
e_modules\mongoose\lib\model.js:2707:11)
            at MongoReservaRepository.save (C:\Users\Kristian\Desktop\barber-saas
\backend\src\infrastructure\database\mongodb\repositories\MongoReservaRepository.
js:15:16)
            at TransactionManager.executeInTransaction.operationName (C:\Users\Kr
istian\Desktop\barber-saas\backend\src\application\use-cases\reservas\CreateReser
va.js:72:42)
            at Function.executeInTransaction (C:\Users\Kristian\Desktop\barber-sa
as\backend\src\utils\TransactionManager.js:57:32)
            at CreateReserva.execute (C:\Users\Kristian\Desktop\barber-saas\backe
nd\src\application\use-cases\reservas\CreateReserva.js:26:34)
            at Object.<anonymous>.exports.crearReservaBySlug (C:\Users\Kristian\D
esktop\barber-saas\backend\src\controllers\public.controller.js:140:25) {
          errorLabelSet: Set(0) {},
          errorResponse: {
            index: 0,
            code: 11000,
            errmsg: `E11000 duplicate key error collection: test.reservas index: 
unique_reservation_slot dup key: { barberoId: 
ObjectId('698be98b6a05e103eb47021b'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698be98b6a05e103eb470219') }`,
            keyPattern: [Object],
            keyValue: [Object]
          },
          index: 0,
          code: 11000,
          keyPattern: { barberoId: 1, fecha: 1, hora: 1, barberiaId: 1 },
          keyValue: {
            barberoId: new ObjectId('698be98b6a05e103eb47021b'),
            fecha: 2026-03-16T00:00:00.000Z,
            hora: '14:00',
            barberiaId: new ObjectId('698be98b6a05e103eb470219')
          }
        },
        context: { operationName: 'CreateReservation', attempt: 2 },
        timestamp: 2026-02-11T02:29:33.164Z,
        originalStack: `MongoServerError: E11000 duplicate key error collection: 
test.reservas index: unique_reservation_slot dup key: { barberoId: 
ObjectId('698be98b6a05e103eb47021b'), fecha: new Date(1773619200000), hora: 
"14:00", barberiaId: ObjectId('698be98b6a05e103eb470219') }\n` +
          '    at InsertOneOperation.handleOk (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\node_modules\\mongodb\\src\\operations\\insert.ts:79:13)\n' +
          '    at tryOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\backen
d\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:294:26)\n' +
          '    at processTicksAndRejections 
(node:internal/process/task_queues:105:5)\n' +
          '    at executeOperation (C:\\Users\\Kristian\\Desktop\\barber-saas\\ba
ckend\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:123:12)\n' +
          '    at Collection.insertOne (C:\\Users\\Kristian\\Desktop\\barber-saas
\\backend\\node_modules\\mongodb\\src\\collection.ts:294:12)\n' +
          '    at model.$__save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backe
nd\\node_modules\\mongoose\\lib\\model.js:398:16)\n' +
          '    at model.save (C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\
\node_modules\\mongoose\\lib\\model.js:609:5)\n' +
          '    at C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\\node_module
s\\mongoose\\lib\\model.js:2722:9\n' +
          '    at async Promise.all (index 0)\n' +
          '    at Function.create (C:\\Users\\Kristian\\Desktop\\barber-saas\\bac
kend\\node_modules\\mongoose\\lib\\model.js:2707:11)\n' +
          '    at MongoReservaRepository.save (C:\\Users\\Kristian\\Desktop\\barb
er-saas\\backend\\src\\infrastructure\\database\\mongodb\\repositories\\MongoRese
rvaRepository.js:15:16)\n' +
          '    at TransactionManager.executeInTransaction.operationName (C:\\User
s\\Kristian\\Desktop\\barber-saas\\backend\\src\\application\\use-cases\\reservas
\\CreateReserva.js:72:42)\n' +
          '    at Function.executeInTransaction (C:\\Users\\Kristian\\Desktop\\ba
rber-saas\\backend\\src\\utils\\TransactionManager.js:57:32)\n' +
          '    at CreateReserva.execute (C:\\Users\\Kristian\\Desktop\\barber-saa
s\\backend\\src\\application\\use-cases\\reservas\\CreateReserva.js:26:34)\n' +
          '    at Object.<anonymous>.exports.crearReservaBySlug (C:\\Users\\Krist
ian\\Desktop\\barber-saas\\backend\\src\\controllers\\public.controller.js:140:25
)'
      }

    [0m [90m 4 |[39m
     [90m 5 |[39m [36mconst[39m errorHandler [33m=[39m (err[33m,[39m 
req[33m,[39m res[33m,[39m next) [33m=>[39m {
    [31m[1m>[22m[39m[90m 6 |[39m   console[33m.[39merror([32m"ƒö┤ 
ERROR:"[39m[33m,[39m err)[33m;[39m
     [90m   |[39m           [31m[1m^[22m[39m
     [90m 7 |[39m
     [90m 8 |[39m   [90m// ­ƒöÑ A├æADIR HEADERS CORS SI NO EXISTEN[39m
     [90m 9 |[39m   [36mconst[39m origin [33m=[39m 
req[33m.[39mheaders[33m.[39morigin[33m;[39m[0m

      at error (src/config/middleware/errorHandler.js:6:11)
      at Layer.handleError (node_modules/router/lib/layer.js:116:17)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at Layer.handleError (node_modules/router/lib/layer.js:111:12)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at Immediate.next (node_modules/router/index.js:291:5)
      at Immediate._onImmediate (node_modules/router/index.js:688:15)

    console.log
      ƒôí [POST] 
/api/public/barberias/test-barberia/barberos/698be98d6a05e103eb47030a/reservar

      at log (src/app.js:93:11)

    console.warn
      ÔÜá´©Å  [Security] Rate limit exceeded {
        ip: '::ffff:127.0.0.1',
        method: 'POST',
        path: '/test-barberia/barberos/698be98d6a05e103eb47030a/reservar',
        max: 30
      }

    [0m [90m 38 |[39m [90m     */[39m
     [90m 39 |[39m     [36mstatic[39m warn(context[33m,[39m 
message[33m,[39m metadata [33m=[39m {}) {
    [31m[1m>[22m[39m[90m 40 |[39m         
console[33m.[39mwarn([32m`ÔÜá´©Å  [${context}] ${message}`[39m[33m,[39m 
metadata)[33m;[39m
     [90m    |[39m                 [31m[1m^[22m[39m
     [90m 41 |[39m     }
     [90m 42 |[39m
     [90m 43 |[39m     [90m/**[39m[0m

      at Function.warn (src/shared/Logger.js:40:17)
      at Object.warn [as handler] (src/middleware/rateLimit.middleware.js:18:20)
      at node_modules/express-rate-limit/dist/index.cjs:939:16
      at node_modules/express-rate-limit/dist/index.cjs:825:5

    console.log
      ƒôí [POST] 
/api/public/barberias/test-barberia/barberos/698be98e6a05e103eb47032a/reservar

      at log (src/app.js:93:11)

    console.warn
      ÔÜá´©Å  [Security] Rate limit exceeded {
        ip: '::ffff:127.0.0.1',
        method: 'POST',
        path: '/test-barberia/barberos/698be98e6a05e103eb47032a/reservar',
        max: 30
      }

    [0m [90m 38 |[39m [90m     */[39m
     [90m 39 |[39m     [36mstatic[39m warn(context[33m,[39m 
message[33m,[39m metadata [33m=[39m {}) {
    [31m[1m>[22m[39m[90m 40 |[39m         
console[33m.[39mwarn([32m`ÔÜá´©Å  [${context}] ${message}`[39m[33m,[39m 
metadata)[33m;[39m
     [90m    |[39m                 [31m[1m^[22m[39m
     [90m 41 |[39m     }
     [90m 42 |[39m
     [90m 43 |[39m     [90m/**[39m[0m

      at Function.warn (src/shared/Logger.js:40:17)
      at Object.warn [as handler] (src/middleware/rateLimit.middleware.js:18:20)
      at node_modules/express-rate-limit/dist/index.cjs:939:16
      at node_modules/express-rate-limit/dist/index.cjs:825:5

    console.log
      ƒôí [POST] 
/api/public/barberias/test-barberia/barberos/698be98e6a05e103eb47032a/reservar

      at log (src/app.js:93:11)

    console.warn
      ÔÜá´©Å  [Security] Rate limit exceeded {
        ip: '::ffff:127.0.0.1',
        method: 'POST',
        path: '/test-barberia/barberos/698be98e6a05e103eb47032a/reservar',
        max: 30
      }

    [0m [90m 38 |[39m [90m     */[39m
     [90m 39 |[39m     [36mstatic[39m warn(context[33m,[39m 
message[33m,[39m metadata [33m=[39m {}) {
    [31m[1m>[22m[39m[90m 40 |[39m         
console[33m.[39mwarn([32m`ÔÜá´©Å  [${context}] ${message}`[39m[33m,[39m 
metadata)[33m;[39m
     [90m    |[39m                 [31m[1m^[22m[39m
     [90m 41 |[39m     }
     [90m 42 |[39m
     [90m 43 |[39m     [90m/**[39m[0m

      at Function.warn (src/shared/Logger.js:40:17)
      at Object.warn [as handler] (src/middleware/rateLimit.middleware.js:18:20)
      at node_modules/express-rate-limit/dist/index.cjs:939:16
      at node_modules/express-rate-limit/dist/index.cjs:825:5

    console.log
      ƒôí [POST] 
/api/public/barberias/test-barberia/barberos/698be98e6a05e103eb47032a/reservar

      at log (src/app.js:93:11)

    console.warn
      ÔÜá´©Å  [Security] Rate limit exceeded {
        ip: '::ffff:127.0.0.1',
        method: 'POST',
        path: '/test-barberia/barberos/698be98e6a05e103eb47032a/reservar',
        max: 30
      }

    [0m [90m 38 |[39m [90m     */[39m
     [90m 39 |[39m     [36mstatic[39m warn(context[33m,[39m 
message[33m,[39m metadata [33m=[39m {}) {
    [31m[1m>[22m[39m[90m 40 |[39m         
console[33m.[39mwarn([32m`ÔÜá´©Å  [${context}] ${message}`[39m[33m,[39m 
metadata)[33m;[39m
     [90m    |[39m                 [31m[1m^[22m[39m
     [90m 41 |[39m     }
     [90m 42 |[39m
     [90m 43 |[39m     [90m/**[39m[0m

      at Function.warn (src/shared/Logger.js:40:17)
      at Object.warn [as handler] (src/middleware/rateLimit.middleware.js:18:20)
      at node_modules/express-rate-limit/dist/index.cjs:939:16
      at node_modules/express-rate-limit/dist/index.cjs:825:5

    console.log
      ƒôí [POST] 
/api/public/barberias/test-barberia/barberos/698be98e6a05e103eb47032a/reservar

      at log (src/app.js:93:11)

    console.warn
      ÔÜá´©Å  [Security] Rate limit exceeded {
        ip: '::ffff:127.0.0.1',
        method: 'POST',
        path: '/test-barberia/barberos/698be98e6a05e103eb47032a/reservar',
        max: 30
      }

    [0m [90m 38 |[39m [90m     */[39m
     [90m 39 |[39m     [36mstatic[39m warn(context[33m,[39m 
message[33m,[39m metadata [33m=[39m {}) {
    [31m[1m>[22m[39m[90m 40 |[39m         
console[33m.[39mwarn([32m`ÔÜá´©Å  [${context}] ${message}`[39m[33m,[39m 
metadata)[33m;[39m
     [90m    |[39m                 [31m[1m^[22m[39m
     [90m 41 |[39m     }
     [90m 42 |[39m
     [90m 43 |[39m     [90m/**[39m[0m

      at Function.warn (src/shared/Logger.js:40:17)
      at Object.warn [as handler] (src/middleware/rateLimit.middleware.js:18:20)
      at node_modules/express-rate-limit/dist/index.cjs:939:16
      at node_modules/express-rate-limit/dist/index.cjs:825:5

    console.log
      ƒôí [POST] 
/api/public/barberias/test-barberia/barberos/698be98e6a05e103eb47032a/reservar

      at log (src/app.js:93:11)

    console.warn
      ÔÜá´©Å  [Security] Rate limit exceeded {
        ip: '::ffff:127.0.0.1',
        method: 'POST',
        path: '/test-barberia/barberos/698be98e6a05e103eb47032a/reservar',
        max: 30
      }

    [0m [90m 38 |[39m [90m     */[39m
     [90m 39 |[39m     [36mstatic[39m warn(context[33m,[39m 
message[33m,[39m metadata [33m=[39m {}) {
    [31m[1m>[22m[39m[90m 40 |[39m         
console[33m.[39mwarn([32m`ÔÜá´©Å  [${context}] ${message}`[39m[33m,[39m 
metadata)[33m;[39m
     [90m    |[39m                 [31m[1m^[22m[39m
     [90m 41 |[39m     }
     [90m 42 |[39m
     [90m 43 |[39m     [90m/**[39m[0m

      at Function.warn (src/shared/Logger.js:40:17)
      at Object.warn [as handler] (src/middleware/rateLimit.middleware.js:18:20)
      at node_modules/express-rate-limit/dist/index.cjs:939:16
      at node_modules/express-rate-limit/dist/index.cjs:825:5

    console.log
      ƒôí [POST] 
/api/public/barberias/test-barberia/barberos/698be98e6a05e103eb47032a/reservar

      at log (src/app.js:93:11)

    console.warn
      ÔÜá´©Å  [Security] Rate limit exceeded {
        ip: '::ffff:127.0.0.1',
        method: 'POST',
        path: '/test-barberia/barberos/698be98e6a05e103eb47032a/reservar',
        max: 30
      }

    [0m [90m 38 |[39m [90m     */[39m
     [90m 39 |[39m     [36mstatic[39m warn(context[33m,[39m 
message[33m,[39m metadata [33m=[39m {}) {
    [31m[1m>[22m[39m[90m 40 |[39m         
console[33m.[39mwarn([32m`ÔÜá´©Å  [${context}] ${message}`[39m[33m,[39m 
metadata)[33m;[39m
     [90m    |[39m                 [31m[1m^[22m[39m
     [90m 41 |[39m     }
     [90m 42 |[39m
     [90m 43 |[39m     [90m/**[39m[0m

      at Function.warn (src/shared/Logger.js:40:17)
      at Object.warn [as handler] (src/middleware/rateLimit.middleware.js:18:20)
      at node_modules/express-rate-limit/dist/index.cjs:939:16
      at node_modules/express-rate-limit/dist/index.cjs:825:5

    console.log
      ƒôí [POST] 
/api/public/barberias/test-barberia/barberos/698be98e6a05e103eb47032a/reservar

      at log (src/app.js:93:11)

    console.warn
      ÔÜá´©Å  [Security] Rate limit exceeded {
        ip: '::ffff:127.0.0.1',
        method: 'POST',
        path: '/test-barberia/barberos/698be98e6a05e103eb47032a/reservar',
        max: 30
      }

    [0m [90m 38 |[39m [90m     */[39m
     [90m 39 |[39m     [36mstatic[39m warn(context[33m,[39m 
message[33m,[39m metadata [33m=[39m {}) {
    [31m[1m>[22m[39m[90m 40 |[39m         
console[33m.[39mwarn([32m`ÔÜá´©Å  [${context}] ${message}`[39m[33m,[39m 
metadata)[33m;[39m
     [90m    |[39m                 [31m[1m^[22m[39m
     [90m 41 |[39m     }
     [90m 42 |[39m
     [90m 43 |[39m     [90m/**[39m[0m

      at Function.warn (src/shared/Logger.js:40:17)
      at Object.warn [as handler] (src/middleware/rateLimit.middleware.js:18:20)
      at node_modules/express-rate-limit/dist/index.cjs:939:16
      at node_modules/express-rate-limit/dist/index.cjs:825:5

    console.log
      ƒôí [POST] 
/api/public/barberias/test-barberia/barberos/698be98e6a05e103eb47032a/reservar

      at log (src/app.js:93:11)

    console.warn
      ÔÜá´©Å  [Security] Rate limit exceeded {
        ip: '::ffff:127.0.0.1',
        method: 'POST',
        path: '/test-barberia/barberos/698be98e6a05e103eb47032a/reservar',
        max: 30
      }

    [0m [90m 38 |[39m [90m     */[39m
     [90m 39 |[39m     [36mstatic[39m warn(context[33m,[39m 
message[33m,[39m metadata [33m=[39m {}) {
    [31m[1m>[22m[39m[90m 40 |[39m         
console[33m.[39mwarn([32m`ÔÜá´©Å  [${context}] ${message}`[39m[33m,[39m 
metadata)[33m;[39m
     [90m    |[39m                 [31m[1m^[22m[39m
     [90m 41 |[39m     }
     [90m 42 |[39m
     [90m 43 |[39m     [90m/**[39m[0m

      at Function.warn (src/shared/Logger.js:40:17)
      at Object.warn [as handler] (src/middleware/rateLimit.middleware.js:18:20)
      at node_modules/express-rate-limit/dist/index.cjs:939:16
      at node_modules/express-rate-limit/dist/index.cjs:825:5

    console.log
      ƒôí [POST] 
/api/public/barberias/test-barberia/barberos/698be98e6a05e103eb47032a/reservar

      at log (src/app.js:93:11)

    console.warn
      ÔÜá´©Å  [Security] Rate limit exceeded {
        ip: '::ffff:127.0.0.1',
        method: 'POST',
        path: '/test-barberia/barberos/698be98e6a05e103eb47032a/reservar',
        max: 30
      }

    [0m [90m 38 |[39m [90m     */[39m
     [90m 39 |[39m     [36mstatic[39m warn(context[33m,[39m 
message[33m,[39m metadata [33m=[39m {}) {
    [31m[1m>[22m[39m[90m 40 |[39m         
console[33m.[39mwarn([32m`ÔÜá´©Å  [${context}] ${message}`[39m[33m,[39m 
metadata)[33m;[39m
     [90m    |[39m                 [31m[1m^[22m[39m
     [90m 41 |[39m     }
     [90m 42 |[39m
     [90m 43 |[39m     [90m/**[39m[0m

      at Function.warn (src/shared/Logger.js:40:17)
      at Object.warn [as handler] (src/middleware/rateLimit.middleware.js:18:20)
      at node_modules/express-rate-limit/dist/index.cjs:939:16
      at node_modules/express-rate-limit/dist/index.cjs:825:5

    console.log
      ƒôí [POST] 
/api/public/barberias/test-barberia/barberos/698be98e6a05e103eb47032a/reservar

      at log (src/app.js:93:11)

    console.warn
      ÔÜá´©Å  [Security] Rate limit exceeded {
        ip: '::ffff:127.0.0.1',
        method: 'POST',
        path: '/test-barberia/barberos/698be98e6a05e103eb47032a/reservar',
        max: 30
      }

    [0m [90m 38 |[39m [90m     */[39m
     [90m 39 |[39m     [36mstatic[39m warn(context[33m,[39m 
message[33m,[39m metadata [33m=[39m {}) {
    [31m[1m>[22m[39m[90m 40 |[39m         
console[33m.[39mwarn([32m`ÔÜá´©Å  [${context}] ${message}`[39m[33m,[39m 
metadata)[33m;[39m
     [90m    |[39m                 [31m[1m^[22m[39m
     [90m 41 |[39m     }
     [90m 42 |[39m
     [90m 43 |[39m     [90m/**[39m[0m

      at Function.warn (src/shared/Logger.js:40:17)
      at Object.warn [as handler] (src/middleware/rateLimit.middleware.js:18:20)
      at node_modules/express-rate-limit/dist/index.cjs:939:16
      at node_modules/express-rate-limit/dist/index.cjs:825:5

    console.log
      ƒôí [POST] 
/api/public/barberias/test-barberia/barberos/698be98e6a05e103eb47032a/reservar

      at log (src/app.js:93:11)

    console.warn
      ÔÜá´©Å  [Security] Rate limit exceeded {
        ip: '::ffff:127.0.0.1',
        method: 'POST',
        path: '/test-barberia/barberos/698be98e6a05e103eb47032a/reservar',
        max: 30
      }

    [0m [90m 38 |[39m [90m     */[39m
     [90m 39 |[39m     [36mstatic[39m warn(context[33m,[39m 
message[33m,[39m metadata [33m=[39m {}) {
    [31m[1m>[22m[39m[90m 40 |[39m         
console[33m.[39mwarn([32m`ÔÜá´©Å  [${context}] ${message}`[39m[33m,[39m 
metadata)[33m;[39m
     [90m    |[39m                 [31m[1m^[22m[39m
     [90m 41 |[39m     }
     [90m 42 |[39m
     [90m 43 |[39m     [90m/**[39m[0m

      at Function.warn (src/shared/Logger.js:40:17)
      at Object.warn [as handler] (src/middleware/rateLimit.middleware.js:18:20)
      at node_modules/express-rate-limit/dist/index.cjs:939:16
      at node_modules/express-rate-limit/dist/index.cjs:825:5

    console.log
      ƒôí [POST] 
/api/public/barberias/test-barberia/barberos/698be98e6a05e103eb47032a/reservar

      at log (src/app.js:93:11)

    console.warn
      ÔÜá´©Å  [Security] Rate limit exceeded {
        ip: '::ffff:127.0.0.1',
        method: 'POST',
        path: '/test-barberia/barberos/698be98e6a05e103eb47032a/reservar',
        max: 30
      }

    [0m [90m 38 |[39m [90m     */[39m
     [90m 39 |[39m     [36mstatic[39m warn(context[33m,[39m 
message[33m,[39m metadata [33m=[39m {}) {
    [31m[1m>[22m[39m[90m 40 |[39m         
console[33m.[39mwarn([32m`ÔÜá´©Å  [${context}] ${message}`[39m[33m,[39m 
metadata)[33m;[39m
     [90m    |[39m                 [31m[1m^[22m[39m
     [90m 41 |[39m     }
     [90m 42 |[39m
     [90m 43 |[39m     [90m/**[39m[0m

      at Function.warn (src/shared/Logger.js:40:17)
      at Object.warn [as handler] (src/middleware/rateLimit.middleware.js:18:20)
      at node_modules/express-rate-limit/dist/index.cjs:939:16
      at node_modules/express-rate-limit/dist/index.cjs:825:5

    console.log
      ƒôí [POST] 
/api/public/barberias/test-barberia/barberos/698be98e6a05e103eb47032a/reservar

      at log (src/app.js:93:11)

    console.warn
      ÔÜá´©Å  [Security] Rate limit exceeded {
        ip: '::ffff:127.0.0.1',
        method: 'POST',
        path: '/test-barberia/barberos/698be98e6a05e103eb47032a/reservar',
        max: 30
      }

    [0m [90m 38 |[39m [90m     */[39m
     [90m 39 |[39m     [36mstatic[39m warn(context[33m,[39m 
message[33m,[39m metadata [33m=[39m {}) {
    [31m[1m>[22m[39m[90m 40 |[39m         
console[33m.[39mwarn([32m`ÔÜá´©Å  [${context}] ${message}`[39m[33m,[39m 
metadata)[33m;[39m
     [90m    |[39m                 [31m[1m^[22m[39m
     [90m 41 |[39m     }
     [90m 42 |[39m
     [90m 43 |[39m     [90m/**[39m[0m

      at Function.warn (src/shared/Logger.js:40:17)
      at Object.warn [as handler] (src/middleware/rateLimit.middleware.js:18:20)
      at node_modules/express-rate-limit/dist/index.cjs:939:16
      at node_modules/express-rate-limit/dist/index.cjs:825:5

    console.log
      ƒôí [POST] 
/api/public/barberias/test-barberia/barberos/698be98e6a05e103eb47032a/reservar

      at log (src/app.js:93:11)

    console.warn
      ÔÜá´©Å  [Security] Rate limit exceeded {
        ip: '::ffff:127.0.0.1',
        method: 'POST',
        path: '/test-barberia/barberos/698be98e6a05e103eb47032a/reservar',
        max: 30
      }

    [0m [90m 38 |[39m [90m     */[39m
     [90m 39 |[39m     [36mstatic[39m warn(context[33m,[39m 
message[33m,[39m metadata [33m=[39m {}) {
    [31m[1m>[22m[39m[90m 40 |[39m         
console[33m.[39mwarn([32m`ÔÜá´©Å  [${context}] ${message}`[39m[33m,[39m 
metadata)[33m;[39m
     [90m    |[39m                 [31m[1m^[22m[39m
     [90m 41 |[39m     }
     [90m 42 |[39m
     [90m 43 |[39m     [90m/**[39m[0m

      at Function.warn (src/shared/Logger.js:40:17)
      at Object.warn [as handler] (src/middleware/rateLimit.middleware.js:18:20)
      at node_modules/express-rate-limit/dist/index.cjs:939:16
      at node_modules/express-rate-limit/dist/index.cjs:825:5

    console.log
      ƒôí [POST] 
/api/public/barberias/test-barberia/barberos/698be98e6a05e103eb47032a/reservar

      at log (src/app.js:93:11)

    console.warn
      ÔÜá´©Å  [Security] Rate limit exceeded {
        ip: '::ffff:127.0.0.1',
        method: 'POST',
        path: '/test-barberia/barberos/698be98e6a05e103eb47032a/reservar',
        max: 30
      }

    [0m [90m 38 |[39m [90m     */[39m
     [90m 39 |[39m     [36mstatic[39m warn(context[33m,[39m 
message[33m,[39m metadata [33m=[39m {}) {
    [31m[1m>[22m[39m[90m 40 |[39m         
console[33m.[39mwarn([32m`ÔÜá´©Å  [${context}] ${message}`[39m[33m,[39m 
metadata)[33m;[39m
     [90m    |[39m                 [31m[1m^[22m[39m
     [90m 41 |[39m     }
     [90m 42 |[39m
     [90m 43 |[39m     [90m/**[39m[0m

      at Function.warn (src/shared/Logger.js:40:17)
      at Object.warn [as handler] (src/middleware/rateLimit.middleware.js:18:20)
      at node_modules/express-rate-limit/dist/index.cjs:939:16
      at node_modules/express-rate-limit/dist/index.cjs:825:5

    console.log
      ƒôí [POST] 
/api/public/barberias/test-barberia/barberos/698be98e6a05e103eb47032a/reservar

      at log (src/app.js:93:11)

    console.warn
      ÔÜá´©Å  [Security] Rate limit exceeded {
        ip: '::ffff:127.0.0.1',
        method: 'POST',
        path: '/test-barberia/barberos/698be98e6a05e103eb47032a/reservar',
        max: 30
      }

    [0m [90m 38 |[39m [90m     */[39m
     [90m 39 |[39m     [36mstatic[39m warn(context[33m,[39m 
message[33m,[39m metadata [33m=[39m {}) {
    [31m[1m>[22m[39m[90m 40 |[39m         
console[33m.[39mwarn([32m`ÔÜá´©Å  [${context}] ${message}`[39m[33m,[39m 
metadata)[33m;[39m
     [90m    |[39m                 [31m[1m^[22m[39m
     [90m 41 |[39m     }
     [90m 42 |[39m
     [90m 43 |[39m     [90m/**[39m[0m

      at Function.warn (src/shared/Logger.js:40:17)
      at Object.warn [as handler] (src/middleware/rateLimit.middleware.js:18:20)
      at node_modules/express-rate-limit/dist/index.cjs:939:16
      at node_modules/express-rate-limit/dist/index.cjs:825:5

    console.log
      ƒôí [POST] 
/api/public/barberias/test-barberia/barberos/698be98e6a05e103eb47032a/reservar

      at log (src/app.js:93:11)

    console.warn
      ÔÜá´©Å  [Security] Rate limit exceeded {
        ip: '::ffff:127.0.0.1',
        method: 'POST',
        path: '/test-barberia/barberos/698be98e6a05e103eb47032a/reservar',
        max: 30
      }

    [0m [90m 38 |[39m [90m     */[39m
     [90m 39 |[39m     [36mstatic[39m warn(context[33m,[39m 
message[33m,[39m metadata [33m=[39m {}) {
    [31m[1m>[22m[39m[90m 40 |[39m         
console[33m.[39mwarn([32m`ÔÜá´©Å  [${context}] ${message}`[39m[33m,[39m 
metadata)[33m;[39m
     [90m    |[39m                 [31m[1m^[22m[39m
     [90m 41 |[39m     }
     [90m 42 |[39m
     [90m 43 |[39m     [90m/**[39m[0m

      at Function.warn (src/shared/Logger.js:40:17)
      at Object.warn [as handler] (src/middleware/rateLimit.middleware.js:18:20)
      at node_modules/express-rate-limit/dist/index.cjs:939:16
      at node_modules/express-rate-limit/dist/index.cjs:825:5

    console.log
      ƒôí [POST] 
/api/public/barberias/test-barberia/barberos/698be98e6a05e103eb47032a/reservar

      at log (src/app.js:93:11)

    console.warn
      ÔÜá´©Å  [Security] Rate limit exceeded {
        ip: '::ffff:127.0.0.1',
        method: 'POST',
        path: '/test-barberia/barberos/698be98e6a05e103eb47032a/reservar',
        max: 30
      }

    [0m [90m 38 |[39m [90m     */[39m
     [90m 39 |[39m     [36mstatic[39m warn(context[33m,[39m 
message[33m,[39m metadata [33m=[39m {}) {
    [31m[1m>[22m[39m[90m 40 |[39m         
console[33m.[39mwarn([32m`ÔÜá´©Å  [${context}] ${message}`[39m[33m,[39m 
metadata)[33m;[39m
     [90m    |[39m                 [31m[1m^[22m[39m
     [90m 41 |[39m     }
     [90m 42 |[39m
     [90m 43 |[39m     [90m/**[39m[0m

      at Function.warn (src/shared/Logger.js:40:17)
      at Object.warn [as handler] (src/middleware/rateLimit.middleware.js:18:20)
      at node_modules/express-rate-limit/dist/index.cjs:939:16
      at node_modules/express-rate-limit/dist/index.cjs:825:5

    console.log
      ƒôí [POST] 
/api/public/barberias/test-barberia/barberos/698be98e6a05e103eb47032a/reservar

      at log (src/app.js:93:11)

    console.warn
      ÔÜá´©Å  [Security] Rate limit exceeded {
        ip: '::ffff:127.0.0.1',
        method: 'POST',
        path: '/test-barberia/barberos/698be98e6a05e103eb47032a/reservar',
        max: 30
      }

    [0m [90m 38 |[39m [90m     */[39m
     [90m 39 |[39m     [36mstatic[39m warn(context[33m,[39m 
message[33m,[39m metadata [33m=[39m {}) {
    [31m[1m>[22m[39m[90m 40 |[39m         
console[33m.[39mwarn([32m`ÔÜá´©Å  [${context}] ${message}`[39m[33m,[39m 
metadata)[33m;[39m
     [90m    |[39m                 [31m[1m^[22m[39m
     [90m 41 |[39m     }
     [90m 42 |[39m
     [90m 43 |[39m     [90m/**[39m[0m

      at Function.warn (src/shared/Logger.js:40:17)
      at Object.warn [as handler] (src/middleware/rateLimit.middleware.js:18:20)
      at node_modules/express-rate-limit/dist/index.cjs:939:16
      at node_modules/express-rate-limit/dist/index.cjs:825:5

    console.log
      ƒôí [POST] 
/api/public/barberias/test-barberia/barberos/698be98e6a05e103eb47032a/reservar

      at log (src/app.js:93:11)

    console.warn
      ÔÜá´©Å  [Security] Rate limit exceeded {
        ip: '::ffff:127.0.0.1',
        method: 'POST',
        path: '/test-barberia/barberos/698be98e6a05e103eb47032a/reservar',
        max: 30
      }

    [0m [90m 38 |[39m [90m     */[39m
     [90m 39 |[39m     [36mstatic[39m warn(context[33m,[39m 
message[33m,[39m metadata [33m=[39m {}) {
    [31m[1m>[22m[39m[90m 40 |[39m         
console[33m.[39mwarn([32m`ÔÜá´©Å  [${context}] ${message}`[39m[33m,[39m 
metadata)[33m;[39m
     [90m    |[39m                 [31m[1m^[22m[39m
     [90m 41 |[39m     }
     [90m 42 |[39m
     [90m 43 |[39m     [90m/**[39m[0m

      at Function.warn (src/shared/Logger.js:40:17)
      at Object.warn [as handler] (src/middleware/rateLimit.middleware.js:18:20)
      at node_modules/express-rate-limit/dist/index.cjs:939:16
      at node_modules/express-rate-limit/dist/index.cjs:825:5

  ÔùÅ ƒöÑ Race Condition Stress Tests ÔÇ║ Performance bajo carga ÔÇ║ Maneja 20 
reservas diferentes simult├íneas sin problemas

    expect(received).toBeGreaterThan(expected)

    Expected: > 15
    Received:   0

    [0m [90m 255 |[39m
     [90m 256 |[39m             [90m// Todas deber├¡an tener ├®xito 
(diferentes horarios)[39m
    [31m[1m>[22m[39m[90m 257 |[39m             expect(successful[33m.[39m
length)[33m.[39mtoBeGreaterThan([35m15[39m)[33m;[39m [90m// Al menos 75% 
de ├®xito[39m
     [90m     |[39m                                       [31m[1m^[22m[39m
     [90m 258 |[39m
     [90m 259 |[39m             [90m// Verificar que no hay duplicados[39m
     [90m 260 |[39m             [36mconst[39m reservas [33m=[39m 
[36mawait[39m [33mReserva[39m[33m.[39mfind({[0m

      at Object.toBeGreaterThan (tests/race-condition-stress.test.js:257:39)

(node:25200) [MONGOOSE] Warning: Duplicate schema index on {"reviewToken":1} 
found. This is often due to declaring an index using both "index: true" and 
"schema.index()". Please remove the duplicate index definition.
(node:25200) [MONGOOSE] Warning: Duplicate schema index on {"reviewToken":1} 
found. This is often due to declaring an index using both "index: true" and 
"schema.index()". Please remove the duplicate index definition.
[0mPOST /api/public/barberias/atomic-shop/barberos/698be994dc4035a7bc8894b2/reservar [32m201[0m 58.530 ms - 638[0m
[0mPOST /api/public/barberias/atomic-shop/barberos/698be994dc4035a7bc8894b2/reservar [32m201[0m 46.288 ms - 638[0m
[0mPOST /api/public/barberias/atomic-shop/barberos/698be994dc4035a7bc8894b2/reservar [32m201[0m 63.043 ms - 638[0m
[0mPOST /api/public/barberias/atomic-shop/barberos/698be994dc4035a7bc8894b2/reservar [32m201[0m 44.369 ms - 638[0m
FAIL tests/reservas_atomicas.test.js (5.246 s)
  ÔùÅ Console

    console.log
      [dotenv@17.2.3] injecting env (13) from .env -- tip: ƒöÉ prevent building 
.env in docker: https://dotenvx.com/prebuild

      at _log (node_modules/dotenv/lib/main.js:142:11)

    console.log
      ƒôí [POST] 
/api/public/barberias/atomic-shop/barberos/698be994dc4035a7bc8894b2/reservar

      at log (src/app.js:93:11)

    console.log
      [Transaction] Started: CreateReservation (attempt 1/3)

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:54:25)

    console.log
      [Transaction] Committed: CreateReservation

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:61:25)

    console.log
      ƒôí [POST] 
/api/public/barberias/atomic-shop/barberos/698be994dc4035a7bc8894b2/reservar

      at log (src/app.js:93:11)

    console.log
      [Transaction] Started: CreateReservation (attempt 1/3)

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:54:25)

    console.log
      [Transaction] Committed: CreateReservation

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:61:25)

    console.log
      ƒôí [POST] 
/api/public/barberias/atomic-shop/barberos/698be994dc4035a7bc8894b2/reservar

      at log (src/app.js:93:11)

    console.log
      [Transaction] Started: CreateReservation (attempt 1/3)

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:54:25)

    console.log
      [Transaction] Committed: CreateReservation

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:61:25)

    console.log
      ƒôí [POST] 
/api/public/barberias/atomic-shop/barberos/698be994dc4035a7bc8894b2/reservar

      at log (src/app.js:93:11)

    console.log
      [Transaction] Started: CreateReservation (attempt 1/3)

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:54:25)

    console.log
      [Transaction] Committed: CreateReservation

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:61:25)

  ÔùÅ Pruebas de Atomicidad de Reservas (Anti-Overbooking) ÔÇ║ No debe permitir 
dos reservas en el mismo horario (Previene Overbooking)

    expect(received).toBe(expected) // Object.is equality

    Expected: 409
    Received: 201

    [0m [90m 85 |[39m
     [90m 86 |[39m         [90m// Debe fallar con el c├│digo 409 Conflict (no 
400)[39m
    [31m[1m>[22m[39m[90m 87 |[39m         
expect(res2[33m.[39mstatus)[33m.[39mtoBe([35m409[39m)[33m;[39m
     [90m    |[39m                             [31m[1m^[22m[39m
     [90m 88 |[39m         
expect(res2[33m.[39mbody[33m.[39mmessage)[33m.[39mtoContain([32m'Alguien 
acaba de reservar este horario'[39m)[33m;[39m
     [90m 89 |[39m
     [90m 90 |[39m         [90m// Verificar en la BD que solo hay una reserva 
real[39m[0m

      at Object.toBe (tests/reservas_atomicas.test.js:87:29)

(node:25200) [MONGOOSE] Warning: Duplicate schema index on {"reviewToken":1} 
found. This is often due to declaring an index using both "index: true" and 
"schema.index()". Please remove the duplicate index definition.
FAIL tests/transaction-rollback.test.js
  ÔùÅ Console

    console.log
      [Transaction] Started: CompleteReservation (attempt 1/3)

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:54:25)

    console.log
      [Transaction] Aborted: CompleteReservation

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:69:29)

    console.error
      [Transaction] Failed: CompleteReservation {
        error: 'barberiaId es requerido para el aislamiento de datos',
        attempt: 1,
        stack: 'Error: barberiaId es requerido para el aislamiento de datos\n' +
          '    at MongoReservaRepository.findById (C:\\Users\\Kristian\\Desktop\\
barber-saas\\backend\\src\\infrastructure\\database\\mongodb\\repositories\\Mongo
ReservaRepository.js:23:19)\n' +
          '    at findById (C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\\s
rc\\application\\use-cases\\reservas\\CompleteReserva.js:27:62)\n' +
          '    at Function.operation [as executeInTransaction] (C:\\Users\\Kristi
an\\Desktop\\barber-saas\\backend\\src\\utils\\TransactionManager.js:57:38)\n' +
          '    at processTicksAndRejections 
(node:internal/process/task_queues:105:5)\n' +
          '    at CompleteReserva.execute (C:\\Users\\Kristian\\Desktop\\barber-s
aas\\backend\\src\\application\\use-cases\\reservas\\CompleteReserva.js:24:24)\n'
 +
          '    at Object.<anonymous> (C:\\Users\\Kristian\\Desktop\\barber-saas\\
backend\\tests\\transaction-rollback.test.js:81:13)'
      }

    [0m [90m 80 |[39m
     [90m 81 |[39m                 [90m// Non-transient error or max retries 
reached[39m
    [31m[1m>[22m[39m[90m 82 |[39m                 
console[33m.[39merror([32m`[Transaction] Failed: 
${operationName}`[39m[33m,[39m {
     [90m    |[39m                         [31m[1m^[22m[39m
     [90m 83 |[39m                     error[33m:[39m 
error[33m.[39mmessage[33m,[39m
     [90m 84 |[39m                     attempt[33m:[39m attempt [33m+[39m 
[35m1[39m[33m,[39m
     [90m 85 |[39m                     stack[33m:[39m 
error[33m.[39mstack[0m

      at Function.error [as executeInTransaction] 
(src/utils/TransactionManager.js:82:25)
      at CompleteReserva.execute 
(src/application/use-cases/reservas/CompleteReserva.js:24:24)
      at Object.<anonymous> (tests/transaction-rollback.test.js:81:13)

    console.log
      [Transaction] Started: CompleteReservation (attempt 1/3)

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:54:25)

    console.log
      [Transaction] Aborted: CompleteReservation

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:69:29)

    console.error
      [Transaction] Failed: CompleteReservation {
        error: 'barberiaId es requerido para el aislamiento de datos',
        attempt: 1,
        stack: 'Error: barberiaId es requerido para el aislamiento de datos\n' +
          '    at MongoReservaRepository.findById (C:\\Users\\Kristian\\Desktop\\
barber-saas\\backend\\src\\infrastructure\\database\\mongodb\\repositories\\Mongo
ReservaRepository.js:23:19)\n' +
          '    at findById (C:\\Users\\Kristian\\Desktop\\barber-saas\\backend\\s
rc\\application\\use-cases\\reservas\\CompleteReserva.js:27:62)\n' +
          '    at Function.operation [as executeInTransaction] (C:\\Users\\Kristi
an\\Desktop\\barber-saas\\backend\\src\\utils\\TransactionManager.js:57:38)\n' +
          '    at processTicksAndRejections 
(node:internal/process/task_queues:105:5)\n' +
          '    at CompleteReserva.execute (C:\\Users\\Kristian\\Desktop\\barber-s
aas\\backend\\src\\application\\use-cases\\reservas\\CompleteReserva.js:24:24)\n'
 +
          '    at Object.<anonymous> (C:\\Users\\Kristian\\Desktop\\barber-saas\\
backend\\tests\\transaction-rollback.test.js:137:28)'
      }

    [0m [90m 80 |[39m
     [90m 81 |[39m                 [90m// Non-transient error or max retries 
reached[39m
    [31m[1m>[22m[39m[90m 82 |[39m                 
console[33m.[39merror([32m`[Transaction] Failed: 
${operationName}`[39m[33m,[39m {
     [90m    |[39m                         [31m[1m^[22m[39m
     [90m 83 |[39m                     error[33m:[39m 
error[33m.[39mmessage[33m,[39m
     [90m 84 |[39m                     attempt[33m:[39m attempt [33m+[39m 
[35m1[39m[33m,[39m
     [90m 85 |[39m                     stack[33m:[39m 
error[33m.[39mstack[0m

      at Function.error [as executeInTransaction] 
(src/utils/TransactionManager.js:82:25)
      at CompleteReserva.execute 
(src/application/use-cases/reservas/CompleteReserva.js:24:24)
      at Object.<anonymous> (tests/transaction-rollback.test.js:137:28)

  ÔùÅ Transaction Rollback Integration Tests ÔÇ║ CompleteReserva Transaction 
Rollback ÔÇ║ should rollback reservation update if client update fails

    expect(received).toBe(expected) // Object.is equality

    Expected: 0
    Received: undefined

    [0m [90m 90 |[39m             [90m// 6. Verify client visit count 
unchanged[39m
     [90m 91 |[39m             [36mconst[39m clienteAfter [33m=[39m 
[36mawait[39m 
[33mUserModel[39m[33m.[39mfindById(cliente[33m.[39m_id)[33m;[39m
    [31m[1m>[22m[39m[90m 92 |[39m             expect(clienteAfter[33m.[39
mhistorialVisitas)[33m.[39mtoBe([35m0[39m)[33m;[39m
     [90m    |[39m                                                   
[31m[1m^[22m[39m
     [90m 93 |[39m
     [90m 94 |[39m             [90m// Restore original method[39m
     [90m 95 |[39m             clienteRepository[33m.[39mupdate [33m=[39m 
originalUpdate[33m;[39m[0m

      at Object.toBe (tests/transaction-rollback.test.js:92:51)

  ÔùÅ Transaction Rollback Integration Tests ÔÇ║ CompleteReserva Transaction 
Rollback ÔÇ║ should commit both updates when successful

    TransactionError: Transaction failed for CompleteReservation: barberiaId es 
requerido para el aislamiento de datos

    [0m [90m 86 |[39m                 })[33m;[39m
     [90m 87 |[39m
    [31m[1m>[22m[39m[90m 88 |[39m                 [36mconst[39m 
transactionError [33m=[39m [36mnew[39m [33mTransactionError[39m(
     [90m    |[39m                                          
[31m[1m^[22m[39m
     [90m 89 |[39m                     [32m`Transaction failed for 
${operationName}: ${error.message}`[39m[33m,[39m
     [90m 90 |[39m                     error[33m,[39m
     [90m 91 |[39m                     { operationName[33m,[39m 
attempt[33m:[39m attempt [33m+[39m [35m1[39m }[0m

      at Function.executeInTransaction (src/utils/TransactionManager.js:88:42)
      at CompleteReserva.execute 
(src/application/use-cases/reservas/CompleteReserva.js:24:24)
      at Object.<anonymous> (tests/transaction-rollback.test.js:137:28)

(node:25200) [MONGOOSE] Warning: Duplicate schema index on {"reviewToken":1} 
found. This is often due to declaring an index using both "index: true" and 
"schema.index()". Please remove the duplicate index definition.
(node:25200) [MONGOOSE] Warning: Duplicate schema index on {"reviewToken":1} 
found. This is often due to declaring an index using both "index: true" and 
"schema.index()". Please remove the duplicate index definition.
[0mPOST /api/auth/login [33m400[0m 7.302 ms - 132[0m
[0mPOST /api/auth/register [33m400[0m 3.329 ms - 356[0m
[0mPOST /api/auth/login [31m500[0m 10033.642 ms - 467[0m
[0mPOST /api/reservas/barberos/invalid-id/reservar [33m400[0m 8.264 ms - 139[0m
[0mPOST /api/reservas/barberos/507f1f77bcf86cd799439011/reservar [33m400[0m 3.633 ms - 258[0m
[0mPOST /api/reservas/barberos/507f1f77bcf86cd799439011/reservar [33m400[0m 2.512 ms - 147[0m
[0mPOST /api/barberias/test-slug/admin/servicios [33m400[0m 3.587 ms - 135[0m
[0mPOST /api/barberias/test-slug/admin/servicios [33m400[0m 1.242 ms - 145[0m
[0mGET /api/reservas?barberoId%5B%24ne%5D [33m401[0m 0.302 ms - 27[0m
[0mPOST /api/auth/login [33m400[0m 1.068 ms - 157[0m
[0mPOST /api/reservas/barberos/507f1f77bcf86cd799439011/reservar [33m400[0m 1.236 ms - 149[0m
[0mPOST /api/reservas/barberos/507f1f77bcf86cd799439011/reservar [33m400[0m 1.912 ms - 149[0m
[0mPOST /api/auth/register [33m400[0m 3.617 ms - 606[0m
PASS tests/validation.test.js (12.058 s)
  ÔùÅ Console

    console.log
      [dotenv@17.2.3] injecting env (13) from .env -- tip: ƒôí add observability 
to secrets: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

    console.log
      ­ƒôí [POST] /api/auth/login

      at log (src/app.js:93:11)

    console.log
      ­ƒôí [POST] /api/auth/register

      at log (src/app.js:93:11)

    console.log
      ­ƒôí [POST] /api/auth/login

      at log (src/app.js:93:11)

    console.error
      ƒö┤ ERROR: MongooseError: Operation `users.findOne()` buffering timed out 
after 10000ms
          at Timeout.<anonymous> (C:\Users\Kristian\Desktop\barber-saas\backend\n
ode_modules\mongoose\lib\drivers\node-mongodb-native\collection.js:187:23)
          at listOnTimeout (node:internal/timers:588:17)
          at processTimers (node:internal/timers:523:7)

    [0m [90m 4 |[39m
     [90m 5 |[39m [36mconst[39m errorHandler [33m=[39m (err[33m,[39m 
req[33m,[39m res[33m,[39m next) [33m=>[39m {
    [31m[1m>[22m[39m[90m 6 |[39m   console[33m.[39merror([32m"ƒö┤ 
ERROR:"[39m[33m,[39m err)[33m;[39m
     [90m   |[39m           [31m[1m^[22m[39m
     [90m 7 |[39m
     [90m 8 |[39m   [90m// ­ƒöÑ A├æADIR HEADERS CORS SI NO EXISTEN[39m
     [90m 9 |[39m   [36mconst[39m origin [33m=[39m 
req[33m.[39mheaders[33m.[39morigin[33m;[39m[0m

      at error (src/config/middleware/errorHandler.js:6:11)
      at Layer.handleError (node_modules/router/lib/layer.js:116:17)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at Layer.handleError (node_modules/router/lib/layer.js:111:12)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at Immediate.next (node_modules/router/index.js:291:5)
      at Immediate._onImmediate (node_modules/router/index.js:688:15)

    console.log
      ­ƒôí [POST] /api/reservas/barberos/invalid-id/reservar

      at log (src/app.js:93:11)

    console.log
      ­ƒôí [POST] /api/reservas/barberos/507f1f77bcf86cd799439011/reservar

      at log (src/app.js:93:11)

    console.log
      ­ƒôí [POST] /api/reservas/barberos/507f1f77bcf86cd799439011/reservar

      at log (src/app.js:93:11)

    console.log
      ­ƒôí [POST] /api/barberias/test-slug/admin/servicios

      at log (src/app.js:93:11)

    console.log
      ­ƒôí [POST] /api/barberias/test-slug/admin/servicios

      at log (src/app.js:93:11)

    console.log
      ­ƒôí [GET] /api/reservas?barberoId%5B%24ne%5D

      at log (src/app.js:93:11)

    console.log
      ­ƒôí [POST] /api/auth/login

      at log (src/app.js:93:11)

    console.log
      ­ƒôí [POST] /api/reservas/barberos/507f1f77bcf86cd799439011/reservar

      at log (src/app.js:93:11)

    console.log
      ­ƒôí [POST] /api/reservas/barberos/507f1f77bcf86cd799439011/reservar

      at log (src/app.js:93:11)

    console.log
      ­ƒôí [POST] /api/auth/register

      at log (src/app.js:93:11)

PASS tests/transactions.test.js
  ÔùÅ Console

    console.log
      [Transaction] Started: TestSuccessfulTransaction (attempt 1/3)

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:54:25)

    console.log
      [Transaction] Committed: TestSuccessfulTransaction

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:61:25)

    console.log
      [Transaction] Started: TestRollback (attempt 1/3)

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:54:25)

    console.log
      [Transaction] Aborted: TestRollback

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:69:29)

    console.error
      [Transaction] Failed: TestRollback {
        error: 'Simulated error',
        attempt: 1,
        stack: 'Error: Simulated error\n' +
          '    at TransactionManager.executeInTransaction.operationName (C:\\User
s\\Kristian\\Desktop\\barber-saas\\backend\\tests\\transactions.test.js:36:31)\n'
 +
          '    at Function.operation [as executeInTransaction] (C:\\Users\\Kristi
an\\Desktop\\barber-saas\\backend\\src\\utils\\TransactionManager.js:57:38)\n' +
          '    at processTicksAndRejections 
(node:internal/process/task_queues:105:5)\n' +
          '    at Object.<anonymous> (C:\\Users\\Kristian\\Desktop\\barber-saas\\
backend\\tests\\transactions.test.js:33:13)'
      }

    [0m [90m 80 |[39m
     [90m 81 |[39m                 [90m// Non-transient error or max retries 
reached[39m
    [31m[1m>[22m[39m[90m 82 |[39m                 
console[33m.[39merror([32m`[Transaction] Failed: 
${operationName}`[39m[33m,[39m {
     [90m    |[39m                         [31m[1m^[22m[39m
     [90m 83 |[39m                     error[33m:[39m 
error[33m.[39mmessage[33m,[39m
     [90m 84 |[39m                     attempt[33m:[39m attempt [33m+[39m 
[35m1[39m[33m,[39m
     [90m 85 |[39m                     stack[33m:[39m 
error[33m.[39mstack[0m

      at Function.error [as executeInTransaction] 
(src/utils/TransactionManager.js:82:25)
      at Object.<anonymous> (tests/transactions.test.js:33:13)

    console.log
      [Transaction] Started: TestRetry (attempt 1/3)

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:54:25)

    console.log
      [Transaction] Aborted: TestRetry

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:69:29)

    console.warn
      [Transaction] Transient error, retrying in 200ms: WriteConflict

    [0m [90m 74 |[39m                     attempt[33m++[39m[33m;[39m
     [90m 75 |[39m                     [36mconst[39m delay [33m=[39m 
retryDelay [33m*[39m [33mMath[39m[33m.[39mpow([35m2[39m[33m,[39m 
attempt)[33m;[39m [90m// Exponential backoff[39m
    [31m[1m>[22m[39m[90m 76 |[39m                     
console[33m.[39mwarn([32m`[Transaction] Transient error, retrying in 
${delay}ms:`[39m[33m,[39m error[33m.[39mmessage)[33m;[39m
     [90m    |[39m                             [31m[1m^[22m[39m
     [90m 77 |[39m                     [36mawait[39m 
[36mthis[39m[33m.[39msleep(delay)[33m;[39m
     [90m 78 |[39m                     [36mcontinue[39m[33m;[39m
     [90m 79 |[39m                 }[0m

      at Function.warn [as executeInTransaction] 
(src/utils/TransactionManager.js:76:29)
      at Object.<anonymous> (tests/transactions.test.js:46:28)

    console.log
      [Transaction] Started: TestRetry (attempt 2/3)

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:54:25)

    console.log
      [Transaction] Committed: TestRetry

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:61:25)

    console.log
      [Transaction] Started: TestNoRetry (attempt 1/3)

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:54:25)

    console.log
      [Transaction] Aborted: TestNoRetry

      at Function.log [as executeInTransaction] 
(src/utils/TransactionManager.js:69:29)

    console.error
      [Transaction] Failed: TestNoRetry {
        error: 'Reserva no encontrada',
        attempt: 1,
        stack: 'Error: Reserva no encontrada\n' +
          '    at TransactionManager.executeInTransaction.operationName (C:\\User
s\\Kristian\\Desktop\\barber-saas\\backend\\tests\\transactions.test.js:71:31)\n'
 +
          '    at Function.operation [as executeInTransaction] (C:\\Users\\Kristi
an\\Desktop\\barber-saas\\backend\\src\\utils\\TransactionManager.js:57:38)\n' +
          '    at Object.<anonymous> (C:\\Users\\Kristian\\Desktop\\barber-saas\\
backend\\tests\\transactions.test.js:67:13)'
      }

    [0m [90m 80 |[39m
     [90m 81 |[39m                 [90m// Non-transient error or max retries 
reached[39m
    [31m[1m>[22m[39m[90m 82 |[39m                 
console[33m.[39merror([32m`[Transaction] Failed: 
${operationName}`[39m[33m,[39m {
     [90m    |[39m                         [31m[1m^[22m[39m
     [90m 83 |[39m                     error[33m:[39m 
error[33m.[39mmessage[33m,[39m
     [90m 84 |[39m                     attempt[33m:[39m attempt [33m+[39m 
[35m1[39m[33m,[39m
     [90m 85 |[39m                     stack[33m:[39m 
error[33m.[39mstack[0m

      at Function.error [as executeInTransaction] 
(src/utils/TransactionManager.js:82:25)
      at Object.<anonymous> (tests/transactions.test.js:67:13)

    console.log
      Ô£à MongoDB transactions are supported

      at Function.log [as validateTransactionSupport] 
(src/utils/TransactionManager.js:192:21)

PASS tests/revenue.test.js

Test Suites: 5 failed, 3 passed, 8 total
Tests:       18 failed, 56 passed, 74 total
Snapshots:   0 total
Time:        65.13 s
Ran all test suites.
